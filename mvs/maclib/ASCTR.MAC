.* MVS 3.8J PUBLIC DOMAIN
         MACRO
&NAME    ASCTR &ID=,&HIGHCTR=,&ROUTE=,&NEXTAS=
         GBLA  &IECPCSW(100),&IECPCTS,&IECPCTN,&IECPCTR,&IECCNTR
.*             IECPCTS  ID VALUE OF LAST ASCTR MACRO
.*             IECPCTN  TOTAL NUMBER OF PULSE COUNTERS DEFINED
         GBLA  &IECNXTA
.*             IECNXTA    NEXTAS VALUE TO BE CHECKED FOR
         GBLB  &IECSWW(2),&IECSW(9),&IECSEQ(10)
.*             IECSWW(1)  ON INDICATES NOT FIRST ASCTR MACRO
.*             IECSW(9) ON INDICATES PULSE COUNT
.*             IECSEQ(7)  SEQUENCE INDICATOR
         GBLB  &IECLNXT,&IECHISW
.*             IECHISW   ON INDICATES HIGHCTR=0 DISP ALREADY HANDLED
         LCLA  &A,&B,&C,&D,&E,&F,&G,&H
         LCLB  &NOCODE,&SWT(5)
.*             SWT(1)             ROUTE=CPU
.*             SWT(2)    ROUTE=DISK
.*             SWT(3)             ROUTE=LOG
.*             SWT(4)             ROUTE=ASLOG
.*             SWT(5)             ROUTE=EXTALRM
         LCLC  &CHAR
         ACTR  1000
         AIF   (&IECSWW(1)).SKIPONE
&IECSEQ(7) SETB 1
.SKIPONE AIF   (&IECSW(9)).SKIPTWO
         MNOTE 12,'ASCTR MACRO NOT VALID BECAUSE PC=YES NOT CODED IN   X
               CONFIGUR MACRO'
         MEXIT
.SKIPTWO AIF  (&IECSEQ(1) AND &IECSEQ(2) AND &IECSEQ(3) AND &IECSEQ(7) X
               AND NOT&IECSEQ(4) AND NOT&IECSEQ(5) AND NOT&IECSEQ(6)).S
&NOCODE  SETB  1
         MNOTE 12,'MACRO SEQUENCE ERROR'
.S       ANOP
         AIF   (T'&ID EQ 'N').IDOK
&CHAR    SETC  T'&ID
&NOCODE  SETB  1
         MNOTE 12,'REQUIRED OPERAND =ID TYPE ATTRIBUTE =&CHAR IMPROPER'
         AGO   .HICTR
.IDOK    ANOP
         AIF   (&ID EQ 0 AND NOT&IECSWW(1)).HICTR
         AIF   (&ID GT &IECPCTS AND &ID LE 99).HICTR
&NOCODE  SETB  1
         MNOTE 12,'ID IS NOT IN ALLOWED RANGE OR IS OUT OF SEQUENCE'
.HICTR   ANOP
         AIF   (T'&HIGHCTR EQ 'N').HICTOK
&CHAR    SETC  T'&HIGHCTR
&NOCODE  SETB  1
         MNOTE 12,'REQUIRED OPERAND=HIGHCTR TYPE ATTRIBUTE=&CHAR IS    X
               IMPROPER'
         AGO   .TOTCTR
.HICTOK  ANOP
         AIF   (&HIGHCTR GE 0 AND &HIGHCTR LE 63).TOTCTR
         MNOTE 12,'HIGHCTR OPERAND IS NOT IN ALLOWED RANGE OF 1 TO 63'
.TOTCTR  ANOP
         AIF   (&HIGHCTR NE 0).TOTCTR1
         AIF   (T'&NEXTAS NE 'O').TOTCTR2
&NOCODE  SETB  1
         MNOTE 12,'NEXTAS OPERAND MUST BE CODED IF HIGHCTR EQUAL 0'
         AGO   .TOTCTR1
.TOTCTR2 ANOP
         AIF   (&NEXTAS GE 0 AND &NEXTAS LE 99).TOTCTR3
&NOCODE  SETB  1
         MNOTE 12,'NEXTAS OPERAND HAS INVALID VALUE'
.TOTCTR3 ANOP
         AIF   (&NEXTAS EQ 0).TOTCTR1
         AIF   (&NEXTAS GT &ID).TOTCTR1
&NOCODE SETB  1
         MNOTE 12,'NEXTAS OPERAND MUST BE GREATER THAN ID,UNLESS 0'
.TOTCTR1 ANOP
         AIF   (&HIGHCTR EQ 0).TOTCTR4
         AIF   (&IECNXTA EQ 0).TOTCTR4
         AIF   (&ID EQ &IECNXTA).TOTCTR5
         MNOTE 12,'ID IS NOT EQUAL NEXTAS OF A PREVIOUS ASCTR MACRO    X
               WITH HIGHCTR=0'
.TOTCTR5 ANOP
&IECNXTA SETA  0
.TOTCTR4 ANOP
         AIF   (T'&ROUTE NE 'O').ROUTE1
&NOCODE  SETB  1
&CHAR    SETC  T'&ROUTE
         MNOTE 12,'ROUTE TYPE ATTRIBUTE = &CHAR IMPROPER'
.ROUTE1  ANOP
&A       SETA  &A+1
         AIF   ('&ROUTE(&A)' EQ 'DISK' OR '&ROUTE(&A)' EQ 'CPU' OR     X
               '&ROUTE(&A)' EQ 'LOG' OR '&ROUTE(&A)' EQ 'ASLOG').ANEXT
         AIF   ('&ROUTE(&A)' EQ 'EXTALRM').ANEXT
         AIF   (T'&ROUTE(&A) EQ 'O').ANEXT
         MNOTE 12,'ROUTE=&ROUTE(&A) INVALID'
&NOCODE  SETB  1
.ANEXT   AIF   (&A LT 4).ROUTE1
&A       SETA  0
         AIF   (&NOCODE).LAST
.ALAS    ANOP
&A       SETA  &A+1
         AIF   (&SWT(1)).NEXT1
&SWT(1)  SETB  ('&ROUTE(&A)' EQ 'CPU')
.NEXT1   AIF   (&SWT(2)).NEXT2
&SWT(2)  SETB  ('&ROUTE(&A)' EQ 'DISK')
.NEXT2   AIF   (&SWT(3)).NEXT3
&SWT(3)  SETB  ('&ROUTE(&A)' EQ 'LOG')
.NEXT3   AIF   (&SWT(4)).NEXT4
&SWT(4)  SETB  ('&ROUTE(&A)' EQ 'ASLOG')
.NEXT4   AIF   (&SWT(5)).NEXT5
&SWT(5)  SETB  ('&ROUTE(&A)' EQ 'EXTALRM')
.NEXT5   AIF   (&A NE 4).ALAS
         AIF   (&SWT(1) AND &SWT(2)).SAME
         AGO   .OK
.SAME    ANOP
&NOCODE  SETB  1
         MNOTE 12,'MUTUALLY EXCLUSIVE OPERANDS DISK AND CPU CODED'
.OK      ANOP
         AIF   (&SWT(1) OR &SWT(2) OR &SWT(3) OR &SWT(4) OR &SWT(5)).LAX
               ST
&NOCODE  SETB  1
         MNOTE 12,'ROUTE = &ROUTE INVALID'
.LAST    ANOP
         AIF   (&IECPCTN LE 1023).LAST1
&NOCODE  SETB  1
         MNOTE 12,'TOTAL NUMBER OF CTRS FOR ALL ASCTR MACROS EXCEEDS   X
               1023'
.LAST1   ANOP
         AIF   (&ID+1 LE &IECCNTR).LAST2
         MNOTE 12,'ID OPERAND IS HIGHER THAN HIGHEST AS MACRO ID'
&NOCODE  SETB  1
.LAST2   ANOP
         AIF   (NOT &NOCODE).GENCODE
         MNOTE 12,'TEXT GENERATION SUPPRESSED'
         AGO   .SET
.GENCODE ANOP
         AIF   (&IECSWW(1)).HA
         SPACE 1
         SPACE 1
*                     AREA STATION COUNTER TABLE
         SPACE 1
         SPACE 1
IECASCTB EQU   *
.HA       ANOP
&A       SETA  0
&B       SETA  &ID
&C       SETA  &IECPCTS
&D       SETA  &B-&C
         AIF   (&IECPCTS NE 0).WHY1
         AIF   (&IECSWW(1)).WHY1
         AGO   .WSSS
.WHY1    ANOP
         AIF   (NOT&IECSWW(1)).WHY
&C       SETA  &C+1
.WHY     ANOP
&D       SETA  &D-1
.WSSS    ANOP
         AIF   (&D EQ 0).NONSKIP
         AIF   (&HIGHCTR NE 0).SKIP1
         AIF   (&IECHISW).SKIP2
         AIF   (&NEXTAS EQ 0).SKIP3
&H       SETA  &NEXTAS-&IECPCTS-1
.SKIP6   ANOP
         AIF   (&IECPCTS NE 0).SKIP4
         AIF   (&IECSWW(1)).SKIP5
&H       SETA  &H+1
         AGO   .SKIP4
.SKIP5   ANOP
.SKIP4   ANOP
&H       SETA  (2*&H)+1
         DC    AL2(&H)
&IECHISW SETB  1
         AGO   .LOOP1
.SKIP3   ANOP
         DC    YL2((IECCTRGR-*)-1)
&IECHISW SETB  1
         AGO   .LOOP1
.SKIP2   ANOP
         DC    AL2(1)
         AGO   .LOOP1
.SKIP1   ANOP
&IECHISW SETB  0
&E       SETA  (2*&D)+1
         DC    AL2(&E)
.LOOP1   ANOP
         AIF   (&B LE 0).WRONG
&B       SETA  &B-1
&D       SETA  &B-&C
         AIF   (&D EQ 0).NONSKIP
         DC    AL2(1)
         AGO   .LOOP1
.WRONG   ANOP
         DC    AL2(1)
.NONSKIP ANOP
&F       SETA  0
         AIF   (NOT &SWT(1)).SET1
&F       SETA  4096
.SET1    AIF   (NOT &SWT(2)).SET2
&F       SETA  &F+8192
.SET2    AIF   (NOT &SWT(3)).SET3
&F       SETA  &F+16384
.SET3    AIF   (NOT &SWT(4)).SET4
         AIF   (&SWT(5)).SET4
&F       SETA  &F+32768
.SET4    AIF   (NOT &SWT(5)).SET5
&F       SETA  &F+34816
.SET5    ANOP
         AIF   (&HIGHCTR NE 0).NOBIT
&IECNXTA SETA  &NEXTAS
         AIF   (&IECHISW).NODISP
         AIF   (&NEXTAS NE 0).NODISP1
         DC    YL2((IECCTRGR-*)-1+&F)
&IECHISW SETB  1
         AGO   .NOBIT2
.NODISP1 ANOP
&H       SETA  &NEXTAS-&ID
&H       SETA  (2*&H)+&F+1
         DC    YL2(&H)
         AGO   .NOBIT2
.NODISP  ANOP
&F       SETA  &F+1
         AGO   .NOBIT1
.NOBIT   ANOP
&IECNXTA SETA  0
&G       SETA  2*&IECPCTN
&F       SETA  &F+&G
&IECHISW SETB  0
.NOBIT1  ANOP
         DC    AL2(&F)
.NOBIT2  ANOP
&IECPCTS SETA  &ID
&IECSWW(1) SETB 1
&A       SETA  &ID+1
&IECPCSW(&A) SETA &HIGHCTR
&A       SETA  &HIGHCTR
&IECPCTN SETA &IECPCTN+&A
.SET     ANOP
         MEND

