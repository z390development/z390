.* MVS 3.8J PUBLIC DOMAIN
         MACRO
&LABEL NETSOL  &SYSTEM=,&PRTCT=,&MESSAGE=IBMMSG,&ACQUIRE=YES,          *
               &NUMBER=10,&STRPCNL=YES,&TIME=5,&ABEND=YES
.*
.*A-000000-999999                                              @DL31HZZ
.*                                                              10SEP76
* /* START OF SPECIFICATIONS ****
*
*01*  MACRO-NAME = NETSOL
*
*01*  STATUS = RELEASE 1
*
*01*  CHANGE-ACTIVITY =NEW MACRO 1ST RELEASE    03 VS2
*                                               03 VS1
*                                               31 DOS
*                      APAR OZ09571                            @VS49571
*                      APAR OZ13672                            @ZA13672
*                      APAR OZ13651                            @ZA13651
*                      APAR OZ13667                            @ZA13667
*                      APAR OZ08423                            @ZA08423
*                      APAR OZ17038                            @ZA17038
*                      APAR OZ17870                            @ZA17870
*                      APAR OZ19510,OZ19517                    @ZA19510
*                      APAR OZ19857                            @ZA19857
*                      APAR OZ19859
*                      APAR OZ19873                            @ZA19873
*                      APAR OZ19916                            @ZA19916
*                      APAR OZ19918                            @ZA19918
*                      APAR OZ25474                            @ZA25474
*                      APAR OZ25713                            @ZA25713
*                      APAR OZ24909                            @ZA24909
*                      APAR OZ27711                            @ZA27711
*                      APAR OZ27846                            @ZA27846
*                      APAR OZ27740                            @ZA27740
*                      APAR OZ28552                            @ZA28552
*                      APAR OZ28912                            @ZA28912
*                      APAR OZ30101                            @ZA30101
*                      APAR OZ31003                            @ZA31003
*                      APAR OZ31146                            @ZA31146
*                      APAR OZ32168                            @ZA32168
*                      APAR OZ32003                            @ZA32003
*                      APAR OZ32289                            @ZA32289
*                      APAR OZ32555                            @ZA32555
*                      APAR OZ33578                            @ZA33578
*                      APAR OZ33715                            @ZA33715
*                      APAR OZ34078                            @ZA34078
*                      APAR OZ34716                            @ZA34716
*                      APAR OZ35374                            @ZA35374
*                      APAR OZ35053                            @ZA35053
*                      APAR OZ36882                            @ZA36882
*                      APAR OZ37625 - SYSROUTE OF OX23390      @ZA37625
*                      APAR OZ37922 - SYSROUTE OF OX23564      @ZA37922
*                      APAR OZ38609                            @ZA38609
*                      APAR OZ38438 WRONG REG USEDON CLSDST    @ZA38438
*                      APAR OZ39673 ABEND0C4 REG5 BAD SNOCCUR  @ZA39673
*                      APAR OZ42307 CLR RPLNIB BEFORE SOLICIT  @ZA42307
*                      APAR OZ43303 RPL0 IN USE ABENDU0005     @ZA43303
*                      APAR OZ44027 CORRECT DATE               @ZA44027
*                      APAR OZ44250 SYSROUTE OF DY22430        @ZA44250
*
*01*  DESCRIPTIVE-NAME = NETWORK SOLICITOR
*
*01*  FUNCTION = THE NETSOL MACRO EXPANDS TO FORM A VTAM APPLICATION
*    PROGRAM, DESIGNED TO OWN A NUMBER OF TERMINALS IN A VTAM NETWORK.
*    THE LOGON-TABLE FOR EACH OF THESE TERMINALS SPECIFIES THE NETWORK
*    SOLICITOR (HEREAFTER REFERRED TO AS NETSOL OR NS) AS THE
*    APPLICATION TO WHICH THE TERMINAL IS INITIALLY LOGGED ON.
*    NETWORK SOLICITOR INVITES EACH SUCH TERMINAL TO SUBMIT LOGON DATA
*    AND IDENTIFIES THE APPLICATION TO BE CONNECTED.
*    NETSOL INQUIRES FOR THE STATUS OF THIS APPLICATION, AND IF IT IS
*    ACTIVE PASSES THE TERMINALS TO IT.  OTHERWISE NETSOL OUTPUTS AN
*    ERROR MESSAGE TO THE TERMINAL INDICATING WHY THE APPLICATION IS
*    INACTIVE, AND REQUESTING  ALTERNATIVE LOGON DATA.  NETWORK
*    SOLICITOR RE-ACQUIRES A TERMINAL WHEN IT IS RELEASED, OR PASSED
*    TO NETWORK SOLICITOR BY ANOTHER APPLICATION.
*
*01*  NOTES = NONE
*
*02*    DEPENDENCIES = API INTERFACE , USER EXIT SCHEDULER
*
*02*    PERFORMANCE = NOT AVAILABLE
*
*02*    RESTRICTIONS = DEVICE SUPPORT LIMITED TO THE FOLLOWING:
*         2740  COMMUNICATIONS TERMINAL                        @DA04534
*         2741  COMMUNICATIONS TERMINAL                        @DA04534
*         1050  DATA COMMUNICATIONS SYSTEM                     @DA04534
*         TWX   AT&T TELETYPEWRITER TERMINAL                   @DA04534
*         WTTY  WORLD TRADE TELEGRAPH STATION                  @DA04534
*         115A  WESTERN UNION PLAN OUTSTATION                  @DA04534
*         1052  PRINTER-KEYBOARD                               @DA04534
*         1054  PAPER TAPE READER                              @DA04534
*         1056  CARD READER                                    @DA04534
*         1092  PR0GRAMMED KEYBOARD                            @DA04534
*         1093  PROGRAMMED KEYBOARD                            @DA04534
*         2770  DATA COMMUNICATION TERMINAL                    @DA04534
*         2780  DATA TRANSMISSION TERMINAL                     @DA04534
*         3735  PROGRAMMABLE BUFFERED TERMINAL (INQUIRY MODE ONLY)
*         3780  DATA TRANSMISSION TERMINAL                     @DA04534
*         SYS3  CPU                                            @DA04534
*         2980  GENERAL BANKING TERMINAL                       @DA04534
*         3277  DISPLAY STATION                                @DA04534
*         3275  DISPLAY STATION                                @DA04534
*         3741  DATA STATION                                   @DA04534
*         3747  DATA CONVERTER                                 @DA04534
*         2265  DISPLAY STATION                                @DA04534
*         2502  CARD READER                                    @DA04534
*         50    MAGNETIC DATA INSCRIBER                        @DA04534
*         1255  MAGNETIC CHARACTER READER                      @DA04534
*         5496  DATA RECORDER                                  @DA04534
*02*    REGISTER-CONVENTIONS = AS FOLLOWS
*
*                      R0 FOR PARAMETER PASSING
*                      R1 FOR PARAMETER PASSING
*                      R2-R4 WORK REGISTERS
*                      R5 RPL/WORK-AREA POINTER
*                      R6 WORK REGISTER
*                      R7 WORK REGISTER                        @VS49571
*                      R8 NIB POINTER                          @VS49571
*                      R9 WORK REGISTER                        @VS49571
*                      R10-R12 BASE REGISTERS                  @ZM32689
*                      R13 SAVE AREA POINTER
*                      R14 RETURN ADDRESS
*                      R15 WORK REGISTER + ENTRY ADDRESS + RETURN CODE
*
*02*    PATCH-LABEL = PATCH
*
*01*  MODULE-TYPE = MACRO
*                                                              @XL03HAJ
*02*    PROCESSOR = ASSEMBLER
*
*02*    PARAMETERS PASSED = AS FOLLOWS
*
*03*           LABEL    OPTIONAL. THE 8 OR FEWER CHARACTER LABEL ON
*                      THE NETSOL MACRO. IDENTIFIES THE NETWORK
*                      SOLICITOR AS AN APPLICATION. IF NOT SPECIFIED
*                      THE NAME 'NETSOL' IS USED.
*03*           SYSTEM   REQUIRED. 'DOS', 'VS1', OR 'VS2'. IDENTIFIES
*                      THE SYSTEM FOR WHICH THE NETWORK SOLICITOR IS
*                      TO BE GENERATED: DOS/VS, OS/VS1, OR OS/VS2.
*03*           PRTCT    OPTIONAL. AN 8 OR FEWER CHARACTER PASSWORD.
*                      IF SPECIFIED MUST AGREE WITH THE PASSWORD ON
*                      THE APPL STATEMENT FOR THE NETWORK SOLICITOR
*                      SET UP FOR THE NETWORK.
*03*           MESSAGE  OPTIONAL. AN 8 OR FEWER CHARACTER CSECT NAME.
*                      DEFAULT IS THE NAME OF AN IBM-SUPPLIED CSECT.
*                      IDENTIFIES CSECT CONTAINING TEXT OF ERROR
*                      MESSAGES SENT TO THE TERMINAL OPERATOR.
*03*           ACQUIRE  OPTIONAL. YES OR NO. DEFAULT IS YES. SPECIFIES
*                      WHETHER CODE IS TO BE INCLUDED IN NETSOL TO
*                      ALLOW OTHER APPLICATIONS TO ACQUIRE TERMINALS
*                      FROM NETSOL.
*03*           NUMBER  OPTIONAL.  A DECIMAL INTERGER GREATER THAN ONE
*                      AND LESS THAN 256.  THIS PARAMETER INDICATES
*                      HOW MANY RPL'S ARE TO BE GENERATED FOR  @VS49571
*                      NETSOL USE.                             @VS49571
*03*           STRPCNL OPTIONAL. YES OR NO. DEFAULT IS YES. SPECIFIES
*                      WHETHER CODE IS TO BE INCLUDED IN NETSOL TO
*                      STRIP ALL CONTROL INFORMATION FROM DATA PASSED
*                      TO NETSOL BEFORE PASSING DATA TO APPLICATION
*                      PROGRAM VIA CLSDST OPTCD=PASS           @ZA07805
*              TIME    OPTIONAL DEFAULT 5. SPECIFIES NUMBER OF @ZA25713
*                      MINUTES BETWEEN NETSOL INITIALIZATION   @ZA25713
*                      AND THE FIRST ISSUING OF ERASE/WRITE TO @ZA25713
*                      3270. PREVENTS OVERLOAD OF SYSTEM       @ZA25713
*                      RESOURCES.                              @ZA25713
*              ABEND   OPTIONAL. YES OR NO. DEFAULT IS YES.    @ZA32003
*                      SPECIFIES WHETHER CODE IS TO BE INCLUDED@ZA32203
*                      IN NETSOL TO ISSUE A MESSAGE OR ABEND   @ZA32003
*                      WITH A U0004 ON A SHOULD NOT OCCUR      @ZA32003
*                      SITURATION.                             @ZA32003
*
*      ALL THESE PARAMETERS CAUSE CONDITIONAL ASSEMBLY.
*
*02*    EXTERNAL-REFERENCES = NONE
*
*02*    ROUTINES = ERREXIT, WRITEMSG                           @XL03HAJ
*
*02*    DATA-SETS = NONE
*
*01*  TABLES = CHTAB, TABDEV, TRTAB1, MANY BRANCH TABLES TO HANDLE
*     ERROR CONDITIONS
*
*01*  INNER-MACROS = NONE
*
*
*01*  SYSTEM-MACROS = WAIT, POST, OPEN, SETLOGON, READ, CLOSE, OPNDST,
*                     SOLICIT, CHECK, INQUIRE, CHANGE, ISTNIB, ISTRPL,
*                     INTRPRET, CLSDST, WRITE, RESET.
*                                                              @VS49571
*01* DESCRIPTION OF ACTION CODES AND FLAGS                     @VS49571
*                                                              @VS49571
*                                                              @VS49571
*        THE ERREXIT ROUTINE COMMUNICATES TO THE ERROR EXIT NSI@VS49571
*        VIA AN ACTION CODE SET IN REG 15 AND, IN SOME CASES,  @VS49571
*        AN ACTION CODE MODIFIER SET IN REG 0. IN SOME SPECIAL @VS49571
*        CASES, FLAGS ARE SET TO PASS INFORMATION TOO.         @VS49571
*                                                              @VS49571
*        THE ACTION CODES AND MODIFIERS INDICATE APPROPRIATE   @VS49571
*        ACTIONS TO BE TAKEN BY THE EXIT ROUTINE. THE EXIT     @VS49571
*        ROUTINE MAY, HOWEVER, HANDLE THE ERROR ACTION         @VS49571
*        DIFFERENTLY FROM WHAT ERREXIT INDICATES BY ITS ACTION @VS49571
*        CODE, IF IT SO CHOOSES.                               @VS49571
*                                                              @VS49571
*        ACTION CODES AND MODIFIERS ARE AS FOLLOWS:            @VS49571
*                                                              @VS49571
*            00 MACRO COMPLETED SUCCESSFULLY                   @VS49571
*               REG 0 MODIFIER=0                               @VS49571
*                                                              @VS49571
*            04 THIS IS A SNO (SHOULD NOT OCCUR) WHICH WILL NOT@VS49571
*               BE SET BY THE ERROR EXIT. IF THIS IS SET AT    @VS49571
*               NSI, THE NETWORK SOLICITOR SHOULD ABNORMALLY   @VS49571
*               TERMINATE.                                     @VS49571
*                                                              @VS49571
*TORELES     08 BRANCH TO RELEASE                              @VS49571
*                                                              @VS49571
*TOWRITE     0C BRANCH TO WRITEMSG                             @VS49571
*               REG 0 MODIFIER=MESSAGE NUMBER PLUS X'80' IF    @VS49571
*                              RESET NEEDED                    @VS49571
*                                                              @VS49571
*REISSU      10 RESET AND/OR REISSUE THE REQUEST               @VS49571
*               REG 0 MODIFIER=0 REISSUE                       @VS49571
*RSETONLY                     =4 RESET                         @VS49571
*RESET1ST                     =8 RESET AND REISSUE             @VS49571
*                                                              @VS49571
*TOENDREQ    14 BRANCH TO FREERPL                              @VS49571
*                                                              @VS49571
*CATCHALL    18 TAKE ACTION ACCORDING TO MODIFIER              @VS49571
*TOSOLIC        REG 0 MODIFIER=0 SOLICIT                       @VS49571
*NOFLUSH                      =4 STOP FLUSHING I/O             @VS49571
*IGNORE                       =8 CHANGE 'GENED' STATUS FROM    @VS49571
*                                I/O TO INPUT ONLY             @VS49571
*                                                              @VS49571
*RSETSOL     1C BRANCH TO RESET THEN SOLICIT                   @VS49571
*                                                              @VS49571
*TOPROBDV    20 BRANCH TO PROBDEV                              @VS49571
*                                                              @VS49571
*    SINCE NETSOL DOES NOT ISSUE ALL API MACROS, NOT ALL       @VS49571
*    RTNCD CODES AND REASON CODES ARE POSSIBLE. THOSE          @VS49571
*    FDBK3 CODES WHICH CAN OCCUR FOR THE MACROS ISSUED ARE     @VS49571
*    LISTED WITHIN THE SUBSECTIONS OF ERREXIT FOR EACH         @VS49571
*    RTNCD CODE. THIS LIST INCLUDES ANY WHICH MAY BE           @VS49571
*    IMPOSSIBLE BECAUSE OF CURRENT NETSOL LOGIC.  THOSE WHICH  @VS49571
*    ARE POSSIBLE ARE INDICATED WITH AN '*'.  RECORD ONLY      @VS49571
*    CODES ARE NOT LISTED.                                     @VS49571
*                                                              @VS49571
*
**** END OF SPECIFICATIONS ***/
.*
.*    VERIFY THE SYNTAX OF THE NETSOL MACRO, AND APPLY DEFAULTS.
.*
         LCLA  &KPRTCT,&NUM,&TABCONT                           @VS49571
         LCLC  &AMSG,&APRTCT,&AACQ,&ALABEL
         LCLC  &MODDATE,&CTCOUNT,&ASTRIP,&AABEND               @ZA32003
.*                                                             @D31JKAJ
.*    TEST VALIDITY OF STRPCNL OPERAND  SHOULD BE 'YES',       @ZA07805
.*    OR 'NO' .                                                @ZA07805
&ASTRIP  SETC  'NO'                                            @ZA07805
         AIF   ('&STRPCNL' EQ 'NO').TSTSTP                     @ZA07805
&ASTRIP  SETC  'YES'                                           @ZA07805
         AIF   ('&STRPCNL' EQ 'YES').TSTSTP                    @ZA07805
         MNOTE 4,'STRPCNL OPERAND INVALID. DEFAULT OF ''YES'' ASSUMED'
.TSTSTP  ANOP                                                  @ZA07805
.*    TEST VALIDITY OF SYSTEM OPERAND.  SHOULD BE 'DOS',       @D31JKAJ
.*    'VS1', OR 'VS2'.                                         @D31JKAJ
.*                                                             @D31JKAJ
         AIF ('&SYSTEM' EQ 'DOS').SYSOK                        @D31JKAX
         AIF ('&SYSTEM' EQ 'VS1').SYSOK                        @D31JKAX
         AIF ('&SYSTEM' EQ 'VS2').SYSOK                        @D31JKAX
         MNOTE 8,'SYSTEM PARAMETER INCORRECT. SYSTEM = ''&SYSTEM'''
         MEXIT                                                 @D31JKAX
.SYSOK   ANOP                                                  @D31JKAX
.*
.*    TEST THE VALIDITY OF THE ACQUIRE OPERAND.  THIS SHOULD BE 'YES'
.*    OR 'NO'.
.*
.TSTACQ  ANOP
&AACQ    SETC  'NO'
         AIF   ('&ACQUIRE' EQ 'NO').TSTPRT
&AACQ    SETC  'YES'
         AIF   ('&ACQUIRE' EQ 'YES').TSTPRT
         MNOTE 4,'ACQUIRE OPERAND INVALID. DEFAULT OF ''YES'' ASSUMED.'
.*
.TSTPRT  ANOP
.*
.*    VERIFY THAT THE PRTCT OPERAND CONTAINS EIGHT OR FEWER CHARACTERS
.*
&APRTCT  SETC  '&PRTCT'
&KPRTCT  SETA  K'&PRTCT
         AIF   (K'&PRTCT LE 8).TSTMSG
&APRTCT  SETC  '&PRTCT'(1,8)           TRUNCATE
&KPRTCT  SETA  8                       SET MAXIMUM LENGTH ALLOWED
         MNOTE 4,'PRTCT OPERAND TOO LONG. TRUNCATED TO ''&APRTCT'''
.*
.TSTMSG  ANOP
.*
.*    VERIFY THAT THE MESSAGE-CSECT NAME SPECIFIED IS 8 OR FEWER
.*    CHARACTERS.  IF NOT, TRUNCATE IT.
.*
&AMSG    SETC  'MSGCSECT'              NAME OF STANDARD MSG CSECT
         AIF   ('&MESSAGE' EQ 'IBMMSG').TSTLABL SKIP NEXT TEST IF STD
&AMSG    SETC  '&MESSAGE'
         AIF   (K'&MESSAGE LE 8).TSTLABL
&AMSG    SETC  '&MESSAGE'(1,8)         TRUNCATE
         MNOTE 4,'MESSAGE OPERAND TOO LONG. TRUNCATED TO ''&AMSG'''
.*
.TSTLABL ANOP
.*
.*       VERIFY THAT THE NAME ON THE NETSOL MACRO IS 8 OR FEWER
.*       CHARACTERS.  IF NOT, TRUNCATE IT.
.*
&ALABEL  SETC  'NETSOL'                SET DEFAULT NAME
         AIF   ('&LABEL' EQ '').EXPAND SKIP FURTHER TESTS
&ALABEL  SETC  '&LABEL'
         AIF   (K'&LABEL LE 8).EXPAND  LABEL IS OK
&ALABEL  SETC  '&LABEL'(1,8)           TRUNCATE
         MNOTE 4,'NETSOL MACRO NAME TOO LONG. TRUNCATED TO ''&LABEL'''
.*
.EXPAND  ANOP                         PROCEED WITH EXPANSION.
         SPACE 3                                               @VS49571
.*                                                             @VS49571
.*       CHECK VALIDITY OF NUMBER PARAMETER                    @VS49571
.*                                                             @VS49571
         AIF   (T'&NUMBER EQ 'N').NUMBER                       @VS49571
.NUMBAD  MNOTE 4,'NUMBER MUST HAVE A DECIMAL VALUE BETWEEN 2 AND 255. 'X
               '10'' ASSUMED.'
&NUM     SETA  10                                              @VS49571
         AGO   .NUMOK                                          @VS49571
.NUMBER  ANOP                                                  @VS49571
&NUM     SETA  &NUMBER                                         @VS49571
         AIF   (&NUM    LT 2).NUMBAD                           @VS49571
         AIF   (&NUM    GT 255).NUMBAD                         @VS49571
.NUMOK   ANOP                                                  @VS49571
.************************************************************  @ZA32003
.*TEST FOR ABEND = YES OR NO                                *  @ZA32003
.************************************************************  @ZA32003
&AABEND  SETC  'NO'                                            @ZA32003
         AIF   ('&ABEND' EQ 'NO').ABNDOK                       @ZA32003
&AABEND  SETC  'YES'                                           @ZA32003
         AIF   ('&ABEND' EQ 'YES').ABNDOK                      @ZA32003
         MNOTE 4,'ABEND OPERAND INVALID. DEFAULT OF ''YES'' ASSUMED.'
.ABNDOK  ANOP                                                  @ZA32003
         SPACE 3                                               @VS49571
.**********************************************************************
.*                                                                    *
.*    SYNTAX CHECK OF NETSOL MACRO COMPLETE                           *
.*                                                                    *
.**********************************************************************
.*
.*
         TITLE 'NETSOL MACRO EXPANSION - MAIN LINE CODE'
         SPACE 2
***********************************************************************
*                                                                     *
*    THIS IS THE MAIN-LINE CODE FOR NETSOL.                           *
*    IT TERMINATES ONLY WHEN VTAM CLOSES DOWN, OR WHEN THE SYSTEM     *
*    OPERATOR CAUSES NETSOL TO BE TERMINATED.                         *
*                                                                     *
***********************************************************************
         SPACE 2
&ALABEL  CSECT
&MODDATE SETC  '&SYSDATE'                                      @ZA44027
         AIF ('&SYSTEM' NE 'DOS').NDOS1
.*
.*                                     DOS/VS ASSEMBLER DOES   @DM13746
.*                                      NOT SUPPORT SYSDATE    @DM13746
.*
***********************************************************************
*                                                                     *
*        NETSOL MAIN-LINE CODE INITIALIZATION                         *
*         DOS/VS SYSTEM DEPENDENT                              @D31JKAJ
*                                                                     *
***********************************************************************
         SPACE 2
START    EQU   *                                               @D31JKAJ
.NDOS1   AIF ('&SYSTEM' NE 'VS1').NVS11
***********************************************************************
*
*        NETSOL MAIN-LINE CODE INITIALIZATION                         *
*         OS/VS1 SYSTEM DEPENDENT                              @D31JKAJ
*                                                                     *
***********************************************************************
         SPACE 2
START    EQU   *
         BALR  15,0                    IN CASE OF DAR, R15 IS  @VS49571
         USING *,R15                    NOT SET CORRECTLY      @VS49571
         TS    DARFLAG                 TEST IF DAR REENTRY     @VS49571
         BZ    NODAR                   NO. USE STANDARD LINKAGE@VS49571
         LA    R15,X'FFF'              LOAD NONZERO COMP CODE  @VS49571
*                                       TO SHOW NETSOL TERM-   @VS49571
*                                       INATED ABNORMALLY.     @VS49571
         SVC   3                       RETURN TO VS1.          @VS49571
NODAR    EQU   *                                               @VS49571
         DROP  R15                                             @VS49571
.NVS11   AIF ('&SYSTEM' NE 'VS2').NVS21                        @D31JKAJ
***********************************************************************
*                                                              @D31JKAJ
*        NETSOL MAIN-LINE CODE INITIALIZATION                         *
*         OS/VS2 SYSTEM DEPENDENT                              @XM02030
*                                                                     *
***********************************************************************
         SPACE 2                                               @D31JKAJ
START    EQU   *                                               @D31JKAJ
         STM   R14,R12,12(R13)         SAVE REGISTERS          @D31JKAJ
.NVS21   ANOP                                                  @D31JKAJ
         BALR  R12,0                   LOAD 1ST BASE REGISTER  @XM02030
*                                                              @ZM32689
*        XXXXXXXXXX                                            @ZM32689
         USING *,R12                   TEMPORARY USING         @ZM32689
*        XXXXXXXXXX                                            @ZM32689
*                                                              @ZM32689
         L     R11,BASE2               LOAD 2ND BASE REGISTER  @ZM32689
         L     R10,BASE3               LOAD 3RD BASE REGISTER  @ZM32689
         L     R12,BASE1               LOAD REAL FIRST BASE    @VS49571
*                                                              @VS49571
*        XXXXXXXXXX                                            #XM02030
         USING START,R12,R11,R10       TELL ASSEMBLER          @ZM32689
*        XXXXXXXXXX                                            #XM02030
*                                                              #XM02030
         B     PRLOGEND                BRANCH AROUND IDENTIFER #XM02030
*                                                              #XM02030
         DC    AL1(16)                 LENGTH OF ID AND DATE   #XM02030
         DC    CL8'&ALABEL'            IDENTIFIER
         DC    C'&MODDATE'             DATE OF LAST UPDATE     @DM13746
MAINSAVE DS    18F                                             @VS49571
BASE2    DC    A(START+4096)           ADDR OF 2ND BASE REG    @ZM32689
BASE3    DC    A(START+8192)           ADDR OF 3RD BASE REG    @ZM32689
         AIF ('&SYSTEM' NE 'VS1').NVS11B                       #XM02030
DARFLAG  DC    X'00'                   SWITCH FOR DAR REENTRY  #XM02030
         DS    0H                                              #XM02030
.NVS11B  ANOP                                                  #XM02030
*                                                              #XM02030
PRLOGEND EQU   *                                               #XM02030
         AIF ('&SYSTEM' NE 'DOS').NDOS1A                       #XM02030
         LA    R13,MAINSAVE            ADDRESS OF SAVE AREA    #XM02030
.NDOS1A  AIF ('&SYSTEM' NE 'VS1').NVS11A                       #XM02030
         LA    R13,MAINSAVE            POINT R13 TO NS SAVE AREA
.NVS11A  AIF ('&SYSTEM' NE 'VS2').NVS21A                       #XM02030
         ST    R13,MAINSAVE+4          CHAIN SAVE AREAS        #XM02030
         LR    R15,R13                                         #XM02030
         LA    R13,MAINSAVE            POINT R13 TO NS SAVE AREA
         ST    R13,8(,R15)             FORWARD SAVE AREA CHAIN #XM02030
.NVS21A  ANOP                                                  #XM02030
*                                                              @VS49571
*        XXXXXXXXXX                                            @VS49571
         USING  IFGRPL,PTRRPL                                  @VS49571
         USING  ISTDNIB,PTRNIB                                 @VS49571
*        XXXXXXXXXXX                                           @VS49571
*                                                              @VS49571
OPENACB  EQU   *                                               #XL03HAJ
         SPACE 2                                               #XL03HAJ
         SR    R15,R15                 CLEAR RETURN-CODE REGISTER
*                                      BEFORE INVOKING OPEN
         SPACE 2                                               #XL03HAJ
*        OPEN  ACB                     CONNECT NETSOL TO VTAM
         SPACE 2                                               #XL03HAJ
         OPEN  ACB
         SPACE 2                                               #XL03HAJ
***                                                            #XL03HAJ
*  THE VALUES IN REG 15 ARE RETURN CODES AS SET BY VTAM.       #XL03HAJ
*   ERREXIT IS NOT ENTERED FOR OPEN ERROR.                     @XL03HAJ
***                                                            @XL03HAJ
         SPACE 2                                               @XL03HAJ
*        CHECK ACB ERROR FLAG FOR HALT                         @ZA05890
         CLI   ACB+X'31',X'52'         HALT IN PROGRESS ?      @ZA05890
         BNE   R15CHK                  NO. CONTINUE            @ZA05890
         SVC   3                                               @ZA05890
R15CHK   LTR   R15,R15                 SUCCESSFUL OPEN ?       @ZA05890
         BNZ   OPENFAIL                NO. BRANCH              @XL03HAJ
         EJECT                                                 @XL03HAJ
         SPACE 2
*        USE SETLRPL IN MAINLINE AND SYNCHRPL IN LOGON EXIT    @VS49571
         SPACE 2
         LA    PTRRPL,SETLRPL          POINT TO RPL FOR WORKARE@VS49571
         SPACE 2
SETLOGON EQU   *                                               @XL03HAJ
         SPACE 2
*     SETLOGON RPL=(PTRRPL),           SYNCH OPERATION. ACT-   @VS49571
*              OPTCD=START              IVATE LOGON EXIT.      @VS49571
*                                                              @VS49571
      SETLOGON RPL=(PTRRPL),           SYNCH OPERATION         @VS49571*
               OPTCD=START                                     @VS49571
         EJECT                                                 @VS49571
***                                                            @XL03HAJ
*  THE VALUES IN REG 15 ARE RETURN CODES AS SET BY VTAM.  IF   @XL03HAJ
*   ERREXIT WAS ENTERED, THE VTAM FEEDBACK CODE IN REG 0 WAS   @XL03HAJ
*   PLACED IN REG 15 BEFORE RETURNING TO THE MAINLINE NSI.     @XL03HAJ
*   ERREXIT DID NOT CHANGE THE RETURN CODES TO ACTION CODES.   @XL03HAJ
***                                                            @XL03HAJ
         SPACE 2                                               @XL03HAJ
         CH    R15,HEX8                NEED TO REISSUE?        @XL03HAJ
         BE    SETLOGON                YES.  DO IT             @XL03HAJ
         LTR   R15,R15                 SETLOGON ACCEPTED ?
         BNZ   SETLFAIL                NO, BRANCH
         LTR   R0,R0                   VALID COMPLETION?       @XL03HAJ
         BE    SETLOGOK                YES CONTINUE            @ZA27846
         OI    UFLAGS,SNOCCURM         INDICATE ERROR          @ZA27846
         B     SETLFAIL                TERMINATE NETSOL        @ZA27846
         SPACE 2                                               @ZA27846
SETLOGOK EQU   *                                               @ZA27846
         SPACE 2                                               @ZA27846
*
***                                                            @XL03HAJ
*        STIMER IS NECESSARY DURING IPL TIME BECAUSE           @ZA25713
*        NETSOL WILL WRITE TO EVERY 3270 TERMINAL IN HIS       @ZA25713
*        LOGON EXIT. FOR A LARGE NETWORK THIS WILL TAKE A      @ZA25713
*        PROHIBITIVE AMOUNT OF TIME.                           @ZA25713
***                                                            @XL03HAJ
*
         SR    R2,R2                                           @ZA25713
         LA    R3,&TIME                                        @ZA32555
         M     R2,TIMECONV               CONVERT MINUTES TO    @ZA25713
         ST    R3,IPLTIME               HUNDRETHS OF SECONDS   @ZA25713
*        STIMER REAL,IPLEXIT,BINTVL=IPLTIME                    @ZA25713
         STIMER REAL,IPLEXIT,BINTVL=IPLTIME
         B WAIT                                                @ZA25713
IPLEXIT  EQU   *                                               @ZA25713
         USING *,R15                                           @ZA25713
         STM   R14,R12,12(R13)                                 @ZA25713
         L     R12,BASE1                                       @ZA25713
         L     R11,BASE2                                       @ZA25713
         L     R10,BASE3                                       @ZA25713
         DROP  R15                                             @ZA25713
         USING START,R12                                       @ZA25713
         MVI   NOLOGWRT,X'00'                                  @ZA25713
         LM    R14,R12,12(R13)                                 @ZA25713
         BR    R14                                             @ZA25713
         EJECT                                                 @XL03HAJ
         SPACE 2
***                                                            @XL03HAJ
*    ALL FURTHER WORK IN NETSOL IS PERFORMED VIA ASYNCHRONOUS EXIT
*    ROUTINES. THE MAINLINE CODE WAITS UPON AN ECB WHICH IS POSTED
*    BY THE TPEND EXIT WHEN VTAM SHUTS DOWN NETSOL.          :       :
***                                                            @XL03HAJ
         SPACE 2
WAIT     EQU   *                                               @ZA25713
        AIF ('&SYSTEM' NE 'DOS').NDOS2                         @D31JKAX
.*
*        WAIT  FINISECB                     WAIT FOR VTAM END
         WAIT  FINISECB
.NDOS2   AIF ('&SYSTEM' NE 'VS1').NVS12                        @D31JKAX
.*
*        WAIT  ECB=FINISECB                 WAIT FOR VTAM END  @VS49571
         WAIT  ECB=FINISECB
.NVS12   AIF ('&SYSTEM' NE 'VS2').NVS22                        @D31JKAJ
.*                                                             @D31JKAJ
*        WAIT  ECB=FINISECB            WAIT FOR VTAM END       @VS49571
         WAIT  ECB=FINISECB                                    @D31JKAJ
.NVS22   ANOP                                                  @D31JKAJ
***                                                            @XL03HAJ
*    ACTION OF NETSOL NOW PROCEEDS BY USE OF EXIT ROUTINES.
*    THE FOLLOWING EXITS ARE SCHEDULED IN RESPONSE TO VTAM EVENTS:
*
*              TPEND   - VTAM SHUTS DOWN
*              LOGON   - A TERMINAL IS SIMULATED LOGGED ON TO NETSOL,
*                        OR IS PASSED TO NETSOL BY ANOTHER APPLICATION
*              LOSTERM - A TERMINAL CURRENTLY LOGGED ON TO NETSOL
*                        IS DISCONNECTED (DIAL-LINE), OR 'VARY'ED TO
*                        ANOTHER APPLICATION
*              RELREQ  - A TERMINAL CURRENTLY LOGGED ON TO NETSOL
*                        IS REQUESTED BY ANOTHER APPLICATION
*                                                              @VS49571
*     RPL EXITS -                                              @VS49571
*                                                              @VS49571
*              READEND - THE OUTSTANDING READ(ANY) HAS BEEN SATISFIED
*              PASSEND - CLSDST(PASS) HAS COMPLETED FOR A LOGON@VS49571
*                       REQUEST MADE FROM A TERMINAL.          @VS49571
*              WRITEND - END OF WRITE REQUEST.  WRITE WAS DUE  @VS49571
*                       TO INVALID LOGON FROM THE TERMINAL.    @VS49571
*              CDSTEND1 - CLSDST(RELEASE) COMPLETED.           @VS49571
*              RESETEND - RESET(UNCOND) COMPLETED.             @VS49571
***                                                            @XL03HAJ
         EJECT                                                 @VS49571
***                                                            @XL03HAJ
*        EXECUTION CONTINUES HERE WHEN ECB IS POSTED BY TPEND EXIT.
***                                                            @XL03HAJ
         SPACE 2
CLOSE    EQU   *                       BRANCH HERE FOR MAINLINE@ZA27846
*                                      'SHOULD NOT OCCUR'      @ZA27846
         SR    R15,R15                 ZERO RC REG FOR CLOSE   @VS49571
         SPACE 2
*        CLOSE ACB                     RELEASE CONNECTION WITH @VS49571
         SPACE 2
         CLOSE ACB                                             @VS49571
         EJECT                                                 @XL03HAJ
***                                                            @XL03HAJ
*  THE VALUES IN REG 15 ARE RETURN CODES AS SET BY VTAM.       @XL03HAJ
*   ERREXIT IS NOT ENTERED FOR CLSDSTERROR.                    @VS49571
***                                                            @XL03HAJ
         SPACE 2                                               @XL03HAJ
         LTR   R15,R15                 DID THE CLOSE GO?       @VS49571
         BZ    CLSOK                   YES, EXIT               @ZA19857
         CLI   ACB+X'31',X'42'         CLOSE COMPLETE?         @ZA19857
         BNE   CLOSFAIL                NO, GIVE UP             @ZA34078
*        WTO MF=(E,LISTWTO1)           INFORM OPERATER         @ZA19857
         WTO MF=(E,LISTWTO1)
         SPACE 2
         AIF ('&SYSTEM' NE 'DOS').NDOS3                        @D31JKAX
*    RETURN TO DOS/VS FROM NETSOL MAIN-LINE CODE
*                                      RCODE=0 ALREADY         @XM02031
         SPACE 2
*        EOJ                           ACTS AS A 'DETACH' WHEN RUNNING
*                                      AS A SUBTASK, BUT ENABLES NETSOL
*                                      TO RUN IN ITS OWN PARTITION IF
*                                      REQUIRED.
         EOJ
.NDOS3   AIF ('&SYSTEM' NE 'VS1').NVS13                        @D31JKAX
*    RETURN TO OS/VS1 FROM NETSOL MAIN-LINE CODE
         SPACE 2
         SR    R15,R15                 RCODE=0 FOR NORMAL RTN  @XM02031
         SPACE 2
         SVC   3                                               @VS49571
.NVS13   AIF ('&SYSTEM' NE 'VS2').NVS23                        @D31JKAX
*    RETURN TO OS/VS2 FROM NETSOL MAIN-LINE CODE               @D31JKAJ
         SPACE 2                                               @D31JKAJ
CLSOK    EQU   *                                               @ZA27846
         TM    UFLAGS,SNOCCURM          IF WE GOT HERE TO AB-  @ZA27846
*                                       NORMALLY TERMINATE,    @ZA27846
         BO    DUMP                     THEN DO IT.            @ZA27846
         L     R13,MAINSAVE+4           FIND INPUT SAVE AREA   @D31JKAJ
         SR    R14,R14                  CLEAR FORWARD SAVE     @D31JKAJ
         ST    R14,8(,R13)               AREA CHAIN PTR        @D31JKAJ
         LM    R14,R12,12(R13)          LOAD INPUT REGS        @D31JKAJ
         SR    R15,R15                 RCODE=0 FOR NORMAL RTN  @XM02031
         SPACE 2                                               @D31JKAJ
*        RETURN
         RETURN
.NVS23   ANOP                                                  @D31JKAX
         TITLE 'NETSOL CODE FOR ''SHOULD NOT OCCUR'' CONDITIONS'
         SPACE 2
***********************************************************************
*                                                                     *
*        THE FOLOWING CODE IS BRANCHED TO FROM THE MAIN-LINE CODE,    *
*        EXIT CODE, AND FROM THE ERREXIT ROUTINE.  THE ONLY ACTION    *
*        TAKEN SINCE THE CASES ARE 'SHOULD NOT OCCUR' CONDITIONS, IS  *
*        TO ABNORMALLY TERMINATE NETSOL WITH A REASON CODE IN         *
*        DUMPFLAG.                                                    *
*                                                                     *
***********************************************************************
         SPACE 2
OPENFAIL EQU   *                       OPEN-ACB IN MAIN-LINE FAILED
         STM   R0,R15,SNOREGS          REGS FOR DEBUGGING      @XL03HAJ
         MVI   DUMPFLAG,OPENCODE       SAVE NETSOL DUMP CODE   @VS49571
         B     DUMP                    BRANCH
         SPACE 2
SETLFAIL EQU   *                       SETLOGON IN MAIN-LINE FAILED
         OI    UFLAGS,SNOCCURM                                 @ZA27846
         STM   R0,R15,SNOREGS          REGS FOR DEBUGGING      @VS49571
         MVI   DUMPFLAG,SETLCODE       SAVE NETSOL DUMP CODE   @VS49571
         B     CLOSE                   BRANCH                  @ZA27846
         SPACE 2
CLOSFAIL EQU   *                                               @ZA27846
         STM   R0,R15,SNOREGS          REGS FOR DEBUGGING      @ZA27846
         OI    UFLAGS,SNOCCURM         FLAGS SNOCCUR CONDITION @ZA27846
         MVI   DUMPFLAG,CBLKCODE       DUMP CODE               @ZA27846
         B     DUMP                    BRANCH                  @ZA27846
         SPACE 2                                               @ZA27846
SNOCCUR  EQU   *                       REQUEST FAILED BECAUSE  @XL03HAJ
*                                       OF AN INVALID CONTROL  @XL03HAJ
*                                       BLOCK OR OTHER CON-    @XL03HAJ
*                                       DITION WHICH SHOULD    @XL03HAJ
*                                       NOT OCCUR              @XL03HAJ
         STM   R0,R15,SNOREGS          REGS FOR DEBUGGING      @ZA25474
*                                     REMOVED CLOSE MACRO      @ZA27846
         AIF   ('&ABEND' EQ 'YES').NMSG1                       @ZA32003
         LR    R5,R1                  LOAD REG5 FROM REG1 RPL  @za39673
         TM    MFLAGS2,ERRCON         SECOND TIME?             @ZA32003
         BO    DUMP1                  YES DUMP NETSOL          @ZA32003
         OI    MFLAGS2,ERRCON         TURN ON ERROR FLAG       @ZA32003
         MVC   TEMP1(1),RPLREQ        MOVE IN REQUEST TYPE     @ZA32003
         UNPK  TEMP2(3),TEMP1(2)      UNPACK                   @ZA32003
         TR    TEMP2(2),TRTBL-240     TRANSLATE                @ZA32003
         MVC   LISTWTO2+81(2),TEMP2   MOVE REQUEST TYPE TO MSG @ZA32003
         MVC   TEMP1(2),RPLFDBK       MOVE IN FEEDBACK CODE    @ZA32003
         UNPK  TEMP2(5),TEMP1(3)      UNPACK                   @ZA32003
         TR    TEMP2(4),TRTBL-240     TRANSLATE                @ZA32003
         MVC   LISTWTO2+97(4),TEMP2   MOVE FEEDBACK TO MSG     @ZA32003
         B     INQUIRC                BRANCH TO RELEASE TERM   @ZA32003
DUMP1    EQU   *                                               @ZA32003
.NMSG1   ANOP                                                  @ZA32003
         MVI   DUMPFLAG,CBLKCODE       SAVE NETSOL DUMP CODE   @VS49571
         OI    UFLAGS,SNOCCURM         INDICATE TERMINAL CONDIT@ZA27846
         OI    UFLAGS,SHUTDOWN         INFORM OTHER EXITS THAT @ZA27846
*                                      SHUTDOWN IS IN PROCESS  @ZA27846
         SPACE 2                                               @ZA27846
*        POST ECB THAT MAINLINE CODE IS WAITING ON             @ZA27846
*        POST  FINISECB                                        @ZA27846
         POST  FINISECB                                        @ZA27846
         SPACE 2                                               @XL03HAJ
         L     R14,RETVTAM@            RESTORE EXIT RETURN ADR@ZA27846
         BR    R14                     RETURN                  @ZA27846
         SPACE 2                                               @ZA27846
DUMP     EQU   *                       TERMINATE WITH A DUMP
         AIF ('&SYSTEM' NE 'DOS').NDOS4                        @D31JKAX
*        FIND END OF NETSOL FOR PDUMP END ADDRESS              @VS49571
         L     R8,VCONMSGS             POINT TO MESSAGE CSECT  @VS49571
         LA    R9,11                   THERE ARE 11 MESSAGES   @VS49571
         BCTR  R9,0                    LAST MESSAGE - 1        @VS49571
         SLL   R9,D2                   4*(LAST MESSAGE-1)      @VS49571
         AR    R9,R8                   POINTS TO TABLE ENTRY   @VS49571
         AH    R8,2(R9)      MSGCSECT@ + LAST MSG DISPLACEMENT @VS49571
         AH    R8,0(R9)      ADD LENGTH OF LAST MESSAGE        @VS49571
*        REG8 NOW POINTS TO THE END OF NETSOL                  @VS49571
*        DUMP AND CANCEL NETSOL, REASON CODE IN DUMPFLAG       @VS49571
*        PDUMP (R12),(R8)                                      @VS49571
         PDUMP (R12),(R8)                                      @VS49571
*        CANCEL                                                @DM09375
         CANCEL
.NDOS4   AIF ('&SYSTEM' NE 'VS1').NVS14                        @D31JKAX
*       TERMINATE NETSOL WITH DUMP, REASON CODE IS NOW IN DUMPFLAG
*
         SR    R1,R1                   PUT REASON CODE IN REG 1@VS49571
         IC    R1,DUMPFLAG                                     @VS49571
*
*        ABEND (1),DUMP
         ABEND (1),DUMP
.NVS14  AIF ('&SYSTEM' NE 'VS2').NVS24                         @D31JKAX
*       TERMINATE NETSOL WITH DUMP, REASON CODE IS NOW IN DUMPFLAG
*                                                              @D31JKAJ
         SR    R1,R1                   PUT REASON CODE IN REG 1@VS49571
         IC    R1,DUMPFLAG                                     @VS49571
*                                                              @D31JKAJ
*        ABEND (1),DUMP                                        @D31JKAJ
         ABEND (1),DUMP                                        @D31JKAJ
.NVS24  ANOP                                                   @D31JKAX
         TITLE 'TPEND - SHUT DOWN NETWORK SOLICITOR'
         SPACE 2
***********************************************************************
*                                                                     *
*    THIS EXIT ROUTINE IS SCHEDULED WHEN:                             *
*                                                                     *
*              * VTAM IS CLOSING DOWN                                 *
*                                                                     *
*              * OPERATOR ISSUED A HALT COMMAND                       *
*                                                                     *
*        ON ENTRY:                                                    *
*                                                                     *
*    REGISTER 1 POINTS AT A PARAMETER LIST CONTAINING THE FOLLOWING:  *
*                                                                     *
*              WORD 0 - ACB ADDRESS.                                  *
*              WORD 1 - REASON CODE FOR SHUTDOWN                      *
*                                                                     *
*        THIS PARAMETER LIST IS NOT USED BY NETSOL                    *
*                                                                     *
*    REGISTER 14 CONTAINS RETURN ADDRESS                              *
*                                                                     *
*    REGISTER 15 CONTAINS ENTRY ADDRESS                               *
*                                                                     *
***********************************************************************
         SPACE 2
TPEND    EQU   *
         SPACE 2
*                                                              @ZM32689
*        XXXXXXXXXX                                            @ZM32689
         DROP  R10                                             @ZM32689
         DROP  R11                     BASE REGS NOT SET UP    @DM09991
         DROP  R12                      YET                    @DM09991
         USING *,R15                   ESTABLISH INITIAL ADDRESSABILITY
*        XXXXXXXXXX                                            @ZM32689
*                                                              @ZM32689
         L     R12,BASE1               R12 IS BASE REGISTER    @DM09991
*                                                              @ZM32689
*        XXXXXXXXXX                                            @ZM32689
         DROP  R15
         USING START,R12,R11,R10       ALL BASE REGS SET       @ZM32689
*        XXXXXXXXXX                                            @ZM32689
*                                                              @ZM32689
         L     R11,BASE2               LOAD 2ND BASE REGISTER  @ZM32689
         L     R10,BASE3               LOAD 3RD BASE REGISTER  @ZM32689
         ST    R14,RETVTAM@            SAVE EXIT RETURN ADDRESS
         LA    R13,GENSAVE             POINT TO SAVE-AREA      @VS49571
         SPACE 2                                               @XL03HAJ
         OI    UFLAGS,SHUTDOWN         INFORM OTHER EXITS THAT @XL03HAJ
*                                       SHUTDOWN IS IN PROCESS @XL03HAJ
         SPACE 2
*        POST ECB THAT MAINLINE CODE IS WAITING ON
         SPACE 2
*        POST  FINISECB
         POST  FINISECB
.*
.*       NOTE THAT THE MACRO CALL ABOVE IS THE SAME FOR BOTH OS AND DOS
.*
         SPACE 2
         L     R14,RETVTAM@            RESTORE EXIT RETURN ADDRESS
         BR    R14                     RETURN
         TITLE 'LOGON - TERMINAL IS CONNECTED'
         SPACE 2
***********************************************************************
*                                                                     *
*    THIS EXIT ROUTINE IS SCHEDULED WHEN:                             *
*                                                                     *
*              * A TERMINAL IS LOGED ON VIA VARY TO NETSOL            *
*                                                                     *
*              * A TERMINAL IS RETURNED TO NETSOL BY AN APPLICATION.  *
*                                                                     *
*        ON ENTRY:                                                    *
*                                                                     *
*    REGISTER 1 POINTS AT A PARAMETER LIST CONTAINING THE FOLLOWING:  *
*                                                                     *
*              WORD 0 - ACB ADDRESS.                                  *
*              WORD 1 - POINTER TO SYMBOLIC TERMINAL NAME             *
*              WORD 2 - RESERVED                                      *
*              WORD 3 - LENGTH OF LOGON DATA.                         *
*                                                                     *
*                                                                     *
*    REGISTER 14 CONTAINS RETURN ADDRESS                              *
*                                                                     *
*    REGISTER 15 CONTAINS ENTRY ADDRESS                               *
*                                                                     *
***********************************************************************
         SPACE 2
LOGON    EQU   *
*                                                              @ZM32689
*        XXXXXXXXXX                                            @ZM32689
         DROP  R10                                             @ZM32689
         DROP  R11                     BASE REGS NOT SET UP    @DM09991
         DROP  R12                      YET                    @DM09991
         USING *,R15                   ESTABLISH INITIAL ADDRESSABILITY
*        XXXXXXXXXX                                            @ZM32689
*                                                              @ZM32689
         L     R12,BASE1               R12 IS BASE REGISTER    @DM09991
*                                                              @ZM32689
*        XXXXXXXXXX                                            @ZM32689
         DROP  R15
         USING START,R12,R11,R10       ALL BASE REGS SET       @ZM32689
*        XXXXXXXXXX                                            @ZM32689
*                                                              @ZM32689
         L     R11,BASE2               LOAD 2ND BASE REGISTER  @ZM32689
         L     R10,BASE3               LOAD 3RD BASE REGISTER  @ZM32689
         ST    R14,RETVTAM@            SAVE EXIT RETURN ADDRESS
         LA    R13,GENSAVE             POINT TO SAVE-AREA      @VS49571
         SPACE 2                                               @XL03HAJ
         TM    UFLAGS,SHUTDOWN         SHUTDOWN IN PROGRESS?   @VS49571
         BO    RETURN                  YES. NO MORE ACTION     @XL03HAJ
         SPACE 2                                               @XL03HAJ
************************************************************** @VS49571
*                                                            * @VS49571
*        SET UP POINTER TO THE SYN RPL AND CLEAN             * @VS49571
*        OUT THE WORK AREAS FOLLOWING IT.                    * @VS49571
*                                                            * @VS49571
************************************************************** @VS49571
         LA    PTRRPL,SYNCHRPL         PT TO RPL FOR THIS EXIT @VS49571
         MVI   SYNWORK,D0              MOVE IN ZEROS           @VS49571
         MVC   SYNWORK+1(WORKRPLA),SYNWORK WIPE OUT WORKAREA   @VS49571
         MVC   SYNWORK+WORKRPLA(WRPLREST),SYNWORK              @VS49571
*                                                              @VS49571
*                                                              @VS49571
         OI    FLAGS2,SYNCHIO          INDICATE USING A SYNCH RPL
         OI    EXITFLAG,LOGONEX        INDICATE IN LOGON EXIT  @VS49571
         SPACE 2                                               @VS49571
************************************************************** @VS49571
*                                                            * @VS49571
*       SET UP SYNCHNIB FIELDS                               * @VS49571
*                                                            * @VS49571
************************************************************** @VS49571
*                                                              @VS49571
         SPACE 2                                               @VS49571
         L     R4,D4(,R1)              GET PTR TO THE TERMINALS@VS49571
*                                       SYMBOLIC NAME          @VS49571
         LA    PTRNIB,SYNCHNIB         GET ADDR OF THE NIB     @VS49571
         MVC   NIBSYM(D8),D0(R4)       MOVE IN SYMBOLIC NAME   @VS49571
         EJECT                                                 @VS49571
***************************************************************@VS49571
*                                                              @VS49571
*        INQUIRE FOR DEVICE CHARACTERISTICS                    @VS49571
*                                                              @VS49571
***************************************************************@VS49571
         SPACE 2                                               @VS49571
INQUIREA EQU   *                                               @VS49571
         SPACE 1                                               @VS49571
         OI    MACFLAGS,INQDEVCH       INDICATE DOING INQUIRE  @VS49571
         OI    MFLAGS2,INQUIRE         INDICATE DOING INQUIRE  @VS49571
         SPACE 2                                               @VS49571
*      INQUIRE RPL=SYNCHRPL,                                   @VS49571
*              NIB=SYNCHNIB,                                   @VS49571
*              OPTCD=DEVCHAR,                                  @VS49571
*              AREA=INQDCHAR,                                  @VS49571
*              AREALEN=L'INQDCHAR                              @VS49571
       INQUIRE RPL=SYNCHRPL,                                   @VS49571*
               NIB=SYNCHNIB,                                   @VS49571*
               OPTCD=DEVCHAR,                                  @VS49571*
               AREA=INQDCHAR,                                  @VS49571*
               AREALEN=L'INQDCHAR                              @VS49571
         SPACE 2                                               @VS49571
         NI    MFLAGS2,FF-INQUIRE      INQUIRE DONE            @VS49571
         EJECT                                                 @VS49571
***                                                            @VS49571
*                                                              @VS49571
*  ERROR ACTIONS FOR INQUIRE(DEVCHAR)                          @VS49571
*                                                              @VS49571
*                                                              @XL03HAJ
*  ERROR ACTIONS FOR ALL API MACROS (NOT OPEN OR CLOSE, AND    @XL03HAJ
*  SOMETIMES NOT CHECK) ISSUED IN EXIT ROUTINES ARE EITHER     @XL03HAJ
*  INDICATED BY AN ACTION CODE IN R15 IF ERREXIT WAS ENTERED,  @XL03HAJ
*  OR BY A NON-ZERO FDBK2 CODE SET BY VTAM IN R0 WHICH         @VS49571
*  SUPPLEMENTS A RTNCD CODE OF ZERO (RETURN CODE IN THIS       @VS49571
*  CASE) SET IN R15.                                           @XL03HAJ
*                                                              @XL03HAJ
*  FOR A GENERAL DESCRIPTION OF ACTION CODES, SEE THE COMMENTS @XL03HAJ
*  AT THE BEGINNING OF 'ERREXIT'.                              @XL03HAJ
*                                                              @XL03HAJ
*  COMMENTS FOR EACH MACRO ERROR HANDLER INCLUDE ALL RTNCD     @VS49571
*  AND FDBK2 CODES WHICH CAN OCCUR FOR THE SPECIFIC MACRO      @VS49571
*  WITHIN THE LOGICAL FRAMEWORK OF NETSOL.  IMPOSSIBLE CON-    @XL03HAJ
*  DITIONS ARE NOT LISTED.                                     @XL03HAJ
*                                                              @XL03HAJ
*                                                   ACTION     @VS49571
*  RTNCD FDBK2                                      CODE(S)    @VS49571
*  CODE  CODE         MEANING                       RETURNED   @VS49571
*                                                   (R15 R0)   @VS49571
*   00    00    SUCCESSFUL COMPLETION                00  00    @VS49571
*   08    00    TEMP STORAGE ALLOCATION FAILURE      10  00    @VS49571
*   10    0A    APPARENT VTAM ERROR                  20  00    @ZA32289
*   10    0E    ABEND IN VTAM                        SNOCCUR   @VS49571
*                                                              @VS49571
***                                                            @VS49571
         SPACE 2                                               @VS49571
         CH    R15,HEX20               HIGHEST POSSIBLE ACTION @ZA32289
         BH    SNOCCUR                  CODE IS X'20'          @ZA32289
         B     ERRTABC(R15)            CHECK VALID ACTIONS     @VS49571
ERRTABC  B     R0CHKC               0  PROBABLY WORKED OK      @VS49571
         BAL   R7,SNOCCUR           4  INDICATES NO LERAD/SYNAD@VS49571
         BAL   R7,SNOCCUR           8                          @VS49571
         BAL   R7,SNOCCUR           C  CAN'T GET ERROR THAT    @VS49571
*                                       CAUSES ERR MESSAGE     @VS49571
         B     INQUIREA            10  REISSUE.  NO NEED TO    @VS49571
*                                       CHECK FOR RESET        @VS49571
         BAL   R7,SNOCCUR          14                          @ZA32289
         BAL   R7,SNOCCUR          18                          @ZA32289
         BAL   R7,SNOCCUR          1C                          @ZA32289
         B     PROBDEV             20 PROBLEM WITH DEVICE      @ZA32289
         SPACE 2                                               @VS49571
R0CHKC   EQU   *                                               @VS49571
         LTR   R0,R0                   INQUIRE AREA TOO SMALL? @VS49571
         BNZ   SNOCCUR                 YES, OR OTHER ERROR     @VS49571
*                                                              @VS49571
* * * * * * * * END OF INQUIRE ERROR HANDLING * * * * * * * *  @VS49571
         EJECT                                                 @VS49571
*                                                              @VS49571
*        CHARACTERISTICS OF DEVICE ARE NOW SET IN INQDCHAR     @VS49571
*        FIELD OF SYNCHRPL                                     @VS49571
*                                                              @VS49571
         SPACE 2                                               @VS49571
***************************************************************@VS49571
*                                                              @VS49571
*        CONVERT DEVICE CHARACTERISTICS INTO NETSOL DEVICE CODE@VS49571
*                                                              @VS49571
***************************************************************@VS49571
         SPACE 2                                               @VS49571
         LA    R1,INQDCHAR             SET UP ADDRESSABILITY   @VS49571
*        XXXXXXXXXXXXX                                         @VS49571
         USING ISTDVCHR,R1                                     @VS49571
*        XXXXXXXXXXXXX                                         @VS49571
         SPACE 2                                               @VS49571
         TM    DEVCHAR,DEVINPUT        IS DEVICE 'GENNED FOR   @VS49571
*                                       INPUT?                 @VS49571
         BNO   CLOSEOUT                NO. OUTPUT ONLY DEVICES @VS49571
*                                       ARE NOT SUPPORTED BY   @VS49571
*                                       NETSOL                 @VS49571
         LA    R3,NTABENT              GET NUMBER OF ENTRIES   @VS49571
*                                       IN TABDEV              @VS49571
         LA    R4,TABDEV               POINT TO TABDEV (FIRST  @VS49571
*                                       ENTRY)                 @VS49571
*                                                              @VS49571
*        XXXXXXXXXX                                            @VS49571
         USING TABENT,R4               AND TELL ASSEMBLER      @VS49571
*        XXXXXXXXXX                                            @VS49571
*                                                              @VS49571
CHECKDEV CLC   DEVTCODE,TABCHAR        SAME DEVICE TYPE ?      @VS49571
         BE    FOUNDDEV                YES, DEVICE SUPPORTED   @VS49571
         SPACE 2
         LA    R4,TABNEXT              POINT TO NEXT ENTRY     @VS49571
         BCT   R3,CHECKDEV             BRANCH TILL END OF TABL @VS49571
*                                       RELEASE IT             @VS49571
*        XXXXXXXXXXXX                                          @VS49571
         DROP R4                                               @VS49571
*        XXXXXXXXXXXX                                          @VS49571
         EJECT                                                 @VS49571
************************************************************** @VS49571
*                                                              @VS49571
*        RELEASE THE TERMINAL TO VTAM BECAUSE WE               @VS49571
*        CANNOT ACCESS IT CORRECTLY OR IT IS AN                @VS49571
*        INVALID TYPE.  THIS MACRO CAN BE SYNCHRONOUS          @VS49571
*        BECAUSE THERE IS NO I/O TO PURGE.                     @VS49571
*                                                              @VS49571
************************************************************** @VS49571
         SPACE 2                                               @VS49571
CLOSEOUT EQU   *                                               @VS49571
         OI    MACFLAGS,CLSREL         INDICATE CLSDST(RELEASE)@VS49571
         OI    MFLAGS2,CLSDST          INDICATE CLSDST(RELEASE)@VS49571
*        CLSDST RPL=SYNCHRPL,          NIB STILL HAS DEVICE    @VS49571
*              OPTCD=RELEASE,          NAME FROM INQUIRE       @VS49571
*              NIB=SYNCHNIB                                    @VS49571
         SPACE 2                                               @VS49571
         CLSDST RPL=SYNCHRPL,                                  @VS49571*
               OPTCD=RELEASE,                                  @VS49571*
               NIB=SYNCHNIB                                    @VS49571
         NI    MFLAGS2,FF-CLSDST       CLSDSTDONE              @ZA33715
         EJECT                                                 @VS49571
         SPACE 2                                               @VS49571
***                                                            @VS49571
*                                                              @VS49571
*  ERROR ACTIONS FOR CLSDST(RELEASE)                           @VS49571
*                                                              @VS49571
*                                                   ACTION     @VS49571
*  RTNCD FDBK2                                      CODE(S)    @VS49571
*  CODE  CODE         MEANING                       RETURNED   @VS49571
*                                                   (R15 R0)   @VS49571
*                                                              @VS49571
*   00    00    SUCCESSFUL COMPLETION                00  00    @VS49571
*   08    00    TEMP STORAGE ALLOCATION FAILURE      10  00    @XL03HAJ
*   0C    0B    REQUEST CANCELLED BY CLSDST          14  00    @VS49571
*   10    0A    APPARENT VTAM ERROR                  20  00    @ZA32289
*   10    0E    ABEND IN VTAM                        SNOCCUR   @XL03HAJ
*   14    53    TERMINAL NOT FOUND                   SNOCCUR   @VS49571
*   14    55    INVALID TERMINAL NAME                14  00    @VS49571
*   14    60    RESOURCE NOT CLOSABLE                14  00    @XL03HAJ
*                                                              @XL03HAJ
***                                                            @XL03HAJ
CLOSOUT1 EQU   *                                               @VS49571
         SPACE 2                                               @VS49571
         CH    R15,HEX20               HIGHEST POSSIBLE ACTION @V322891
         BH    SNOCCUR                  CODE IS X'20'          @ZA32289
         B     ERRTAB9C(R15)           CHECK VALID ACTIONS     @VS49571
ERRTAB9C B     R0CHK9C              0  PROBABLY RELEASED IT    @VS49571
         BAL   R7,SNOCCUR           4                          @VS49571
         BAL   R7,SNOCCUR           8  ALREADY RELEASING, NEW  @VS49571
*                                       RELEASE WON'T HELP     @VS49571
         BAL   R7,SNOCCUR           C  NO MSG TO WRITE AND     @VS49571
*                                       COULDN'T ANYWAY        @VS49571
         B     CLOSEOUT            10  REISSUE. NO RESET NEEDED@VS49571
         B     RETURN              14  THE NAME OF THE TERMINAL@VS49571
*                                       SUPPLIED BY VTAM WAS   @VS49571
*                                       INVALID.               @VS49571
         BAL   R7,SNOCCUR          18                          @ZA32289
         BAL   R7,SNOCCUR          1C                          @ZA32289
         B     PROBDEV             20  PROBLEM WITH DEVICE     @ZA32289
         SPACE 2                                               @XL03HAJ
R0CHK9C  EQU   *                                               @VS49571
         LTR   R0,R0                   VALID COMPLETION?       @VS49571
         BNZ   SNOCCUR                 ERROR IF NOT            @VS49571
*                                                              @VS49571
* * * * * * * * END OF CLSDST ERROR HANDLING * * * * * * * * * @XL03HAJ
*                                                              @XL03HAJ
*                                                              @VS49571
************** RETURN TO VTAM *****************                @VS49571
*                                                              @VS49571
         B     RETURN              RETURN TO VTAM              @VS49571
         EJECT                                                 @VS49571
************************************************************** @VS49571
*                                                              @VS49571
*        THE TERMINAL IS A VALID TERMINAL FOR THIS PROGRAM     @VS49571
*                                                              @VS49571
************************************************************** @VS49571
         SPACE 2                                               @VS49571
FOUNDDEV EQU   *                                               @VS49571
         MVC   NIBUSER(4),DCZEROS  INITIALIZE USER FIELD       @VS49571
         S     R4,TABDEV@          GET INDEX INTO THE TABLE    @VS49571
         STC   R4,NIBUSER          STORE THE INDEX FOR LATER USE
         TM    DEVCHAR,DEVOTPUT    IS TERMINAL ALSO OUTPUT     @VS49571
         BNO   INONLY              NO, BRANCH                  @VS49571
         OI    NIBUSER+D1,IODEV    INDICATE DEVICE IS INPUT AND@VS49571
*                                   OUTPUT                     @VS49571
INONLY   EQU   *                                               @VS49571
         SPACE 2                                               @VS49571
*        XXXXXXXXXXX                                           @VS49571
         DROP R1                                               @VS49571
*        XXXXXXXXXXX                                           @VS49571
         EJECT                                                 @VS49571
***********************************************************************
*                                                                     *
*    ISSUE AN OPNDST TO CONNECT NETSOL TO LOGGED-ON TERMINAL.         *
*                                                                     *
***********************************************************************
         SPACE 2                                               @XL03HAJ
OPENDST  EQU *                                                 @XL03HAJ
         SPACE 2
         OI    MACFLAGS,OPNSPEC    INDICATE DOING AN OPNDST(SP)@VS49571
         OI    MFLAGS,OPNDSPEC     INDICATE DOING AN OPNDST(SP)@VS49571
         SPACE 2                                               @VS49571
*       OPNDST RPL=SYNCHRPL,                                   @VS49571
*              OPTCD=(ACCEPT,SPEC,NQ),                         @ZA08423
*              NIB=SYNCHNIB                                    @VS49571
         SPACE 2                                               @VS49571
        OPNDST RPL=SYNCHRPL,                                   @VS49571*
               OPTCD=(ACCEPT,SPEC,NQ),                         @ZA08423*
               NIB=SYNCHNIB                                    @VS49571
         SPACE 2                                               @VS49571
         NI    MFLAGS,FF-OPNDSPEC  OPNDST(SPEC) COMPLETED      @VS49571
         EJECT                                                 @XL03HAJ
         SPACE 2                                               @XL03HAJ
***                                                            @XL03HAJ
*                                                              @XL03HAJ
*  ERROR ACTIONS FOR OPNDST(ACCEPT,SPEC)                       @VS49571
*                                                              @XL03HAJ
*                                                   ACTION     @VS49571
*  RTNCD FDBK2                                      CODE(S)    @VS49571
*  CODE  CODE         MEANING                       RETURNED   @VS49571
*                                                   (R15 R0)   @VS49571
*                                                              @XL03HAJ
*   00    00    SUCCESSFUL COMPLETION                00  00    @XL03HAJ
*   08    00    TEMP STORAGE ALLOCATION FAILURE      10  00    @XL03HAJ
*   0C    05    NCP ABEND, RESTART SUCCESSFUL        10  08    @VS49571
*   10    03    VTAM IS HALTING                      14  00    @XL03HAJ
*   10    05    PERMENENT FAILURE IN PATH            08  00    @VS49571
*   10    06    AUTO NETWORK SHUTDOWN                08  00    @VS49571
*   10    0A    APPARENT VTAM ERROR                  20  00    @ZA32289
*   10    0E    ABEND IN VTAM                        SNOCCUR   @XL03HAJ
*   14    53    TERMINAL NOT FOUND                   SNOCCUR   @VS49571
*   14    55    INVALID TERMINAL NAME                14  00    @VS49571
*                                                              @XL03HAJ
***                                                            @XL03HAJ
         SPACE 2                                               @XL03HAJ
         CH    R15,HEX20               HIGHEST VALID ACTION    @ZA32289
         BH    SNOCCUR                  CODE IS X'20'          @ZA32289
         SPACE 2                                               @XL03HAJ
         B     ERRTAB1(R15)            CHECK VALID ACTIONS     @XL03HAJ
ERRTAB1  B     R0CHK1               0  CHECK IF TERM ACCEPTED  @XL03HAJ
         BAL   R7,SNOCCUR           4                          @VS49571
         B     RETURN               8  CAN'T RELEASE IF CAN'T  @XL03HAJ
*                                       GET IT                 @XL03HAJ
         BAL   R7,SNOCCUR           C  CAN'T WRITE MSG IF NOT  @VS49571
*                                      CONNECTED               @XL03HAJ
         B     ERROPENA            10  REISSUE. CHECK FOR RESET@VS49571
         B     RETURN              14  CAN'T CONNECT DEVICE    @VS49571
         BAL   R7,SNOCCUR          18                          @ZA32289
         BAL   R7,SNOCCUR          1C                          @ZA32289
         B     PROBDEV             20  PROBLEM WITH DEVICE     @ZA32289
         SPACE 2                                               @XL03HAJ
ERROPENA EQU   *                                               @VS49571
         CH    R0,HEX8                 SHOULD WE DO A RESET    @VS49571
         BNE   OPENDST                 NO, GO REISSUE THE CMD. @VS49571
         LA    R9,OPENDST              GET RETURN ADDRESS FOR  @VS49571
*                                       AFTER THE RESET        @VS49571
         B     RESETSUB                DO A RESET              @VS49571
         SPACE 2                                               @VS49571
R0CHK1   EQU *                                                 @XL03HAJ
         CH    R0,HEX9                 TERM UNAVAILABLE        @ZA08423
         BE    RETURN                  RETURN IF SO            @ZA08423
         LTR   R0,R0                   SUCCESSFUL COMPLETION?  @XL03HAJ
         BNZ   SNOCCUR                 NO. ERROR               @XL03HAJ
*                                                              @XL03HAJ
* * * * * * * * END OF OPNDST ERROR HANDLING * * * * * * * * * @XL03HAJ
*                                                              @XL03HAJ
*                                      YES. FALL THROUGH TO    @XL03HAJ
*                                       SOLICIT THE DEVICE     @XL03HAJ
*                                       JUST CONNECTED.        @XL03HAJ
         SPACE 4                                               @XL03HAJ
***                                                            @XL03HAJ
*                                                              @XL03HAJ
*  CID OF DEVICE JUST OPNDST'ED IS NOW IN SYNCHRPL.            @VS49571
*                                                              @XL03HAJ
***                                                            @XL03HAJ
         LA    R8,SYNCHNIB             USERFIELD IS NOT PUT IN @ZA13651
*                                       RPL BY OPNDST.         @ZA13651
         CLI   NIBUSER,T3275           IF TERMINAL IS A 3270   @ZA13651
         BE    DEV3270                  THEN WRITE A MESSAGE   @ZA13651
         CLI   NIBUSER,T3277            ERASING THE SCREEN AND @ZA13651
         BNE   SOLICIT                  SAYING TERMINAL LOGGED @ZA13651
*                                       ON TO NETWORK SOLICITOR@ZA13651
*                                      THIS TEST IS DEPENDENT  @ZA13651
*                                       ON TABINDEX IN FIRST   @ZA13651
*                                       BYTE OF NIB USERFIELD  @ZA13651
DEV3270  EQU   *
         TM    DEVFLAGS,DEVFCCTL        CONNECTION SERVIVE REQ @ZA36882
         BZ    MLOC3270                 NO, MUST BE LOCAL,     @ZA36882
*                                       SKIP IPL TIME CHECK    @ZA36882
         TM    NOLOGWRT,X'FF'           IS IT IPL TIME?        @ZA25713
         BO    SOLICIT                  YES. DON'T WRITE       @ZA25713
MLOC3270 EQU   *                                               @ZA36882
         LA    R15,TWO                  YES. IT IS A 3270. TELL@ZA13651
         BAL   R14,GETRPL               CALLER IS LOGON EXIT   @ZA13651
*                                       FOR ERASE WRITE        @ZA13651
         LA    R0,MSG12                 WRITE LOGON MESSAGE    @ZA13651
         MVC   RPLARG(4),SYNARG         INITIALIZE CID         @ZA13651
         MVC   CID(4),SYNARG                                   @ZA13651
         MVC   USERWORD(4),NIBUSER      SET UP USERFIELD       @ZA13651
         SR    R3,R3                                           @ZA13651
         IC    R3,TABINDEX              GET INDEX INTO TABDEV  @ZA13651
         A     R3,TABDEV@               POINT TO CORRECT ENTRY @ZA13651
*                                        IN TABDEV             @ZA13651
         MVC   TABLINFO,D0(R3)          SAVE INFO IN RPL       @ZA13651
*                                        WORKAREA              @ZA13651
         OI    FLAGS2,LOGWRITE          FLAG WRITE FROM        @ZA13651
         B     WRITEMSG                  LOGON EXIT            @ZA13651
CONTLOGN EQU   *                                               @ZA13651
*        REGISTER FIVE NOW POINTS TO THE WRITE RPL.            @ZA13651
*        REGISTER FIVE IS NOT CHANGED AT ANY POINT IN THIS     @ZA13651
*         EXIT SO THAT THE FREERPL AT THE END OF THE EXIT      @ZA13651
*         WILL HAVE THE CORRECT RPL ADDRESS                    @ZA13651
         MVC   SYNARG(4),CID             RESTORE CID IN SYNCHRPL
         NI    SRPLEXT1,FF-RPLNIB        REINITIALIZE SYNCHRPL @ZA13651
         EJECT                                                 @XL03HAJ
         SPACE 2
***********************************************************************
*                                                                     *
*        SOLICIT THE TERMINAL FOR DATA.  WHEN DATA IS RECEIVED AN     *
*        OUTSTANDING READ-ANY WILL BE SATISFIED AND THE READEND       *
*        EXIT WILL BE SCHEDULED.                                      *
*                                                              @XL03HAJ
***********************************************************************
         SPACE 2
SOLICIT  EQU   *                                               @XL03HAJ
         SPACE 2                                               @XL03HAJ
         OI    MACFLAGS,SOLIC          INDICATE DOING SOLICIT  @VS49571
         OI    MFLAGS2,SOLICITS        INDICATE DOING SOLICIT  @VS49571
         NI    SRPLEXT1,FF-RPLNIB      CLEAR RPLNIB FLAG       @ZA42307
         SPACE 2                                               @VS49571
*      SOLICIT RPL=SYNCHRPL,                                   @VS49571
*              OPTCD=(SPEC,CA)                                 @XL03HAJ
         SPACE 2                                               @VS49571
       SOLICIT RPL=SYNCHRPL,                                   @VS49571*
               OPTCD=(SPEC,CA)                                 @XL03HAJ
         SPACE 2                                               @VS49571
         NI    MFLAGS2,FF-SOLICITS     SOLICIT DONE            @VS49571
         EJECT                                                 @XL03HAJ
***                                                            @XL03HAJ
*                                                              @XL03HAJ
*   NOTE: THE DEVICE HAS TO BE CONNECTED OR NETSOL WOULD NOT   @XL03HAJ
*   HAVE GOTTEN THIS FAR                                       @VS49571
*   AND I/O ERRORS WILL BE PICKED UP BY THE READEND            @VS49571
*   EXIT.                                                      @XL03HAJ
*                                                              @XL03HAJ
*                                                   ACTION     @VS49571
*  RTNCD FDBK2                                      CODE(S)    @VS49571
*  CODE  CODE         MEANING                       RETURNED   @VS49571
*                                                   (R15 R0)   @VS49571
*                                                              @XL03HAJ
*   00    00    SUCCESSFUL COMPLETION                00  00    @XL03HAJ
*   08    00    TEMP STORAGE ALLOCATION FAILURE      10  00    @XL03HAJ
*   10    0E    ABEND IN VTAM                        SNOCCUR   @XL03HAJ
*   14    12    CLSDST IN PROGRESS(CAN'T HAPPEN HERE)14  00    @VS49571
*   14    13    CID INVALID                          14  00    @VS49571
*   14    32    REQUEST INVALID FOR SPECIFIED DEVICE 08  00    @VS49571
*   14    5D    OPNDST INVALID (CAN'T HAPPEN HERE)   14  00    @VS49571
*                                                              @XL03HAJ
***                                                            @XL03HAJ
         SPACE 1                                               @XL03HAJ
         CH    R15,HEX20               IS IT GREATER THAN      @ZA19510
*                                      ALLOWABLE MAX.          @VS49571
         BH    SNOCCUR                 YES, TERMINATE NETSOL   @VS49571
         B     ERRSOLIC(R15)           BRANCH TO ERROR PROCESS @VS49571
ERRSOLIC EQU   *                                               @VS49571
         B     R0CHKSOL            0   SUCCESSFULLY COMPLETED  @VS49571
         BAL   R7,SNOCCUR          4                           @VS49571
         B     RELEASE             8   RELEASE THE DEVICE      @VS49571
         BAL   R7,SNOCCUR          C   NO MESSAGE POSSIBLE     @VS49571
         B     SOLICIT             10  TEMP STORAGE ALLOCATION @VS49571
*                                       FAILURE? RESOLICIT.    @VS49571
         B     CIDTEST             14  NOT POSSIBLE FOR THIS SO@ZA30101
         BAL   R7,SNOCCUR          18  SHOULD NOT OCCUR        @ZA19510
         BAL   R7,SNOCCUR          1C  SHOULD NOT OCCUR        @ZA19510
         B     PROBDEV             20  RELEASE THIS DEVICE     @ZA19510
         SPACE 1                                               @VS49571
CIDTEST  EQU   *                                               @ZA30101
         CLI   SYNFDB2,X'5D'          OPNDST FAIL              @ZA30101
         BE    SNOCCUR                SHOULD NOT OCCUR         @ZA30101
         TM    FLAGS2,LOGWRITE        ERASE WRITE?             @ZA33578
         BO    FREERPL                FREE THE RPL             @ZA30101
         B     SNOCCUR                SHOULD NOT OCCUR         @ZA30101
         SPACE 1                                               @ZA30101
R0CHKSOL EQU   *                                               @VS49571
         LTR   R0,R0                   SUCCESSFUL COMPLETION?  @XL03HAJ
         BNZ   SNOCCUR                 NO. ERROR               @XL03HAJ
*                                                              @XL03HAJ
* * * * * * * * END OF SOLICIT ERROR HANDLING * * * * * * * *  @XL03HAJ
*                                                              @XL03HAJ
         EJECT                                                 @VS49571
         SPACE 8                                               @VS49571
OKSOLICT EQU   *                       SOLICIT SKIPPED OR OK   @XM02032
         TM    FLAGS2,LOGWRITE     ISSUE A WRITE ?             @ZA13651
         BO    FREERPL             YES. HAVE AN RPL, FREE IT   @ZA13651
         TM    UFLAGS,NEEDREAD     IS READ FLAG ON (ALWAYS ON  @VS49571
*                                   DURING FIRST LOGON)        @VS49571
         BNO   RETURN              NO, BRANCH OUT TO VTAM      @VS49571
         LA    R15,TWELVE          INDICATE ENTRY IS FROM LOGON@VS49571
         BAL   R14,GETRPL          GET AN RPL FOR THE READ     @VS49571
         LTR   R5,R5               DID WE GET AN RPL           @VS49571
         BZ    RETURN              NO, FORGET ABOUT IT AND     @VS49571
*                                   READ WILL BE DONE LATER    @VS49571
         B     FREERPL             YES, FREERPL WILL DO THE READ
*                                                              @VS49571
         TITLE 'READEND - TERMINAL INPUT RECEIVED '
         SPACE 2
***********************************************************************
*                                                                     *
*    THIS EXIT ROUTINE IS SCHEDULED WHEN THE OUTSTANDING READ-ANY     *
*    COMPLETES.                                                       *
*                                                                     *
*        ON ENTRY:                                                    *
*                                                                     *
*    REGISTER 1 POINTS TO THE RPL USED FOR THE READ-ANY (IGFRPL)     *
*                                                              @XL03HAJ
*               THE CID FIELD OF THIS RPL HAS CID OF DEVICE    @VS49571
*                                                                     *
*    REGISTER 14 CONTAINS RETURN ADDRESS                              *
*                                                                     *
*    REGISTER 15 CONTAINS ENTRY ADDRESS                               *
*                                                                     *
***********************************************************************
         SPACE 2
READEND  EQU   *
         SPACE 2
*                                                              @ZM32689
*        XXXXXXXXXX                                            @ZM32689
         DROP  R10                                             @ZM32689
         DROP  R11                     BASE REGS NOT SET UP    @DM09991
         DROP  R12                      YET                    @DM09991
         USING *,R15                   ESTABLISH INITIAL ADDRESSABILITY
*        XXXXXXXXXX                                            @ZM32689
*                                                              @ZM32689
         L     R12,BASE1               R12 IS BASE REGISTER    @VS49571
*                                                              @ZM32689
*        XXXXXXXXXX                                            @ZM32689
         DROP  R15
         USING START,R12,R11,R10       ALL BASE REGS SET       @ZM32689
*        XXXXXXXXXX                                            @ZM32689
*                                                              @ZM32689
         L     R11,BASE2               LOAD 2ND BASE REGISTER  @ZM32689
         L     R10,BASE3               LOAD 3RD BASE REGISTER  @ZM32689
         ST    R14,RETVTAM@            SAVE EXIT RETURN ADDRESS
         LA    R13,GENSAVE             POINT TO SAVE-AREA      @VS49571
         SPACE 2                                               @XL03HAJ
         TM    UFLAGS,SHUTDOWN         SHUTDOWN IN PROGRESS?   @VS49571
         BO    RETURN                  YES. NO MORE ACTION     @VS49571
         EJECT                                                 @VS49571
*************************************************************  @VS49571
*                                                           *  @VS49571
*        ISSUE NEW READ IF POSSIBLE                         *  @VS49571
*                                                           *  @VS49571
*************************************************************  @VS49571
         SPACE 2                                               @VS49571
         LR    R7,R1                   SAVE INPUT RPL POINTER  @VS49571
         LA    R15,ZERO                SET READEND INDICATOR   @VS49571
         BAL   R14,GETRPL              GET ANOTHER RPL         @VS49571
*                                                              @VS49571
*                                                              @VS49571
************************************************************** @VS49571
*                                                              @VS49571
*        IF NO RPL IS RETURNED FROM GETRPL, GETRPL WILL        @VS49571
*        TURN ON THE NEEDREAD FLAG SO THE READ CAN BE ISSUED   @VS49571
*        BY FREERPL AS SOON AS AN RPL HAS BEEN FREED           @VS49571
*                                                              @VS49571
************************************************************** @VS49571
*                                                              @VS49571
*                                                              @VS49571
         LTR   R5,R5                   DO WE HAVE A RPL        @VS49571
         BZ    NORPLRED                NO, DO READ LATER       @VS49571
*                                                              @VS49571
         BAL   R14,READSUB             ISSUE A READ (ANY) TO   @VS49571
*                                       RE-ACTIVATE THE READEND@VS49571
*                                       EXIT. THIS ALLOWS      @VS49571
*                                       NETSOL TO HANDLE LOGONS@VS49571
*                                       FROM MORE THAN ONE     @VS49571
*                                       TERMINAL CONCURRENTLY. @VS49571
NORPLRED EQU   *                                               @VS49571
         LR    PTRRPL,R7               RESTORE THE INPUT RPL @ @VS49571
         LR    R1,R7                                           @VS49571
         OI    EXITFLAG,READEX         INDICATE IN READEND EXIT@VS49571
         EJECT
         SPACE 2                                               @XM09020
***********************************************************************
*                                                                     *
*        SAVE CID OF DEVICE FROM RPL ARG FIELD.                @VS49571
*                                                              @DA04534
*        SAVE RPL DATAFLG FIELD (FDBK). INFORMATION WITHIN IT  @VS49571
*        USED BY NETSOL IS:                                    @XM02032
*          RPLUINPT        UNSOLICITED DATA                    @VS49571
*          RPLEOT          END OF TRANSMISSION                 @VS49571
*                                                                     *
*        GET LENGTH OF RECORD READ. THIS WILL BE DECREMENTED   @DA04534
*        IF DEVICE CONTROL CHARACTERS ARE REMOVED BEFORE INTRPRET.    *
*                                                              @DA04534
*        GET THE DEVICE CONTROL CHARACTERS FROM TABDEV (VIA RPLUSFLD).
*                                                                     *
*        NOTE: INFO IN RPL MAY NOT BE VALID IF CHECK RETURNS   #XM09020
*              AN ERROR.                                       #XM09020
*                                                                     *
***********************************************************************
         SPACE 2
         MVC   CID(4),RPLARG           GET CID FROM RPL        @VS49571
         MVC   RDATAFLG(1),RPLFDB3     GET DATA FLAGS (FDBK)   @VS49571
         MVC   RECLEN(4),RPLRLEN       RECORD LENGTH           @VS49571
         SPACE 2                                               @VS49571
         MVC   USERWORD(4),RPLUSFLD    SAVE DEV INDEX AND FLAGS@VS49571
         SR    R3,R3                                           @VS49571
         IC    R3,TABINDEX             GET INDEX INTO TABDEV   @VS49571
         A     R3,TABDEV@              POINT TO CORRECT ENTRY  @VS49571
*                                       IN TABDEV              @VS49571
         MVC   TABLINFO,D0(R3)         SAVE THE INFO IN THE    @VS49571
*                                       RPL WORKAREA           @VS49571
         EJECT                                                 #XM09020
         SPACE 2                                               @DA04534
CHECK    EQU   *                                               #XL03HAJ
         OI    MFLAGS,READA            TELL ERREXIT THAT ERRORS@XL03HAJ
*                                       ARE FOR READ(ANY)      @XL03HAJ
         SPACE 2                                               @XL03HAJ
*        CHECK RPL=(PTRRPL)            CHECK FOR ERROR, ERREXIT@VS49571
*                                      IS ENTERED IF ERRORS HAVE
*                                      OCCURRED
         CHECK RPL=(PTRRPL)                                    @VS49571
         SPACE 4                                               @XL03HAJ
         NI    MFLAGS,X'FF'-READA      RESET READ INDICATOR    @XL03HAJ
         EJECT                                                 @VS49571
***                                                            @XL03HAJ
*                                                              @XL03HAJ
*  ERROR ACTIONS FOR CHECK OF READ (ANY)                       @VS49571
*                                                              @XL03HAJ
*                                                   ACTION     @VS49571
*  RTNCD FDBK2                                      CODE(S)    @VS49571
*  CODE  CODE         MEANING                       RETURNED   @VS49571
*                                                   (R15 R0)   @VS49571
*                                                              @XL03HAJ
*   00    00    SUCCESSFUL COMPLETION                00  00    @XL03HAJ
*   04    01    ATTENTION RECEIVED                   18  00    @VS49571
*   04    02    BISYNCH STATUS MSG RECEIVED          08  00    @DA04534
*                                                 OR 10  00    @DA04534
*                                                 OR 1C  00    @DA04534
*                                                 OR 20  00    @Z40GKD3
*   08    00    TEMP STORAGE ALLOCATION FAILURE      10  00    @XL03HAJ
*   0C    00    I/O ERROR.  DEVICE STILL USABLE      08  00    @DA04534
*                                                 OR 0C  81    @DA04534
*                                                 OR 10  00    @DA04534
*                                                 OR 1C  00    @DA04534
*                                                 OR 20  00    @Z40GKD3
*   0C    01    I/O ERROR.  DEVICE NOT USABLE        08  00    @XL03HAJ
*   0C    02    TEST REQUEST SET                     08  00    @XL03HAJ
*   0C    05    NCP ABENDED, RESTART SUCCESSFUL      10  08    @VS49571
*   0C    06    NCP ABEND.  LAST PURGE               10  08    @XL03HAJ
*   0C    0A    I/O RESET BY USER                    18  00    @VS49571
*   0C    0B    CANCELED BY CLSDST                   14  00    @VS49571
*   10    04    VTAM AND NCP INCOMPATABLE            20  00    @Z40GKD3
*   10    05    PERMANENT PATH FAILURE               08  00    @XL03HAJ
*   10    06    AUTO NETWORK SHUTDOWN                08  00    @XL03HAJ
*   10    08    DIAL DISCONNECT                      10  00    @VS49571
*                                                 OR 14  00    @VS49571
*   10    0B    DIAL-OUT DISCONNECT                  08  00    @XL03HAJ
*                                                 OR 0C  01    @XL03HAJ
*   10    0C    DIAL-IN DISCONNECT                   08  00    @XL03HAJ
*   14    12    CLSDST IN PROGRESS                   14  00    @VS49571
*   14    32    REQUEST INVALID FOR SPECIFIED DEVICE 08  00    @VS49571
*                                                              @XL03HAJ
***                                                            @XL03HAJ
         SPACE 2                                               @XL03HAJ
CHECKERS EQU   *                                               @DA04534
         CH    R15,HEX20               HIGHEST POSSIBLE ACTION @Z40GKD3
         BH    SNOCCUR                  CODE IS X'20'          @Z40GKD3
         B     ERRTAB2(R15)            CHECK VALID ACTIONS     @XL03HAJ
ERRTAB2  B     R0CHK2               0  VALID DATA FROM READ?   @XL03HAJ
         BAL   R7,SNOCCUR           4                          @VS49571
         B     RELEASE              8  CONNECTION TO DEVICE IS @XL03HAJ
*                                       KAPUT; MAKE IT OFFICIAL@XL03HAJ
*                                      MAYBE TEST REQUEST SET  @XL03HAJ
         B     WRITEMSG             C  I/0 ERROR.  TELL USER   @XL03HAJ
*                                      TO RESUBMIT DATA        @XL03HAJ
         B     RSETEST2            10  TEST FOR RESET OR       @XL03HAJ
*                                       REISSUE                @XL03HAJ
         B     FREERPL             14                          @VS49571
         B     RESOLCIT            18                          @XL03HAJ
         B     RESETSOL            1C  RESET THEN SOLICIT      @DA04534
         B     PROBDEV             20  I/O PROBLEM WITH DEVICE @Z40GKD3
         SPACE 4                                               @XL03HAJ
RSETEST2 EQU  *                                                @XL03HAJ
         LTR  R0,R0                    TEST FOR 0 AND SET UP   @XL03HAJ
*                                       FOR BRANCH INDEX AFTER @XL03HAJ
*                                       A POSSIBLE RESET       @XL03HAJ
         BZ    RESOLCIT             0  REISSUE MEANS FOR THE   @XL03HAJ
*                                       SOLICIT AND READ,      @XL03HAJ
*                                       NOT THE CHECK          @XL03HAJ
RESETRA  EQU   *                   NOT ZERO, THEREFORE IT IS 8 @VS49571
         B     RESETSOL             8  RESET AND REISSUE SOLIC @VS49571
R0CHK2   EQU   *                                               @VS49571
         LTR   R0,R0                                           @VS49571
         BNZ   SNOCCUR             SHOULD NOT OCCUR            @VS49571
*                                                              @XL03HAJ
* * * * * * * * END OF READ(ANY) ERROR HANDLING * * * * * * *  @VS49571
*                                                              @XL03HAJ
         EJECT                                                 @VS49571
         LA    R6,IOAREA               POINT TO DATA RECEIVED  @VS49571
         L     R2,RECLEN               GET DATA LENGTH
         AIF   ('&ASTRIP' EQ 'YES').STRIP1
         STC   R2,STRIPLEN             SAVE LENGTH INCLUDING   @ZA07805
*                                      CONTROL CHARACTERS      @ZA07805
         MVC   NOSTRIPA(80),0(R6)      SAVE DATA WITH CONTROL  @ZA07805
.STRIP1  ANOP
         LTR   R2,R2                   RECEIVE ANY DATA?       @XM09031
*                                      IN CASE NO DATA RECEIVED@ZA13667
*                                       RESOLICIT THE TERMINAL @ZA13667
         BZ    RESOLCIT                                        @ZA13667
         LA    R3,L'IOAREA             COMPARE THE RECLEN WITH @VS49571
         CR    R2,R3                    THE READ BUFFER LENGTH.@DM14113
         BNH   WHATDEV                 BUFFER LENGTH GREATER   @DM14113
*                                       THAN INPUT RECORD.     @DM14113
         LR    R2,R3                   ONLY THE FIRST 80 BYTES @VS49571
*                                       WILL BE READ IN.       @DM14113
         SPACE 2                                               @DA04534
***********************************************************************
*                                                              @DA04534
*  EACH OF SEVERAL DEVICES MAY HAVE DEVICE CONTROL CHARACTERS  @DA04534
*  AS PART OF THE INPUT STREAM.  THESE MUST BE STRIPPED OFF IN @DA04534
*  ORDER THAT THE INTRPRET WORK CORRECTLY.  FOR MOST DEVICES   @DA04534
*  SUPPORTED BY NETSOL, THE CONTROL CHARACTERS HAVE HEX VALUES @DA04534
*  FROM 00 TO 49, AND THERE ARE NO VALID DATA CHARACTERS       @DA04534
*  WITHIN THAT RANGE.  THE DEVICE CONTROL CHARACTERS FOR THESE @DA04534
*  DEVICES ARE STRIPPED BY A COMMON 'CCSTRIP' ROUTINE.  OTHER  @DA04534
*  DEVICES MUST BE HANDLED DIFFERENTLY.  THOSE DEVICES WHICH   @DA04534
*  DO NOT USE THE COMMON STRIPPING ROUTINE ARE AS FOLLOWS:     @DA04534
*                                                              @DA04534
*     SYS3          3277          3735                         @DA04534
*     3741          3275                                       @DA04534
*     3747                                                     @DA04534
*                                                              @DA04534
***********************************************************************
*                                                              @DA04534
*                                                              @DA04534
WHATDEV  EQU   *                                               @DA04534
         CLI   TYPECODE,DEV3277        IF THE DEVICE IS A 3277 @DA04534
         BE    TYPE3270                 OR A 3275, STRIP       @DA04534
         CLI   TYPECODE,DEV3275         DEVICE CONTROL CHARS   @DA04534
         BE    TYPE3270                 AS 3270 DEVICES        @DA04534
         CLI   TYPECODE,DEV3735        IS DEVICE 3735?         @DA04534
         BE    TYPE3735                YES. HANDLE SEPARATELY  @DA04534
         CLI   TYPECODE,DEVSYS3        SYS3 CPU?               @DA04534
         BE    INTRPRET                YES. NO STRIP NEEDED    @DA04534
         CLI   TYPECODE,DEV3741        3741?                   @DA04534
         BE    INTRPRET                YES. NO STRIP NEEDED    @DA04534
         CLI   TYPECODE,DEV3747        3747?                   @DA04534
         BE    INTRPRET                YES. NO STRIP NEEDED    @DA04534
         B     CCSTRIP                 FOR ALL OTHERS, USE THE @DA04534
*                                       COMMON STRIPPING       @DA04534
*                                       ROUTINE                @DA04534
         EJECT
         SPACE 2
***********************************************************************
*                                                                     *
*        DEVICE IS 3270.  CHECK FOR 'CLEAR' KEY DEPRESSED.  IF IT IS  *
*        THE TERMINAL USER WILL BE PROBABLY ALREADY KEYING IN DATA.   *
*        DO NOT RESET THE TERMINAL BEFORE SOLICITING THE       @XL03HAJ
*        DATA WHICH HAS ALREADY BEEN ENTERED.                  @XL03HAJ
*                                                              @DA04534
*    INPUT: R2 = NON-ZERO LOGON SEQUENCE LENGTH                @DA04534
*           R6 = ADDRESS OF 'IOAREA' (LOGON SEQUENCE)        @DA04534
*                                                                     *
***********************************************************************
         SPACE 2
TYPE3270 EQU   *                                               @DA04534
         CLI   0(R6),CLEARKEY          IS IT 'CLEAR' KEY ?
         BNE   CHECKPF                 NO. CHECK FURTHER       @XL03HAJ
         LA    R0,MSG12                YES. WRITE MSG          @ZA44250
         B     WRITEMSG                WRITE GOOD MORNING MSG  @ZA44250
         SPACE 2
***********************************************************************
*                                                                     *
*        NOT 'CLEAR' KEY, CHECK FOR OTHER FUNCTION KEY DEPRESS.  IF   *
*        IT IS A FUNCTION KEY THE DATA WILL BE PASSED DIRECTLY TO     *
*        INTERPRET, OTHERWISE THE DATA POINTER WILL BE UPDATED TO     *
*        SKIP THE 3270 DEVICE CONTROL SEQUENCE.                       *
*                                                                     *
***********************************************************************
         SPACE 2
CHECKPF  EQU   *                                               @XL03HAJ
         SPACE 2                                               @XL03HAJ
         CLI   0(R6),PF10              TEST
         BL    CHECKPA                   FOR
         CLI   0(R6),PF12                  VALID
         BNH   INTRPRET                      PROGRAM
         CLI   0(R6),PF01                      FUNCTION
         BL    REMOVE                            KEY
         CLI   0(R6),PF09                          DEPRESS
         BNH   INTRPRET                              .
         B     REMOVE                                  .
         SPACE 2
CHECKPA  EQU   *
         SPACE 2
         CLI   0(R6),PA1               TEST
         BE    INTRPRET                  FOR
         CLI   0(R6),PA2                   VALID
         BE    INTRPRET                      PROGRAM
         CLI   0(R6),PA3                       ACCESS
         BE    INTRPRET                          KEY DEPRESS
         SPACE 2
*    LOGON DATA IS ALPHANUMERIC STRING.
         SPACE 2
REMOVE   EQU   *
         LA    R1,LCTLSEQ              GET LENGTH OF DEVICE CONTROL
*                                      SEQUENCE FOR 3270
         AR    R6,R1                   SKIP DEVICE CONTROL SEQUENCE
         SR    R2,R1                   ADJUST DATA LENGTH
         BNP   BADSEQNC                BRANCH IF NO MORE DATA  @DM07616
         SPACE 2
         CLI   0(R6),SBA               SBA FIELD ?             @DM07616
         BNE   CCSTRIP                 NO, BRANCH              @ZA27846
         SPACE 2
         AR    R6,R1                   YES, ADJUST AGAIN
         SR    R2,R1                   AND AGAIN
         BP    CCSTRIP                 READY FOR INTRPRET IF   @ZA27846
*                                       MORE DATA              @DM07616
         SPACE 2
BADSEQNC EQU   *                       INVALID 3270 LOGON SEQ  @DM07616
*                                      MUST HAVE BEEN AID      @DA04534
*                                       CHARACTER              @DA04534
         LA    R0,MSG02                AID CHARACTERS OTHER    @DA04534
         B     WRITEMSG                 THAN PA, PF, AND CLEAR @DA04534
*                                       ARE INVALID INPUT      @DA04534
         EJECT                                                 @DA04534
         SPACE 2                                               @DA04534
************************************************************** @DA04534
*                                                              @DA04534
*    THE DEVICE IS A 3735 PROGRAMMABLE BUFFERED TERMINAL.  THE @DA04534
*    DEVICE CONTROL CHARACTERS TO BE STRIPPED FROM THE INPUT   @DA04534
*    CHARACTER STRING CONSIST OF THREE CHARACTERS: TWO NULS    @DA04534
*    (X'00') WITH A LETTER OR OTHER GRAPHIC BETWEEN THEM.      @DA04534
*    3735 CONTROL CHARACTERS ALWAYS LEAD THE INPUT STRING.  IN @DA04534
*    THE NORMAL CASE THE LETTER IN BETWEEN IS C'I'.  RATHER    @DA04534
*    THAN CHECK FOR A VALID CHARACTER BETWEEN THE NULS, NETSOL @DA04534
*    SIMPLY CHECKS FOR TWO NULS WITH ONE BYTE IN BETWEEN.  ANY @DA04534
*    SUCH COMBINATION IS STRIPPED FROM THE INPUT STRING.       @DA04534
*                                                              @DA04534
*    INPUT: R2 = NON-ZERO LOGON SEQUENCE LENGTH                @DA04534
*           R6 = ADDRESS OF 'IOAREA' (LOGON SEQUENCE)          @VS49571
*                                                              @DA04534
************************************************************** @DA04534
*                                                              @DA04534
*                                                              @DA04534
TYPE3735 EQU   *                                               @DA04534
         LA    R1,LCTLSEQ              LENG OF CONTROL STRING  @DA04534
*                                       (3)                    @DA04534
         CR    R2,R1                   ARE THERE MORE CHARAC-  @DA04534
*                                       TERS THAN THE THREE    @DA04534
*                                       EXPECTED DEVICE CON-   @DA04534
*                                       TROL CHARACTERS?       @DA04534
         BNH   PROBDEV                 NO. ERROR               @DA04534
         CLI   D0(R6),NUL              IS THE FIRST BYTE NUL?  @DA04534
         BNE   PROBDEV                 NO. ERROR               @DA04534
         CLI   D2(R6),NUL              IS THE THIRD BYTE NUL?  @DA04534
         BNE   PROBDEV                 NO. ERROR               @DA04534
         SR    R2,R1                   ADJUST LENGTH AND START @DA04534
         AR    R6,R1                    OF STRIPPED INPUT      @DA04534
*                                       STRING                 @DA04534
         B     INTRPRET                NOW INTRPRET LOGON SEQ  @DA04534
         EJECT                                                 #XM09031
         SPACE 2                                               #XM09031
************************************************************** #XM09031
*                                                              #XM09031
*   STRIP LEADING AND TRAILING DEVICE CONTROL CHARACTERS AND   #XM09031
*   CONVERT THE INTERNAL CONTROL CHARACTERS TO BLANKS.         #XM09031
*                                                              #XM09031
*    INPUT: R2 = NON-ZERO LOGON SEQUENCE LENGTH                #XM09031
*           R6 = ADDRESS OF 'IOAREA' (LOGON SEQUENCE)          @VS49571
*                                                              #XM09031
************************************************************** #XM09031
*                                                              #XM09031
*                                                              #XM09031
CCSTRIP  EQU   *                                               #XM09031
         BCTR  R2,0                    DECREMENT LENGTH FOR    #XM09031
*                                       EXECUTE INSTRUCTION    #XM09031
         EX    R2,CCTOBLNK             CONVERT LEADING, TRAIL- #XM09031
*                                       ING, AND INTERNAL      #XM09031
*                                       CONTROL CHARACTERS TO  #XM09031
*                                       BLANKS                 #XM09031
         B     PASTTRT                 GO AROUND TRT           @VS49571
         SPACE 2                                               @VS49571
***                                                            #XM09031
*                                                              #XM09031
*  USING LENGTH OF INPUT STRING AS SPECIFIED IN THE EXECUTE    #XM09031
*  INSTRUCTION, TRANSLATE DEVICE CONTROL CHARACTERS (ACTUALLY  #XM09031
*  ALL NON-PRINTABLES) TO BLANKS.                              #XM09031
*                                                              #XM09031
***                                                            #XM09031
*                                                              #XM09031
CCTOBLNK TR    D0(D0,R6),TRTAB1        *** EXECUTED ***        #XM09031
         SPACE 2                                               #XM09031
PASTTRT  EQU   *                                               @VS49571
         LA    R2,D1(,R2)              RESTORE LENGTH OF LOGON #XM09031
*                                       SEQUENCE               #XM09031
         SPACE 4                                               #XM09031
***                                                            #XM09031
*                                                              #XM09031
*  FIRST STEP IS TO STRIP OFF LEADING BLANKS.  THEY WERE ALL   #XM09031
*  CONVERTED FROM CONTROL CHARACTERS SINCE VTAM STRIPS OFF     #XM09031
*  LEADING BLANKS.                                             #XM09031
*                                                              #XM09031
***                                                            #XM09031
*                                                              #XM09031
*                                                              #XM09031
         BCTR  R6,0                    DECREMENT FOR 1ST TIME  #XM09031
*                                       THRU STRIPPING LOOP    #XM09031
*                                      USE LENGTH OF SEQUENCE  #XM09031
*                                       STRING AS LOOP COUNTER #XM09031
*                                      NOTE: R2 IS AT LEAST 1  #XM09031
STRIP1ST EQU   *                                               #XM09031
         LA    R6,D1(,R6)              INCREMENT TO NEXT/1ST   #XM09031
*                                       CHARACTER OF STRING    #XM09031
         CLI   0(R6),C' '              IS IT A BLANK?          #XM09031
         BNE   STRIPBAK                NO. LEADING BLANKS ARE  #XM09031
*                                       ALL STRIPPED.  NOW DO  #XM09031
*                                       TRAILING ONES.         #XM09031
*                                      CHARACTERS STRIPPED BY  #XM09031
*                                       CHANGING POINTER (AL-  #XM09031
*                                       READY DONE) AND COUNT- #XM09031
*                                       ER (THIS INSTRUCTION)  #XM09031
         BCT   R2,STRIP1ST             CONTINUE STRIPPING      #XM09031
         LA    R0,MSG02                END OF STRING.  ALL     #XM09031
         B     WRITEMSG                 BLANKS.  ISSUE ERR MSG #XM09031
         SPACE 2                                               @VS49571
***                                                            #XM09031
*                                                              #XM09031
*  LEADING BLANKS HAVE BEEN STRIPPED.  STRIP TRAILING BLANKS   #XM09031
*  BY FINDING LAST NON-BLANK CHARACTER AND STRIP ALL THAT      #XM09031
*  FOLLOW.                                                     #XM09031
*                                                              #XM09031
***                                                            #XM09031
*                                                              #XM09031
STRIPBAK  EQU   *                                              #XM09031
         LR    RCUR,R6                 POINT AT BEGINNING OF   #XM09031
*                                       SEQUENCE               #XM09031
         LR    R3,R2                   USE LENGTH OF SEQUENCE  #XM09031
*                                       STRING AS LOOP COUNTER #XM09031
*                                      NOTE: R3 IS AT LEAST 1  #XM09031
         LR    REND,RCUR               STARTING VALUE FOR LAST #XM09031
*                                       NON-BLANK              #XM09031
         B     ENDYET                  PREPARE FOR 1ST PASS    #XM09031
STRIP2ND EQU   *                                               #XM09031
         LA    RCUR,D1(,RCUR)          LOOK AT NEXT CHARACTER  #XM09031
         CLI   0(RCUR),C' '            IS IT BLANK?            #XM09031
         BE    ENDYET                  YES. KEEP LOOKING FOR   #XM09031
*                                       END                    #XM09031
         LR    REND,RCUR               SAVE ADDR OF LAST NON-  #XM09031
*                                       BLANK FOUND            #XM09031
ENDYET   EQU   *                                               #XM09031
         BCT   R3,STRIP2ND             KEEP LOOPING TILL END   #XM09031
*                                       OF STRING              #XM09031
         SR    RCUR,REND               FIND LENGTH OF TRAILING #XM09031
*                                       BLANKS                 #XM09031
         SR    R2,RCUR                 STRIP TRAILING BLANKS   #XM09031
*                                       BY CHANGING COUNTER    #XM09031
         B     INTRPRET                NOW INTRPRET LOGON SEQ  #XM09031
         EJECT                                                 #XM09031
         SPACE 2                                               #XM09031
***********************************************************************
*                                                                     *
*    USE INTRPRET TO LOOK UP THE LOGON CHARACTERISTICS TABLE AND FIND *
*    THE NAME OF THE APPLICATION REQUIRED BY THE TERMINAL USER.       *
*    ERREXIT WILL BE CALLED IN CASE OF ERROR.                  @XL03HAJ
*                                                                     *
*        R6 POINTS AT THE LOGON DATA                                  *
*        R2 CONTAINS LOGON DATA LENGTH                                *
*                                                                     *
***********************************************************************
         SPACE 2
INTRPRET EQU   *
         SPACE 2
         STC   R2,DATASEQL             SAVE LOGON SEQ LENGTH   @XM06995
         LR    R1,R2                   PUT IT IN WORK REG      @XM07107
         BCTR  R1,0                    MINUS 1 FOR THE EXECUTE @XM07107
         EX    R1,MVCSEQ               SAVE LOGON SEQUENCE     @XM01017
         B     PASTMVC                 BRANCH AROUND EX'D MVC  @XM06995
MVCSEQ   MVC   DATASEQ(D0),D0(R6)      TO SAVE LOGON SEQUENCE  @XM06995
PASTMVC  EQU   *                                               @XM06995
         SPACE 2                                               @VS49571
         MVC   SYNARG(FOUR),CID        MOVE IN THE CID         @VS49571
         OI    MACFLAG2,INTAPPID       TURN ON INTRPRET FLAG   @X50BHD3
         OI    MFLAGS,INTRPRT          TURN ON INTRPRET FLAG   @X50BHD3
         NI    SRPLEXT1,FF-RPLNIB      INITIALIZE SYNCHRPL     @VS49571
*                                      RPL HAS A CID IN ARG FLD@VS49571
         SPACE 2
*     INTRPRET RPL=SYNCHRPL,                                   @VS49571
*              AREA=(R6),                                             *
*              RECLEN=(R2),                                           *
*              AAREA=APPLID,                                          *
*              AAREALN=L'APPLID                                @VS49571
         SPACE 2                                               @VS49571
      INTRPRET RPL=SYNCHRPL,                                   @VS49571*
               AREA=(R6),                                              *
               RECLEN=(R2),                                            *
               AAREA=APPLID,                                   @VS49571*
               AAREALN=L'APPLID                                @VS49571
         SPACE 2                                               @X50BHD3
         NI    MFLAGS,FF-INTRPRT       TURN OFF INTRPRET FLAG  @VS49571
         EJECT                                                 @XL03HAJ
***                                                            @XL03HAJ
*                                                              @XL03HAJ
*  ERROR ACTIONS FOR INTRPRET                                  @XL03HAJ
*                                                              @XL03HAJ
*                                                   ACTION     @VS49571
*  RTNCD FDBK2                                      CODE(S)    @VS49571
*  CODE  CODE         MEANING                       RETURNED   @VS49571
*                                                   (R15 R0)   @VS49571
*                                                              @XL03HAJ
*   00    00    SUCCESSFUL COMPLETION                00  00    @XL03HAJ
*   08    00    TEMP STORAGE ALLOCATION FAILURE      10  00    @XL03HAJ
*   10    0A    APPARENT VTAM ERROR                  20  00    @ZA32289
*   10    0D    VTAM INACTIVE TO YOUR ACB            SNOCCUR   @VS49571
*   10    0E    ABEND IN VTAM                        SNOCCUR   @XL03HAJ
*   14    13    CID INVALID                          14  00    @VS49571
*   14    4A    NO INTRPRET ROUTINE                  0C  04    @XL03HAJ
*   14    4B    INVALID LOGON SEQUENCE               0C  02    @XL03HAJ
*   14    4D    NO INTRPRET TABLE              (DOS) 0C  03    @XL03HAJ
*                                            (VS1/2) 0C  02    @XL03HAJ
*                                               OR   00  00    @XL03HAJ
*   14    55    INVALID LOGON SEQ IN INTRPRT ROUTINE 0C  02    @X50BHD3
*                                                              @X50BHD3
***                                                            @XL03HAJ
         SPACE 2                                               @XL03HAJ
         CH    R15,HEX20               HIGHEST POSSIBLE ACTION @ZA19916
         BH    SNOCCUR                  CODE IS X'20'          @ZA19916
         B     ERRTAB3(R15)            CHECK VALID ACTIONS     @XL03HAJ
ERRTAB3  B     R0CHK3               0  PROBABLY WORKED OK      @XL03HAJ
         BAL   R7,SNOCCUR           4                          @VS49571
         BAL   R7,SNOCCUR           8  CONNECTION TO DEVICE IS @VS49571
*                                       IRRELEVANT             @XL03HAJ
         B     WRITEMSG             C  THIS IS NORMAL CASE FOR @XL03HAJ
*                                      INVALID LOGON SEQUENCE  @XL03HAJ
         B     PASTMVC             10  REISSUE.  NO NEED TO    @XL03HAJ
*                                       CHECK FOR RESET        @XL03HAJ
         B     FREERPL             14  JUST GET OUT            @VS49571
         BAL   R7,SNOCCUR          18  SHOULD NOT OCCUR        @ZA19916
         BAL   R7,SNOCCUR          1C  SHOULD NOT OCCUR        @ZA19916
         B     PROBDEV             20  PROBLEM WITH DEVICE     @ZA19916
         SPACE 2                                               @XL03HAJ
R0CHK3   EQU   *                                               @XL03HAJ
         LTR   R0,R0                   INTERP AREA TOO SMALL?  @XL03HAJ
         BNZ   SNOCCUR                 YES, OR OTHER ERROR     @XL03HAJ
         SPACE 2                                               @ZA38438
         STC   R2,DATASEQL             SAVE LOGON SEQ LENGTH   @ZA38438
         LR    R1,R2                   PUT IT IN WORK REG      @ZA38438
         BCTR  R1,0                    MINUS 1 FOR THE EXECUTE @ZA38438
         EX    R1,MVCSEQ1              SAVE LOGON SEQUENCE     @ZA38438
         B     PASTMVC1                BRANCH AROUND EX'D MVC  @ZA38438
MVCSEQ1  MVC   DATASEQ(D0),D0(R6)      TO SAVE LOGON SEQUENCE  @ZA38438
PASTMVC1 EQU   *                                               @ZA38438
*                                                              @XL03HAJ
* * * * * * * * END OF INTRPRET ERROR HANDLING * * * * * * * * @XL03HAJ
*                                                              @XL03HAJ
         SPACE 2                                               @XL03HAJ
         LA    PTRNIB,SYNCHNIB     PUT THE APPLICATION         @VS49571
         MVC   NIBSYM(8),APPLID         NAME INTO NIB SYMBOLIC @VS49571
*                                       NAME SLOT.             @VS49571
         EJECT
         SPACE 2
***************************************************************@VS49571
*                                                              @VS49571
*    INQUIRE FOR THE APPLICATION STATUS                        @VS49571
*                                                              @VS49571
***************************************************************@VS49571
         SPACE 2
INQUIREB EQU *                                                 @VS49571
         OI    MACFLAG2,INQAPPS                                @XL03HAJ
         OI    MFLAGS,INQAPPST         TELL ERREXIT OF         @XL03HAJ
*                                       INQUIRE(APPSTAT)       @XL03HAJ
         SPACE 2                                               @XL03HAJ
*      INQUIRE RPL=SYNCHRPL,                                   @VS49571
*              OPTCD=APPSTAT,                                  @VS49571
*              NIB=SYNCHNIB                                    @VS49571
         SPACE 2                                               @VS49571
       INQUIRE RPL=SYNCHRPL,                                   @VS49571*
               OPTCD=APPSTAT,                                  @VS49571*
               NIB=SYNCHNIB                                    @VS49571
         SPACE 2                                               @XL03HAJ
         NI    MFLAGS,X'FF'-INQAPPST   RESET ERREXIT FLAG      @XL03HAJ
         NI    SRPLEXT1,FF-RPLNIB      NIB NO LONGER NEEDED    @VS49571
         EJECT                                                 @XL03HAJ
         SPACE 2                                               @XL03HAJ
***                                                            @XL03HAJ
*                                                              @XL03HAJ
*  ERROR ACTIONS FOR INQUIRE(APPSTAT)                          @XL03HAJ
*                                                              @XL03HAJ
*                                                   ACTION     @VS49571
*  RTNCD FDBK2                                      CODE(S)    @VS49571
*  CODE  CODE         MEANING                       RETURNED   @VS49571
*                                                   (R15 R0)   @VS49571
*                                                              @XL03HAJ
*   00    00    SUCCESSFUL COMPLETION                00  00    @XL03HAJ
*   08    00    TEMP STORAGE ALLOCATION FAILURE      10  00    @XL03HAJ
*   10    0A    VTAM ERROR                           20  00    @ZA32289
*   10    0E    ABEND IN VTAM                        SNOCCUR   @XL03HAJ
*   14    4C    NO APPLICATION NAME                  0C  06    @XL03HAJ
*   14    53    INVALID SYMBOLIC (APPLICATION) NAME  0C  06    @XM09467
*                                                              @XL03HAJ
***                                                            @XL03HAJ
         SPACE 2                                               @XL03HAJ
         CH    R15,HEX20               HIGHEST POSSIBLE ACTION @ZA32289
         BH    SNOCCUR                  CODE IS X'20'          @ZA32289
         B     ERRTAB4(R15)            CHECK VALID ACTIONS     @XL03HAJ
ERRTAB4  B     R0CHK4               0  PROBABLY WORKED OK      @XL03HAJ
         BAL   R7,SNOCCUR           4                          @VS49571
         BAL   R7,SNOCCUR           8  CONNECTION TO DEVICE IS @VS49571
*                                       IRRELEVANT             @XL03HAJ
         B     WRITEMSG             C  THIS IS NORMAL CASE FOR @XL03HAJ
*                                       APPLICATION UNKNOWN    @XL03HAJ
         B     INQUIREB            10  REISSUE.  NO NEED TO    @XL03HAJ
         BAL   R7,SNOCCUR          14                          @ZA32289
         BAL   R7,SNOCCUR          18                          @ZA32289
         BAL   R7,SNOCCUR          1C                          @ZA32289
         B     PROBDEV             20  PROBLEM WITH DEVICE     @ZA32289
         SPACE 2                                               @XL03HAJ
R0CHK4   EQU   *                                               @XL03HAJ
         LTR   R0,R0                   INQUIRE AREA TOO SMALL? @XL03HAJ
         BNZ   SNOCCUR                 YES, OR OTHER ERROR     @XL03HAJ
*                                                              @XL03HAJ
* * * * * * * * END OF INQUIRE ERROR HANDLING * * * * * * * *  @XL03HAJ
*                                                              @XL03HAJ
*                                      NO. FALL THRU           @XL03HAJ
         SPACE 2                                               @XL03HAJ
         EJECT                                                 @XL03HAJ
         SPACE 2
***********************************************************************
*                                                                     *
*    TEST RPL FEEDBACK (FDBK) FOR INDICATION OF APPLICATION STATUS.   *
*    CODES ARE:                                                       *
*                                                                     *
*        0 - ACTIVE AND AVAILABLE                                     *
*        4 - INACTIVE                                                 *
*        8 - NEVER ACCEPTS A LOGON                                    *
*       12 - TEMPORARILY NOT ACCEPTING LOGONS                         *
*       16 - APPLICATION IS QUIESCING (CLOSED ITS LOGON QUEUE)        *
*                                                                     *
***********************************************************************
         SPACE 2                                               @VS49571
         SR    R15,R15                 CLEAR  REG 15           @VS49571
         IC    R15,SYNFDB3             EXTRACT FEEDBACK INFO.  @VS49571
         STC   R15,APPLSTAT            SAVE FOR DEBUGGING.     @VS49571
         SPACE 2
         B     STATUS(R15)             BRANCH IN TABLE
STATUS   B     APPACTIV                 0
         B     APPINACT                 4
         B     APPNEVER                 8
         B     APPTEMP                 12
         B     APPCLOSE                16                      @VS49571
         SPACE 2
APPTEMP  EQU   *                       APPLICATION TEMPORARILY NOT
*                                      ACCEPTING LOGONS
         LA    R0,MSG11                SET MESSAGE CODE        @XL03HAJ
         B     WRITEMSG                TELL TERMINAL USER
         SPACE 2
APPNEVER EQU   *                       APPLICATION NEVER ACCEPTS LOGONS
         LA    R0,MSG10                SET MESSAGE CODE        @XL03HAJ
         B     WRITEMSG                TELL TERMINAL USER
         SPACE 2
APPINACT EQU   *                       APPLICATION INACTIVE
         LA    R0,MSG08                SET MESSAGE CODE        @XL03HAJ
         B     WRITEMSG                TELL TERMINAL USER
         SPACE 2
APPCLOSE EQU   *                       APPLICATION QUIESCING   @VS49571
         LA    R0,MSG09                SET MESSAGE CODE        @XL03HAJ
         B     WRITEMSG                TELL TERMINAL USER
         EJECT
         SPACE 2
***********************************************************************
*                                                                     *
*    THE APPLICATION IS ACTIVE AND AVAILABLE. PASS THE TERMINAL PLUS  *
*    LOGON DATA TO THE DESIRED APPLICATION.                           *
*                                                                     *
***********************************************************************
         SPACE 2
APPACTIV EQU   *
         SPACE 2
         SR    R2,R2                   CLEAR
         AIF   ('&ASTRIP' EQ 'YES').STRIP2
         LA    R3,NOSTRIPA             ADDRESS DATA TO PASS    @ZA07805
         IC    R2,STRIPLEN             LENGTH OF DATA TO PASS  @ZA07805
.STRIP2  ANOP
         AIF   ('&ASTRIP' EQ 'NO').STRIP3
         IC    R2,DATASEQL             GET DATA SEQUENCE LENGTH PASSED
*                                       FROM INTRPRET          @VS49571
         LA    R3,DATASEQ              ADDRESS OF DATA TO PASS @ZA07805
.STRIP3  ANOP
         SPACE 2
PASS     EQU   *                                               @XL03HAJ
         OI    MACFLAG2,CLOSPASS                               @VS49571
         OI    MFLAGS2,CLSDST                                  @VS49571
         SPACE 2                                               @XL03HAJ
*      CLSDST  RPL=(PTRRPL),                                  @VS49571*
*              OPTCD=(ASY,PASS),                                      *
*              AAREA=APPLID,                                          *
*              AREA=(R3),                                      @ZA07805
*              RECLEN=(R2),                                    @VS49571
*              EXIT=PASSEND                                    @VS49571
         SPACE 2                                               @VS49571
       CLSDST  RPL=(PTRRPL),                                   @VS49571*
               OPTCD=(ASY,PASS),                               @VS49571*
               AAREA=APPLID,                                           *
               AREA=(R3),                                      @ZA07805*
               RECLEN=(R2),                                    @VS49571*
               EXIT=PASSEND                                    @VS49571
         SPACE 4                                               @VS49571
         NI    MFLAGS2,FF-CLSDST                               @VS49571
         EJECT                                                 @VS49571
         SPACE 2                                               @VS49571
***                                                            @VS49571
*                                                              @VS49571
*  ERROR ACTIONS FOR CLSDST(PASS)                              @VS49571
*                                                              @VS49571
*                                                   ACTION     @VS49571
*  RTNCD FDBK2                                      CODE(S)    @VS49571
*  CODE  CODE         MEANING                       RETURNED   @VS49571
*                                                   (R15 R0)   @VS49571
*                                                              @VS49571
*   00    00    SUCCESSFUL COMPLETION                00  00    @VS49571
*   08    00    TEMP STORAGE ALLOCATION FAILURE      10  00    @VS49571
*                                                              @VS49571
***                                                            @VS49571
         SPACE 2                                               @VS49571
         CH    R15,HEX10               VTAM BUFFERS FULL?      @VS49571
*                                       (ONLY POSSIBLE ERROR)  @VS49571
         BE    PASS                    YES. REISSUE            @VS49571
         LTR   R15,R15                 CLOSE(PASS) ACCEPTED    @VS49571
         BNZ   SNOCCUR                 NO. IMPOSSIBLE          @VS49571
         LTR   R0,R0                   VALID COMPLETION?       @XL03HAJ
         BNZ   SNOCCUR                 NO. ERROR               @XL03HAJ
*                                                              @XL03HAJ
* * * * * * * * END OF CLSDSTERROR HANDLING* * * * * * * * * * @VS49571
*                                                              @XL03HAJ
         SPACE 8                                               @XL03HAJ
         B     RETURN                  RETURN TO VTAM          @VS49571
         EJECT                                                 @VS49571
************************************************************** @VS49571
*                                                            * @VS49571
*        CHECK THAT THE CLSDST(PASS) WORKED CORRECTLY        * @VS49571
*                                                            * @VS49571
*        THIS EXIT ROUTINE IS SCHEDULED WHEN A CLSDST (PASS) * @VS49571
*        IS ISSUED.  THE CLSDST IS ISSUED WHEN A VALID LOGON * @VS49571
*        SEQUENCE HAS BEEN RECEIVED FROM THE TERMINAL AND    * @VS49571
*        THE DESIRED APPLICATION IS RECEIVING LOGON'S.       * @VS49571
*                                                            * @VS49571
*        REGISTER 5 CONTAINS THE ADDRESS OF THE RPL USED     * @VS49571
*            IN THE CLSDST.                                  * @VS49571
*                                                            * @VS49571
*                                                            * @VS49571
************************************************************** @VS49571
         SPACE 2                                               @VS49571
PASSEND  EQU   *                                               @VS49571
*                                                              @VS49571
         SPACE 2                                               @VS49571
*                                                              @VS49571
*        XXXXXXXXXX                                            @VS49571
         DROP  R10                                             @VS49571
         DROP  R11                     BASE REGS NOT SET UP    @VS49571
         DROP  R12                      YET                    @VS49571
         USING *,R15                   ESTABLISH INITIAL ADDRES@VS49571
*        XXXXXXXXXX                                            @VS49571
*                                                              @VS49571
         L     R12,STARTADD            R12 IS BASE REGISTER    @VS49571
*                                                              @VS49571
*        XXXXXXXXXX                                            @VS49571
         DROP  R15                                             @VS49571
         USING START,R12,R11,R10       ALL BASE REGS SET       @VS49571
*        XXXXXXXXXX                                            @VS49571
*                                                              @VS49571
         L     R11,BASE2               LOAD 2ND BASE REGISTER  @VS49571
         L     R10,BASE3               LOAD 3RD BASE REGISTER  @VS49571
         ST    R14,RETVTAM@            SAVE EXIT RETURN ADDRESS@VS49571
         LA    R13,GENSAVE             POINT TO SAVE-AREA      @VS49571
         SPACE 2                                               @VS49571
         TM    UFLAGS,SHUTDOWN         SHUTDOWN IN PROGRESS?   @VS49571
         BO    RETURN                  YES. NO MORE ACTION     @VS49571
         LR    PTRRPL,R1               GET THE RPL PASSED      @VS49571
         EJECT                                                 @VS49571
         OI    EXITFLAG,PASSEX         INDICATE IN PASSEND     @VS49571
         OI    MFLAGS2,CLSDST          TELL ERREXIT THAT ERROR @VS49571
*                                       ARE FOR CLSDST         @VS49571
         SPACE 2                                               @XL03HAJ
*        CHECK RPL=(PTRRPL)            CHECK FOR ERROR, ERREXIT@VS49571
*                                       IS ENTERED IF ERRORS HAVE
*                                       OCCURRED               @VS49571
         CHECK RPL=(PTRRPL)                                    @VS49571
         SPACE 2                                               @XL03HAJ
         NI    MFLAGS2,X'FF'-CLSDST    RESET INDICATOR         @VS49571
         EJECT                                                 @VS49571
***                                                            @VS49571
*                                                              @VS49571
*  ERROR ACTIONS FOR CLSDST(PASS)                              @VS49571
*                                                              @VS49571
*                                                   ACTION     @VS49571
*  RTNCD FDBK2                                      CODE(S)    @VS49571
*  CODE  CODE         MEANING                       RETURNED   @VS49571
*                                                   (R15 R0)   @VS49571
*                                                              @VS49571
*   00    00    SUCCESSFUL COMPLETION                00  00    @VS49571
*   08    00    TEMP STORAGE ALLOCATION FAILURE      10  00    @VS49571
*   0C    0B    REQUEST CANCELLED BY CLSDST          14  00    @VS49571
*   10    00    APPLICATION UNAVAILABLE              0C  07    @VS49571
*   10    02    TARGET APPLICATION UNACCEPTABLE      0C  09    @VS49571
*   10    0A    APPARENT VTAM ERROR                  20  00    @ZA32289
*   10    0D    VTAM INACTIVE TO YOUR ACB            SNOCCUR   @VS49571
*   10    0E    ABEND IN VTAM                        SNOCCUR   @VS49571
*   14    12    CLSDST IN PROGRESS                   14  00    @VS49571
*   14    13    CID INVALID                          14  00    @VS49571
*   14    55    NO OPNDST AUTHORIZATION              0C  05    @VS49571
*   14    5D    OPNDST INVALID (TERM NOT CONNECTED)  14  00    @VS49571
*   14    5F    RESOURCE NOT OWNED                   14  00    @VS49571
*                                                              @VS49571
***                                                            @VS49571
         SPACE 2                                               @VS49571
         CH    R15,HEX20               HIGHEST POSSIBLE ACTION @ZA32289
         BH    SNOCCUR                  CODE IS X'20'          @ZA32289
         B     ERRTAB5(R15)            CHECK VALID ACTIONS     @XL03HAJ
ERRTAB5  B     R0CHK5               0  PROBABLY PASSED DEVICE  @XL03HAJ
         BAL   R7,SNOCCUR           4                          @VS49571
         BAL   R7,SNOCCUR           8                          @VS49571
         B     WRITEMSG             C  NORMAL CASE IF APPLI-   @XL03HAJ
*                                       CATION STOPPED ACCEPT- @XL03HAJ
*                                       ING LOGONS SINCE THE   @XL03HAJ
*                                       INQUIRE                @XL03HAJ
         B     PASS                10  REISSUE RESET FIRST     @VS49571
         B     FREERPL             14  IT COULD BE THAT NETSOL @VS49571
*                                       NO LONGER HAS THE      @XL03HAJ
*                                       DEVICE SINCE IT WAS    @XL03HAJ
*                                       FREED BY RELREQ AFTER  @XL03HAJ
*                                       THE READEND EXIT WAS   @XL03HAJ
*                                       SCHEDULED.             @XL03HAJ
         BAL   R7,SNOCCUR           18                         @ZA32289
         BAL   R7,SNOCCUR           1C                         @ZA32289
         B     PROBDEV              20  PROBLEM WITH DEVICE    @ZA32289
         SPACE 2                                               @VS49571
R0CHK5   EQU   *                                               @VS49571
         LTR   R0,R0                   VALID COMPLETION?       @VS49571
         BNZ   SNOCCUR                 ERROR IF NOT            @VS49571
*                                                              @VS49571
* * * * * * * * END OF CLSDST ERROR HANDLING * * * * * * * * * @VS49571
*                                                              @VS49571
         SPACE 2                                               @VS49571
         B     FREERPL             FREE THE RPL AND GO BACK    @VS49571
*                                  TO VTAM                     @VS49571
         TITLE 'WRITEMSG - WRITE MESSAGE TO TERMINAL'          @XL03HAJ
***********************************************************************
*                                                                     *
*        THIS CODE IS ENTERED ONLY FROM THE READEND REQUEST.          *
*                                                                     *
*              ON ENTRY:                                              *
*                                                                     *
*        REGISTER 0 CONTAINS THE NUMBER OF THE MESSAGE TO BE WRITTEN  *
*        REGISTER 5 POINTS TO THE RPL BEING USED.              @VS49571
*                                                                     *
***********************************************************************
         SPACE 2
WRITEMSG EQU   *
         STC   R0,MSGINDEX             SAVE MESSAGE INDEX      @VS49571
         SPACE 2                                               @XL03HAJ
***********************************************************************
*                                                                     *
*        WRITE MESSAGE TO TERMINAL                                    *
*                                                                     *
***********************************************************************
         SPACE 2                                               @VS49571
MSGOK    EQU   *                                               @VS49571
         SR    R1,R1                   CLEAR OUT REG           @VS49571
         IC    R1,MSGINDEX             GET THE INDEX           @VS49571
         LA    R2,X'FF'-X'80'          TURN OFF POSSIBLE RESET @VS49571
         NR    R1,R2                    INDICATOR PRIOR TO     @VS49571
*                                       INDEXING               @VS49571
         BCTR  R1,0                    INDEX - 1               @VS49571
         SLL   R1,D2                   4 * (INDEX - 1)         @VS49571
*                                      = DISPLACEMENT OF MESSAG@VS49571
         L     R2,VCONMSGS             POINT TO MESSAGE CSECT
         AR    R1,R2                   POINT TO MESSAGE ENTRY
         AH    R2,D2(,R1)              POINT TO MESSAGE
         LH    R1,D0(,R1)              GET MESSAGE LENGTH
         LA    R3,IOAREA               POINT TO OUTPUT AREA    @VS49571
         SPACE 4                                               @VS49571
***********************************************************************
*                                                                     *
*        REGISTER 1 CONTAINS MESSAGE LENGTH                           *
*        REGISTER 2 POINTS TO MESSAGE                          @VS49571
*        REGISTER 3 POINTS TO OUTPUT AREA                      @VS49571
*                                                              @VS49571
***************************************************************@VS49571
         EJECT                                                 @VS49571
         SPACE 2                                               @VS49571
***************************************************************@VS49571
*                                                              @VS49571
*        MOVE LEADING DEVICE CONTROL CHARACTER STRING TO OUTPUT@VS49571
*                                                              @VS49571
***************************************************************@VS49571
         SPACE 2                                               @VS49571
         SR    R4,R4                   CLEAR                   @VS49571
         IC    R4,LENGCC               GET LENGTHS OF LEADING  @VS49571
*                                       AND TRAILING CONTROL   @VS49571
*                                       STRINGS                @VS49571
         SRA   R4,D4                   USE ONLY LEADING STRING @VS49571
         BZ    MVMSG                   BRANCH IF ZERO          @VS49571
         SPACE 2                                               @VS49571
         SR    R6,R6                   CLEAR                   @VS49571
         IC    R6,LEADCC               OFFSET OF LEADING CC    @VS49571
*                                       STRING                 @DA04534
         LA    R6,CHTAB(R6)            POINT TO STRING REQUIRED
         BCTR  R4,0                    REDUCE FOR EXECUTED MVC
         EX    R4,MVC                  MOVE STRING TO OUTPUT AREA
         LA    R3,D1(R3,R4)            POINT TO NEXT OUTPUT POSITION
         SPACE 2
***********************************************************************
*                                                                     *
*        MOVE MESSAGE TO OUTPUT AREA                                  *
*                                                                     *
***********************************************************************
         SPACE 2
MVMSG    EQU   *
         BCTR  R1,0                    REDUCE FOR EXECUTED MVC
         LR    R6,R2                   POINT AT MESSAGE
         EX    R1,MVC                  MOVE MESSAGE TO OUTPUT AREA
         B     PASTMVC2                GO AROUND MVC           @VS49571
         SPACE 2
***********************************************************************
*                                                                     *
*        THE FOLLOWING INSTRUCTION IS THE SUBJECT OF AN EXECUTE       *
*        INSTRUCTION IN THE WRITEMSG CODE ABOVE.  IT IS USED TO       *
*        MOVE LEADING AND TRAILING DEVICE CONTROL STRINGS, AS WELL    *
*        AS THE MESSAGE TO THE OUTPUT AREA.                           *
*                                                                     *
***********************************************************************
         SPACE 2
MVC      MVC   D0(D0,R3),D0(R6)        *** EXECUTED ***
         SPACE 2
PASTMVC2 EQU   *                                               @VS49571
         LA    R3,D1(R3,R1)            POINT TO NEXT OUTPUT POSITION
         EJECT
***********************************************************************
*                                                                     *
*        MOVE TRAILING DEVICE CONTROL CHARACTER STRING TO OUTPUT AREA *
*                                                                     *
***********************************************************************
         SPACE 2
         IC    R4,LENGCC               GET LENGTHS OF LEADING  @DA04534
*                                       AND TRAILING CONTROL   @DA04534
*                                       STRINGS                @DA04534
         LA    R6,TRAILMSK             MASK FOR TRAILING STRING LENGTH
         NR    R4,R6                   TRAILING STRING ONLY REQUIRED
         BZ    POINTIO                 BRANCH IF ZERO          @VS49571
         SPACE 2                                               @VS49571
         IC    R6,TRAILCC              OFFSET OF TRAILING CC   @VS49571
*                                       STRING                 @VS49571
         LA    R6,CHTAB(R6)            POINT TO STRING REQUIRED@VS49571
         BCTR  R4,0                    REDUCE FOR EXECUTED MVC @VS49571
         EX    R4,MVC                  MOVE STRING TO OUTPUT AR@VS49571
         LA    R3,D1(R3,R4)            POINT TO NEXT OUTPUT POS@VS49571
         SPACE 2                                               @VS49571
POINTIO  EQU   *                                               @VS49571
         SPACE 2                                               @VS49571
         LA    R2,IOAREA              POINT AT START OF COMPLETE MSG
         SR    R3,R2                   LENGTH OF MESSAGE
         SPACE 2
WRITE    EQU   *
         SPACE 2
         TM    MSGINDEX,RESETIND       RESET BEFORE MSG?       @VS49571
         BNO   WRITEGO                 NO, GO WRITE            @VS49571
         SPACE 4                                               @VS49571
DORESET3 EQU   *                                               @VS49571
         ST    R3,WRITELEN            SAVE MSG LENGTH          @ZA13651
         BAL   R9,RESETSUB             ADDR OF RESET EXIT RTN  @VS49571
*                                       AND DO RESET           @VS49571
         SPACE 1                                               @VS49571
         NI    MSGINDEX,X'FF'-RESETIND TURN OFF POSSIBLE RESET @VS49571
*                                       INDICATOR              @XL03HAJ
         L     R3,WRITELEN             RESTORE R3 OVER RESET   @ZA13651
*                                       EXIT.                  @ZA13651
         EJECT                                                 @VS49571
WRITEGO  EQU   *                                               @VS49571
         TM    DFLAGS,IODEV            IS DEVICE 'GENNED FOR   @VS49571
*                                       OUTPUT?                @DA04534
         BNO   OKWRITE                 NO. SKIP THE WRITE.     @VS49571
*                                       ONLY NEEDED TO FLUSH   @DA04534
*                                       OUT BUFFERS FOR NEXT   @DA04534
*                                       SOLICIT/READ.          @DA04534
         CLI   TABINDEX,T3275          ALL DATA FROM GENERAL   @VS49571
         BE    ERASWRIT                 POLL DEVICES IS UN-    @VS49571
         CLI   TABINDEX,T3277           SOLICITED. CHECK FOR   @VS49571
         BE    ERASWRIT                 3275 OR 3277 IN        @VS49571
*                                       USERWORD. THERE IS NO  @VS49571
*                                       NEED TO RESET DEVICE   @VS49571
         TM    RDATAFLG,RPLUINPT       UNSOLICITED DATA?       @VS49571
         BZ    SOLCDATA                NO. DATA WAS SOLICITED. @XM02032
*                                       PROCEED WITH WRITE     @XM02032
         TM    FLAGS,ONERESET          YES. HAS AT LEAST ONE   @XM02032
*                                       RESET, WHICH KILLED AN @XM02032
*                                       OUTSTANDING SOLICIT,   @XM02032
*                                       BEEN ISSUED?           @XM02032
         BZ    DORESET3                NO. ISSUE RESET TO KILL @VS49571
*                                       AN OUTSTANDING SOLICIT @XM02032
*                                       OR WRITE WILL HANG     @XM02032
*                                      YES. NO OUTSTANDING I/O @XM02032
*                                       SO PROCEED WITH WRITE  @XM02032
SOLCDATA EQU   *                                               @XM02032
         OI    MACFLAG2,WRITLBT        TELL ERREXIT OF WRITE   @XL03HAJ
         OI    MFLAGS,WRITING          TELL ERREXIT OF WRITE   @XL03HAJ
         SPACE 2                                               @XL03HAJ
*        WRITE RPL=(PTRRPL),           WRITE ERROR MESSAGE     @VS49571
*              OPTCD=(ASY,LBT),                                @VS49571
*              AREA=IOAREA,                                    @VS49571
*              RECLEN=(R3),                                    @VS49571
*              EXIT=WRITEND                                    @VS49571
         WRITE RPL=(PTRRPL),                                   @VS49571*
               OPTCD=(ASY,LBT),                                @VS49571*
               AREA=IOAREA,                                    @VS49571*
               RECLEN=(R3),                                    @VS49571*
               EXIT=WRITEND                                    @VS49571
         SPACE 2                                               @XL03HAJ
         NI    MFLAGS,X'FF'-WRITING    RESET INDICATOR         @XL03HAJ
         EJECT                                                 @VS49571
         SPACE 2                                               @VS49571
***                                                            @VS49571
*                                                              @VS49571
*  ERROR ACTIONS FOR WRITE                                     @VS49571
*                                                              @VS49571
*                                                   ACTION     @VS49571
*  RTNCD FDBK2                                      CODE(S)    @VS49571
*  CODE  CODE         MEANING                       RETURNED   @VS49571
*                                                   (R15 R0)   @VS49571
*                                                              @VS49571
*   00    00    SUCCESSFUL COMPLETION                00  00    @VS49571
*   08    00    TEMP STORAGE ALLOCATION FAILURE      10  00    @VS49571
*                                                              @VS49571
***                                                            @VS49571
         SPACE 2                                               @VS49571
         CH    R15,HEX10               VTAM BUFFERS FULL?      @VS49571
*                                       (ONLY POSSIBLE ERROR)  @VS49571
         BE    SOLCDATA                YES. REISSUE            @VS49571
         LTR   R15,R15                 WRITE ACCEPTED?         @VS49571
         BNZ   SNOCCUR                 NO. IMPOSSIBLE          @VS49571
         LTR   R0,R0                   ACCEPTED? (2ND CHK)?    @VS49571
         BNZ   SNOCCUR                 NO. ERROR               @XL03HAJ
*                                                              @XL03HAJ
* * * * * * * * END OF WRITE ERROR HANDLING* * * * * * * * * * @XL03HAJ
*                                                              @XL03HAJ
         SPACE 8                                               @XL03HAJ
         B     RETURN                  RETURN TO VTAM          @VS49571
         EJECT                                                 @VS49571
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *  @ZA13651
*                                                              @ZA13651
*        ERASE WRITE FOR 3275 AND 3277                         @ZA13651
*                                                              @ZA13651
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *  @ZA13651
ERASWRIT EQU   *                                               @ZA13651
         OI    MACFLAG2,WRITLBT        TELL ERREXIT OF WRITE   @ZA13651
         OI    MFLAGS,WRITING          TELL ERREXIT OF WRITE   @ZA13651
         SPACE 2                                               @ZA13651
*        WRITE RPL=(PTRRPL),           WRITE ERROR OR LOGON    @ZA13651
*              OPTCD=(LBT,ERASE),       MESSAGE.               @ZA13651
*              AREA=IOAREA,                                    @ZA13651
*              RECLEN=(R3),                                    @ZA13651
*              EXIT=WRITEND                                    @ZA13651
         WRITE RPL=(PTRRPL),                                   @ZA13651*
               OPTCD=(LBT,ERASE),                              @ZA13651*
               AREA=IOAREA,                                    @ZA13651*
               RECLEN=(R3),                                    @ZA13651*
               EXIT=WRITEND                                    @ZA13651
         SPACE 2                                               @ZA13651
         NI    MFLAGS,X'FF'-WRITING    RESET INDICATOR         @ZA13651
         TM    FLAGS2,SYNCHIO          IS THIS SYNCH WRITE     @ZA13651
*                                       FROM LOGON EXIT?       @ZA13651
         BO    WRITCHEK                YES. SKIP CHECK         @ZA13651
         EJECT                                                 @ZA13651
         SPACE 2                                               @ZA13651
***                                                            @ZA13651
*                                                              @ZA13651
*  ERROR ACTIONS FOR ERASE WRITE                               @ZA13651
*                                                              @ZA13651
*                                                   ACTION     @ZA13651
*  RTNCD FDBK2                                      CODE(S)    @ZA13651
*  CODE  CODE         MEANING                       RETURNED   @ZA13651
*                                                   (R15 R0)   @ZA13651
*                                                              @ZA13651
*   00    00    SUCCESSFUL COMPLETION                00  00    @ZA13651
*   08    00    TEMP STORAGE ALLOCATION FAILURE      10  00    @ZA13651
*                                                              @ZA13651
***                                                            @ZA13651
         SPACE 2                                               @ZA13651
         CH    R15,HEX10               VTAM BUFFERS FULL?      @ZA13651
*                                       (ONLY POSSIBLE ERROR)  @ZA13651
         BE    ERASWRIT                YES. REISSUE            @ZA13651
         LTR   R15,R15                 WRITE ACCEPTED?         @ZA13651
         BNZ   SNOCCUR                 NO. IMPOSSIBLE          @ZA13651
         LTR   R0,R0                   ACCEPTED? (2ND CHK)?    @ZA13651
         BNZ   SNOCCUR                 NO. ERROR               @ZA13651
*                                                              @ZA13651
* * * * * * * * END OF ERASE WRITE ERROR HANDLING  * * * * * * @ZA13651
*                                                              @ZA13651
         SPACE 8                                               @ZA13651
         B     RETURN                  RETURN TO VTAM          @ZA13651
         EJECT                                                 @ZA13651
************************************************************** @VS49571
*                                                              @VS49571
*         WRITEND IS ENTERED WHEN THE EXIT HAS BEEN SCHEDULED  @VS49571
*         FOR THE WRITE DONE ABOVE.                            @VS49571
*                                                              @VS49571
*         REGISTER 1 POINTS TO THE ASYNCH RPL BEING USED       @VS49571
*         REGISTER 15 POINTS TO WRITEND AND IS USED FOR        @VS49571
*                     ADDRESSABILITY                           @VS49571
*                                                              @VS49571
************************************************************** @VS49571
WRITEND  EQU   *                                               @VS49571
*        XXXXXXXXXX                                            @VS49571
         DROP  R10                                             @VS49571
         DROP  R11                     BASE REGS NOT SET UP    @VS49571
         DROP  R12                      YET                    @VS49571
         USING *,R15                   ESTABLISH INITIAL ADDRES@VS49571
*        XXXXXXXXXX                                            @VS49571
         L     R12,STARTADD            R12 IS BASE REGISTER    @VS49571
*        XXXXXXXXXX                                            @VS49571
         DROP  R15                                             @VS49571
         USING START,R12,R11,R10       ALL BASE REGS SET       @VS49571
*        XXXXXXXXXX                                            @VS49571
*                                                              @VS49571
         L     R11,BASE2               LOAD 2ND BASE REGISTER  @VS49571
         L     R10,BASE3               LOAD 3RD BASE REGISTER  @VS49571
         ST    R14,RETVTAM@            SAVE EXIT RETURN ADDRESS@VS49571
         LA    R13,GENSAVE             POINT TO SAVE-AREA      @VS49571
         SPACE 2                                               @VS49571
         TM    UFLAGS,SHUTDOWN         SHUTDOWN IN PROGRESS?   @VS49571
         BO    RETURN                  YES. NO MORE ACTION     @VS49571
         SPACE 2                                               @VS49571
         LR    PTRRPL,R1               POINT TO THE INPUT RPL  @VS49571
         L     R3,WRITELEN             RESTORE R3 IN CASE      @ZA19918
*                                       REISSUE WRITE          @ZA19918
         SPACE 2                                               @VS49571
         OI    MFLAGS,WRITING          TELL ERREXIT THAT ERROR @VS49571
*                                       ARE FOR WRITE          @VS49571
*        CHECK RPL=(PTRRPL)            CHECK FOR ERROR, ERREXIT@VS49571
*                                      IS ENTERED IF ERRORS HAVE
*                                      OCCURRED
         CHECK RPL=(PTRRPL)                                    @VS49571
         NI    MFLAGS,X'FF'-WRITING    RESET READ INDICATOR    @VS49571
         EJECT                                                 @XL03HAJ
         SPACE 2                                               @XL03HAJ
***                                                            @XL03HAJ
*                                                              @XL03HAJ
*  ERROR ACTIONS FOR WRITE                                     @XL03HAJ
*                                                              @XL03HAJ
*                                                   ACTION     @VS49571
*  RTNCD FDBK2                                      CODE(S)    @VS49571
*  CODE  CODE         MEANING                       RETURNED   @VS49571
*                                                   (R15 R0)   @VS49571
*                                                              @XL03HAJ
*   00    00    SUCCESSFUL COMPLETION                00  00    @XL03HAJ
*   04    00    RVI RECEIVED                         10  04    @XL03HAJ
*   04    01    REVERSE BREAK RECEIVED               10  04    @XL03HAJ
*   04    02    BISYNCH STATUS MSG RECEIVED          08  00    @DA04534
*                                                 OR 10  00    @DA04534
*                                                 OR 1C  00    @DA04534
*                                                 OR 20  00    @Z40GKD3
*   08    00    TEMP STORAGE ALLOCATION FAILURE      10  00    @XL03HAJ
*   0C    00    I/O ERROR.  DEVICE STILL USABLE      08  00    @DA04534
*                                                 OR 10  04    @DA04534
*                                                 OR 10  08    @DA04534
*                                                 OR 1C  00    @DA04534
*                                                 OR 20  00    @Z40GKD3
*   0C    01    I/O ERROR.  DEVICE NOT USABLE        08  --    @XL03HAJ
*   0C    02    REQUEST CANCELED BY TEST REQUEST MSG 08  00    @VS49571
*   0C    03    VTAM BUFFERS CLEARED                 20  --    @ZA19873
*   0C    04    VTAM BUFFERS FULL                    20  --    @Z40GKD3
*   0C    05    NCP ABEND.  RESTART SUCCESSFUL       10  08    @VS49571
*   0C    06    NCP ABEND.  LAST PURGE               10  08    @XL03HAJ
*   0C    0A    REQUEST CANCELLED BY RESET           00  00    @VS49571
*   0C    0B    REQUEST CANCELLED BY CLSDST          14  00    @VS49571
*   0C    0E    YIELDED TO CONTENSION                10  08    @VS49571
*   0C    0F    YIELDED TO CONTENSION(ERROR LOCK SET)10  08    @VS49571
*   10    04    VTAM AND NCP INCOMPATABLE            20  00    @Z40GKD3
*   10    05    PERMENENT PATH FAILURE               08  00    @XL03HAJ
*   10    06    AUTO NETWORK SHUTDOWN                08  00    @XL03HAJ
*   10    07    VARY DEACTIVATE IMMEDIATE            08  00    @XL03HAJ
*   10    08    DIAL-LINE DISCONNECTION              10  00    @VS49571
*                                                 OR 14  00    @VS49571
*   10    0B    DIAL-OUT DISCONNECT                  08  00    @XL03HAJ
*   10    0C    DIAL-IN DISCONNECT                   08  00    @XL03HAJ
*   10    0E    ABEND IN VTAM                        SNOCCUR   @XL03HAJ
*   14    12    CLSDST IN PROGRESS                   14  00    @VS49571
*   14    13    CID INVALID                          14  00    @XL03HAJ
*   14    32    REQUEST INVALID FOR SPECIFIED DEVICE 18  08    @VS49571
*   14    5D    OPNDST INVALID (TERM NOT CONNECTED)  14  00    @VS49571
*                                                              @XL03HAJ
***                                                            @XL03HAJ
         SPACE 2                                               @XL03HAJ
WRITCHEK EQU   *                                               @ZA13651
         OI    EXITFLAG,WRITEX         INDICATE WRITE EXIT     @VS49571
         CH    R15,HEX20               HIGHEST VALID ACTION    @Z40GKD3
         BH    SNOCCUR                  CODE IS X'20'          @Z40GKD3
         SPACE 2                                               @XL03HAJ
         B     ERRTABB(R15)            CHECK VALID ACTION      @XL03HAJ
ERRTABB  B     R0CHKB               0  CHECK IF WRITE WENT     @XL03HAJ
         BAL   R7,SNOCCUR           4                          @VS49571
         B     RELEASE              8  CONNECTION TO DEVICE    @XL03HAJ
*                                       IS KAPUT: MAKE IT      @XL03HAJ
*                                       OFFICIAL               @XL03HAJ
         BAL   R7,SNOCCUR           C  ALREADY WRITING, CAN'T  @VS49571
*                                       GET ONE OF THE MSG     @XL03HAJ
*                                       ERROR CONDITIONS       @XL03HAJ
         B     RSETESTB            10  CHECK RESET OR REISSUE  @XL03HAJ
         B     FREERPL             14  DEVICE GONE             @VS49571
         B     CATCHA2             18                          @DA04534
         B     RESETSOL            1C  RESET THEN SOLICIT      @DA04534
         B     PROBDEV             20  I/O PROBLEM WITH DEVICE @Z40GKD3
         SPACE 4                                               @XL03HAJ
RSETESTB EQU   *                                               @XL03HAJ
         LR    R4,R0                   SET UP FOR BR INDEX     @XL03HAJ
         B     RSETABB(R4)             HANDLE RESET AND/OR     @XL03HAJ
*                                       REISSUE                @XL03HAJ
RSETABB  B     WRITE                0  REISSUE ONLY            @XL03HAJ
         B     DORESET4             4  RESET BECAUSE RVI       @XL03HAJ
*                                       RECEIVED OR BECAUSE OF @DA04534
*                                       A BISYNCH STATUS ERR   @DA04534
*                                       ON 0C/00 IO ERROR.  IF @DA04534
*                                       ON RVI, THE WRITE      @DA04534
*                                       COMPLETED OK.          @XL03HAJ
*                                       THIS CAN ALSO HAPPEN   @DA04534
*                                       THE SECOND TIME FOR A  @DA04534
*                                       0C/00 IO ERR ATTEMPT-  @DA04534
*                                       ING TO ISSUE A WRITE   @DA04534
         B     DORESET3             8  RESET AND REISSUE       @XL03HAJ
         SPACE 2                                               @XL03HAJ
CATCHA2  EQU   *                                               @VS49571
         CH    R0,HEX8            ONLY VALID CODE IS X'08'     @VS49571
         BNE   SNOCCUR            ^8  SHOULD NOT OCCUR         @VS49571
         B     OKWRITE            8   READ ONLY DEVICE. IGNORE WRITE
         SPACE 2                                               @VS49571
R0CHKB   EQU   *                                               @XL03HAJ
         CH    R0,HEX3                 YIELDED TO CONTENTION?  @XL03HAJ
         BE    DORESET3          3  4  YES. IGNORE USER WISHES @VS49571
         CH    R0,HEX4                  RESET AND REISSUE      @XL03HAJ
         BE    DORESET3                 THE WRITE.  IF BUFFERS @VS49571
*                                       ARE FULL FROM INPUT    @XL03HAJ
*                                       DATA, WRITE WILL FAIL  @XL03HAJ
*                                       WITH 0C/04 AND CAUSE   @XL03HAJ
*                                       BUFFERS TO BE PURGED   @XL03HAJ
*                                       BEFORE REISSUEING      @XL03HAJ
*                                       ANOTHER WRITE.  IF     @XL03HAJ
*                                       BUFFERS AREN'T FULL,   @XL03HAJ
*                                       THE DATA WILL EVENTUAL-@XL03HAJ
*                                       LY SATISFY A READ(ANY).@XL03HAJ
         LTR   R0,R0                   SUCCESSFUL COMPLETION?  @XL03HAJ
         BNZ   SNOCCUR                 NO. ERROR               @XL03HAJ
         B     OKWRITE                 YES. PROBABLY RESOLICIT @XL03HAJ
         SPACE 2                                               @XL03HAJ
***                                                            @XL03HAJ
*                                                              @XL03HAJ
*  RESET THE TERMINAL (USED ONLY AFTER AN RVI RECEIVED OR      @DA04534
*  BISYNCH STATUS MSG ON I/O ERROR 0C/00)                      @DA04534
*                                                              @XL03HAJ
***                                                            @XL03HAJ
         SPACE 2                                               @XL03HAJ
DORESET4 EQU   *                                               @VS49571
         BAL   R9,RESETSUB             ADDR OF RESET EXIT RTN  @VS49571
*                                       AND DO RESET           @VS49571
         SPACE 2                                               @VS49571
*                                                              #XL03HAJ
* * * * * * * * END OF WRITE ERROR HANDLING * * * * * * * * *  @XL03HAJ
*                                                              @XL03HAJ
OKWRITE  EQU   *                                               @XL03HAJ
         NI    FLAGS,X'FF'-LOOPONCE    WRITE WENT. TURN OFF    @XL03HAJ
*                                       RETRYING INDICATOR     @XL03HAJ
         TM    FLAGS2,LOGWRITE         IS THIS ERASE WRITE FROM@ZA13651
         BO    CONTLOGN                 LOGON EXT? GO FREE RPL @ZA13651
*                                       AND PUT OUT READ       @ZA13651
         SPACE 2                                               @XL03HAJ
         SPACE 2                                               @XL03HAJ
         AIF ('&SYSTEM' NE 'DOS').NDOS5                        @D31JKAX
         CLI   MSGINDEX,MSG03          WAS THERE AN INTRPRET TABLE?
         BE    RELEASE                 NO. NETSOL CAN NEVER PASS
*                                       THE DEVICE TO AN APPLICATION,
*                                       SO FREE IT NOW FOR A LATER
*                                       ACQUIRE BY AN APPLICATION.
.NDOS5   AIF ('&SYSTEM' NE 'VS1').NVS15                        @D31JKAX
.*      CAN RE-SOLICIT THE DEVICE EVEN THOUGH THERE IS NO INTRPRET
.*      TABLE BECAUSE THE STANDARD LOGON SEQUENCE CAN BE USED. @VS49571
.NVS15   AIF ('&SYSTEM' NE 'VS2').NVS25                        @D31JKAX
.*      CAN RE-SOLICIT THE DEVICE EVEN THOUGH THERE IS NO INTRPRET
.*      TABLE BECAUSE THE STANDARD LOGON SEQUENCE CAN BE USED. @D31JKAJ
.NVS25   ANOP                                                  @D31JKAX
         SPACE 2
         B     RESOLCIT                RE-SOLICIT FOR LOGON SEQ@VS49571
*                                                              @VS49571
*                                                              @VS49571
         EJECT                                                 @VS49571
BASE1    DC    A(START)                ADDR OF FIRST BASE REG  @VS49571
         AIF   ('&AACQ' EQ 'NO').NORLRQ FOLLOWING EXIT NOT REQUIRED, AS
.*                                     ACQUIRE PARAMETER ON NETSOL
.*                                     MACRO IS 'NO'.
.*
         TITLE 'RELREQ - TERMINAL OWNED BY NETSOL NEEDED ''ELSEWHERE'''
         SPACE 2
***********************************************************************
*                                                                     *
*    THIS EXIT ROUTINE IS SCHEDULED WHEN AN APPLICATION ISSUES        *
*    OPNDST (ACQUIRE) FOR A TERMINAL CURRENTLY OWNED BY NETSOL.       *
*                                                              @VS49571
*        ON ENTRY:                                             @VS49571
*                                                              @VS49571
*    REGISTER 1 POINTS AT A PARAMETER LIST CONTAINING THE      @VS49571
*         FOLLOWING;                                           @VS49571
*              WORD 0 - ACB ADDRESS.                           @VS49571
*              WORD 1 - ADDRESS OF SYMBOLIC NAME OF TERMINAL   @VS49571
*                                                              @VS49571
*    REGISTER 14 CONTAINS RETURN ADDRESS                       @VS49571
*                                                              @VS49571
*    REGISTER 15 CONTAINS ENTRY ADDRESS                        @VS49571
*                                                              @VS49571
***************************************************************@VS49571
         SPACE 2                                               @VS49571
RELREQ   EQU   *                                               @VS49571
         SPACE 2                                               @VS49571
*                                                              @VS49571
*        XXXXXXXXXX                                            @VS49571
         DROP  R10                                             @VS49571
         DROP  R11                     BASE REGS NOT SET UP    @VS49571
         DROP  R12                      YET                    @VS49571
         USING *,R15                   ESTABLISH INITIAL ADDRES@VS49571
*        XXXXXXXXXX                                            @VS49571
*                                                              @VS49571
         L     R12,STARTADD            R12 IS BASE REGISTER    @VS49571
*                                                              @VS49571
*        XXXXXXXXXX                                            @VS49571
         DROP  R15                                             @VS49571
         USING START,R12,R11,R10       ALL BASE REGS SET       @VS49571
*        XXXXXXXXXX                                            @VS49571
*                                                              @VS49571
         L     R11,BASE2               LOAD 2ND BASE REGISTER  @VS49571
         L     R10,BASE3               LOAD 3RD BASE REGISTER  @VS49571
         ST    R14,RETVTAM@            SAVE EXIT RETURN ADDRESS@VS49571
         LA    R13,GENSAVE             POINT TO SAVE-AREA      @VS49571
         SPACE 2                                               @VS49571
         TM    UFLAGS,SHUTDOWN         SHUTDOWN IN PROGRESS?   @VS49571
         BO    RETURN                  YES. NO MORE ACTION     @VS49571
         SPACE 2                                               @VS49571
         LA    R15,EIGHT               INDICATE RELREQ EXIT    @VS49571
         BAL   R14,GETRPL              GET AN RPL              @VS49571
         SPACE 2                                               @VS49571
         OI    EXITFLAG,RELREQEX       INDICATE IN RELREQ EXIT @VS49571
         SPACE 2                                               @VS49571
         LA    PTRNIB,SYNCHNIB                                 @VS49571
         L     R3,D4(R1)                POINT TO NIB           @VS49571
         MVC   NIBSYM(8),D0(R3)         PLACE SYMBOLIC TERMINAL@VS49571
*                                        NAME IN NIB.          @VS49571
         MVC   NAMEDEV,D0(R3)            SAVE NAME FOR RELEASE @VS49571
         EJECT                                                 @VS49571
************************************************************** @VS49571
*                                                              @VS49571
*        FIND THE CID OF THE TERMINAL                          @VS49571
*                                                              @VS49571
************************************************************** @VS49571
         SPACE 1                                               @VS49571
INQUIREC EQU   *                                               @VS49571
         SPACE 1                                               @VS49571
         OI    MACFLAGS,INQCIDX     INDICATE DOING INQUIRE     @VS49571
         OI    MFLAGS2,INQUIRE      INDICATE DOING INQUIRE     @VS49571
         SPACE 1                                               @VS49571
*      INQUIRE RPL=SYNCHRPL,        FIND CID FOR SYMBOLIC      @VS49571
*              OPTCD=CIDXLATE,       NAME.  CID IS IN THE      @VS49571
*              NIB=SYNCHNIB,         ASYNCH RPL                @VS49571
*              AREA=CID,                                       @VS49571
*              AREALEN=FOUR                                    @VS49571
       SPACE 1                                                 @VS49571
       INQUIRE RPL=SYNCHRPL,                                   @VS49571*
               OPTCD=CIDXLATE,                                 @VS49571*
               NIB=SYNCHNIB,                                   @VS49571*
               AREA=CID,                                       @VS49571*
               AREALEN=FOUR                                    @VS49571
         SPACE 2                                               @VS49571
         NI    MFLAGS2,FF-INQUIRE      INQUIRE IS DONE         @VS49571
         NI    SRPLEXT1,FF-RPLNIB      NIB NO LONGER NEEDED    @VS49571
         EJECT                                                 @VS49571
***                                                            @VS49571
*                                                              @VS49571
*  ERROR ACTIONS FOR INQUIRE(CIDXLATE)                         @VS49571
*                                                              @VS49571
*                                                   ACTION     @VS49571
*  RTNCD FDBK2                                      CODE(S)    @VS49571
*  CODE  CODE         MEANING                       RETURNED   @VS49571
*                                                   (R15 R0)   @VS49571
*                                                              @VS49571
*   00    00    SUCCESSFUL COMPLETION                00  00    @VS49571
*   08    00    TEMP STORAGE ALLOCATION FAILURE      10  00    @VS49571
*   10    0A    APPARENT VTAM ERROR                  20  00    @ZA32289
*   10    0E    ABEND IN VTAM                        SNOCCUR   @VS49571
*   14    13    CID INVALID                          14  00    @VS49571
*                                                              @VS49571
***                                                            @VS49571
         SPACE 2                                               @VS49571
         CH    R15,HEX20               HIGHEST POSSIBLE ACTION @ZA32289
         BH    SNOCCUR                  CODE IS X'20'          @ZA32289
         B     ERRTABZ(R15)            CHECK VALID ACTIONS     @VS49571
ERRTABZ  B     R0CHKZ               0  PROBABLY WORKED OK      @VS49571
         BAL   R7,SNOCCUR           4                          @VS49571
         BAL   R7,SNOCCUR           8                          @VS49571
         BAL   R7,SNOCCUR           C  CAN'T GET ERROR THAT    @VS49571
*                                       CAUSES ERR MESSAGE     @VS49571
         B     INQUIREC            10  REISSUE.  NO NEED TO    @XL03HAJ
*                                       CHECK FOR RESET        @XL03HAJ
         BAL   R7,SNOCCUR          14  SHOULD NOT OCCUR        @ZA32168
         BAL   R7,SNOCCUR          18                          @ZA32289
         BAL   R7,SNOCCUR          1C                          @ZA32289
         B     PROBDEV             20  PROBLEM WITH DEVICE     @ZA32289
         SPACE 2                                               @XL03HAJ
R0CHKZ   EQU   *                                               @XL03HAJ
         LTR   R0,R0                   ANY ERROR?              @VS49571
         BZ    CONTRELQ                NO, CONTINUE PROCESS    @VS49571
         CH    R0,HEX7                 INFO NOT AVAILABLE      @VS49571
         BE    FREERPL                 YES, FREERPL AND EXIT   @VS49571
         BAL   R7,SNOCCUR              OTHER ERROR, IMPOSSIBLE @VS49571
*                                                              @VS49571
CONTRELQ EQU   *                       CONTINUE PROCESSING     @VS49571
*                                                              @XL03HAJ
* * * * * * * * END OF INQUIRE ERROR HANDLING * * * * * * * *  @XL03HAJ
*                                                              @XL03HAJ
         EJECT                                                 @VS49571
************************************************************** @VS49571
*                                                              @VS49571
*        SEARCH ALL RPLS FOR A MATCHING CID.IF ONE IS FOUND,   @VS49571
*        IGNORE RELREQ REQUEST AS THE TERMINAL IS ISSUING      @VS49571
*        A LOGON (READEND REQUEST) AND IT HAS FIRST CALL.      @VS49571
*                                                              @VS49571
************************************************************** @VS49571
         LA    R2,NUMRPLS              GET NUMBER OF RPLS      @VS49571
         L     R3,ARPL0                GET THE ADDR. OF THE    @VS49571
*                                      FIRST RPL IN THE TABLE  @VS49571
CIDCOMP  EQU   *                                               @VS49571
         CLC   CID(FOUR),CIDLOC(R3)    IS THIS OUR CID         @VS49571
         BNE   CIDINCRE                NO, GET NEXT RPL        @VS49571
         SPACE 2                                               @VS49571
*************************************************************  @VS49571
*                                                              @VS49571
*        WE HAVE FOUND AN EQUAL CID.  IS THIS RPL THE RPL      @VS49571
*        THAT WE JUST GOT AT THE BEGINNING OF RELREQ?          @VS49571
*        IF SO, CONTINUE THE SCAN.  IF NOT, RELEASE THE RPL    @VS49571
*        JUST GOTTEN AND RETURN TO VTAM.                       @VS49571
*                                                              @VS49571
*        RELREQ IS CANCELED DUE TO TH: FACT THAT THE TERMINAL  @VS49571
*        IS ALREADY ISSUEING A LOGON REQUEST.                  @VS49571
*                                                              @VS49571
************************************************************** @VS49571
         SPACE 1                                               @VS49571
         CR    PTRRPL,R3               IS THIS THE NEW RPL JUST@VS49571
*                                       PASSED TO RELREQ EXIT  @VS49571
         BNE   FREERPL                 NO, ANOTHER EXIT IS     @VS49571
*                                       USING THE DEVICE. SKIP @VS49571
*                                       THE RELREQ.            @VS49571
*                                                              @VS49571
*                          YES, CONTINUE THE SCAN              @VS49571
*                                                              @VS49571
CIDINCRE EQU   *                                               @VS49571
         A     R3,LNGTHRPL             INCREMENT RPLPTR        @VS49571
         BCT   R2,CIDCOMP              DO LOOKUP               @VS49571
***************************************************************@VS49571
*                                                              @VS49571
*        CID WAS NOT FOUND THEREFORE THE RELREQ IS VALID       @VS49571
*                                                              @VS49571
*    NOW RELEASE THE TERMINAL. THE REQUESTING APPLICATION CAN  @VS49571
*    LOGON TO IT.                                              @VS49571
*                                                              @VS49571
***************************************************************@VS49571
*                                      SET INDICATOR TO        @VS49571
         OI    FLAGS,RELOPND           RELEASE THE DEVICE AND  @VS49571
*                                      TRY TO REOPEN IT        @VS49571
         MVC   RPLARG(FOUR),CID        GET CID INTO ASYNCH RPL @VS49571
         B     RELEASE                 GO DO THE RELEASE       @VS49571
.NORLRQ  ANOP
         TITLE 'LOSTERM - TERMINAL LOST FROM NETWORK SOLICITOR'
         SPACE 2
***********************************************************************
*                                                                     *
*    THIS EXIT ROUTINE IS SCHEDULED WHEN A TERMINAL CURRENTLY LOGGED  *
*    ON TO NETSOL IS LOST BY:                                  @VS49571
*                                                              @VS49571
*              * A DIAL LINE DISCONNECT                        @VS49571
*                                                              @VS49571
*              * TEST REQUEST                                  @VS49571
*                                                              @VS49571
*              * OPERATOR ISSUED A VARY COMMAND                @VS49571
*                                                              @VS49571
*        ON ENTRY:                                             @VS49571
*                                                              @VS49571
*    REGISTER 1 POINTS AT A PARAMETER LIST CONTAINING THE      @VS49571
*            FOLLOWING;                                        @VS49571
*              WORD 0 - ACB ADDRESS.                           @VS49571
*              WORD 1 - CID OF LOST TERMINAL                   @VS49571
*              WORD 2 - USER FIELD FROM NIB                    @VS49571
*              WORD 3 - REASON CODE, AS FOLLOWS:               @VS49571
*                                                              @VS49571
*                         0 - DIAL-LINE DISCONNECT (DIAL-IN)   @VS49571
*                         4 - DIAL-LINE DISCONNECT (DIAL-OUT)  @VS49571
*                         8 - RESERVED                         @VS49571
*                        12 - NETWORK OPERATOR ISSUED A VARY CO@VS49571
*                        16 - (RECORD ONLY)                    @VS49571
*                        20 - (RECORD ONLY)                    @VS49571
*                        24 - (RECORD ONLY)                    @VS49571
*                        28 - (RECORD ONLY)                    @VS49571
*                        32 - (RECORD ONLY)                    @VS49571
*                        36 - (RECORD ONLY)                    @VS49571
*                        40 - TEST REQUEST SET                 @VS49571
*                                                              @VS49571
*    REGISTER 14 CONTAINS RETURN ADDRESS                       @VS49571
*                                                              @VS49571
*    REGISTER 15 CONTAINS ENTRY ADDRESS                        @VS49571
*                                                              @VS49571
***************************************************************@VS49571
         SPACE 2                                               @VS49571
LOSTERM  EQU   *                                               @VS49571
         SPACE 2                                               @VS49571
*                                                              @VS49571
*        XXXXXXXXXX                                            @VS49571
         DROP  R10                                             @VS49571
         DROP  R11                     BASE REGS NOT SET UP    @VS49571
         DROP  R12                      YET                    @VS49571
         USING *,R15                   ESTABLISH INITIAL ADDRES@VS49571
*        XXXXXXXXXX                                            @VS49571
*                                                              @VS49571
         L     R12,STARTADD            R12 IS BASE REGISTER    @DM09991
*                                                              @ZM32689
*        XXXXXXXXXX                                            @ZM32689
         DROP  R15
         USING START,R12,R11,R10       ALL BASE REGS SET       @ZM32689
*        XXXXXXXXXX                                            @ZM32689
*                                                              @ZM32689
         L     R11,BASE2               LOAD 2ND BASE REGISTER  @ZM32689
         L     R10,BASE3               LOAD 3RD BASE REGISTER  @ZM32689
         ST    R14,RETVTAM@            SAVE EXIT RETURN ADDRESS
         LA    R13,GENSAVE            POINT TO SAVE-AREA
         SPACE 2                                               @XL03HAJ
         TM    UFLAGS,SHUTDOWN          SHUTDOWN IN PROGRESS?  @VS49571
         BO    RETURN                  YES. NO MORE ACTION     @XL03HAJ
         SPACE 2                                               @XL03HAJ
         LA    R15,FOUR                INDICATE IN LOSTERM EXIT@VS49571
         BAL   R14,GETRPL              GET AN RPL FOR WORK     @VS49571
         SPACE 2                                               @VS49571
         OI    EXITFLAG,LOSTEX         INDICATE IN LOSTERM EXIT@VS49571
         SPACE 2                                               @VS49571
         MVC   CID,D4(R1)              SAVE CID IN RPL/WORKQREA@VS49571
         SPACE 4                                               @VS49571
         SR    R3,R3                                           @VS49571
         MVC   USERWORD,D8(R1)         SAVE THE USER INFO      @VS49571
         IC    R3,TABINDEX             GET THE INDEX TO TABDEV @VS49571
         A     R3,TABDEV@              POINT TO THE CORRECT    @VS49571
*                                      ENTRY IN TABDEV         @VS49571
         MVC   TABLINFO,D0(R3)         SAVE DEVICE CHARICTERISTICS
         SPACE 4                                               @VS49571
         L     R3,D12(0,R1)            LOAD THE REASON CODE    @DM14112
         CH    R3,HEX28                IS IT TEST REQUEST SET? @DM14112
         BNE   RELEASE                 NO. JUST RELEASE DEVICE.@VS49571
         OI    FLAGS,RELOPND           YES. RELEASE DEVICE AND @DM14112
         B     RELEASE                  RE-ACQUIRE IT.         @DM14112
         TITLE 'FREERPL - FREE RPL AND INDICATE IT IN TABLE'   @VS49571
         SPACE 2                                               @VS49571
***********************************************************************
*                                                                     *
*        FREERPL IS ENTERED WHEN AN RPL/WORKAREA IS NOLONGER   @VS49571
*        NEEDED BY THE EXIT ROUTINES.  ITS PRIMARY FUNCTION    @VS49571
*        IS TO MARK AS AVAILABLE FOR LATER USE THE RPL/WORKAREA@VS49571
*        BEING FREED.  ITS SECONDARY FUNCTION IS TO USE THE    @VS49571
*        RPL/WORKAREA BEING FREED TO RESTART A PENDING REQUEST.@VS49571
*        (SUCH AS READ(ANY)).                                  @VS49571
*                                                              @VS49571
*        AT EXIT FROM FREERPL, CONTROL IS RETURNED TO VTAM.    @VS49571
*                                                              @VS49571
*        INPUT REGISTERS                                       @VS49571
*          R5  - POINTS TO RPL/WORKAREA TO BE FREED            @VS49571
*          R10-R12 - BASE REGISTERS                            @VS49571
*          R13 - ADDRESS OF GENSAVE (REGISTER SAVE AREA)       @VS49571
*          R14 - R4 NO SPECIFIC INPUT REQUIRED                 @VS49571
*                                                              @VS49571
*                                                                     *
***********************************************************************
         SPACE 2
FREERPL  EQU   *                                               @VS49571
         SPACE 2                                               @VS49571
         MVC   CID2(FOUR),CID          SAVE THE CID FOR DEBUG  @VS49571
         XC    CID(FOUR),CID           WIPE OUT THE CID. THIS  @VS49571
*                                       IS DONE INCASE THE     @VS49571
*                                       'RELREQ' EXIT NEEDS TO @VS49571
*                                       SCAN THE CID'S         @VS49571
         C     R5,ARPL0                IS THIS RPL=RPL0        @VS49571
         BE    RETURN                  YES, VALUE IN RNDXTABL  @VS49571
*                                       IS ALREADY ZERO.       @VS49571
*                                       THEREFORE, RETURN TO VTAM
         SPACE 2                                               @VS49571
         TM    UFLAGS,NEEDREAD         IS A READ PENDING       @VS49571
         BO    ISSUERD                 YES, ISSUE THE READ     @VS49571
         SPACE 2                                               @VS49571
         S     R5,ARPL0                GET DISPLACEMENT INTO   @VS49571
*                                      RPL TABLE               @VS49571
         SR    R4,R4                   CLEAR OUT FOR DIVISION  @VS49571
         SPACE 2                                               @VS49571
         D     R4,LNGTHRPL             GET INDEX INTO INDEX TAB@VS49571
*                                       QUOTIENT IS IN R5      @VS49571
*                                       REMAINDER IS IN R4     @VS49571
         LTR   R4,R4                    REMAINDER MUST ALWAYS  @VS49571
*                                       BE ZERO                @VS49571
         BNZ   SNOCCUR                 IF NOT, ABEND           @VS49571
         SPACE 2                                               @VS49571
         STC   R5,RNDXTABL(R5)         RESET THE INDEX IN THE  @VS49571
*                                      TABLE TO INDICATE THIS  @VS49571
*                                      ENTRY IS AVAILABLE      @VS49571
         B     RETURN                  NO. RETURN TO VTAM      @ZA13651
         EJECT                                                 @VS49571
ISSUERD EQU   *                                                @VS49571
         SPACE 2                                               @VS49571
         MVC   IFGRPL(LNIFGRPL),FRESHRPL RESET THE RPL         @VS49571
         MVI   WORKSPAC,ZERO           WIPE OUT RPL WORKAREA   @VS49571
         MVC   WORKSPAC+ONE(WORKRPLA),WORKSPAC                 @VS49571
         MVC   WORKSPAC+WORKRPLA(WRPLREST),WORKSPAC            @VS49571
         SPACE 2                                               @VS49571
         BAL   R14,READSUB             ISSUE THE READ (ANY)    @VS49571
         NI    UFLAGS,FF-NEEDREAD      TURN OFF READ PENDING SW@VS49571
         SPACE 4                                               @VS49571
*                                                              @VS49571
*        NOW RETURN TO VTAM                                    @VS49571
*                                                              @VS49571
         SPACE 4                                               @XL03HAJ
RETURN   EQU   *                                               @XL03HAJ
         L     R14,RETVTAM@            RESTORE EXIT RETURN ADDRESS
         BR    R14                     RETURN
         TITLE 'RESOLCIT - RESOLCIT/RESETSOL'                  @VS49571
         SPACE 2                                               @VS49571
***************************************************************@VS49571
*                                                              @VS49571
*        SOLICIT THE TERMINAL FOR DATA.  WHEN DATA IS RECEIVED @VS49571
*        OUTSTANDING READ-ANY WILL BE SATISFIED AND THE READEND@VS49571
*        EXIT WILL BE SCHEDULED.                               @VS49571
*                                                              @VS49571
*        ENTRY MAY BE FROM:                                    @VS49571
*                                                              @VS49571
*          RELREQ REQUEST IF THE CLSDST(PASS) WAS NOT ACCEPTED @VS49571
*           BY THE REQUESTING APPLICATION, AND IT WAS THEN     @VS49571
*           REAQUIRED BY NETSOL VIA OPNDST(ACQUIRE,SPEC).      @VS49571
*                                                              @VS49571
*          READEND REQUEST RIGHT AFTER THE CHECK.              @VS49571
*                                                              @VS49571
*          READEND REQUEST AFTER ERROR MESSAGE WAS WRITTEN.    @VS49571
*                                                              @VS49571
*          READEND FOR A BISYNCH STATUS ERROR MESSAGE AFTER    @VS49571
*           ISSUING A RESET AT 'RESETSOL'.                     @VS49571
*                                                              @VS49571
*        IF THE SOLICIT IS REQUIRED FOR A READEND REQUEST,     @VS49571
*        IF ENTRY WAS FOR UNSOLICITED DATA, AND IF NO RESET    @VS49571
*        HAS BEEN ISSUED, THEN THE SOLICIT SHOULD NOT BE       @VS49571
*        ISSUED BECAUSE THE PREVIOUS SOLICIT FOR THIS TERMINAL @VS49571
*        IS STILL OUTSTANDING.                                 @VS49571
*                                                              @VS49571
*        REGISTER 5 POINTS TO THE ASYNC RPL BEING USED.  THIS  @VS49571
*            RPL CONTAINS THE CID OF THE DEVICE.               @VS49571
*        REGISTERS 10-12 ARE THE BASE REGISTERS FOR THE PROGRAM@VS49571
*-                                                             @VS49571
*        NORMAL EXIT IS TO FREERPL TO RELEASE THE ASYNCH RPL   @VS49571
*        AND RETURN TO VTAM.  ABNORMAL EXIT IS TO SNOCCUR OR   @VS49571
*        PROBDEV OR RETURN.                                    @VS49571
*                                                              @VS49571
***************************************************************@VS49571
         SPACE 1                                               @VS49571
***************************************************************@VS49571
*                                                              @VS49571
*  FOR CERTAIN BISYNCH STATUS ERROR MESSAGES, A RESET(UNCOND), @VS49571
*  THEN A SOLICIT/READ MUST BE DONE.                           @VS49571
*  DEVICES FOR WHICH THIS                                      @VS49571
*  CAN HAPPEN ARE 3277, 3275, 3741, AND 3747.                  @VS49571
*                                                              @VS49571
***************************************************************@VS49571
         SPACE 1                                               @VS49571
RESETSOL EQU   *                                               @VS49571
         SPACE 1                                               @VS49571
         BAL   R9,RESETSUB             RESET THE DEVICE        @VS49571
         EJECT                                                 @VS49571
RESOLCIT EQU   *                                               @VS49571
         TM    FLAGS2,MODMLOOP         INTERVENTION REQUIRED?  @ZA13672
         BNO   NOCHANGE                NO. GO SOLICIT          @ZA13672
         SR    R9,R9                   INSERT NUMBER OF LOOPS  @ZA13672
         IC    R9,MODMCNT               FROM USERWORD.         @ZA13672
         LA    R9,1(R9)                INCREMENT IT AND PUT IT @ZA13672
         STC   R9,MODMCNT               IN USERWORD.           @ZA13672
         BAL   R9,CHANGE               INCREMENT USERWORD COUNT@ZA13672
         NI    FLAGS2,FF-MODMLOOP      SHUT OFF FLAG           @ZA13672
NOCHANGE EQU   *                                               @ZA13672
         CLI   TABINDEX,T3275          ALL DATA FROM GENERAL   @VS49571
         BE    RESOLCT1                 POLL DEVICES IS UN-    @VS49571
         CLI   TABINDEX,T3277           SOLICITED. CHECK FOR   @VS49571
         BE    RESOLCT1                 3275 OR 3277 IN        @VS49571
*                                       USERWORD. THERE IS NO  @VS49571
*                                       NEED TO RESET DEVICE.  @VS49571
         TM    RDATAFLG,RPLUINPT       ENTRY FOR UNSOLICITED   @VS49571
*                                      DATA?                   @VS49571
         BZ    RESOLCT1                NO. RE-SOLICIT THE      @VS49571
*                                       TERMINAL               @XM02032
         TM    FLAGS,ONERESET          YES. WAS OUTSTANDING    @XM02032
*                                       SOLICIT KILLED BY AT   @XM02032
*                                       LEAST ONE RESET?       @XM02032
         BZ    OKRESOL                 NO. OUTSTANDING SOLICIT @XM02032
*                                       IS STILL GOOD.  SKIP   @XM02032
*                                       THE SOLICIT            @XM02032
         SPACE 2                                               @VS49571
RESOLCT1 EQU   *                                               @VS49571
         MVC   SYNARG(FOUR),CID        GET THE CID FROM THE    @VS49571
*                                      ASYNCH RPL              @VS49571
         SPACE 2                                               @VS49571
DORESOL  EQU   *                                               @XM02032
         SPACE 2                                               @VS49571
         OI    MACFLAGS,SOLIC          INDICATE DOING SOLICIT  @VS49571
         OI    MFLAGS2,SOLICITS        INDICATE DOING SOLICIT  @VS49571
         NI    SRPLEXT1,FF-RPLNIB      CLEAR RPLNIB FLAG       @ZA42307
         SPACE 2                                               @XL03HAJ
*      SOLICIT RPL=SYNCHRPL,                                   @VS49571
*              OPTCD=(SPEC,CA)                                 @VS49571
       SOLICIT RPL=SYNCHRPL,                                   @VS49571*
               OPTCD=(SPEC,CA)                                 @VS49571
         SPACE 2                                               @VS49571
         NI    MFLAGS2,FF-SOLICITS     SOLICIT DONE            @VS49571
         EJECT                                                 @VS49571
***                                                            @VS49571
*                                                              @VS49571
*   NOTE: THE DEVICE HAS TO BE CONNECTED OR NETSOL WOULD NOT   @VS49571
*   HAVE GOTTEN THIS FAR                                       @VS49571
*           ANY I/O ERRORS WILL BE PICKED UP BY THE READEND    @VS49571
*   EXIT.                                                      @VS49571
*                                                              @VS49571
*                                                   ACTION     @VS49571
*  RTNCD FDBK2                                      CODE(S)    @VS49571
*  CODE  CODE         MEANING                       RETURNED   @VS49571
*                                                   (R15 R0)   @VS49571
*                                                              @VS49571
*   00    00    SUCCESSFUL COMPLETION                00  00    @VS49571
*   08    00    TEMP STORAGE ALLOCATION FAILURE      10  00    @VS49571
*   0C    04    VTAM BUFFERS FULL                    20  00    @VS49571
*   10    0E    ABEND IN VTAM                        SNOCCUR   @VS49571
*   14    12    CLSDST IN PROGRESS                   14  00    @VS49571
*   14    13    CID INVALID                          14  00    @VS49571
*   14    32    REQUEST INVALID FOR SPECIFIED DEVICE 08  00    @VS49571
*   14    5D    OPNDST INVALID (TERM NOT CONNECTED)  14  00    @VS49571
*                                                              @VS49571
***                                                            @VS49571
         SPACE 2                                               @VS49571
         CH    R15,HEX20               IS IT GREATER THAN      @VS49571
*                                      ALLOWABLE MAX.          @VS49571
         BH    SNOCCUR                 YES, TERMINATE NETSOL   @VS49571
         B     ERRSOLID(R15)           BRANCH TO ERROR PROCESS @VS49571
ERRSOLID EQU   *                                               @VS49571
         B     R0CHKSLD            0   SUCCESSFULLY COMPLETED  @VS49571
         BAL   R7,SNOCCUR          4                           @VS49571
         B     RELEASE             8   RELEASE THE DEVICE      @VS49571
         BAL   R7,SNOCCUR          C   NO MESSAGE POSSIBLE     @VS49571
         BAL   R7,SNOCCUR          10  CAN'T HAPPEN ON THE     @VS49571
*                                       SECOND SOLICIT         @VS49571
         B     FREERPL             14   FREE THE RPL           @ZA27711
         BAL   R7,SNOCCUR          18                          @VS49571
         BAL   R7,SNOCCUR          1C                          @VS49571
         B     PROBDEV             20  PROBLEM WITH DEVICE     @VS49571
         SPACE 2                                               @VS49571
R0CHKSLD EQU   *                                               @VS49571
         LTR   R0,R0                   SUCCESSFUL COMPLETION?  @XL03HAJ
         BNZ   SNOCCUR                 NO. ERROR               @XL03HAJ
*                                                              @XL03HAJ
* * * * * * * * END OF SOLICIT ERROR HANDLING * * * * * * * *  @XL03HAJ
*                                                              @XL03HAJ
OKRESOL  EQU   *                       SOLICIT SKIPPED OR OK.  @XM02032
         B     FREERPL                  MUST GO TO FREERPL     @VS49571
*                                       AND POSSIBLY ISSUE     @VS49571
*                                       READ-ANY               @VS49571
         TITLE 'RELEASE - RELEASE THE DEVICE TO VTAM'          @VS49571
************************************************************** @VS49571
*                                                              @VS49571
*        RELEASE THE TERMINAL, AND PERHAPS RE-ACQUIRE IT.      @VS49571
         AIF ('&SYSTEM' EQ 'DOS').DOSJG1A                      @VS49571
*                                                              @VS49571
*        THERE ARE TWO ENTRY POINTS TO THIS ROUTINE, 'PROBDEV' @VS49571
*        AND 'RELEASE'. 'PROBDEV' WILL WTO AND RELEASE THE DEV-@VS49571
*        ICE BECAUSE OF AN I/O PROBLEM. 'RELEASE' WILL RELEASE @VS49571
*        THE DEVICE , AND IF THERE IS A TEST REQUEST SET       @VS49571
*        'RELEASE' WILL REACQUIRE THE DEVICE.                  @VS49571
.DOSJG1A ANOP                                                  @VS49571
         AIF ('&SYSTEM' NE 'DOS').NDOSJG1                      @VS49571
*                                                              @VS49571
*        THERE ARE TWO ENTRY POINTS TO THIS ROUTINE, 'PROBDEV' @VS49571
*        AND 'RELEASE'.  'PROBDEV' WILL DUMP UNLESS IT IS      @VS49571
*        PATCHED TO TRY A RELEASE.  'RELEASE' WILL RELEASE THE @VS49571
*        DEVICE AND TRY TO RE-ACQUIRE IT (IF A SWITCH HAS      @VS49571
*        BEEN SET).                                            @VS49571
.NDOSJG1 ANOP                                                  @VS49571
*                                                              @VS49571
*        REGISTER 5 (PTRRPL) WILL POINT TO AN RPL. (IT MAY BE  @VS49571
*        SYNCHRONOUS OR ASYNCHRONOUS)                          @VS49571
*        REGISTER 10-12 - BASE REGISTERS                       @VS49571
*                                                              @VS49571
************************************************************** @VS49571
         AIF ('&SYSTEM' NE 'DOS').NDOSJG2                      @VS49571
PROBDEV  EQU   *                       DEVICE PROBLEM OCCURRED @VS49571
*                                       BECAUSE OF HARDWARE,   @VS49571
*                                       NETWORK, OR USER CAUSED@VS49571
*                                       SYSTEM PROBLEM.        @VS49571
         NOP   RELEASE                 THIS INSTRUCTION CAN BE @VS49571
*                                       ZAPPED TO RELEASE THE  @VS49571
*                                       DEVICE RATHER THAN     @VS49571
*                                       TERMINATE NETSOL.      @VS49571
         STM   R0,R15,SNOREGS          REGS FOR DEBUGGING      @VS49571
         MVI   DUMPFLAG,DEVPCODE       CODE FOR FAILURE TYPE   @VS49571
         B     DUMP                    DUMP NETSOL             @VS49571
         SPACE 2
.NDOSJG2 ANOP                                                  @Z40GKD3
         AIF ('&SYSTEM' EQ 'DOS').DOSJG2A                      @VS49571
         SPACE 2                                               @VS49571
PROBDEV  EQU   *                       PROBLEM WITH DEVICE.    @VS49571
         OI    FLAGS2,BADEVICE         TURN ON  FLAG FOR WTO.  @VS49571
         B     INQUIRC                                         @VS49571
.DOSJG2A ANOP                                                  @VS49571
         SPACE 2                                               @VS49571
RELEASE  EQU   *                                               @VS49571
         TM    FLAGS,RELOPND           IS RELEASE A PRELUDE TO @VS49571
*                                       REOPEN?                @XL03HAJ
         BZ    CLOSEREL                NO. SIMPLY RELEASE IT   @VS49571
*                                      YES. MUST SAVE SYMBOLIC @XL03HAJ
*                                       NAME FOR LATER REOPEN  @XL03HAJ
*                                      NOTE: THIS CAN OCCUR    @XL03HAJ
*                                       FOR READ(ANY)/CHECK    @XL03HAJ
*                                       ERROR HANDLING.        @VS49571
         EJECT                                                 @XL03HAJ
***************************************************************@XL03HAJ
*                                                              @VS49571
*        TRANSLATE CID TO SYMBOLIC TERMINAL NAME               @VS49571
*                                                              @VS49571
***************************************************************@VS49571
         SPACE 2                                               @VS49571
INQUIRC  EQU   *                                               @VS49571
         CLC   NAMEDEV,DCZEROS         IS THE NAMEDEV FIELD VAL@VS49571
         AIF ('&SYSTEM' EQ 'DOS').DOSJG3A                      @VS49571
         BNE   ENDINQC                 YES,CHECK PROBDEV       @VS49571
.DOSJG3A ANOP                                                  @VS49571
         AIF   ('&SYSTEM' NE 'DOS').NDOSJG3                    @VS49571
         BNE   DORSET                  YES, CHECK USERWORD     @VS49571
.NDOSJG3 ANOP                                                  @VS49571
         MVC   SYNARG(FOUR),CID        GET CID INTO SYNCHRPL   @VS49571
         OI    MFLAGS2,INQUIRE         INDICATE INQUIRE        @VS49571
         OI    MACFLAGS,INQCIDX        INDICATE INQ CIDXLATE   @VS49571
         NI    SRPLEXT1,FF-RPLNIB      SYNCH RPL HAS CID IN    @VS49571
*                                       ARG FIELD              @VS49571
         SPACE 2                                               @VS49571
*      INQUIRE RPL=SYNCHRPL,           FIND SYMBOLIC NAME      @VS49571
*              OPTCD=CIDXLATE,          FOR CID IN ASYNCH RPL  @VS49571
*              AREA=NAMEDEV,                                   @VS49571
*              AREALEN=D8                                      @VS49571
         SPACE 2                                               @VS49571
       INQUIRE RPL=SYNCHRPL,                                   @VS49571*
               OPTCD=CIDXLATE,                                 @VS49571*
               AREA=NAMEDEV,                                   @VS49571*
               AREALEN=D8                                      @VS49571
         SPACE 2                                               @VS49571
         NI    MFLAGS2,FF-INQUIRE      INQUIRE IS DONE         @VS49571
         EJECT                                                 @VS49571
***                                                            @VS49571
*                                                              @VS49571
*  ERROR ACTIONS FOR INQUIRE(CIDXLATE)                         @VS49571
*                                                              @VS49571
*                                                   ACTION     @VS49571
*  RTNCD FDBK2                                      CODE(S)    @VS49571
*  CODE  CODE         MEANING                       RETURNED   @VS49571
*                                                   (R15 R0)   @VS49571
*                                                              @VS49571
*   00    00    SUCCESSFUL COMPLETION                00  00    @VS49571
*   08    00    TEMP STORAGE ALLOCATION FAILURE      10  00    @VS49571
*   10    0A    APPARENT VTAM ERROR                  20  00    @ZA32289
*   10    0E    ABEND IN VTAM                        SNOCCUR   @VS49571
*   14    13    CID INVALID                          14  00    @VS49571
*                                                              @VS49571
***                                                            @VS49571
         SPACE 2                                               @VS49571
         CH    R15,HEX20               HIGHEST POSSIBLE ACTION @ZA32289
         BH    SNOCCUR                  CODE IS X'20'          @ZA32289
         B     ERRTABD(R15)            CHECK VALID ACTIONS     @VS49571
ERRTABD  B     R0CHKD               0  PROBABLY WORKED OK      @VS49571
         BAL   R7,SNOCCUR           4                          @VS49571
         BAL   R7,SNOCCUR           8                          @VS49571
         BAL   R7,SNOCCUR           C  CAN'T GET ERROR THAT    @VS49571
*                                       CAUSES ERR MESSAGE     @VS49571
         B     INQUIRC             10  REISSUE.  NO NEED TO    @XL03HAJ
*                                       CHECK FOR RESET        @XL03HAJ
         B     FREERPL             14  DEVICE GONE.            @VS49571
         BAL   R7,SNOCCUR          18                          @ZA32289
         BAL   R7,SNOCCUR          1C                          @ZA32289
         B     PROBDEV             20  PROBLEM WITH DEVICE     @ZA32289
         SPACE 2                                               @XL03HAJ
R0CHKD   EQU   *                                               @XL03HAJ
         CH    R0,HEX7                 IS PRLFDB2 = X'07'      @ZA27740
*                                    YES. TERMINAL IS RELEASED @ZA27740
         BE    FREERPL                 NO. CONTINUE NORMALLY   @ZA27740
         LTR   R0,R0                   INQUIRE AREA TOO SMALL? @XL03HAJ
         BNZ   SNOCCUR                 YES, OR OTHER ERROR     @XL03HAJ
*                                                              @XL03HAJ
* * * * * * * * END OF INQUIRE ERROR HANDLING * * * * * * * *  @XL03HAJ
*                                                              @XL03HAJ
         AIF ('&SYSTEM' EQ 'DOS').DOSJG4A                      @VS49571
         EJECT                                                 @VS49571
***************************************************************@VS49571
*                                                              @VS49571
*        I/O PROBLEM WITH DEVICE, SEND A  MESSAGE TO           @VS49571
*        SYSTEM OPERATOR AND RELEASE THE DEVICE.               @VS49571
*        THIS SECTION OF CODE IS ENTERED THROUGH               @VS49571
*        PROBDEV ..... IF NOT ENTERED BY MEANS OF              @VS49571
*        PROBDEV TAKE BRANCH AROUND TO ENDWTO.                 @VS49571
*                                                              @VS49571
***************************************************************@Z40GKD3
         SPACE 4                                               @VS49571
ENDINQC  EQU   *                                               @VS49571
         AIF   ('&ABEND' NE 'NO').TSTERR                       @ZA32003
         TM    MFLAGS2,ERRCON          DID WE COME FROM SNOCCUR@ZA32003
         BO    MSGWTO2                 YES BRANCH MSG TWO      @ZA32003
.TSTERR  ANOP                                                  @ZA32003
         TM    FLAGS2,BADEVICE         IS WTO BIT ON ?         @Z40GKD3
         BNO   ENDWTO                  NO. DON'T WTO.          @Z40GKD3
         NI    FLAGS2,FF-BADEVICE      YES. WTO BIT ON THEN    @Z40GKD3
*                                       TURN WTO FLAG OFF.     @Z40GKD3
         MVC   LISTWTO+17(8),NAMEDEV   MOVE DEVICE NAME INTO   @Z40GKD3
*                                       THE MESSAGE AREA OF    @Z40GKD3
*                                       THE LIST FORM OF WTO.  @Z40GKD3
         SPACE 2                                               @Z40GKD3
*        WTO   MF=(E,LISTWTO)          EXECUTE FORM OF WTO     @Z40GKD3
         WTO   MF=(E,LISTWTO)                                  @VS49571
         AIF   ('&ABEND' NE 'NO').RELE                         @ZA32003
         B     NTMSG2                  BRANCH AROUND MSG       @ZA32003
MSGWTO2  EQU   *                                               @ZA32003
         CLC   NAMEDEV,DCZEROS         DO WE HAVE NAME?        @ZA32003
         BNE   GDNAME                 YES BRANCH               @ZA32003
         MVC   NAMEDEV,=C'UNKNOWN '   INIT TERM FIELD          @ZA32003
GDNAME   EQU   *                                               @ZA32003
         MVC   LISTWTO2+21(8),NAMEDEV MOVE NAME INTO MSG       @ZA32003
*        WTO   MF=(E,LISTWTO2)        EXECUTE FORM OF WTO      @ZA32003
         WTO   MF=(E,LISTWTO2)        EXECUTE FORM OF WTO      @ZA32003
NTMSG2   EQU   *                                               @ZA32003
.RELE    ANOP                                                  @ZA32003
         SPACE 2                                               @VS49571
         B     CLOSEREL                RELEASE THE DEVICE      @VS49571
*                                       AFTER MESSAGE IS SENT. @VS49571
ENDWTO   EQU    *                                              @VS49571
.DOSJG4A ANOP                                                  @VS49571
         EJECT                                                 @VS49571
DORSET   EQU   *                                               @VS49571
         TM    FLAGS,RELOPND           ARE WE TO TRY TO REOPEN @VS49571
         BZ    CLOSEREL                NO, JUST CLOSE IT       @VS49571
         CLC   USERWORD,DCZEROS        IS USERWORD VALID       @VS49571
         BNE   CLOSEREL                YES, DO THE CLOSE       @VS49571
         BAL   R9,RESETSUB             GET USERWORD            @VS49571
         MVC   USERWORD,RPLUSFLD                               @VS49571
         SPACE 1                                               @VS49571
CLOSEREL EQU   *                                               @VS49571
         SPACE 1                                               @VS49571
         OI    MFLAGS2,CLSDST          INDICATE DOING CLOSE(REL@VS49571
         OI    MACFLAGS,CLSREL         INDICATE CLSDST REL     @ZA33715
         L     R2,CID                  OBTAIN CID              @VS49571
         SPACE 1                                               @VS49571
*       CLSDST RPL=(PTRRPL),           THIS IS DONE EITHER     @VS49571
*              EXIT=CDSTEND1,           SYNCH OR ASYNCH,       @VS49571
*              OPTCD=RELEASE,           DEPENDING ON SETTING OF@VS49571
*              ARG=(R2)                 SYNCHIO & RPLASY FLAGS.@VS49571
*                                                              @VS49571
        CLSDST RPL=(PTRRPL),                                   @VS49571*
               EXIT=CDSTEND1,                                  @VS49571*
               OPTCD=RELEASE,                                  @VS49571*
               ARG=(R2)                                        @VS49571
         SPACE 2                                               @VS49571
         NI    MFLAGS2,FF-CLSDST       INDICATE CLOSE DONE     @VS49571
         SPACE 1                                               @VS49571
         TM    FLAGS2,SYNCHIO          WAS THIS OPERATION DONE @VS49571
*                                       WITH A SYNCH RPL?      @VS49571
         BO    CDST15                  YES, SKIP THE CHECK     @VS49571
         EJECT                                                 @VS49571
***                                                            @VS49571
*                                                              @VS49571
*  ERROR ACTIONS FOR CLSDST(RELEASE)                           @VS49571
*                                                              @VS49571
*                                                   ACTION     @VS49571
*  RTNCD FDBK2                                      CODE(S)    @VS49571
*  CODE  CODE         MEANING                       RETURNED   @VS49571
*                                                   (R15 R0)   @VS49571
*                                                              @VS49571
*   00    00    SUCCESSFUL COMPLETION                00  00    @VS49571
*   08    00    TEMP STORAGE ALLOCATION FAILURE      10  00    @VS49571
*                                                              @VS49571
***                                                            @VS49571
         SPACE 2                                               @VS49571
         CH    R15,HEX10               VTAM BUFFERS FULL?      @VS49571
*                                       (ONLY POSSIBLE ERROR)  @VS49571
         BE    CLOSEREL                YES. REISSUE            @VS49571
         LTR   R15,R15                 CLSDST ACCEPTED?        @VS49571
         BNZ   SNOCCUR                 NO. IMPOSSIBLE          @VS49571
         LTR   R0,R0                   ACCEPTED? (2ND TEST)?   @VS49571
         BNZ   SNOCCUR                 NO. ERROR               @VS49571
*                                                              @VS49571
* * * * * * * * END OF CLSDST ERROR HANDELING * * * * * * * *  @VS49571
         SPACE 4                                               @VS49571
         B     RETURN              GO BACK TO VTAM AND         @VS49571
*                                  WAIT FOR EXIT TO BE SCHEDULE@VS49571
*                                                              @VS49571
         EJECT                                                 @VS49571
         SPACE 2                                               @VS49571
***************************************************************@VS49571
*                                                              @VS49571
*        CHECK VALIDITY OF THE CLSDST(RELEASE)                 @VS49571
*        ENTRY IS FROM THE CLSDST(RELEASE) IN THE RELEASE RTN. @VS49571
*                                                              @VS49571
*        REGISTER 1 - POINTS TO THE RPL USED.                  @VS49571
*        REGISTER 15 - BASE REGISTER                           @VS49571
*                                                              @VS49571
***************************************************************@VS49571
         SPACE 2                                               @VS49571
CDSTEND1 EQU   *                                               @VS49571
*        XXXXXXXXXX                                            @VS49571
         DROP  R10                                             @VS49571
         DROP  R11                     BASE REGS NOT SET UP    @VS49571
         DROP  R12                      YET                    @VS49571
         USING *,R15                   ESTABLISH INITIAL ADDRES@VS49571
*        XXXXXXXXXX                                            @VS49571
         L     R12,STARTADD            R12 IS BASE REGISTER    @VS49571
*        XXXXXXXXXX                                            @VS49571
         DROP  R15                                             @VS49571
         USING START,R12,R11,R10       ALL BASE REGS SET       @VS49571
*        XXXXXXXXXX                                            @VS49571
*                                                              @VS49571
         L     R11,BASE2               LOAD 2ND BASE REGISTER  @VS49571
         L     R10,BASE3               LOAD 3RD BASE REGISTER  @VS49571
         ST    R14,RETVTAM@            SAVE EXIT RETURN ADDRESS@VS49571
         LA    R13,GENSAVE             POINT TO SAVE-AREA      @VS49571
         SPACE 2                                               @VS49571
         TM    UFLAGS,SHUTDOWN         SHUTDOWN IN PROGRESS?   @VS49571
         BO    RETURN                  YES. NO MORE ACTION     @VS49571
         SPACE 2                                               @VS49571
         LR    PTRRPL,R1               POINT TO THE INPUT RPL  @VS49571
         EJECT                                                 @VS49571
         SPACE 8                                               @VS49571
         OI    MFLAGS2,CLSDST          TELL ERREXIT THAT ERROR @VS49571
*                                       IS FOR CLSDST(RELEASE) @VS49571
*        CHECK RPL=(PTRRPL)            CHECK FOR ERROR, ERREXIT@VS49571
*                                       IS ENTERED IF ERRORS HAVE
*                                       OCCURRED
         CHECK RPL=(PTRRPL)                                    @VS49571
         SPACE 2
         NI    MFLAGS2,X'FF'-CLSDST    RESET CLSDST INDICATOR  @VS49571
         EJECT                                                 @XL03HAJ
***                                                            @VS49571
*                                                              @VS49571
*  ERROR ACTIONS FOR CLSDST(RELEASE)                           @VS49571
*                                                              @VS49571
*                                                   ACTION     @VS49571
*  RTNCD FDBK2                                      CODE(S)    @VS49571
*  CODE  CODE         MEANING                       RETURNED   @VS49571
*                                                   (R15 R0)   @VS49571
*                                                              @VS49571
*   00    00    SUCCESSFUL COMPLETION                00  00    @VS49571
*   08    00    TEMP STORAGE ALLOCATION FAILURE      10  00    @XL03HAJ
*   0C    0B    REQUEST CANCELLED BY CLSDST          14  00    @VS49571
*   10    0A    APPARENT VTAM ERROR                  20  00    @ZA32289
*   10    0E    ABEND IN VTAM                        SNOCCUR   @XL03HAJ
*   14    12    CLSDST IN PROGRESS                   14  00    @VS49571
*   14    13    CID INVALID                          14  00    @XL03HAJ
*   14    5D    OPNDST INVALID (TERM NOT CONNECTED)  14  00    @VS49571
*   14    60    RESOURCE NOT CLOSABLE                14  00    @XL03HAJ
*                                                              @XL03HAJ
***                                                            @XL03HAJ
         SPACE 2                                               @VS49571
CDST15   EQU   *                                               @VS49571
         SPACE 2                                               @VS49571
         OI    EXITFLAG,CLOSEX         INDICATE IN CLOSE REL EX@VS49571
         CL    R1,ARPL0                IS IT RPL0              @ZA34716
         BE    RASYNCH                 YES CONTINUE RELEASE    @ZA34716
         TM    FLAGS2,SYNCHIO          SYNCH RPL?              @ZA34716
         BO    RETURN                  YES RETURN TO VTAM      @ZA34716
         SPACE 2                                               @XL03HAJ
RASYNCH  EQU   *                                               @ZA34716
         CH    R15,HEX20               HIGHEST POSSIBLE ACTION @ZA32289
         BH    SNOCCUR                  CODE IS X'20'          @ZA32289
         B     ERRTAB9(R15)            CHECK VALID ACTIONS     @XL03HAJ
ERRTAB9  B     R0CHK9               0  PROBABLY RELEASED IT    @XL03HAJ
         BAL   R7,SNOCCUR           4                          @VS49571
         BAL   R7,SNOCCUR           8  ALREADY RELEASING, NEW  @VS49571
*                                       RELEASE WON'T HELP     @XL03HAJ
         BAL   R7,SNOCCUR           C  NO MSG TO WRITE AND     @VS49571
*                                       PROBABLY COULDN'T      @XL03HAJ
*                                       ANYWAY                 @XL03HAJ
         B     CLOSEREL            10  REISSUE.                @VS49571
         B     FREERPL             14  IT COULD BE THAT NETSOL @VS49571
*                                       NO LONGER HAS THE      @XL03HAJ
*                                       DEVICE SINCE IT WAS    @XL03HAJ
*                                       ALREADY FREED BY A LOSTERM,
*                                       RELREQ OR READEND      @VS49571
*                                       REQUEST.               @VS49571
         BAL   R7,SNOCCUR          18                          @ZA32289
         BAL   R7,SNOCCUR          1C                          @ZA32289
         B     PROBDEV             20  PROBLEM WITH DEVICE     @ZA32289
         SPACE 2                                               @XL03HAJ
R0CHK9   EQU   *                                               @XL03HAJ
         LTR   R0,R0                   VALID COMPLETION?       @XL03HAJ
         BNZ   SNOCCUR                 ERROR IF NOT            @XL03HAJ
*                                                              @XL03HAJ
* * * * * * * * END OF CLSDST ERROR HANDLING * * * * * * * * * @XL03HAJ
*                                                              @XL03HAJ
         TM    FLAGS,RELOPND           WAS DEVICE RELEASED     @XL03HAJ
*                                       PRIOR TO OPNDST        @XL03HAJ
*                                       BECAUSE TEST REQUEST   @XL03HAJ
*                                       SET (ERROR CODE 0C/02)?@XL03HAJ
         BZ    FREERPL                 NO.  JUST READ(ANY)     @VS49571
         NI    FLAGS,X'FF'-RELOPND     YES. TURN OFF FLAG      @XL03HAJ
         EJECT                                                 @VS49571
         SPACE 2                                               @VS49571
***************************************************************@VS49571
*                                                              @VS49571
*  AFTER RELEASING THE TERMINAL, IT MAY BE NECESSARY TO        @VS49571
*  RE-ACQUIRE IT, OR AT LEAST ATTEMPT TO RE-ACQUIRE IT, FOR THE@VS49571
*  FOLLOWING REASONS:                                          @VS49571
*                                                              @VS49571
*    THE OTHER APPLICATION MAY CANCEL ITS REQUEST FOR THE      @VS49571
*    TERMINAL AFTER NETSOL'S RELREQ EXIT HAS ISSUED THE        @VS49571
*    CLSDST(RELEASE), BUT BEFORE LOGGING ONTO THE TERMINAL.    @XL03HAJ
*    IN THIS CASE NETSOL WISHES TO RE-ACQUIRE THE TERMINAL.    @XL03HAJ
*    THE TERMINAL WILL ONLY BE ACQUIRED BY NETSOL IF THE       @XL03HAJ
*    OTHER APPLICATION HAS NOT ALREADY LOGGED ON THE TERMINAL. @XL03HAJ
*                                                              @XL03HAJ
*    THE TERMINAL MAY HAVE BEEN RELEASED BECAUSE IT WAS LOGGED @XL03HAJ
*    ON TO NETSOL WHEN THE TEST REQUEST KEY WAS SET.  THIS     @XL03HAJ
*    BLOCKS ALL FURTHER I/O TO THE DEVICE, INCLUDING ENTRY OF  @XL03HAJ
*    A LOGON SEQUENCE NECESSARY TO PASS THE DEVICE TO TOLTEP.  @XL03HAJ
*    NETSOL MUST RELEASE, THEN RE-ACQUIRE THE DEVICE SO THAT   @XL03HAJ
*    I/O IS NO LONGER BLOCKED.                                 @VS49571
*                                                              @VS49571
***************************************************************@VS49571
         SPACE 2                                               @VS49571
         LA    PTRNIB,SYNCHNIB         POINT TO THE NIB        @VS49571
         MVC   NIBSYM(EIGHT),NAMEDEV   GET THE SYMBOLIC NAME   @VS49571
         MVC   NIBUSER(FOUR),USERWORD  SAVE DEVICE CHAR.       @VS49571
*                                                              @VS49571
*   NOTE; PROC FIELD IS O.K. DUE TO DEFAULTS                   @VS49571
         SPACE 2                                               @VS49571
REOPEN   EQU *                                                 @VS49571
         SPACE 2                                               @VS49571
*                                       USE BY ERREXIT         @VS49571
***                                                            @VS49571
*                                                              @VS49571
*  MUST USE NIB WITH SYMBOLIC TERMINAL NAME BECAUSE THE CID IS @VS49571
*  NO LONGER VALID AFTER DEVICE IS RELEASED.  OPNDST(SPEC)     @VS49571
*  MUST HAVE A SYMBOLIC TERMINAL NAME SUPPLIED.                @VS49571
*                                                              @VS49571
***                                                            @VS49571
         SPACE 2                                               @VS49571
         OI    MFLAGS,OPNDSPEC         SET INDICATOR FOR       @VS49571
         OI    MACFLAGS,OPNSPEC                                @VS49571
         SPACE 2                                               @VS49571
*       OPNDST RPL=SYNCHRPL,                                   @VS49571
*              OPTCD=(SPEC,ACQUIRE),                           @VS49571
*              NIB=SYNCHNIB                                    @VS49571
        OPNDST RPL=SYNCHRPL,                                   @VS49571*
               OPTCD=(SPEC,ACQUIRE),                           @VS49571*
               NIB=SYNCHNIB                                    @VS49571
         SPACE 2                                               @VS49571
         NI    MFLAGS,X'FF'-OPNDSPEC   RESET INDICATOR         @VS49571
         EJECT                                                 @VS49571
         SPACE 2                                               @VS49571
***                                                            @VS49571
*                                                              @VS49571
*  ERROR ACTIONS FOR OPNDST(SPEC)                              @VS49571
*                                                              @VS49571
*                                                   ACTION     @VS49571
*  RTNCD FDBK2                                      CODE(S)    @VS49571
*  CODE  CODE         MEANING                       RETURNED   @VS49571
*                                                   (R15 R0)   @VS49571
*                                                              @VS49571
*   00    00    SUCCESSFUL COMPLETION                00  00    @VS49571
*   08    00    TEMP STORAGE ALLOCATION FAILURE      10  00    @VS49571
*   0C    05    NCP ABEND.  RESTART SUCCESSFUL       10  08    @VS49571
*   10    00    DEVICE UNAVAILABLE                   14  00    @VS49571
*   10    03    VTAM IS HALTING                      SNOCCUR   @VS49571
*   10    05    PERMENENT FAILURE IN PATH            08  00    @VS49571
*   10    06    AUTO NETWORK SHUTDOWN                08  00    @VS49571
*   10    0A    APPARENT VTAM ERROR                  20  00    @ZA32289
*   10    0E    ABEND IN VTAM                        SNOCCUR   @VS49571
*   14    12    CLSDST IN PROGRESS                   14  00    @VS49571
*   14    55    NO OPNDST AUTHORIZATION              SNOCCUR   @VS49571
*                                                              @VS49571
***                                                            @VS49571
         SPACE 2                                               @VS49571
         CH    R15,HEX20               HIGHEST VALID ACTION    @ZA32289
         BH    SNOCCUR                  CODE IS X'20'          @ZA32289
         SPACE 2                                               @VS49571
         B     ERRTAB7(R15)            CHECK VALID ACTIONS     @VS49571
ERRTAB7  B     R0CHK7               0  CHECK IF DEVICE ACCEPTED@XL03HAJ
         BAL   R7,SNOCCUR           4                          @VS49571
         BAL   R7,SNOCCUR           8  CAN'T RELEASE IF CAN'T  @VS49571
*                                       GET IT                 @XL03HAJ
         BAL   R7,SNOCCUR           C  CAN'T WRITE MSG IF NOT  @VS49571
*                                      CONNECTED               @XL03HAJ
         B     ERROPENB            10  REISSUE. NO NEED TO     @XL03HAJ
*                                       CHECK FOR RESET        @XL03HAJ
         B     FREERPL             14  A NORMAL CASE.  FAILED  @VS49571
*                                       TO RECONNECT DEVICE.   @XL03HAJ
         BAL   R7,SNOCCUR          18                          @ZA32289
         BAL   R7,SNOCCUR          1C                          @ZA32289
         B     PROBDEV             20  PROBLEMWITH DEVICE      @ZA32289
         SPACE 2                                               @VS49571
ERROPENB EQU   *                                               @VS49571
         CH    R0,HEX8                                         @VS49571
         BL    REOPEN                  REISSUE THE COMMAND     @VS49571
         LA    R9,REOPEN               LOAD ADDR WHERE TO RETURN
         B     RESETSUB                ISSUE THE RESET         @VS49571
         SPACE 2                                               @VS49571
R0CHK7   EQU *                                                 @VS49571
         CH    R0,HEX8                 TERMINAL RECONNECTED?   @VS49571
         BE    FREERPL                 NO. THIS IS WHAT IS     @VS49571
*                                       WANTED.  CONTINUE      @VS49571
*                                       WITH OTHER DEVICES.    @VS49571
         LTR   R0,R0                   SUCCESSFUL COMPLETION?  @VS49571
         BNZ   SNOCCUR                 NO. ERROR               @VS49571
*                                                              @VS49571
* * * * * * * * END OF OPNDST ERROR HANDLING * * * * * * * * * @VS49571
*                                                              @VS49571
         B     RESOLCIT                REDO THE SOLICIT        @VS49571
         TITLE 'RESETSUB - ISSUE A RESET TO A TERMINAL'        @VS49571
         SPACE 2                                               @VS49571
***************************************************************@VS49571
*                                                              @VS49571
*                     RESET (UNCOND)                           @VS49571
*                                                              @VS49571
*        RESETSUB ISSUES THE RESET (UNCOND) FOR DEVICES.       @VS49571
*        IT HAS ITS OWN EXIT ROUTINE CALLED RESETEND.          @VS49571
*        AFTER NORMAL PROCESSING, CONTROL IS RETURNED TO THE   @VS49571
*        CALLING ROUTINE USING REGISTER NINE.  FOR ERROR       @VS49571
*        CONDITIONS SEE RESETEND.                              @VS49571
*                                                              @VS49571
*        INPUT REGISTERS:                                      @VS49571
*                                                              @VS49571
*              REG 10-12 - BASE REGISTERS                      @VS49571
*              REG 5     - POINTS TO RPL. (SYNCH OR ASYNCH)    @VS49571
*              REG 9     - POINTS TO CALLER'S RETURN ADDRESS   @VS49571
*                                                              @VS49571
*        OUTPUT REGISTERS:                                     @VS49571
*                                                              @VS49571
*              REG 0-1   - UNPREDICTABLE                       @VS49571
*              REG 2-13  - VALUE AT INPUT                      @VS49571
*              REG 14-15 - UNPREDICTABLE                       @VS49571
*                                                              @VS49571
*                                                              @VS49571
***************************************************************@VS49571
         SPACE 2                                               @VS49571
RESETSUB EQU   *                                               @VS49571
         ST    R9,RTNSAVE             SAVE RETURN ADDRESS     @VS49571
         OI    MACFLAG2,RESETUN        RESET(UNCOND) INDICATOR @VS49571
RSETAGIN EQU   *                                               @VS49571
         OI    MFLAGS,RESETU           RESET(UNCOND) INDICATOR @VS49571
*                                                              @VS49571
*        RESET RPL=(PTRRPL),           RPL IS SET FOR SYNCH OR @VS49571
*              OPTCD=UNCOND,            ASYNCH OPERATION.      @VS49571
*              EXIT=RESETEND                                   @VS49571
         RESET RPL=(PTRRPL),                                   @VS49571*
               OPTCD=UNCOND,                                   @VS49571*
               EXIT=RESETEND                                   @VS49571
         SPACE 2                                               @VS49571
         NI    MFLAGS,X'FF'-RESETU     TURN OFF FLAG           @XL03HAJ
         SPACE 2                                               @VS49571
         TM    FLAGS2,SYNCHIO          WAS THIS RESET DONE WITH@VS49571
*                                       THE SYNCHRPL           @VS49571
         BO    RSETCHK                 YES, SKIP CHECK MACRO   @VS49571
         EJECT                                                 @VS49571
         SPACE 2                                               @VS49571
***                                                            @VS49571
*                                                              @VS49571
*  ERROR ACTIONS FOR RESET                                     @VS49571
*                                                              @VS49571
*                                                   ACTION     @VS49571
*  RTNCD FDBK2                                      CODE(S)    @VS49571
*  CODE  CODE         MEANING                       RETURNED   @VS49571
*                                                   (R15 R0)   @VS49571
*                                                              @VS49571
*   00    00    SUCCESSFUL COMPLETION                00  00    @VS49571
*   08    00    TEMP STORAGE ALLOCATION FAILURE      10  00    @VS49571
*                                                              @VS49571
***                                                            @VS49571
         SPACE 2                                               @VS49571
         CH    R15,HEX10               VTAM BUFFERS FULL?      @VS49571
*                                       (ONLY POSSIBLE ERROR)  @VS49571
         BE    RSETAGIN                YES. REISSUE            @VS49571
         LTR   R15,R15                 RESET ACCEPTED?         @VS49571
         BNZ   SNOCCUR                 NO. IMPOSSIBLE          @VS49571
         LTR   R0,R0                   ACCEPTED? (2ND CHECK)?  @VS49571
         BNZ   SNOCCUR                 NO. ERROR               @VS49571
*                                                              @VS49571
* * * * * * * * END OF RESET ERROR HANDLING * * * * * * * * * *@VS49571
*                                                              @XL03HAJ
         SPACE 8                                               @XL03HAJ
         B     RETURN                  RETURN TO VTAM          @VS49571
         EJECT                                                 @VS49571
************************************************************** @VS49571
*                                                              @VS49571
*        CHECK OUT THE RESET                                   @VS49571
*                                                              @VS49571
*        REGISTER 1 - POINTS TO THE RPL USED IN THE RESET.     @VS49571
*                                                              @VS49571
************************************************************** @VS49571
         SPACE 1                                               @VS49571
RESETEND EQU   *                                               @VS49571
         SPACE 1                                               @VS49571
*        XXXXXXXXXX                                            @VS49571
         DROP  R10                                             @VS49571
         DROP  R11                     BASE REGS NOT SET UP    @VS49571
         DROP  R12                      YET                    @VS49571
         USING *,R15                   ESTABLISH INITIAL ADDRES@VS49571
*        XXXXXXXXXX                                            @VS49571
         L     R12,STARTADD            R12 IS BASE REGISTER    @VS49571
*        XXXXXXXXXX                                            @VS49571
         DROP  R15                                             @VS49571
         USING START,R12,R11,R10       ALL BASE REGS SET       @VS49571
*        XXXXXXXXXX                                            @VS49571
*                                                              @VS49571
         L     R11,BASE2               LOAD 2ND BASE REGISTER  @VS49571
         L     R10,BASE3               LOAD 3RD BASE REGISTER  @VS49571
         ST    R14,RETVTAM@            SAVE EXIT RETURN ADDRESS@VS49571
         LA    R13,GENSAVE             POINT TO SAVE-AREA      @VS49571
         SPACE 1                                               @VS49571
         TM    UFLAGS,SHUTDOWN         SHUTDOWN IN PROGRESS?   @VS49571
         BO    RETURN                  YES. NO MORE ACTION     @VS49571
         SPACE 1                                               @VS49571
         LR    PTRRPL,R1               GET THE RPL POINTER     @VS49571
CHECKRST EQU   *                                               #XL03HAJ
         OI    MFLAGS,RESETU           TELL ERREXIT THAT ERRORS@ZA31146
*                                       ARE FOR RESET          @VS49571
         SPACE 1                                               @XL03HAJ
*        CHECK RPL=(PTRRPL)            CHECK FOR ERROR, ERREXIT@VS49571
*                                      IS ENTERED IF ERRORS HAVE
*                                      OCCURRED
         CHECK RPL=(PTRRPL)                                    @VS49571
         SPACE 1                                               @XL03HAJ
         NI    MFLAGS,X'FF'-RESETU     RESET INDICATOR         @ZA31146
         EJECT                                                 @VS49571
***                                                            @XM9733K
*                                                              @XM9733K
*  ERROR ACTIONS FOR RESET                                     @XM9733K
*                                                              @XM9733K
*                                                   ACTION     @VS49571
*  RTNCD FDBK2                                      CODE(S)    @VS49571
*  CODE  CODE         MEANING                       RETURNED   @VS49571
*                                                   (R15 R0)   @VS49571
*                                                              @XM9733K
*   00    00    SUCCESSFUL COMPLETION                00  00    @VS49571
*   08    00    TEMP STORAGE ALLOCATION FAILURE      10  00    @VS49571
*   0C    04    BUFFER THRESHOLD EXCEEDED            00  00    @VS49571
*   0C    05    NCP ABEND.  RESTART SUCCESSFUL       10  00    @VS49571
*   0C    06    NCP ABEND.  LAST PURGE               10  08    @VS49571
*   0C    0B    REQUEST CANCELLED BY CLSDST          14  00    @VS49571
*   10    04    VTAM/NCP INCOMPATABILITY             14  00    @VS49571
*   10    05    PERMANENT PATH FAILURE               08  00    @VS49571
*   10    06    AUTO NETWORK SHUTDOWN                08  00    @VS49571
*   10    07    VARY DEACTIVATE IMMEDIATE            08  00    @VS49571
*   10    0E    ABEND IN VTAM                        SNOCCUR   @VS49571
*   14    12    CLSDST IN PROGRESS                   14  00    @VS49571
*   14    13    CID INVALID                          14  00    @VS49571
*   14    5D    OPNDST INVALID (TERM NOT CONNECTED)  14  00    @VS49571
*                                                              @VS49571
***                                                            @VS49571
         SPACE 2                                               @VS49571
RSETCHK  EQU   *                                               @VS49571
         SPACE 2                                               @VS49571
         OI    EXITFLAG,RESETEX       INDICATE IN RESET EXIT   @VS49571
         SPACE 2                                               @VS49571
         CH    R15,HEX20               HIGHEST POSSIBLE ACTION @ZA32289
         BH    SNOCCUR                  CODE IS X'20'          @ZA32289
         B     ERRTABF(R15)            CHECK VALID ACTIONS     @XM9733K
ERRTABF  B     R0CHKF               0  RESET GO OK?            @XM9733K
         BAL   R7,SNOCCUR           4                          @VS49571
         B     RELEASE              8  CONNECTION TO DEVICE IS @XM9733K
*                                       KAPUT; MAKE IT OFFICIAL@XM9733K
         BAL   R7,SNOCCUR           C  NO ERRORS THAT GIVE MSG @VS49571
         B     RSETAGIN            10  REISSUE RESET IN ALL    @XM9733K
*                                       CASES                  @XM9733K
         B     FREERPL             14  RELEASE RPL AND RETURN  @VS49571
         B     RSETDONE                THEN CONTINUE PROCESSING@VS49571
         BAL   R7,SNOCCUR          18                          @ZA32289
         BAL   R7,SNOCCUR          1C                          @ZA32289
         B     PROBDEV             20 PROBLEM WITH DEVICE      @ZA32289
         SPACE 2                                               @XM9733K
R0CHKF   EQU   *                                               @VS49571
         LTR   R0,R0                   SUCCESSFUL COMPLETION?  @VS49571
         BNZ   SNOCCUR                  NO. ERROR              @VS49571
*                                                              @VS49571
* * * * * * * * END OF RESET ERROR HANDLING * * * * * * * * *  @VS49571
*                                                              @VS49571
RSETDONE OI    FLAGS,ONERESET          FLAG SUCCESSFUL RESET   @VS49571
         SPACE 2                                               @VS49571
         L     R9,RTNSAVE             LOAD RETURN ADDRESS     @VS49571
         BR    R9                      RETURN TO CALLING RTN   @VS49571
         TITLE 'CHANGE - MODIFY THE USERFIELD OF THE NIB'      @ZA13672
         SPACE 2                                               @ZA13672
***************************************************************@ZA13672
*                                                              @ZA13672
*                     CHANGE                                   @ZA13672
*                                                              @VS49571
*        CHANGE ISSUES A CHANGE TO MODIFY THE USERFIELD.       @VS49571
*        THIS SUBROUTINE EXPECTS THE CHANGE TO ALREADY BE IN   @ZA13672
*        THE USERWORD IN THE RPL WORKAREA.                     @ZA13672
*                                                              @ZA13672
*        INPUT REGISTERS:                                      @VS49571
*                                                              @VS49571
*              REG 10-12 - BASE REGISTERS                      @VS49571
*              REG 5     - POINTS TO RPL. (SYNCH OR ASYNCH)    @VS49571
*
*                                                              @VS49571
*        OUTPUT REGISTERS:                                     @VS49571
*                                                              @VS49571
*              REG 0-1   - UNPREDICTABLE                       @VS49571
*              REG 2-13  - VALUE AT INPUT                      @VS49571
*              REG 14-15 - UNPREDICTABLE                       @VS49571
*                                                              @VS49571
*                                                              @VS49571
***************************************************************@VS49571
         SPACE 2                                               @VS49571
CHANGE   EQU   *                                               @ZA13672
         ST    R9,RTNSAVE              SAVE CALLER ADDRESS     @ZA13672
         OI    MACFLAG2,CHANGNIB       CHANGE NIB INDICATOR    @ZA13672
         TM    FLAGS2,MODMLOOP         LOOP BECAUSE INT REQ ?  @ZA13672
         BNO   SNOCCUR                 NO. SOMETHING WRONG     @ZA13672
         LA    R8,SYNCHNIB             SET UP NIB ADDRESS      @ZA13672
         MVC   NIBUSER(4),USERWORD     UPDATE NIB USERFIELD    @ZA13672
         MVC   NIBCID(4),CID           PUT CID IN NIB          @ZA13672
RECHANGE EQU   *                                               @ZA13672
         OI    MFLAGS,CHNGENIB         CHANGE NIB INDICATOR    @ZA13672
*                                                              @ZA13672
*       CHANGE RPL=SYNCHRPL,           RPL IS SET FOR SYNCH    @ZA13672
*              NIB=SYNCHNIB             OPERATION.             @ZA13672
        CHANGE RPL=SYNCHRPL,                                   @ZA13672*
               NIB=SYNCHNIB                                    @ZA13672
         SPACE 2                                               @ZA13672
         NI    SRPLEXT1,FF-RPLNIB      TURN OFF RPLNIB FLAG    @ZA13672
         NI    MFLAGS,X'FF'-CHNGENIB   TURN OFF FLAG           @ZA13672
         EJECT                                                 @ZA13672
         SPACE 2                                               @ZA13672
***                                                            @ZA13672
*                                                              @ZA13672
*  ERROR ACTIONS FOR CHANGE                                    @XM9733K
*                                                              @XM9733K
*                                                   ACTION     @VS49571
*  RTNCD FDBK2                                      CODE(S)    @VS49571
*  CODE  CODE         MEANING                       RETURNED   @VS49571
*                                                   (R15 R0)   @VS49571
*                                                              @XM9733K
*   00    00    SUCCESSFUL COMPLETION                00  00    @VS49571
*   08    00    TEMP STORAGE ALLOCATION FAILURE      10  00    @VS49571
*   0C    05    NCP ABEND.  RESTART SUCCESSFUL       10  00    @VS49571
*   10    05    PERMANENT PATH FAILURE               08  00    @VS49571
*   10    06    AUTO NETWORK SHUTDOWN                08  00    @VS49571
*   10    07    VARY DEACTIVATE IMMEDIATE            08  00    @VS49571
*   10    0D    VTAM INACTIVE TO YOUR TCB            SNOCCUR   @ZA13672
*   10    0E    ABEND IN VTAM                        SNOCCUR   @VS49571
*   14    12    CLSDST IN PROGRESS                   14  00    @VS49571
*   14    13    CID INVALID                          14  00    @VS49571
*   14    52    NIB INVALID                          SNOCCUR   @ZA13672
*   14    5D    OPNDST INVALID (TERM NOT CONNECTED)  14  00    @VS49571
*                                                              @VS49571
***                                                            @VS49571
         SPACE 2                                               @VS49571
         CH    R15,HEX20               HIGHEST POSSIBLE ACTION @ZA32289
         BH    SNOCCUR                  CODE IS X'20'          @ZA32289
         B     ERRTABG(R15)            CHECK VALID ACTIONS     @XM9733K
ERRTABG  B     R0CHKG               0  CHANGE GO OK?           @XM9733K
         BAL   R7,SNOCCUR           4                          @VS49571
         B     RELEASE              8  CONNECTION TO DEVICE IS @XM9733K
*                                       KAPUT; MAKE IT OFFICIAL@XM9733K
         BAL   R7,SNOCCUR           C  NO ERRORS THAT GIVE MSG @VS49571
         B     RECHANGE            10  REISSUE CHANGE IN ALL   @XM9733K
*                                       CASES                  @XM9733K
         B     FREERPL             14  RELEASE RPL AND RETURN  @VS49571
         BAL   R7,SNOCCUR          18                          @ZA32289
         BAL   R7,SNOCCUR          1C                          @ZA32289
         B     PROBDEV             20  PROBLEM WITH DEVICE     @ZA32289
         SPACE 2                                               @XM9733K
R0CHKG   EQU   *                                               @ZA13672
         LTR   R0,R0                   SUCCESSFUL COMPLETION?  @VS49571
         BNZ   SNOCCUR                  NO. ERROR              @VS49571
*                                                              @VS49571
* * * * * * * * END OF CHANGE ERROR HANDLING  * * * * * * * *  @VS49571
*                                                              @VS49571
         SPACE 2                                               @ZA13672
         L     R9,RTNSAVE             LOAD RETURN ADDRESS      @ZA13672
         BR    R9                     RETURN TO CALLER         @ZA13672
         TITLE 'GETRPL - FINDS THE FIRST FREE RPL IN A TABLE'  @VS49571
************************************************************** @VS49571
*                                                              @VS49571
*        THE GETRPL SUBROUTINE HAS TWO FUNCTIONS.  ITS PRIMARY @VS49571
*        FUNCTION IS TO LOCATE AND INITIALIZE AN RPL/WORKAREA  @VS49571
*        AVAILABLE TO BE USED FOR ASYNCHRONOUS I/O REQUESTS    @VS49571
*        (AND SYNCHRONOUS I/O REQUESTS IN CERTAIN CASES).  ITS @VS49571
*        SECONDARY FUNCTION IS TO FLAG AS PENDING THOSE        @VS49571
*        REQUESTS THAT NEED AN RPL/WORKAREA WHEN NONE IS       @VS49571
*        AVAILABLE.                                            @VS49571
*                                                              @VS49571
*        INPUT REGISTERS:                                      @VS49571
*                                                              @VS49571
*              REG 10-12 - BASE REGISTERS                      @VS49571
*              REG 14    - CALLER'S RETURN ADDRESS             @VS49571
*              REG 15    - REQUEST-TYPE CODE WHICH IDENTIFIES  @VS49571
*                          THE CALLER                          @VS49571
*                          0 - READEND EXIT-ROUTINE            @VS49571
*                          4 - LOSTERM EXIT-ROUTINE            @VS49571
*                          8 - RELREQ  EXIT-ROUTINE            @VS49571
*                         12 - LOGON   EXIT-ROUTINE            @VS49571
*                                                              @VS49571
*        OUTPUT REGISTERS:                                     @VS49571
*                                                              @VS49571
*              REG 0   - UNPREDICTABLE                         @VS49571
*              REG 1   - VALUE AT INPUT                        @VS49571
*              REG 2-4 - UNPREDICTABLE                         @VS49571
*              REG 5   - ADDRESS OF AN INITIALIZED REL/WORKAREA@VS49571
*                        OR ZERO.  IF REGISTER 5 IS ZERO, THEN @VS49571
*                        THE PENDING FLAG IS SET FOR THAT REQUEST.
*                                                              @VS49571
***************************************************************@VS49571
         SPACE 2                                               @VS49571
GETRPL   EQU   *                                               @VS49571
         SPACE 2                                               @VS49571
         ST    R14,SUBSAV14            SAVE RETURN ADDR        @VS49571
         LR    R14,R1                  SAVE R1 FOR CALLER      @VS49571
         SR    R2,R2                   CLEAR OUT POINTER       @VS49571
         TRT   RNDXTABL(NUMRPLS),RNDXTABL                      @VS49571
*                                      THIS POINTS R1 AT THE   @VS49571
*                                       FIRST ENTRY THAT IS NOT@VS49571
*                                       ZERO. R2 CONTAINS RPL# @VS49571
*                                       OF THE FIRST FREE RPL  @VS49571
*                                       SLOT IN RDNXTABL.      @VS49571
         LTR   R2,R2                   WAS A FREE RPL FOUND    @VS49571
         BZ    NONEFREE                NO, CHECK IF WE NEED    @VS49571
*                                       TO USE RPL0            @VS49571
         EJECT                                                 @VS49571
         SPACE 9                                               @VS49571
*                                                              @VS49571
*        A FREE RPL WAS FOUND (NOTE: RPL0 IS NEVER FREE)       @VS49571
*                                                              @VS49571
         MVI   D0(R1),ZERO             INDICATE THIS RPL BUSY  @VS49571
         LR    R5,R2                   PREPARE FOR MULT.       @VS49571
         M     R4,LNGTHRPL             R5 CONTAINS THE         @VS49571
*                                       DISPLACEMENT           @VS49571
         A     R5,ARPL0                R5 NOW POINTS TO THE RPL@VS49571
         EJECT                                                 @VS49571
         SPACE 6                                               @VS49571
INITRPL  EQU   *                       INITIALIZE THE RPL      @VS49571
         MVC   IFGRPL(LNIFGRPL),FRESHRPL                       @VS49571
*                                      INIT THE RPL AREA       @VS49571
*        NOTE THIS MAKES THE RPL ASYNCH                        @VS49571
*                                                              @VS49571
         MVI   WORKSPAC,ZERO           MOVE ZERO'S TO THE      @VS49571
*                                       RPL WORK AREA          @VS49571
         MVC   WORKSPAC+ONE(WORKRPLA),WORKSPAC                 @VS49571
         MVC   WORKSPAC+WORKRPLA(WRPLREST),WORKSPAC            @VS49571
         C     R5,ARPL0                IS THIS RPL0            @VS49571
         BNE   GETRPLND                NO, BRANCH              @VS49571
*                                                              @VS49571
*        RPL0 MUST BE MADE SYNCH                               @VS49571
*                                                              @VS49571
         NI    RPLOPT1,FF-RPLASY       MAKE RPL SYN            @VS49571
         OI    FLAGS2,SYNCHIO          MAKE WORK AREA SYN      @VS49571
         SPACE 4                                               @VS49571
GETRPLND EQU   *                                               @VS49571
*                                                              @VS49571
*        EXIT FROM THE SUBRTN                                  @VS49571
*                                                              @VS49571
         LR    R1,R14                  RESET R1                @VS49571
         L     R14,SUBSAV14            GET RETURN ADDR TO CALLR@VS49571
         BR    R14                     RETURN TO CALLER        @VS49571
         EJECT                                                 @VS49571
         SPACE 4                                               @VS49571
NONEFREE EQU   *                                               @VS49571
         SPACE 2                                               @VS49571
         LTR   R15,R15                 IS CALLER 'READEND' EXIT@VS49571
         BNZ   SEEIFLGN                NO, SEE IF FROM LOGON   @VS49571
         SPACE 2                                               @VS49571
         OI    UFLAGS,NEEDREAD         INDICATE READ PENDING   @VS49571
         SPACE 2                                               @VS49571
GOTNONE  EQU   *                                               @VS49571
         SPACE 2                                               @VS49571
         SR    R5,R5                   PASS BACK NO RPL        @VS49571
         B     GETRPLND                GO BACK TO CALLER       @VS49571
         SPACE 4                                               @VS49571
SEEIFLGN EQU   *                                               @VS49571
         SPACE 2                                               @VS49571
         CH    R15,HEXC                IS CALLER 'LOGON' EXIT  @VS49571
*                                       TO PUT OUT READ        @ZA13651
         BE    GOTNONE                 YES, GIVE NO RPL TO CALLER
*                                      NO, IT MUST BE RELREQ,  @ZA13651
*                                       LOSTERM OR LOGON TO    @ZA13651
*                                       PUT OUT ERASE WRITE    @ZA13651
         SPACE 2                                               @VS49571
         L     R5,ARPL0                POINT TO RPL0           @VS49571
         TM    69(5),X'FF'             IS RPL ACTIVE?          @ZA43303
         BNO   INITRPL                 INITIALIZE THE RPL      @ZA43303
         MVI   DUMPFLAG,RPL0CODE       MOVE IN DUMP CODE       @ZA43303
         B     DUMP                    BRANCH TO DUMP          @ZA43303
         TITLE 'READSUB - SUBRTN TO DO READ(ANY)'              @VS49571
***********************************************************************
*                                                                     *
*                      READ (ANY)                              @VS49571
*                                                              @VS49571
*        THIS SUBROUTINE IS ENTERED ONLY WHEN A READ(ANY) IS TO@VS49571
*        BE ISSUED.                                            @VS49571
*                                                              @VS49571
*        INPUT REGISTERS:                                      @VS49571
*                                                              @VS49571
*              REG 10-12 - BASE REGISTERS                      @VS49571
*              REG 5     - POINTS TO AN ASYNCHRONOUS RPL PLUS  @VS49571
*                          ITS WORKAREA                        @VS49571
*              REG 14    - CALLER'S RETURN ADDRESS             @VS49571
*                                                              @VS49571
*         OUTPUT REGISTERS:                                    @VS49571
*                                                              @VS49571
*               REG 0-1   - UNPREDICTABLE                      @VS49571
*               REG 2-14  - VALUE AT INPUT                     @VS49571
*               REG 15    - UNPREDICTABLE                      @VS49571
*                                                              @VS49571
*                                                              @VS49571
*                                                                     *
***********************************************************************
         SPACE 2                                               @XL03HAJ
READSUB  EQU   *                                               @VS49571
         SPACE 2
         ST    R14,SUBSAV14            SAVE RETURN ADDR        @VS49571
         SPACE 2                                               @VS49571
READANY  EQU   *                                               @VS49571
         SPACE 2                                               @VS49571
         OI    MFLAGS,READA            INDICATE READ(ANY) IN PROGRESS
         SPACE 2                                               @VS49571
*        READ  RPL=(PTRRPL),                                  @VS49571*
*              OPTCD=(ASY,ANY),                                @VS49571
*              AREA=IOAREA,                                    @VS49571
*              AREALEN=L'IOAREA,                               @VS49571
*              EXIT=READEND                                    @VS49571
          SPACE 2                                              @VS49571
         READ  RPL=(PTRRPL),                                   @VS49571*
               OPTCD=(ASY,ANY),                                @VS49571*
               AREA=IOAREA,                                    @VS49571*
               AREALEN=L'IOAREA,                               @VS49571*
               EXIT=READEND                                    @VS49571
         SPACE 2                                               @VS49571
         NI    MFLAGS,FF-READA         READ(ANY) ISSUED        @VS49571
         EJECT                                                 @VS49571
         SPACE 2                                               @VS49571
***                                                            @VS49571
*                                                              @VS49571
*  ERROR ACTIONS FOR READ(ANY)                                 @VS49571
*                                                              @VS49571
*                                                   ACTION     @VS49571
*  RTNCD FDBK2                                      CODE(S)    @VS49571
*  CODE  CODE         MEANING                       RETURNED   @VS49571
*                                                   (R15 R0)   @VS49571
*                                                              @VS49571
*   00    00    SUCCESSFUL COMPLETION                00  00    @VS49571
*   08    00    TEMP STORAGE ALLOCATION FAILURE      10  00    @XL03HAJ
*                                                              @XL03HAJ
***                                                            @XL03HAJ
         SPACE 2                                               @XL03HAJ
         CH    R15,HEX10               VTAM BUFFERS FULL?      @XL03HAJ
*                                       (ONLY POSSIBLE ERROR)  @XL03HAJ
         BE    READANY                 YES. REISSUE            @XL03HAJ
         LTR   R15,R15                 READ-ANY ACCEPTED?      @XL03HAJ
         BNZ   RDEXERR                 NO. IMPOSSIBLE          @ZA32003
         LTR   R0,R0                   ACCEPTED? (2ND TEST)?   @VS49571
         BNZ   RDEXERR                 NO. ERROR               @ZA32003
*                                                              @XL03HAJ
* * * * * * * * END OF READ ERROR HANDLING * * * * * * * * * * @XL03HAJ
*                                                              @XL03HAJ
         SPACE 8                                               @VS49571
         L     R14,SUBSAV14            RESTORE THE RETURN ADDR @VS49571
         BR    R14                     RETURN TO CALLER        @VS49571
RDEXERR  EQU   *                       READ EXIT ERROR         @ZA32003
         AIF   ('&ABEND' EQ 'YES').SKP1                        @ZA32003
         OI    MFLAGS2,ERRCON          TURN ON SO DUMP TAKEN   @ZA32003
.SKP1    ANOP                                                  @ZA32003
         BAL   R7,SNOCCUR              SHOULD NOT OCCUR        @ZA32003
         SPACE 6                                               @VS49571
STARTADD DC    A(START)                FIRST BASE.  USED BY    @VS49571
*                                       THE EXIT ROUTINES TO   @VS49571
*                                       ESTABLISH ADDRESSABILITY
         TITLE 'ERREXIT -  ERROR OCCURRED'                     @XL03HAJ
         SPACE 2
***********************************************************************
*                                                                     *
*    THIS ROUTINE IS ENTERED IF AN ERROR IS DETECTED.          @XL03HAJ
*                                                                     *
*        INPUT REGS:                                                  *
*                                                                     *
*    REGISTER 0 CONTAINS A RTNCD CODE (4, 8, C, 10, 14, 18)    @VS49571
*                                                              @XL03HAJ
*    REGISTER 1 POINTS TO THE RPL OF THE REQUEST                      *
*                                                              @XL03HAJ
*           THE FDBK2 FIELD OF THIS RPL CONTAINS A REASON      @XL03HAJ
*           CODE WHICH IS A SUBCODE OF THE RTNCD CODE IN       @VS49571
*           REGISTER 0.                                        @XL03HAJ
*                                                                     *
*    REGISTER 2 - 12 UNMODIFIED BY VTAM                               *
*                                                                     *
*    REGISTER 13 POINTS TO THE SAVE AREA IN USE                       *
*                                                                     *
*    REGISTER 14 CONTAINS RETURN ADDRESS TO VTAM                      *
*                                                                     *
*    REGISTER 15 ERREXIT ROUTINE ADDRESS                       @VS49571
*                                                              @VS49571
*                                                              @XL03HAJ
*                                                              @XL03HAJ
*    EXIT FROM ERREXIT IS AS FOLLOWS:                          @XL03HAJ
*                                                              @XL03HAJ
*           THRU ERRETURN TO VTAM, WHICH WILL RETURN TO THE    @XL03HAJ
*           MAINLINE OR EXIT ROUTINE NSI.                      @XL03HAJ
*                                                              @XL03HAJ
*           TO SNOCCUR, WHICH WILL ABNORMALLY TERMINATE        @XL03HAJ
*           NETSOL.                                            @XL03HAJ
*                                                              @DA04534
*           TO PROBDEV.                                        @VS49571
*                                                              @XL03HAJ
*                                                              @XL03HAJ
*        OUTPUT REGS:                                          @XL03HAJ
*                                                              @XL03HAJ
*    REGISTER  1-9  UNPREDICTABLE                              @ZM32689
*                                                              @XL03HAJ
*    REGISTER 10-12 NETSOL BASE REGISTERS                      @ZM32689
*                                                              @XL03HAJ
*    REGISTER 13    SAVE AREA UPON ENTRY                       @Z40GKD3
*                                                              @XL03HAJ
*    REGISTER 14    UNPREDICTABLE IF EXIT TO SNOCCUR OR        @XL03HAJ
*                    RETURN.                                   @XL03HAJ
*                   VALUE AT INPUT IF RETURN TO VTAM.          @XL03HAJ
*                                                              @XL03HAJ
*    REGISTER 15    THE INPUT RTNCD CODE IF ERREXIT WAS        @VS49571
*                   ENTERED FROM MAINLINE NETSOL.              @XL03HAJ
*                   AN ACTION CODE IF ENTERED FROM AN EXIT     @XL03HAJ
*                    ROUTINE.                                  @XL03HAJ
*                                                              @XL03HAJ
*    REGISTER  0    UNPREDICTABLE IF ENTERED FROM MAINLINE     @XL03HAJ
*                    NETSOL.                                   @XL03HAJ
*                   AN ACTION CODE MODIFIER IF ENTERED FROM AN @XL03HAJ
*                    EXIT ROUTINE.                             @XL03HAJ
*                                                              @XL03HAJ
*        NOTE: REGISTERS 0 AND 15 WILL BE RETURNED THRU VTAM   @XL03HAJ
*              TO MAINLINE OR EXIT ROUTINE NSI.                @XL03HAJ
         EJECT                                                 @XL03HAJ
*    DESCRIPTION OF ACTION CODES AND FLAGS                     @VS49571
*                                                              @VS49571
*                                                              @VS49571
*        THE ERREXIT ROUTINE COMMUNICATES TO THE ERROR EXIT NSI@VS49571
*        VIA AN ACTION CODE SET IN REG 15 AND, IN SOME CASES,  @VS49571
*        AN ACTION CODE MODIFIER SET IN REG 0. IN SOME SPECIAL @VS49571
*        CASES, FLAGS ARE SET TO PASS INFORMATION TOO.         @VS49571
*                                                              @VS49571
*        THE ACTION CODES AND MODIFIERS INDICATE APPROPRIATE   @VS49571
*        ACTIONS TO BE TAKEN BY THE EXIT ROUTINE. THE EXIT     @VS49571
*        ROUTINE MAY, HOWEVER, HANDLE THE ERROR ACTION         @VS49571
*        DIFFERENTLY FROM WHAT ERREXIT INDICATES BY ITS ACTION @VS49571
*        CODE, IF IT SO CHOOSES.                               @VS49571
*                                                              @VS49571
*        ACTION CODES AND MODIFIERS ARE AS FOLLOWS:            @VS49571
*                                                              @VS49571
*            00 MACRO COMPLETED SUCCESSFULLY                   @VS49571
*               REG 0 MODIFIER=0                               @VS49571
*                                                              @VS49571
*            04 THIS IS A SNO (SHOULD NOT OCCUR) WHICH WILL NOT@VS49571
*               BE SET BY THE ERROR EXIT. IF THIS IS SET AT    @VS49571
*               NSI, THE NETWORK SOLICITOR SHOULD ABNORMALLY   @VS49571
*               TERMINATE.                                     @VS49571
*                                                              @VS49571
*TORELES     08 BRANCH TO RELEASE                              @VS49571
*                                                              @VS49571
*TOWRITE     0C BRANCH TO WRITEMSG                             @VS49571
*               REG 0 MODIFIER=MESSAGE NUMBER PLUS X'80' IF    @VS49571
*                              RESET NEEDED                    @VS49571
*                                                              @VS49571
*REISSU      10 RESET AND/OR REISSUE THE REQUEST               @VS49571
*               REG 0 MODIFIER=0 REISSUE                       @VS49571
*RSETONLY                     =4 RESET                         @VS49571
*RESET1ST                     =8 RESET AND REISSUE             @VS49571
*                                                              @VS49571
*TOENDREQ    14 BRANCH TO FREERPL                              @VS49571
*                                                              @VS49571
*CATCHALL    18 TAKE ACTION ACCORDING TO MODIFIER              @VS49571
*TOSOLIC        REG 0 MODIFIER=0 SOLICIT                       @VS49571
*NOFLUSH                      =4 STOP FLUSHING I/O             @VS49571
*IGNORE                       =8 CHANGE 'GENED' STATUS FROM    @VS49571
*                                I/O TO INPUT ONLY             @VS49571
*                                                              @VS49571
*RSETSOL     1C BRANCH TO RESET THEN SOLICIT                   @VS49571
*                                                              @VS49571
*TOPROBDV    20 BRANCH TO PROBDEV                              @VS49571
*                                                              @VS49571
*    SINCE NETSOL DOES NOT ISSUE ALL API MACROS, NOT ALL       @VS49571
*    RTNCD CODES AND REASON CODES ARE POSSIBLE. THOSE          @VS49571
*    FDBK3 CODES WHICH CAN OCCUR FOR THE MACROS ISSUED ARE     @VS49571
*    LISTED WITHIN THE SUBSECTIONS OF ERREXIT FOR EACH         @VS49571
*    RTNCD CODE. THIS LIST INCLUDES ANY WHICH MAY BE           @VS49571
*    IMPOSSIBLE BECAUSE OF CURRENT NETSOL LOGIC.  THOSE WHICH  @VS49571
*    ARE POSSIBLE ARE INDICATED WITH AN '*'.  RECORD ONLY      @VS49571
*    CODES ARE NOT LISTED.                                     @VS49571
*                                                              @VS49571
*                                                              @VS49571
*    THE FLAGS SET ARE:                                        @VS49571
*                                                              @VS49571
*          LOOPONCE - REISSUE I/O COMMAND ONE MORE TIME. IF    @VS49571
*                     THE REISSUED COMMAND IS SUCCESSFUL, THE  @VS49571
*                     FLAG MUST BE TURNED OFF BY THE MAINLINE  @VS49571
*                     OR EXIT ROUTINE. IF UNSUCCESSFUL,        @VS49571
*                     ERREXIT TURNS OFF THE FLAG ON ENTRY TO   @VS49571
*                     HANDLE THE FAILURE.                      @VS49571
*                                                              @XL03HAJ
*            RELOPND - RELEASE THE DEVICE THEN OPNDST(ACQUIRE) @XL03HAJ
*                      IT, THUS RE-ESTABLISHING A SESSION FOR  @XL03HAJ
*                      THAT DEVICE.                            @XL03HAJ
*                                                              @XL03HAJ
*           SHUTDOWN - NETSOL SHUTDOWN IN PROGRESS. IF THIS    @XL03HAJ
*                      BIT IS ON AT ENTRY TO AN EXIT ROUTINE   @XL03HAJ
*                      OTHER THAN TPEND, NO PROCESSING IS DONE @XL03HAJ
*                      WITHIN THE ROUTINE. THIS WILL RAPIDLY   @XL03HAJ
*                      FLUSH EXITS REQUESTS ALREADY SCHEDULED  @XL03HAJ
*                      AT THE TIME A NEED FOR SHUTDOWN IS      @XL03HAJ
*                      DETECTED.                               @XL03HAJ
*                      NOTE: THIS BIT IS ALSO SET BY THE TPEND @XL03HAJ
*                            EXIT, WHICH HAS BEEN SCHEDULED    @XL03HAJ
*                            PRIOR TO ENTRY TO ERREXIT FOR A   @XL03HAJ
*                            SHUTDOWN CONDITION.               @XL03HAJ
*                                                              @XL03HAJ
***********************************************************************
         SPACE 2
ERREXIT  EQU   *                                               @XL03HAJ
         SPACE 2
***********************************************************************
*                                                                     *
*        NO NEED TO ESTABLISH ADDRESSABILITY, SINCE BASE REGISTERS    *
*        HAVE NOT BEEN MODIFIED.  NOTE THAT ALSO PTRRPL POINTS TO RPL *
*        USED IN EXIT ROUTINE, ALTHOUGH IT IS NOT NECESSARILY THE RPL *
*        IN USE WHEN ERREXIT WAS ENTERED, I. E. SYNCHRPL MAY   @VS49571
*        HAVE BEEN IN USE FOR INQUIRE (APPSTAT).               @XL03HAJ
*                                                                     *
***********************************************************************
         SPACE 2                                               @XL03HAJ
         LR    R15,R0                  SAVE RTNCD CODE TO      @VS49571
*                                       USE AS RETURN CODE IF  @XL03HAJ
*                                       ENTRY FROM MAINLINE.   @XL03HAJ
         STC   R15,RTNCD               SAVE RTNCD CODE         @VS49571
         SPACE 2                                               @VS49571
***********************************************************************
*                                                                     *
*        CHECK IF ERREXIT HAS BEEN ENTERED FROM MAIN-LINE OR   @XL03HAJ
*        EXIT ROUTINE.  IF ERROR IN MAIN-LINE THEN RETURN VIA  @XL03HAJ
*        REGISTER 14, AND UPON RETURN TO MAIN-LINE CODE        @XL03HAJ
*        APPROPRIATE ACTION WILL BE TAKEN.                     @XL03HAJ
*                                                                     *
***********************************************************************
         SPACE 2
         LR    R3,R14                  SAVE RETURN ADDR        @XL03HAJ
         LA    R8,SETLRPL              IS REQUEST A            @VS49571
         CR    R1,R8                   SETLOGON?               @VS49571
         BER   R14                     YES.  IN MAINLINE       @VS49571
*                                       AND RETURN TO VTAM.    @VS49571
         SPACE 2
         CH    R15,HEX18           18  RPL ECB/EXIT PROBLEM?   @XL03HAJ
         BNL   SNOCCUR                 YES. CANNOT VALIDLY     @XL03HAJ
*                                       OCCUR SINCE SHUTDOWN   @XL03HAJ
*                                       SWITCH STOPS EXITS'    @XL03HAJ
*                                       ACTION PRIOR TO THE    @XL03HAJ
*                                       CLSDSTACB.             @VS49571
*                                      NOTE. CODES HIGHER      @XL03HAJ
*                                       THAN 18 DO NOT EXIST   @XL03HAJ
         SPACE 2
************************************************************** @VS49571
*                                                              @VS49571
*        UPON ENTRY IF R1 ^=> ADDRESS OF RPL0, OR R1 ^= R5,    @VS49571
*        THEN R1'S AND R5'S INFORMATION MUST BE COMBINED.      @VS49571
*        THE COMMAND THAT CAUSED THE ERROR WAS                 @VS49571
*        ISSUED USING SYNCHRPL AND R5 IS POINTING TO AN        @VS49571
*        ASYNCH RPL.  FOR THIS RTN WE NEED SOME INFO IN BOTH.  @VS49571
*                                                              @VS49571
************************************************************** @VS49571
         SPACE 2                                               @VS49571
*        XXXXXXXXXXXX                                          @VS49571
         DROP  R5                                              @VS49571
         USING IFGRPL,R1                                       @VS49571
*        XXXXXXXXXXXX                                          @VS49571
         SPACE 2                                               @VS49571
         CR    R1,R5                   ARE WE USING ONE RPL    @VS49571
         BE    ERRPLOK                 YES, BRANCH             @VS49571
         MVC   SYNWORK(WORKRPLA),LNIFGRPL(R5)                  @VS49571
         MVC   SYNWORK+WORKRPLA(WRPLREST),INRPLWRK(R5)         @VS49571
*                                      MOVE THE ASYNCH RPL     @VS49571
*                                       WORKAREA TO THE SYNCH  @VS49571
*                                       RPL WORKAREA           @VS49571
ERRPLOK  EQU   *                                               @VS49571
         EJECT                                                @VS49571
***********************************************************************
*                                                                     *
*        GET THE FDBK2 FIELD FROM THE RPL.  NOTE THAT R1 AND   @VS49571
*        R5 POINT TO THE RPL FOR THE REQUEST THAT FAILED.      @VS49571
*                                                              @VS49571
*        GET SENSE FIELD IN CASE OF BISYNCH STATUS ERROR       @VS49571
*        MESSAGE FROM 3277, 3275, 3741, OR 3747.               @VS49571
*                                                                     *
***********************************************************************
         SPACE 2                                               @VS49571
         SR    R6,R6                   CLEAR REG 6  .          @VS49571
         IC    R6,RPLFDB2              PICK UP REASON CODE     @VS49571
         STC   R6,FDBK2                SAVE FOR DEBUGGING.     @VS49571
         LR    R7,R6                   START TO INITIALIZE R7  @VS49571
*                                       WHICH WILL BE USED AS  @VS49571
*                                       AN INDEX FOR BRANCH    @VS49571
*                                       TABLES                 @VS49571
         SR    R0,R0                   SET UP DEFAULT ACTION   @VS49571
*                                       MODIFIER OF ZERO       @VS49571
         MVC   STATUS2(2),RPLFDBK2     MOVE BI-SYNCH STATUS    @VS49571
*                                       FROM THE RPL.          @VS49571
         EJECT                                                 @VS49571
***********************************************************************
*                                                                     *
* TRANSLATE RTNCD CODE AND FDBK2 CODE INTO ACTION CODE         @VS49571
*                                                              @XL03HAJ
*   RTNCD CODES HAVE A GENERAL MEANING AS FOLLOWS:             @VS49571
*                                                              @XL03HAJ
*          04   EXTRAORDINARY COMPLETION                       @XL03HAJ
*                 FUNCTION COMPLETED. ADDITIONAL INFORMATION   @XL03HAJ
*                 AVAILABLE. PROBABLY HANDLED OUT OF LINE.     @XL03HAJ
*                 CONDITION SHOULD BE HANDLED BEFORE MAKING    @XL03HAJ
*                 FURTHER REQUESTS TO THE DEVICE.              @XL03HAJ
*                                                              @XL03HAJ
*          08   REISSUE                                        @XL03HAJ
*                 TEMPORARY ENVIRONMENT CONDITION CAUSED       @XL03HAJ
*                 REQUEST TO BE REJECTED.                      @XL03HAJ
*                                                              @XL03HAJ
*          0C   DAMAGE                                         @XL03HAJ
*                 INTEGRITY OF THE REQUEST OR DEVICE HAS BEEN  @XL03HAJ
*                 DISTURBED.                                   @XL03HAJ
*                                                              @XL03HAJ
*          10   ENVIRONMENT ERROR                              @XL03HAJ
*                 REQUEST INCOMPLETE DUE TO ENVIRONMENTAL      @XL03HAJ
*                 CONDITION. ENVIRONMENT MUST BE ALTERED       @XL03HAJ
*                 BEFORE RECOVERY CAN BE ATTEMPTED.            @XL03HAJ
*                                                              @XL03HAJ
*          14   USER LOGIC ERROR                               @XL03HAJ
*                 USER ERROR ON THE REQUEST. REQUEST REJECTED  @XL03HAJ
*                 OR INCOMPLETE. NOT EXECUTABLE IN THE         @XL03HAJ
*                 PRESENT FORM.                                @XL03HAJ
*                                                              @XL03HAJ
*          18   RPL NOT AN RPL   OR   RPL IS ALREADY ACTIVE.   @VS49571
*                                                              @XL03HAJ
***********************************************************************
         SPACE 2                                               @XL03HAJ
         B     FEEDTAB(R15)            GO TO FEEDBACK CODE     @XL03HAJ
*                                       HANDLING ROUTINE       @XL03HAJ
FEEDTAB  BAL   R7,SNOCCUR           0  FEEDBACK OF 00 DOESN'T  @VS49571
*                                       ENTER LERAD OR SYNAD   @XL03HAJ
         B     EXTRAORD             4  EXTRAORDINARY COM-      @XL03HAJ
*                                       PLETION                @XL03HAJ
         B     REISSUE              8  REISSUE                 @XL03HAJ
         B     DAMAGE               C  DAMAGE                  @XL03HAJ
         B     ENVIRON             10  ENVIRONMENT ERROR       @XL03HAJ
         B     LOGIC               14  LOGIC ERROR             @XL03HAJ
         TITLE 'ERREXIT - ERROR OCCURRED           RTNCD = 04' @VS49571
         SPACE 2                                               @XL03HAJ
***                                                            @XL03HAJ
*                                                              @XL03HAJ
*  RTNCD CODE 04 - EXTRAORDINARY COMPLETION                    @VS49571
*                                                              @XL03HAJ
*   FDBK2 CODE   MACRO(S)         MEANING                      @VS49571
*                                                              @XL03HAJ
*        00    * WRITE(LBT)/CHECK RVI RECEIVED                 @XL03HAJ
*                                                              @XL03HAJ
*        01    * READ(ANY)/CHECK  ATTENTION OR REVERSE BREAK   @XL03HAJ
*              * WRITE(LBT)/CHECK                              @XL03HAJ
*                                                              @XL03HAJ
*        02    * READ(ANY)//CHECK BSC STATUS MSG RECEIVED      @DA04534
*              * WRITE(LBT)/CHECK                              @DA04534
*                                                              @XL03HAJ
***                                                            @XL03HAJ
         SPACE 2                                               @XL03HAJ
EXTRAORD EQU   *                                               @XL03HAJ
         CH    R6,HEX2                 IS REASON CODE WITHIN   @XL03HAJ
*                                       LIMITS OF POSSIBILITY? @XL03HAJ
         BH    SNOCCUR             >2  NO. ERROR               @XL03HAJ
         SPACE 2                                               @XL03HAJ
         AR    R7,R7                   MULTIPLY REASON CODE BY @XL03HAJ
         AR    R7,R6                    12 FOR BRANCH TABLE    @XL03HAJ
         SLL   R7,D2                    INDEXING               @XL03HAJ
         B     RSNTAB4(R7)             GO TO REASON            @XL03HAJ
*                                       HANDLING ROUTINE       @XL03HAJ
RSNTAB4  LA    R15,REISSU           0  RVI RECEIVED            @XL03HAJ
         LA    R0,RSETONLY             THIS MEANS 'THE WRITE   @XL03HAJ
         B     ERRETURN                 WENT OK, BUT PLEASE    @XL03HAJ
*                                       STOP BECAUSE THE NCP   @XL03HAJ
*                                       IS GETTING OVER-       @XL03HAJ
*                                       LOADED', BUT IS NOT A  @XL03HAJ
*                                       DEMAND.  THE WRITE WAS @XL03HAJ
*                                       FOR ONE BLOCK ONLY, SO @XL03HAJ
*                                       NETSOL NEEDS ONLY TO   @XL03HAJ
*                                       RESET THE ERROR LOCK.  @XL03HAJ
*                                                              @XL03HAJ
         LA    R15,REISSU           1  ATTENTION OR REVERSE    @XL03HAJ
*                                       BREAK RECEIVED         @XL03HAJ
         LA    R0,RSETONLY             TEMPORARILY ASSUME      @XL03HAJ
         B     ATTNCHK                  WRITE, THEN CHECK IT   @XL03HAJ
*                                                              @XL03HAJ
         B     WHATDEV1             2  BISYNCH STATUS ERR MSG  @DA04534
         SPACE 4                                               @DA04534
ATTNCHK  EQU   *                                               @XL03HAJ
         TM    MFLAGS,WRITING          IF ERROR ON WRITE, THEN @XL03HAJ
*                                       MUST HAVE BEEN A       @XL03HAJ
*                                       REVERSE BREAK, WHICH   @XL03HAJ
*                                       STOPS THE WRITE TO     @XL03HAJ
*                                       SEND IN DATA TO READ.  @XL03HAJ
*                                       RESET THE ERROR LOCK   @XL03HAJ
         BO    ERRETURN                 AND ACT AS IF WRIT WENT@XL03HAJ
         LA    R15,RSETSOL             YES. MUST HAVE BEEN     @ZA38609
         SR    R0,R0                                           @VS49571
         TM    MFLAGS,READA            IS THIS A READ(ANY)     @VS49571
         BO    ERRETURN                YES, RETURN             @VS49571
         BAL   R7,SNOCCUR              NO OTHER POSSIBILITY    @VS49571
         SPACE 4                                               @DA04534
WHATDEV1 EQU *                                                 @DA04534
         LA    R15,TORELES             ASSUME DEVICE UNUSABLE  @DA04534
         CLI   TYPECODE,DEV3277        IS IT A 3277?           @DA04534
         BE    STAT3270                YES. HANDLE AS A 3270   @DA04534
         CLI   TYPECODE,DEV3275        IS IT A 3275?           @DA04534
         BE    STAT3270                YES. HANDLE AS A 3270   @DA04534
         CLI   TYPECODE,DEV3741        IS IT A 3741?           @DA04534
         BE    STAT3741                YES. HANDLE 3741        @DA04534
         CLI   TYPECODE,DEV3747        IS IT A 3747?           @DA04534
         BE    STAT3747                YES HANDLE 3747         @DA04534
         LA    R15,TOPROBDV            SOMETHING'S WRONG       @Z40GKD3
         B     ERRETURN                NO. MUST BE ONE OF THE  @Z40GKD3
*                                       ABOVE                  @DA04534
         SPACE 4                                               @DA04534
STAT3270 EQU   *                       HANDLE BISYNCH STATUS   @DA04534
*                                       ERROR MESSAGE FOR A    @DA04534
*                                       3270 DEVICE            @DA04534
         CLC   STATUS2,BISTC240        WAS BISYNCH STATUS RET- @DA04534
*                                       URNED FOR DEVICE END   @DA04534
*                                       (ALONE), WHICH SHOWS   @DA04534
*                                       POWER ON?              @DA04534
         BE    INTRREQ1                YES, CHECK MORE         @VS49571
         CLC   STATUS2,BIST4050        NO, CHECK IF INTERUPT   @VS49571
*                                       REQUIRED (DEVICE POWER-@VS49571
*                                       ED OFF).               @VS49571
         BNE   ERRETURN                IF NOT POWERED OFF, JUST@VS49571
*                                       RELEASE THE DEVICE.    @VS49571
         OI    FLAGS,RELOPND           RELEASE DEVICE, THEN    @ZA28912
*                                      ATTEMP TO RECONNECT     @ZA28912
         B     ERRETURN                                        @VS49571
INTRREQ1 EQU   *                                               @VS49571
         LA    R15,TOWRITE             IN CASE DEVICE PROBLEM  @ZA44250
         LA    R0,MSG12                WRITE GOOD MORNING MSG  @ZA44250
*        TM    MFLAGS,READA+WRITING    DELETED BY APAR ZA44250 @ZA44250
*                                       INITIAL READ OR WRITE  @DA04534
*                                       OF AN ERROR MESSAGE?   @DA04534
*        BZ    ERRETURN                DELETED BY APAR ZA44250 @ZA44250
*                                       FLUSHING               @DA04534
*        LA    R15,REISSU              DELETED BY APAR ZA44250 @ZA44250
         B     ERRETURN                 SOLICIT OR THE WRITE   @DA04534
*                                       AGAIN.  R0 ALREADY SET @DA04534
*                                       FOR REISSUE ONLY.      @DA04534
         SPACE 4                                               @DA04534
STAT3741 EQU   *                       HANDLE BISYNCH STATUS   @DA04534
*                                       ERROR MESSAGE FOR 3741 @DA04534
         CLC   STATUS2,BISTF2          NO RECORD FOUND ON      @DA04534
*                                       DISKETTE?              @DA04534
         BE    NORECORD                YES. NO RECORD.  RE-    @DA04534
*                                       ISSUE THE SOLICIT/READ @DA04534
         CLC   STATUS2,BISTE2          NO. DID OPERATOR ABORT  @DA04534
*                                       JOB BY PRESSING RESET? @DA04534
         BNE   ERRETURN                NO. OTHER ERROR.        @DA04534
*                                       RELEASE THE DEVICE.    @DA04534
         B     ABORTED                 YES. GO TO 3741/3747    @DA04534
*                                       COMMON 'ABORTED' ROU-  @DA04534
*                                       TINE                   @DA04534
         SPACE 2                                               @DA04534
NORECORD EQU   *                                               @DA04534
         LA    R15,TOPROBDV            IN CASE DEVICE PROBLEM  @Z40GKD3
         TM    MFLAGS,READA            HAPPEN ON READ(ANY)?    @ZA33715
         BZ    ERRETURN                NO. IMPOSSIBLE          @Z40GKD3
         LA    R15,TOWRITE             YES. ISSUE ERROR MSG    @DA04534
         LA    R0,MSG02                 TO TERMINAL OPERATOR   @DA04534
         B     ERRETURN                                        @DA04534
         SPACE 4                                               @DA04534
STAT3747 EQU   *                       HANDLE BISYNCH STATUS   @DA04534
*                                       ERROR MESSAGE FOR 3747 @DA04534
         CLC   STATUS2,BIST50          OPERATOR REQUEST ABORT? @DA04534
         BE    ERRETURN                NO. OTHER BISYNCH ERR.  @DA04534
*                                       RELEASE THE DEVICE     @DA04534
*                                      YES. FALL THRU TO       @DA04534
*                                       COMMON 3741/3747 ABORT @DA04534
*                                       ROUTINE                @DA04534
         SPACE 4                                               @DA04534
ABORTED  EQU   *                       COMMON ABORT ROUTINE    @DA04534
         LA    R15,TOPROBDV            IN CASE DEVICE PROBLEM  @Z40GKD3
         TM    MFLAGS,READA+WRITING  HAPPEN ON READ OR WRITE?
         BZ    ERRETURN                NO. IMPOSSIBLE          @Z40GKD3
         LA    R15,RSETSOL             YES. RESET THEN SOLICIT @DA04534
         B     ERRETURN                                        @DA04534
         TITLE 'ERREXIT - ERROR OCCURRED           RTNCD = 08' @VS49571
         SPACE 2                                               #XL03HAJ
***                                                            #XL03HAJ
*                                                              #XL03HAJ
*  RTNCD CODE 08 - REISSUE                                     @VS49571
*                                                              @XL03HAJ
*   FDBK2 CODE   MACRO(S)         MEANING                      @VS49571
*                                                              @XL03HAJ
*      00      * ALL API MACROS   TEMPORARY STORAGE            @XL03HAJ
*                (NOT CHECK,       ALLOCATION FAILURE          @XL03HAJ
*                 OPEN, OR CLOSE)                              @XL03HAJ
*                                                              @XL03HAJ
***                                                            @XL03HAJ
         SPACE 2                                               @XL03HAJ
REISSUE  EQU   *                                               @XL03HAJ
         LTR   R6,R6                   ONLY VALID REASON CODE  @XL03HAJ
*                                       IS 0                   @XL03HAJ
         BNZ   SNOCCUR             >0  ERROR IF NOT            @XL03HAJ
         LA    R15,REISSU           0  ACTION IS TO REISSUE    @XL03HAJ
*                                      REG 0 IS ALREADY SET FOR@XL03HAJ
*                                       REISSUE ONLY           @XL03HAJ
         B     ERRETURN                RETURN TO EXIT ROUTINE  @XL03HAJ
         TITLE 'ERREXIT - ERROR OCCURRED           RTNCD = 0C' @VS49571
         SPACE 2                                               @XL03HAJ
***                                                            @XL03HAJ
*                                                              @XL03HAJ
*  FEEDBACK CODE 0C - DAMAGE                                   @XL03HAJ
*                                                              @XL03HAJ
*   REASON CODE    MACRO(S)          MEANING                   @XL03HAJ
*                                                              @XL03HAJ
*       00      * READ(ANY)/CHECK   I/O ERROR. DEVICE          @XL03HAJ
*               * WRITE(LBT)/CHECK                             @XL03HAJ
*                                                              @XL03HAJ
*       01      * READ(ANY)/CHECK   I/O ERROR. DEVICE          @XL03HAJ
*               * WRITE(LBT)/CHECK                             @XL03HAJ
*                                                              @XL03HAJ
*       02      * READ(ANY)/CHECK   TEST REQUEST SET           @XL03HAJ
*               * WRITE(LBT)/CHECK                             @VS49571
*                                                              @XL03HAJ
*       03        READ(ANY)/CHECK   BUFFER THRESHOLD EXCEEDED. @XL03HAJ
*                                                              @XL03HAJ
*       04      * WRITE(LBT)/CHECK  BUFFER THRESHOLD EXCEEDED. @XL03HAJ
*               * SOLICIT(SPEC)/CHECK                          @XL03HAJ
*               * RESET(UNCOND)/CHECK                          @XL03HAJ
*                                                              @XL03HAJ
*       05      * READ(ANY)/CHECK   NCP ABEND.                 @XL03HAJ
*               * OPNDST(SPEC,ACQUIRE)                         @XL03HAJ
*               * OPNDST(ACCEPT,ANY)                           @XL03HAJ
*               * SOLICIT(SPEC)/READ(ANY)/CHECK                @XL03HAJ
*               * WRITE(LBT)/CHECK                             @XL03HAJ
*               * RESET(UNCOND)/CHECK                          @XL03HAJ
*               * CHANGE                                       @VS49571
*                                                              @XL03HAJ
*       06      * READ(ANY)/CHECK   NCP ABEND. LAST PURGE.     @XL03HAJ
*               * WRITE(LBT)/CHECK                             @XL03HAJ
*               * RESET(UNCOND)/CHECK                          @XL03HAJ
*                                                              @XL03HAJ
*       07                                                     @XL03HAJ
*                                                              @XL03HAJ
*       08                                                     @XL03HAJ
*                                                              @XL03HAJ
*       09                                                     @XL03HAJ
*                                                              @XL03HAJ
*       0A      * READ(ANY)/CHECK   I/O RESET BY USER          @XM02215
*               * WRITE(LBT)/CHECK                             @XL03HAJ
*                                                              @XL03HAJ
*       0B      * READ(ANY)/CHECK   CANCELED BY USER CLSDST    @XL03HAJ
*               * WRITE(LBT)/CHECK                             @XL03HAJ
*               * RESET (UNCOND)/CHECK                         @VS49571
*               * CLSDST/CHECK                                 @VS49571
*               * CHANGE/CHECK                                 @VS49571
*                                                              @XL03HAJ
*       0C                                                     @XL03HAJ
*                                                              @XL03HAJ
*       0D                                                     @XL03HAJ
*                                                              @VS49571
*       0E      * WRITE(LBT)/CHECK                             @VS49571
*                                                              @VS49571
*       0F      * WRITE(LBT)/CHECK                             @VS49571
*                                                              @XL03HAJ
***                                                            @XL03HAJ
         SPACE 2                                               @XL03HAJ
DAMAGE   EQU   *                                               @XL03HAJ
         CH    R6,HEXF                 IS REASON CODE WITHIN   @XL03HAJ
*                                       LIMITS OF POSSIBILITY? @XL03HAJ
         BH    SNOCCUR             >F  NO. ERROR               @XL03HAJ
         SPACE 2                                               @XL03HAJ
         AR    R7,R7                   MULTIPLY REASON CODE BY @XL03HAJ
         AR    R7,R6                    12 FOR BRANCH TABLE    @XL03HAJ
         SLL   R7,D2                    INDEXING               @XL03HAJ
         B     RSNTABC(R7)             GO TO REASON CODE       @XL03HAJ
*                                       HANDLING ROUTINE       @XL03HAJ
         SPACE 2                                               @XL03HAJ
RSNTABC  LH    R15,STATUS2          0  I/O ERROR (NOT PERM)    @VS49571
         B     TEMPERR                  SAVE BISYNCH STATUS    @ZA13672
         NOP   0                                               @ZA13672
*                                                              @XL03HAJ
         LA    R15,TORELES          1  PERMANENT I/O ERROR     @XL03HAJ
         B     ERRETURN                RELEASE THE TERMINAL    @XL03HAJ
         NOP   0                                               @XL03HAJ
*                                                              @XL03HAJ
         LA    R15,TORELES          2  TEST REQUEST SET        @XL03HAJ
         OI    FLAGS,RELOPND            I/O SATISFIED BY TRM.  @XL03HAJ
         B     ERRETURN                ALL I/O IS NOW STOPPED. @XL03HAJ
*                                       RELEASE THE DEVICE,    @XL03HAJ
*                                       THEN ACQUIRE IT AGAIN  @XL03HAJ
*                                       SO A VALID LOGON SE-   @XL03HAJ
*                                       QUENCE CAN BE ENTERED  @XL03HAJ
*                                       TO PASS THE DEVICE TO  @XL03HAJ
*                                       TOLTEP.                @XL03HAJ
*                                                              @XL03HAJ
         LA    R15,TOPROBDV         3  BUFFER THRESHOLD        @ZA19873
         B     ERRETURN                 EXCEEDED, RELEASE TERM @ZA19873
         NOP   0                                               @ZA19873
*                                                              @XL03HAJ
         B     EXCEEDED             4  BUFFER THRESHOLD        @XL03HAJ
         NOP   0                        EXCEEDED               @XL03HAJ
         NOP   0                        THIS HAPPENS IF A      @XL03HAJ
*                                       RESET, SOLICIT, OR A   @XL03HAJ
*                                       WRITE IS ISSUED AND    @XL03HAJ
*                                       ALL THE READ BUFFERS   @XL03HAJ
*                                       FOR THIS DEVICE ARE    @XL03HAJ
*                                       FULL FROM PREVIOUS I/O @XL03HAJ
*                                       REQUESTS FOR THIS      @XL03HAJ
*                                       DEVICE.                @XL03HAJ
*                                      NOTE: IF THIS CONDITION @XL03HAJ
*                                       OCCURS, VTAM HAS AL-   @XL03HAJ
*                                       READY ISSUED A RESET   @XL03HAJ
*                                       TO THE DEVICE.         @XL03HAJ
*                                                              @XL03HAJ
         LA    R15,REISSU           5  NCP ABENDED. RESTART OK @XL03HAJ
         B     ERR0C05                 THIS ONLY HAPPENS WHEN  @XL03HAJ
         NOP   0                        MORE THAN ONE I/O      @XL03HAJ
*                                       COMMAND PER DEVICE.    @XL03HAJ
*                                                              @XL03HAJ
         LA    R15,REISSU           6  NCP ABENDED. RESTART OK @XL03HAJ
         LA    R0,RESET1ST              LAST I/O REQ PER THIS  @XL03HAJ
         B     ERRETURN                 DEVICE HAS JUST BEEN   @XL03HAJ
*                                       PURGED.  RESET AND     @XL03HAJ
*                                       REISSUE ORIGINAL I/O.  @XL03HAJ
*                                       IF ON RESET, JUST RE-  @XL03HAJ
*                                       ISSUE.                 @XL03HAJ
*                                                              @XL03HAJ
         BAL   R7,SNOCCUR           7  (RECORD ONLY)           @VS49571
         NOP   0                                               @XL03HAJ
         NOP   0                                               @XL03HAJ
*                                                              @XL03HAJ
         BAL   R7,SNOCCUR           8  (RECORD ONLY)           @VS49571
         NOP   0                                               @XL03HAJ
         NOP   0                                               @XL03HAJ
*                                                              @XL03HAJ
         BAL   R7,SNOCCUR           9  Q'ED SIMLOGON CANCELLED @VS49571
         NOP   0                       SIMLOGON NOT USED       @XL03HAJ
         NOP   0                                               @XL03HAJ
*                                                              @XL03HAJ
*                                   A  I/O RESET BY USER       @XM02215
         TM    MFLAGS,READA+WRITING+CHANGNIB+RESETU            @ZA35053
         BZ    SNOCCUR                 ERROR IF NOT READ(ANY)  @XM02215
         B     IORESET                  OR WRITE(LBT)          @XM02215
*                                      ERROR POSSIBLE ON READ  @XM02215
*                                       (ANY) AS FOLLOWS:      @XM02215
*                                       THE PROBLEM CAN OCCUR  @XM02215
*                                       IF THE WRITE GETS A    @XM02215
*                                       CONTENTION ERROR WITH  @XM02215
*                                       UNSOLICITED DATE FROM  @XL03HAJ
*                                       THE DEVICE.  THE RESET @XL03HAJ
*                                       AFTER THE CONTENTION   @XL03HAJ
*                                       CAN CANCEL THE I/O     @XL03HAJ
*                                       FROM THE UNSOLICITED   @XL03HAJ
*                                       DATA.  THIS TOO WILL BE@XL03HAJ
*                                       LATER DETECTED ON A    @XL03HAJ
*                                       READ(ANY).             @XM02215
*                                      EVEN IF THERE IS NO     @XM02215
*                                       CONTENTION ERROR, THIS @XM02215
*                                       CAN OCCUR ON A RESET   @XM02215
*                                       TO CLEAR AN OUTSTAND-  @XM02215
*                                       ING SOLICIT PRIOR TO   @XM02215
*                                       ISSUEING A WRITE WHILE @XM02215
*                                       HANDLING UNSOLICITED   @XM02215
*                                       DATA.                  @XM02215
*                                                              @XL03HAJ
         LA    R15,TOENDREQ         B  USER CLSDST CANCELED    @XL03HAJ
         B     ERRETURN                 REQUEST.               @XL03HAJ
         NOP   0                                               @VS49571
*                                      THIS ERROR CAN OCCUR FOR@VS49571
*                                      READ, WRITE, OR RESET.  @VS49571
*                                                              @VS49571
         BAL   R7,SNOCCUR           C  SHOULD NOT OCCUR        @VS49571
         NOP   0                                               @VS49571
         NOP   0                                               @VS49571
*                                                              @VS49571
         BAL   R7,SNOCCUR           D  SHOULD NOT OCCUR        @VS49571
         NOP   0                                               @VS49571
         NOP   0                                               @VS49571
*                                                              @VS49571
         LA    R15,REISSU           E  YIELD TO CONTENTION     @VS49571
         LA    R0,RESET1ST             CAN OCCUR FOR WRITE.    @VS49571
         B     ERRETURN                THE ACTION IS A RESET   @VS49571
*                                      (UNCOND) AND A REISSUE  @VS49571
*                                      OF THE WRITE. NETSOL WANTS
*                                      THE TERMINAL OPERATOR TO@VS49571
*                                      RECEIVE THE ERROR MSG   @VS49571
*                                      BEFORE TRYING TO ENTER  @VS49571
*                                      ANOTHER LOGON SEQUENCE, @VS49571
*                                      SO NETSOL IGNORES WHAT  @VS49571
*                                      THE TERMINAL OPERATOR   @VS49571
*                                      ENTERS WHEN THERE IS    @VS49571
*                                      CONTENTION.             @VS49571
*                                                              @VS49571
         LA    R15,REISSU           F  YIELDED TO CONTENTION   @VS49571
         LA    R0,RESET1ST             (ERROR LOCK SET)        @VS49571
         B     ERRETURN                THIS IS ESSENTIALLY THE @VS49571
*                                      SAME SITUATION AS FOR   @VS49571
*                                      ERROR CONDITION 0C/0E   @VS49571
*                                      AND ERROR ACTION IS THE @VS49571
*                                      SAME                    @VS49571
*                                                              @VS49571
         EJECT                                                 @VS49571
         SPACE 2                                               @VS49571
ERR0C05  EQU   *                                               @VS49571
         TM    MFLAGS,RESETU           IS THIS FOR RESET?      @VS49571
         BO    ERRETURN                YES, JUST REISSUE RESET @VS49571
         LA    R0,RESET1ST             NO, RESET THEN REISSUE  @VS49571
         B     ERRETURN                GET OUT                 @VS49571
         SPACE 4                                               @XL03HAJ
TEMPERR  EQU   *                                               @XL03HAJ
*                    DELETE CODE TO TEST FOR 3270 TYPE DEVICES @ZA24909
         OI    FLAGS2,MODMLOOP         TURN ON MODEM LOOP BIT  @ZA13672
         SR    R8,R8                   COMPARE THE NUMBER OF   @ZA13672
         IC    R8,MODMCNT               LOOPS THROUGH THE 0C00 @ZA13672
         CH    R8,MAXLOOP               INTERVENTION REQUIRED  @ZA13672
         BL    TEMPERR1                LOW. CONTINUE NORMALLY  @ZA13672
         LA    R15,TOPROBDV            HIGH. IN INFINITE LOOP  @ZA13672
         B     ERRETURN                 RELEASE DEVICE AND WTO.@ZA13672
TEMPERR1 LTR   R15,R15                 IS THERE RPL SENSE INFO?@ZA13672
         BNZ   WHATDEV2                BR IF SENSE INFO        @DA04534
*                                      NO SENSE INFO           @DA04534
         LA    R15,REISSU              TEMPORARILY ASSUME      @DA04534
         LA    R0,RSETONLY              WRITE, THEN CHECK      @DA04534
         TM    MFLAGS,WRITING          ERROR ON OUTPUT?        @XL03HAJ
         BZ    SEEIFRD                 NO. CHECK FOR INPUT     @XL03HAJ
         TM    FLAGS,LOOPONCE          YES. TRY REISSUE YET?   @XL03HAJ
         BZ    REWRITE                 NO. THEN RETRY ONE TIME @XL03HAJ
         NI    FLAGS,X'FF'-LOOPONCE    YES. RESET RETRY FLAG.  @XL03HAJ
         B     ERRETURN                 DON'T REISSUE ERROR    @XL03HAJ
*                                       MESSAGE AGAIN JUST     @XL03HAJ
*                                       RESET AND GO ON.ACTION @XL03HAJ
*                                       CODES ALREADY SET      @XL03HAJ
*                                                              @XL03HAJ
REWRITE  EQU   *                                               @XL03HAJ
         OI    FLAGS,LOOPONCE          NO. TRY ONE MORE TIME   @XL03HAJ
         LA    R0,RESET1ST              RESET AND REISSUE      @XL03HAJ
         B     ERRETURN                                        @XL03HAJ
*                                                              @XL03HAJ
SEEIFRD  EQU   *                                               @XL03HAJ
         TM    MFLAGS,READA          INPUT?                  @XL03HAJ
         BZ    SNOCCUR                 NO. IMPOSSIBLE          @XL03HAJ
         LA    R15,TOWRITE             YES. RESET AND WRITE    @XL03HAJ
         LA    R0,MSG01+X'80'           ERROR MESSAGE          @XL03HAJ
         B     ERRETURN                                        @XL03HAJ
         SPACE 4                                               @XL03HAJ
WHATDEV2 EQU *                                                 @DA04534
         LA    R15,TORELES             ASSUME DEVICE UNUSABLE  @DA04534
         CLI   TYPECODE,DEV3277        IS IT A 3277?           @DA04534
         BE    SENS3270                YES. HANDLE AS A 3270   @DA04534
         CLI   TYPECODE,DEV3275        IS IT A 3275?           @DA04534
         BE    SENS3270                YES. HANDLE AS A 3270   @DA04534
         CLI   TYPECODE,DEV3741        IS IT A 3741?           @DA04534
         BE    SENS3741                YES. HANDLE 3741        @DA04534
         CLI   TYPECODE,DEV3747        IS IT A 3747?           @DA04534
         BE    SENS3747                YES HANDLE 3747         @DA04534
         LA    R15,TOPROBDV            SOMETHING'S WRONG       @Z40GKD3
         B     ERRETURN                NO. MUST BE ONE OF THE  @Z40GKD3
*                                       ABOVE                  @DA04534
         SPACE 4                                               @DA04534
SENS3270 EQU   *                       HANDLE BISYNCH STATUS   @DA04534
*                                       ERROR MESSAGE FOR A    @DA04534
*                                       3270 DEVICE            @DA04534
         CLC   STATUS2,BISTC240        WAS BISYNCH STATUS RET- @DA04534
*                                       URNED FOR DEVICE END   @DA04534
*                                       (ALONE), WHICH SHOWS   @DA04534
*                                       POWER ON?              @DA04534
         BE    INTRREQ2                YES, CHECK MORE         @VS49571
         CLC   STATUS2,BIST4050        NO, CHECK IF INTERRUPT  @VS49571
*                                       REQUIRED (DEVICE POWER-@VS49571
*                                       ED OFF).               @VS49571
         BNE   ERRETURN                NO, (NOT POWER OFF)     @VS49571
*                                       THEN RELEASE THE DEVICE@VS49571
         OI    FLAGS,RELOPND           RELEASE DEVICE, THEN    @ZA28912
*                                      ATTEMPT TO RECONNECT    @ZA28912
         B     ERRETURN                                        @VS49571
INTRREQ2 EQU   *                                               @VS49571
         LA    R15,TOWRITE             YES. SET UP TO WRITE    @ZA44250
         LA    R0,MSG12                ISSUE THE GOOD MORNING  @ZA44250
*        TM    MFLAGS,READA+WRITING    DELETED BY APAR ZA44250 @ZA44250
*                                       INITIAL READ OR WRITE  @DA04534
*                                       OF AN ERROR MESSAGE?   @DA04534
*        BZ    ERRETURN                DELETED BY APAR ZA44250 @ZA44250
*                                       FLUSHING               @DA04534
*        LA    R15,REISSU              DELETED BY APAR ZA44250 @ZA44250
*        LA    R0,RESET1ST             DELETED BY APAR ZA44250 @ZA44250
         B     ERRETURN                 MSG                    @ZA44250
         SPACE 4                                               @DA04534
SENS3741 EQU   *                       HANDLE BISYNCH STATUS   @DA04534
*                                       ERROR MESSAGE FOR 3741 @DA04534
         CLC   STATUS2,BISTF2          NO RECORD FOUND ON      @DA04534
*                                       DISKETTE?              @DA04534
         BE    NORECRD                 YES. NO RECORD.  RE-    @DA04534
*                                       ISSUE THE SOLICIT/READ @DA04534
         CLC   STATUS2,BISTE2          NO. DID OPERATOR ABORT  @DA04534
*                                       JOB BY PRESSING RESET? @DA04534
         BNE   ERRETURN                NO. OTHER ERROR.        @DA04534
*                                       RELEASE THE DEVICE.    @DA04534
         B     ABORTED2                YES. GO TO 3741/3747    @DA04534
*                                       COMMON 'ABORTED' ROU-  @DA04534
*                                       TINE                   @DA04534
         SPACE 2                                               @DA04534
NORECRD  EQU   *                                               @DA04534
         LA    R15,TOPROBDV            IN CASE DEVICE PROBLEM  @Z40GKD3
         TM    MFLAGS,READA            HAPPEN ON READ(ANY)?    @ZA33715
         BZ    ERRETURN                NO. IMPOSSIBLE          @Z40GKD3
         LA    R15,TOWRITE             YES. RESET AND ISSUE    @DA04534
         LA    R0,MSG02+X'80'           ERROR MSG TO THE       @DA04534
         B     ERRETURN                 TERMINAL OPERATOR      @DA04534
         SPACE 4                                               @DA04534
SENS3747 EQU   *                       HANDLE BISYNCH STATUS   @DA04534
*                                       ERROR MESSAGE FOR 3747 @DA04534
         CLC   STATUS2,BIST50          OPERATOR REQUEST ABORT? @DA04534
         BE    ERRETURN                NO. OTHER BISYNCH ERR.  @DA04534
*                                       RELEASE THE DEVICE     @DA04534
*                                      YES. FALL THRU TO       @DA04534
*                                       COMMON 3741/3747 ABORT @DA04534
*                                       ROUTINE                @DA04534
         SPACE 4                                               @DA04534
ABORTED2 EQU   *                       COMMON ABORT ROUTINE    @DA04534
         LA    R15,TOPROBDV            IN CASE DEVICE PROBLEM  @Z40GKD3
         TM    MFLAGS,READA+WRITING  HAPPEN ON READ OR WRITE?
         BZ    ERRETURN                NO. IMPOSSIBLE          @Z40GKD3
         LA    R15,RSETSOL             YES. RESET THEN SOLICIT @DA04534
         B     ERRETURN                                        @DA04534
         EJECT                                                 @DA04534
***                                                            #XL03HAJ
*                                                              #XL03HAJ
*  THE BUFFER THRESHHOLD EXCEEDED CONDITION CAN OCCUR FOR THE  #XL03HAJ
*  VARIOUS OUTPUT REQUESTS AS FOLLOWS:                         #XL03HAJ
*                                                              #XL03HAJ
*    RESET - THE MOST LIKELY CONDITION IS DUE TO A DEVICE      @VS49571
*            PROBLEM AS DESCRIBED UNDER THE WRITE ERROR        @VS49571
*            DESCRIPTION.                                      @VS49571
*                                                              @XL03HAJ
*    WRITE - NETSOL LOGIC ATTEMPTS TO ELIMINATE THIS SITUATION @VS49571
*            BY DOING A READ(ANY) WITH THE TRUNC OPTION ON THE @VS49571
*            NIB.                                              @VS49571
*            SOMETIMES, HOWEVER A DEVICE MAY HAVE A            @XL03HAJ
*            HARDWARE PROBLEM WHICH CAUSES IT TO ENTER HUGE    @XL03HAJ
*            HUNKS OF UNSOLICITED DATA THAT FILL THE BUFFERS   @XL03HAJ
*            AFTER THE FLUSHING HAS BEEN DONE BUT BEFORE THE   @XL03HAJ
*            WRITE IS ISSUED.  (DEPENDING ON TIMING, THE SAME  @XL03HAJ
*            THING COULD HAPPEN IF THE DEVICE WERE WORKING     @XL03HAJ
*            CORRECTLY, BUT A TERMINAL OPERATOR WITH FAST      @XL03HAJ
*            FINGERS PURPOSFULLY ENTERED LOTS OF UNSOLICITED   @XL03HAJ
*            DATA.                                             @XL03HAJ
*                                                              @XL03HAJ
*  SOLICIT - HARDWARE ERROR AS DESCRIBED ABOVE UNDER THE WRITE @XL03HAJ
*            ERROR DESCRIPTION.                                @XL03HAJ
*                                                              @XL03HAJ
***                                                            @XL03HAJ
*                                                              @XL03HAJ
EXCEEDED EQU   *                                               @XL03HAJ
         SR    R15,R15                 IF RESET UNCOND, VTAM   @XL03HAJ
         TM    MFLAGS,RESETU            HAS ALREADY ISSUED A   @XL03HAJ
         BO    ERRETURN                 RESET, SO ACT AS IF    @XL03HAJ
*                                       VALID COMPLETION.      @XL03HAJ
*                                                              @XL03HAJ
         LA   R15,TOPROBDV             ANY OTHER ERROR IS PRO- @Z40GKD3
         B    ERRETURN                  BABLY DUE TO A BAD     @Z40GKD3
*                                       DEVICE WHICH KEEPS     @XL03HAJ
*                                       ENTERING DATA.         @XL03HAJ
         EJECT                                                 @XL03HAJ
IORESET  EQU   *                                               @XL03HAJ
         TM    MFLAGS,READA            FOUND ON READ(ANY)?     @XM02215
         BO    IORESETA                YES. HANDLE THAT CASE   @XM02215
*                                                              @VS49571
         TM    MFLAGS,RESETU           IS IT RESET             @ZA35053
         BO    IORESTB                 YES HANDLE THAT CASE    @ZA35053
         B     IOWRITE                 NO MUST BE WRITE        @ZA35053
IORESTB  EQU   *                                               @ZA35053
         LA    R15,TOENDREQ            FREE THE RPL IF RESET   @ZA35053
         B     ERRETURN                HAS BEEN ISSUED         @ZA35053
IOWRITE  EQU   *                                               @ZA35053
         SR    R15,R15                 NO, MUST BE ON A WRITE. @VS49571
         B     ERRETURN                 WENT OK.               @VS49571
*                                                              @VS49571
*                                                              @VS49571
IORESETA EQU   *                                               @XM02215
         LA    R15,CATCHALL            REISSUE THE SOLICIT/READ@VS49571
         B     ERRETURN                NOTE: THERE MAY BE A    @XM02215
*                                       SOLICIT ALREADY OUT-   @XM02215
*                                       STANDING.  IF SO, THE  @XM02215
*                                       NEW SOLICIT WILL BE    @XM02215
*                                       IGNORED, AND THE RE-   @XM02215
*                                       SPONSE TO THE SOLICIT  @XM02215
*                                       WILL BE 00/00.         @XM02215
         TITLE 'ERREXIT - ERROR OCCURRED           RTNCD = 10' @VS49571
         SPACE 2                                               @XL03HAJ
***                                                            @XL03HAJ
*                                                              @XL03HAJ
*  RTNCD CODE 10 - ENVIRONMENT                                 @VS49571
*                                                              @XL03HAJ
*   FDBK2 CODE   MACRO(S)               MEANING                @VS49571
*                                                              @XL03HAJ
*       00     * OPNDST(SPEC,ACQUIRE)   DEVICE OR APPLICATION  @XL03HAJ
*              * CLSDST(PASS)/CHECK      UNAVAILABLE.          @XL03HAJ
*                                                              @XL03HAJ
*       01                                                     @XL03HAJ
*                                                              @XL03HAJ
*       02     * CLSDST(PASS)/CHECK     TARGET APPLICATION     @XL03HAJ
*                                        UNACCEPTABLE.         @XL03HAJ
*                                                              @XL03HAJ
*       03     * OPNDST(SPEC,ACQUIRE)   VTAM IS HALTING.       @XL03HAJ
*              * OPNDST(ACCEPT,ANY)                            @XL03HAJ
*                                                              @XL03HAJ
*       04     * READ(ANY)/CHECK        INCOMPATABLE DEFINITION@XL03HAJ
*              * WRITE(LBT)/CHECK        BETWEEN VTAM AND NCP. @VS49571
*              * RESET(UNCOND)/CHECK                           @XL03HAJ
*                                                              @XL03HAJ
*       05     * OPNDST(SPEC,ACQUIRE)   PERMENENT FAILURE      @XL03HAJ
*              * READ(ANY)/CHECK         IN PATH.              @XL03HAJ
*              * WRITE(LBT)/CHECK                              @XL03HAJ
*              * RESET(UNCOND)/CHECK                           @XL03HAJ
*              * CHANGE/CHECK                                  @VS49571
*                                                              @XL03HAJ
*       06     * OPNDST(SPEC,ACQUIRE)   AUTO NETWORK SHUTDOWN  @XL03HAJ
*              * READ(ANY)/CHECK                               @XL03HAJ
*              * WRITE(LBT)/CHECK                              @XL03HAJ
*              * RESET(UNCOND)/CHECK                           @XL03HAJ
*              * CHANGE/CHECK                                  @VS49571
*                                                              @XL03HAJ
*       07       READ(ANY)/CHECK        VARY DEACTIVATE        @XL03HAJ
*              * WRITE(LBT)/CHECK                              @XL03HAJ
*              * RESET(UNCOND)/CHECK                           @XL03HAJ
*                                                              @XL03HAJ
*       08     * READ(ANY)/CHECK         DIAL DISCONNECT       @VS49571
*              * SOLICIT                                       @VS49571
*              * WRITE(LBT)/CHECK                              @XL03HAJ
*                                                              @XL03HAJ
*       09                              (RECORD ONLY)          @XL03HAJ
*                                                              @XL03HAJ
*       0A     * OPNDST(SPEC,ACQUIRE)   APPARENT VTAM ERROR    @XL03HAJ
*              * CLSDST(RELEASE)/CHECK                         @XL03HAJ
*              * CLSDST(PASS)/CHECK                            @XL03HAJ
*              * INQUIRE(DEVCHAR)                              @XL03HAJ
*              * INQUIRE(CIDXLATE)                             @XL03HAJ
*              * INTRPRET                                      @XL03HAJ
*              * CHANGE/CHECK                                  @VS49571
*              * INQUIRE(APPSTAT)                              @VS49571
*                                                              @XL03HAJ
*       0B     * READ(ANY)/CHECK        DIAL-OUT DISCONNECT    @VS49571
*              * WRITE(LBT)/CHECK                              @XL03HAJ
*                                                              @XL03HAJ
*       0C     * READ(ANY)/CHECK        DIAL-IN DISCONNECT     @VS49571
*              * WRITE(LBT)/CHECK                              @XL03HAJ
*                                                              @XL03HAJ
*       0D       ALL API MACROS         VTAM NOT ACTIVE TO     @XL03HAJ
*                                        APPLICATION           @XL03HAJ
*                                                              @XL03HAJ
*       0E     * ALL API MACROS         ABEND IN VTAM          @XL03HAJ
*                                                              @XL03HAJ
*                                                              @XL03HAJ
***                                                            @XL03HAJ
         SPACE 2                                               @XL03HAJ
ENVIRON  EQU   *                                               @XL03HAJ
         CH    R6,HEXE                 IS RSN CODE VALID SIZE? @XL03HAJ
         BH    SNOCCUR             >E  NO. ERROR               @XL03HAJ
         SPACE 2                                               @XL03HAJ
***                                                            @XL03HAJ
*                                                              @XL03HAJ
*   HANDLE FIRST THREE REASON CODES WITHOUT BRANCH TABLE.      @XL03HAJ
*                                                              @XL03HAJ
***                                                            @XL03HAJ
         SPACE 2                                               @XL03HAJ
         LTR   R6,R6                   CHECK FOR TERMINAL OR   @XL03HAJ
*                                       APPLICATION NOT        @XL03HAJ
*                                       AVAILABLE.             @XL03HAJ
         BNZ   CHKQUIES            ^0  IF NOT, NEXT CHECK      @XL03HAJ
*                                                              @XL03HAJ
         TM    MFLAGS,OPNDSPEC      0  ERROR ON OPNDST(SPEC)?  @XL03HAJ
         BO    TERMUNAV                YES. HANDLE THAT CASE   @XL03HAJ
         LA    R15,TOWRITE             NO. APPLICATION UNAVAIL-@XL03HAJ
         LA    R0,MSG07                 ABLE WRITE ERROR MSG   @XL03HAJ
         B     ERRETURN                                        @XL03HAJ
TERMUNAV EQU   *                                               @XL03HAJ
         LA    R15,TOENDREQ            TERMINAL UNAVAILABLE FOR@VS49571
         B     ERRETURN                 FOR OPNDST(SPEC) AFTER @XL03HAJ
*                                       CLSDST(PASS) BECAUSE   @XL03HAJ
*                                       CLSDST(PASS) FAILED    @XL03HAJ
*                                       AND THE NETWORK OPER-  @XL03HAJ
*                                       ATOR VARRIED OFF THE   @XL03HAJ
*                                       TERMINAL.              @XL03HAJ
         SPACE 2                                               @XL03HAJ
CHKQUIES EQU   *                                               @XL03HAJ
         LA    R15,TORELES             PREPARE ACTION CODE     @XL03HAJ
         SLL   R7,D2                    AND BRANCH TABLE INDEX @XL03HAJ
*                                       IN CASE REASON CODE    @XL03HAJ
*                                       GREATER THAN 2         @XL03HAJ
         CH    R6,HEX2                 CHECK FOR 1 OR 2        @XL03HAJ
*                                                              @XL03HAJ
         BL    SNOCCUR              1  (RECORD ONLY)           @XL03HAJ
*                                                              @XL03HAJ
         BH    RSNTAB10(R7)        >2  GO TO REASON CODE       @XL03HAJ
*                                       HANDLING ROUTINE       @XL03HAJ
*                                                              @XL03HAJ
         LA    R15,TOWRITE          2  APPLICATION IS QUIESCING@XL03HAJ
         LA    R0,MSG09                 OR NEVER ACCEPTS LOGONS@XL03HAJ
*                                       BUT QUIESCE IS MORE    @XL03HAJ
*                                       LIKELY SINCE 'NEVER    @XL03HAJ
*                                       ACCEPTS WOULD PROBABLY @XL03HAJ
*                                       HAVE BEEN FOUND ON THE @XL03HAJ
*                                       INQUIRE.  EITHER CAN   @XL03HAJ
*                                       HAPPEN IF THE OTHER    @XL03HAJ
*                                       APPLICATION CHANGES ITS@XL03HAJ
*                                       STATUS AFTER NETSOL'S  @XL03HAJ
*                                       INQUIRE(APPSTAT) BUT   @XL03HAJ
*                                       PRIOR TO THE LATER     @XL03HAJ
*                                       CLSDST(PASS).          @XL03HAJ
         B     ERRETURN                WRITE ERROR MESSAGE     @XL03HAJ
         SPACE 2                                               @XL03HAJ
RSNTAB10 EQU   *-(3*4)                 START TABLE AT R6=3     @XL03HAJ
*                                                              @XL03HAJ
         B     QUIKHALT             3  VTAM IS HALTING.        @XL03HAJ
*                                      NETSOL CAN NO LONGER    @XL03HAJ
*                                       COMMUNICATE WITH       @XL03HAJ
*                                       DEVICES. TPEND NOTIFIED@XL03HAJ
*                                                              @XL03HAJ
         B     INCOMPAT             4  INCOMPATIBLE DEFINITION @Z40GKD3
*                                      SOMETHING IS WRONG WITH @XL03HAJ
*                                       NCP OR VTAM GEN OF     @XL03HAJ
*                                       NETWORK FOR THIS       @XL03HAJ
*                                       DEVICE.                @XL03HAJ
*                                                              @XL03HAJ
         B     ERRETURN             5  PERMANENT PATH FAILURE  @XL03HAJ
*                                      ACTION CODE ALREADY SET @XL03HAJ
*                                       UP TO RELEASE DEVICE   @XL03HAJ
*                                                              @XL03HAJ
         B     ERRETURN             6  AUTO NETWORK SHUTDOWN   @XL03HAJ
*                                      ACTION CODE ALREADY SET @XL03HAJ
*                                       UP TO RELEASE DEVICE   @XL03HAJ
*                                                              @XL03HAJ
         B     ERRETURN             7  VARY DEACT. IMMEDIATE   @XL03HAJ
*                                       LOSTERM WAS SCHEDULED  @XL03HAJ
*                                      ACTION CODE ALREADY SET @XL03HAJ
*                                       UP TO RELEASE DEVICE   @XL03HAJ
*                                                              @XL03HAJ
         B     ERR1008              8  DIAL  DISCONNECT        @XL03HAJ
*                                      CAN OCCUR FOR READ OR   @VS49571
*                                      WRITE MACRO.  TRY TO    @VS49571
*                                      REESTABLISH CONNECTION  @VS49571
*                                      WITH TERMINAL BY REISSUING
*                                      THE I/O COMMAND (ONE TIME).
*                                      IF NO-GO, RELEASE THE RPL
*                                      AND RETURN TO VTAM.     @VS49571
*                                                              @XL03HAJ
         BAL   R7,SNOCCUR           9  (RECORD ONLY)           @VS49571
*                                                              @XL03HAJ
         B     VTAMERR              A  VTAM ERROR FOR DEVICE   @ZA19916
*                                                              @XL03HAJ
         B     RECONECT             B  DIAL-OUT DISCONNECT     @XL03HAJ
*                                       LOSTERM NOT SCHEDULED  @XL03HAJ
*                                      TRY TO RECONNECT ONCE   @XL03HAJ
*                                                              @XL03HAJ
         B     ERRETURN             C  DIAL-IN  DISCONNECT     @XL03HAJ
*                                       LOSTERM WAS SCHEDULED  @XL03HAJ
*                                      ACTION CODE ALREADY SET @XL03HAJ
*                                       UP TO RELEASE DEVICE   @XL03HAJ
         B     SNOCCUR              D  VTAM INACTIVE TO YOUR   @VS49571
*                                      ACB.  SHOULD NOT OCCUR  @VS49571
*                                                              @VS49571
         B     ERR100E              E  VTAM INACTIVE TO YOUR   @VS49571
*                                      ACB.  CAN OCCUR FOR ANY @VS49571
*                                      API MACRO. ACTION IS TO @VS49571
*                                      FREE THE RPL, AND RETURN@VS49571
*                                      TO VTAM.                @VS49571
*                                                              @VS49571
         SPACE 4                                               @XL03HAJ
QUIKHALT EQU   *                                               @XL03HAJ
         LA    R15,TOENDREQ            INDICATE RETURN TO VTAM @VS49571
         MVI   UFLAGS,SHUTDOWN          TURN ON SHUTDOWN       @ZA33715
         B     ERRETURN                                        @VS49571
*                                                              @VS49571
         SPACE 4                                               @XL03HAJ
INCOMPAT EQU   *                       INCOMPATIBLE NCP/VTAM   @Z40GKD3
         LA    R15,TOPROBDV            SOMETHING'S WRONG       @Z40GKD3
         B     ERRETURN                BRANCH TO PROBDEV       @Z40GKD3
         SPACE 2                                               @Z40GKD3
VTAMERR  EQU   *                       ON 100A RTNCD  JUST     @ZA19916
         LA    R15,TOPROBDV             RELEASE THE TERMINAL.  @ZA19916
         B     ERRETURN                                        @ZA19916
         SPACE 2                                               @ZA19916
RECONECT EQU   *                                               @XL03HAJ
         TM    FLAGS,LOOPONCE          ALREADY RETRY I/O?      @XL03HAJ
         BZ    WHATIO                  NO. DO SO, BUT FIRST    @XL03HAJ
*                                       CHECK WHAT KIND.       @XL03HAJ
         NI    FLAGS,X'FF'-LOOPONCE    YES. RESET RETRY FLAG.  @XL03HAJ
         B     ERRETURN                ACTION CODE ALREADY SET @XL03HAJ
*                                       UP TO RELEASE DEVICE.  @XL03HAJ
*                                                              @XL03HAJ
WHATIO   EQU   *                                               @XL03HAJ
         OI    FLAGS,LOOPONCE          INDICATE RETRY I/O      @XL03HAJ
         LA    R15,REISSU              SET ACTION FOR RE-ISSUE @XL03HAJ
*                                       IN CASE ERROR ON WRITE.@XL03HAJ
*                                       R0 ALREADY SET UP FOR  @XL03HAJ
*                                       RE-ISSUE ONLY.         @XL03HAJ
         TM    MFLAGS,WRITING          DISCONNECT ON WRITE?    @XL03HAJ
         BO    ERRETURN                YES. REISSUE I/O.       @XL03HAJ
*                                                              @XL03HAJ
         LA    R15,TOWRITE             ACTION FOR READ(ANY) IS @XL03HAJ
         LA    R0,MSG01                 TO DO RETRY VIA WRITE  @XL03HAJ
*                                       OF ERROR MESSAGE.      @XL03HAJ
         TM    MFLAGS,READA            ERROR ON READ(ANY)?     @XL03HAJ
         BO    ERRETURN                YES. WRITE ERROR MSG    @XL03HAJ
*                                                              @XL03HAJ
         SR    R15,R15                 YES. GIVE NORMAL        @XL03HAJ
         B     ERRETURN                 RETURN.  THE RETRY OF  @XL03HAJ
*                                       I/O WILL BE NEW WRITE  @XL03HAJ
*                                       I/O.                   @XL03HAJ
         SPACE 2                                               @VS49571
ERR1008  EQU   *                       LOSTERM WILL CLOSE THE  @VS49571
*                                       THE DEVICE LATER       @VS49571
*                                                              @VS49571
         LA    R15,TOENDREQ            INDICATE END OF REQUEST @VS49571
         TM    FLAGS,LOOPONCE          WAS THIS ALREADY DONE   @VS49571
*                                       ONCE?                  @VS49571
         BO    ERRETURN                YES, DON'T RETRY AGAIN  @VS49571
         OI    FLAGS,LOOPONCE          INDICATE DONE ONCE      @VS49571
         LA    R15,REISSU              RETRY THE COMMAND ONCE  @VS49571
         B     ERRETURN                                        @VS49571
         SPACE 2                                               @VS49571
ERR100E  EQU   *                                               @VS49571
         LA    R15,TOENDREQ                                    @VS49571
         B     ERRETURN                                        @VS49571
         TITLE 'ERREXIT - ERROR OCCURRED           RTNCD = 14' @VS49571
         SPACE 2                                               @XL03HAJ
***                                                            @XL03HAJ
*                                                              @XL03HAJ
*  RTNCD CODE 14 - LOGIC                                       @VS49571
*                                                              @XL03HAJ
*   FDBK2 CODE      MACRO(S)           MEANING                 @VS49571
*                                                              @XL03HAJ
*        00         ALL API MACROS     NON-VTAM REQUEST CODE   @XL03HAJ
*                   (NOT CHECK, OPEN,                          @XL03HAJ
*                    OR CLOSE)                                 @XL03HAJ
*                                                              @XL03HAJ
*        01                            RESERVED                @XL03HAJ
*                                                              @XL03HAJ
*        02         ALL API MACROS     EXIT ADDRESS IS ZERO    @XL03HAJ
*                   (NOT CHECK, OPEN,                          @XL03HAJ
*                    OR CLOSE)                                 @XL03HAJ
*                                                              @XL03HAJ
*        03         ALL API MACROS     ECB ADDRESS IS ZERO     @XL03HAJ
*                   (NOT CHECK, OPEN,                          @XL03HAJ
*                    OR CLOSE)                                 @XL03HAJ
*                                                              @XL03HAJ
*        04         CHECK              RPL IS NOT ACTIVE       @XL03HAJ
*                                                              @XL03HAJ
*        05-0F                         RESERVED                @XL03HAJ
*                                                              @XL03HAJ
*        10         ALL API MACROS     INVALID ACB             @XL03HAJ
*                   (NOT CHECK, OPEN,                          @XL03HAJ
*                    OR CLOSE)                                 @XL03HAJ
*                                                              @XL03HAJ
*        11                                                    @XL03HAJ
*                                                              @XL03HAJ
*        12       * OPNDST(ACQUIRE,    CLSDST IN PROGRESS      @XL03HAJ
*                          SPEC)/CHECK                         @VS49571
*                 * OPNDST(ACCEPT,                             @VS49571
*                          ANY)/CHECK                          @VS49571
*                 * CLSDST(PASS)/CHECK                         @VS49571
*                 * CLSDST(RELEASE)/CHECK                      @VS49571
*                 * SOLICIT(SPEC)/CHECK                        @VS49571
*                 * READ(ANY)/CHECK                            @VS49571
*                 * WRITE(LBT)/CHECK                           @VS49571
*                 * RESET(UNCOND)/CHECK                        @VS49571
*                 * CHANGE                                     @VS49571
*                                                              @XL03HAJ
*        13       * CLSDST(PASS)/CHECK CID INVALID             @VS49571
*                 * CLSDST(RELEASE)/CHECK                      @VS49571
*                   INQUIRE(DEVCHAR)/CHECK                     @VS49571
*                 * INQUIRE(CIDXLATE)                          @VS49571
*                   INQUIRE(APPSTAT)                           @VS49571
*                 * INTRPRET                                   @XL03HAJ
*                 * SOLICIT(SPEC)                              @XL03HAJ
*                 * WRITE(LBT)/CHECK                           @VS49571
*                 * RESET(UNCOND)/CHECK                        @VS49571
*                 * CHANGE                                     @VS49571
*                                                              @XL03HAJ
*        14                                                    @XL03HAJ
*                                                              @XL03HAJ
*        15                                                    @XL03HAJ
*                                                              @XL03HAJ
*        16         SOLICIT(SPEC)      SOLICIT SPECIFIC TO     @XL03HAJ
*                                       OUTPUT ONLY            @XL03HAJ
*                                                              @XL03HAJ
*        17                                                    @VS49571
*                                                              @XL03HAJ
*        18                                                    @VS49571
*                                                              @XL03HAJ
*        19                                                    @XL03HAJ
*                                                              @XL03HAJ
*        1A                                                    @XL03HAJ
*                                                              @XL03HAJ
*        1B                                                    @XL03HAJ
*                                                              @XL03HAJ
*        1C                                                    @XL03HAJ
*                                                              @XL03HAJ
*        1D                                                    @XL03HAJ
*                                                              @XL03HAJ
*        1E         INQUIRE(DEVCHAR)   INVALID DATA AREA       @XL03HAJ
*                   INQUIRE(APPSTAT)    OR LENGTH              @XL03HAJ
*                   INQUIRE(CIDXLATE)                          @XL03HAJ
*                   INTRPRET                                   @XL03HAJ
*                   READ(ANY)/CHECK                            @VS49571
*                   WRITE(LBT)/CHECK                           @VS49571
*                                                              @XL03HAJ
*        1F                                                    @XL03HAJ
*                                                              @XL03HAJ
*        20                                                    @XL03HAJ
*                                                              @XL03HAJ
*        21                                                    @XL03HAJ
*                                                              @XL03HAJ
*        22                                                    @XL03HAJ
*                                                              @XL03HAJ
*        23         ALL API MACROS     INVALID MACRO REQUEST   @XL03HAJ
*                   (NOT CHECK, OPEN,   TYPE                   @XL03HAJ
*                    OR CLOSE)                                 @XL03HAJ
*                                                              @XL03HAJ
*        24                                                    @XL03HAJ
*                                                              @XL03HAJ
*        25                                                    @XL03HAJ
*                                                              @XL03HAJ
*        26                                                    @XL03HAJ
*                                                              @XL03HAJ
*        27         RESET(UNCOND)      RESET OPTION CODE       @XL03HAJ
*                                       INVALID                @XL03HAJ
*                                                              @XL03HAJ
*        28                                                    @XL03HAJ
*                                                              @XL03HAJ
*        29                                                    @XL03HAJ
*                                                              @XL03HAJ
*        2A                                                    @XL03HAJ
*                                                              @XL03HAJ
*        2B                                                    @XL03HAJ
*                                                              @XL03HAJ
*        2C         WRITE(LBT)         OUTPUT NOT PRECEEDED    @XL03HAJ
*                   RESET(UNCOND)       BY INPUT               @XL03HAJ
*                                                              @XL03HAJ
*        2D                                                    @XL03HAJ
*                                                              @XL03HAJ
*        2E                                                    @XL03HAJ
*                                                              @XL03HAJ
*        2F                                                    @XL03HAJ
*                                                              @XL03HAJ
*        30                                                    @XL03HAJ
*                                                              @XL03HAJ
*        31         WRITE(LBT)         INVALID DATA AREA       @XL03HAJ
*                                       OR LENGTH              @XL03HAJ
*                                                              @XL03HAJ
*        32       * SOLICIT(SPEC)/     REQUEST INVALID FOR     @VS49571
*                 * READ(ANY)/CHECK                            @VS49571
*                 * WRITE(SPEC)/CHECK   SPECIFIED DEVICE       @VS49571
*                 * RESET(UNCOND)/CHECK                        @VS49571
*                                                              @XL03HAJ
*        33                                                    @XL03HAJ
*                                                              @XL03HAJ
*        34         WRITE(LBT)         NO READ WHERE REQUIRED  @VS49571
*                   RESET(UNCOND)                              @VS49571
*                                                              @XL03HAJ
*        35                                                    @XL03HAJ
*                                                              @XL03HAJ
*        36                                                    @XL03HAJ
*                                                              @XL03HAJ
*        37                                                    @XL03HAJ
*                                                              @XL03HAJ
*        38                                                    @XL03HAJ
*                                                              @XL03HAJ
*        39         SOLICT(SPEC)       FIRST I/O FAILED DUE    @XL03HAJ
*                   READ(ANY)/CHECK     TO INVALID PROCESSING  @XL03HAJ
*                   WRITE(LBT)          OPTIONS                @VS49571
*                   RESET(UNCOND)                              @XL03HAJ
*                                                              @XL03HAJ
*        3A-49                                                 @XL03HAJ
*                                                              @XL03HAJ
*        4A       * INTRPRET            NO INTRPRET ROUTINE    @XL03HAJ
*                                                              @XL03HAJ
*        4B       * INTRPRET            INVALID LOGON SEQUENCE @XL03HAJ
*                                                              @XL03HAJ
*        4C       * INQUIRE(APPSTAT)    NO TERMINAL OR         @XL03HAJ
*                   INQUIRE(DEVCHAR)     APPLICATION PROGRAM   @XL03HAJ
*                   INTRPRET             NAME                  @XL03HAJ
*                                                              @XL03HAJ
*        4D       * INTRPRET            NO INTRPRET TABLE      @XL03HAJ
*                                                              @XL03HAJ
*        4E         OPNDST(ACCEPT,ANY)  INVALID NIB LIST       @XL03HAJ
*                                                              @XL03HAJ
*        4F         OPNDST(ACCEPT,ANY)  INVALID OPNDST TYPE    @XL03HAJ
*                   OPNDST(ACQUIRE,SPEC)                       @XL03HAJ
*                                                              @XL03HAJ
*        50         OPNDST(ACCEPT,ANY)                         @XL03HAJ
*                   OPNDST(ACQUIRE,SPEC)                       @XL03HAJ
*                                                              @XL03HAJ
*        51         OPNDST(ACCEPT,ANY)  APPLICATION NEVER      @XL03HAJ
*                   OPNDST(ACQUIRE,SPEC) ACCEPTS LOGON         @XL03HAJ
*                                                              @XL03HAJ
*        52         OPNDST(ACCEPT,ANY)  INVALID NIB            @XL03HAJ
*                   OPNDST(ACQUIRE,SPEC)                       @XL03HAJ
*                   CLSDST(RELEASE)                            @XL03HAJ
*                   INQUIRE(APPSTAT)                           @XL03HAJ
*                                                              @XL03HAJ
*        53         OPNDST(ACCEPT,ANY)  SYMBOLIC NAME UNKNOWN  @XL03HAJ
*                   OPNDST(ACQUIRE,SPEC)                       @XL03HAJ
*                 * CLSDST(RELEASE)                            @VS49571
*                 * INQUIRE(APPSTAT)                           @XM09467
*                                                              @XL03HAJ
*        54         OPNDST(ACQUIRE,SPEC) DESTINATION UNOPENABLE@XL03HAJ
*                                                              @XL03HAJ
*        55         OPNDST(ACCEPT,ANY)  NO OPNDST AUTHORIZATION@XL03HAJ
*                 * OPNDST(ACQUIRE,SPEC)                       @XL03HAJ
*                 * CLSDST(RELEASE)/CHECK                      @VS49571
*                 * CLSDST(PASS)/CHECK                         @XL03HAJ
*                                             OR               @VS49571
*                 * INTRPRET            INTRPRET ROUTINE FAILED@X50BHD3
*                                        TO RETURN APLICATION  @X50BHD3
*                                        NAME.                 @X50BHD3
*                                                              @X50BHD3
*        56         OPNDST(ACCEPT,ANY)  CONFLICT BETWEEN MODE  @VS49571
*                   OPNDST(ACQUIRE,SPEC) AND DEVICE TYPE       @XL03HAJ
*                                                              @XL03HAJ
*        57         OPNDST(ACCEPT,ANY)  INVALID MODE           @XL03HAJ
*                   OPNDST(ACQUIRE,SPEC)                       @XL03HAJ
*                                                              @XL03HAJ
*        58                                                    @XL03HAJ
*                                                              @XL03HAJ
*        59                                                    @XL03HAJ
*                                                              @XL03HAJ
*        5A                                                    @XL03HAJ
*                                                              @XL03HAJ
*        5B         CLSDST(PASS)        INVALID LOGON DATA ADR @XL03HAJ
*                                                              @XL03HAJ
*        5C                                                    @XL03HAJ
*                                                              @XL03HAJ
*        5D      *  CLSDST(PASS)/CHECK  DESTINATION NOT OPENED @VS49571
*                *  CLSDST(RELEASE)/CHECK                      @VS49571
*                *  SOLICIT(SPEC)                              @VS49571
*                *  READ(ANY)/CHECK                            @VS49571
*                *  WRITE(LBT)/CHECK                           @VS49571
*                *  RESET(UNCOND)/CHECK                        @VS49571
*                *  CHANGE                                     @VS49571
*                                                              @XL03HAJ
*        5E         CLSDST(PASS)        NO PASS AUTHORIZATION  @XL03HAJ
*                                                              @XL03HAJ
*        5F       * CLSDST(PASS)/CHECK  RESOURCE NOT OWNED     @XL03HAJ
*                                                              @XL03HAJ
*        60       * CLSDST(RELEASE)/    RESOURCE NOT CLOSABLE  @VS49571
*                    CHECK                                     @VS49571
*                                                              @XL03HAJ
*        61         SETLOGON(START)     INVALID SETLOGON       @XL03HAJ
*                                                              @XL03HAJ
*        62         SOLICIT(SPEC)       MACRO NOT VALID FOR    @XL03HAJ
*                   READ(ANY)/CHECK      SPECIFIED DEVICE TYPE @XL03HAJ
*                   WRITE(LBT)                                 @XL03HAJ
*                   RESET(UNCOND)                              @XL03HAJ
*                                                              @XL03HAJ
***                                                            @XL03HAJ
         SPACE 2                                               @XL03HAJ
LOGIC    EQU   *                                               @XL03HAJ
         CH    R6,HEX60                 IS REASON CODE WITHIN  @XL03HAJ
*                                       LIMITS OF POSSIBILITY? @XL03HAJ
*                                       X'60' IS HIGHEST VALID @XL03HAJ
*                                       VALUE TO BE EXPECTED.  @XL03HAJ
         BH    SNOCCUR            >60  NO. ERROR               @XL03HAJ
         CH    R6,HEX4A                IF REASON CODE AT LEAST @XL03HAJ
         BNL   CHK56X            >=4A   X'4A', DO SEPARATELY   @XL03HAJ
         SPACE 2                                               @XL03HAJ
         LA    R15,TOENDREQ            PREPARE ACTION FOR      @VS49571
*                                       REASON CODES OF 12 & 13@VS49571
         CH    R6,HEX12                CLSDST IN PROGRESS?     @VS49571
         BE    ERRETURN            12  YES, ACTION CODE        @VS49571
*                                        ALREADY SET           @VS49571
         SPACE 2                                               @VS49571
         CH    R6,HEX13                IS REASON CODE 13?      @XL03HAJ
         BE    ERRETURN            13  CID INVALID             @XL03HAJ
*                                      PROBABLY ALREADY        @XL03HAJ
*                                       RELEASED THE TERMINAL. @XL03HAJ
*                                       IGNORE.                @XL03HAJ
         CH    R6,HEX16            16 OUTPUT ONLY              @ZA19859
         BE    INVDEV                 YES, RELEASE             @ZA19859
         SPACE 2                                               @XL03HAJ
         CH    R6,HEX1E            1E  INVALID DATA            @ZA37625
         BE    SEEIFRD                                         @ZA37625
         SPACE 2                                               @ZA37625
         CH    R6,HEX32                REQUEST INVALID FOR     @VS49571
*                                       SPECIFIED DEVICE?      @VS49571
         BNE   SNOCCUR         ^VALID  NO, WRONG CODE          @VS49571
*                                                              @VS49571
         TM    MFLAGS,WRITING        32 IS THIS WRITE          @VS49571
         BNZ   ERRINPUT                YES, ERROR WAS ON OUTPUT@VS49571
*                                       DEVICE I.E. INPUT ONLY @VS49571
*                                      NO, DEVICE IS OUTPUT ONLY
INVDEV   LA    R15,TORELES             RELEASE THE DEVICE      @VS49571
         B     ERRETURN                                        @VS49571
         SPACE 2                                               @VS49571
ERRINPUT EQU   *                       DEVICE IS INPUT ONLY    @VS49571
         LA    R15,CATCHALL            USE CATCHALL            @VS49571
         LA    R0,IGNORE               BUT REALLY ONLY         @VS49571
*                                       IGNORE THE             @VS49571
*                                       WRITE THAT CAUSED THE  @VS49571
         B     ERRETURN                 ERROR                  @VS49571
         EJECT                                                 @XL03HAJ
CHK56X   EQU   *                                               @XL03HAJ
         CH    R6,HEX56                IF REASON CODE MORE THAN@XL03HAJ
         BH    CHK5DX             >56   X'56', DO SEPARATELY   @XL03HAJ
         SPACE 2                                               @XL03HAJ
         LA    R15,TOWRITE             PREPARE DEFAULT ACTION  @XL03HAJ
         SLL   R7,D3                    AND BRANCH TABLE INDEX @XL03HAJ
         B     RSNTAB14(R7)            GO TO REASON CODE       @XL03HAJ
*                                       HANDLING ROUTINE       @XL03HAJ
         SPACE 2                                               @XL03HAJ
RSNTAB14 EQU   *-(8*(X'4A'))           START TABLE W/ R6=X'4A' @XL03HAJ
         LA    R0,MSG04            4A  NO INTERPRET ROUTINE    @XL03HAJ
         B     ERRETURN                                        @XL03HAJ
*                                                              @XL03HAJ
         LA    R0,MSG02            4B  INVALID LOGON SEQUENCE  @XL03HAJ
         B     ERRETURN                                        @XL03HAJ
*                                                              @XL03HAJ
         LA    R0,MSG06            4C  NO SYMBOLIC NAME (FOR   @XM09467
         B     TSTINQA                  APPLICATION)           @XM09467
*                                      ASSUME INQUIRE(APPSTAT) @XM09467
*                                       THEN CHECK FOR IT      @XM09467
*                                                              @XL03HAJ
         LA    R0,MSG03            4D  NO INTRPRET TABLE       @XL03HAJ
         B     STDLOGON                ASSUME ERROR, THEN CHECK@XL03HAJ
*                                      FOR VALID STANDARD LOGON@XL03HAJ
*                                                              @XL03HAJ
         BAL   R7,SNOCCUR          4E                          @VS49571
         NOP   0                                               @XL03HAJ
*                                                              @XL03HAJ
         BAL   R7,SNOCCUR          4F                          @VS49571
         NOP   0                                               @XL03HAJ
*                                                              @XL03HAJ
         BAL   R7,SNOCCUR          50                          @VS49571
         NOP   0                                               @XL03HAJ
*                                                              @XL03HAJ
         BAL   R7,SNOCCUR          51  APPLICATION NEVER       @VS49571
         NOP   0                        ACCEPTS LOGONS         @XL03HAJ
*                                      MEANS NETSOL NEVER      @XL03HAJ
*                                       ACCEPTS LOGON.         @XL03HAJ
*                                                              @XL03HAJ
         BAL   R7,SNOCCUR          52                          @VS49571
         NOP   0                                               @XL03HAJ
*                                                              @XL03HAJ
         LA    R0,MSG06            53  SYMBOLIC (APPLICATION)  @XM09467
         B     TSTINQA                  NAME NOT KNOWN         @XM09467
*                                      ASSUME INQUIRE(APPSTAT) @XM09467
*                                       THEN CHECK FOR IT      @XM09467
*                                                              @XL03HAJ
         BAL   R7,SNOCCUR          54                          @VS49571
         NOP   0                                               @XL03HAJ
*                                                              @XL03HAJ
         LA    R0,MSG05            55  TERMINAL UNAUTHORIZED   @XL03HAJ
         B     OTHERAPL                 FOR APPLICATION        @XL03HAJ
*                                      OR                      @VS49571
*                                      AN INSTALLATION-SUPPLIED@VS49571
*                                       INTERPRET ROUTINE HAS  @VS49571
*                                       REFUSED TO GRANT THE   @VS49571
*                                       TERMINAL ACCESS TO AN  @VS49571
*                                       APPLICATION CORRESPONDING
*                                       TO THE TERMINAL-OPERATOR
*                                       SUPPLIED LOGON SEQUENCE.
*                                      ASSUME CLSDST(PASS),    @XL03HAJ
*                                       THEN CHECK FOR IT.     @XL03HAJ
*                                                              @XL03HAJ
         BAL   R7,SNOCCUR          56  CONFLICT BETWEEN MODE   @VS49571
         NOP   0                        AND DEVICE TYPE.       @XL03HAJ
*                                      TRIED TO OPNDST FOR     @XL03HAJ
*                                       A RECORD DEVICE.       @XL03HAJ
*                                       NETSOL ONLY SUPPORTS   @XL03HAJ
*                                       BASIC DEVICES.         @VS49571
*                                      CAN NOT OCCUR IN NETSOL @VS49571
         SPACE 2                                               @XL03HAJ
CHK5DX   EQU   *                                               @VS49571
         CH    R6,HEX5D                OPNDST INVALID (TERMINAL@VS49571
*                                       NOT CONNECTED)         @VS49571
         BNE   CHK5FX             ^5D  NOT X'5D', CHECK FURTHER@VS49571
         LA    R15,TOENDREQ        5D  ACTION, RELEASE RPL AND @VS49571
         B     ERRETURN                 RETURN TO VTAM         @VS49571
         SPACE 2                                               @VS49571
CHK5FX   EQU   *                                               @XL03HAJ
         CH    R6,HEX5F                LESS THAN X'5F' NOT     @XL03HAJ
         BL    SNOCCUR            <5F   VALID                  @XL03HAJ
*                                                              @XL03HAJ
         LA    R15,TOENDREQ     5F 60  REASON CODES OF 5F      @VS49571
         B     ERRETURN                 AND 60 ARE POSSIBLE IF @XL03HAJ
*                                       A RELREQ OR READEND    @XL03HAJ
*                                       EXIT IS PROCESSED      @XL03HAJ
*                                       AFTER THE DEVICE WAS   @XL03HAJ
*                                       PASSED TO ANOTHER      @XL03HAJ
*                                       APPLICATION.  THIS CAN @XL03HAJ
*                                       HAPPEN BECAUSE THE     @XL03HAJ
*                                       CLSDST(PASS) WILL NOT  @XL03HAJ
*                                       PURGE AN ALREADY       @XL03HAJ
*                                       SCHEDULED EXIT.        @XL03HAJ
         EJECT                                                 @XL03HAJ
         SPACE 4                                               @XL03HAJ
TSTINQA  EQU   *                                               @XL03HAJ
         TM    MFLAGS,INQAPPST         INQUIRE OF APPLICATION  @XL03HAJ
*                                       STATUS MEANS THE       @XL03HAJ
*                                       APPLICATION WAS UN-    @XL03HAJ
*                                       KNOWN TO VTAM.         @XL03HAJ
         BO    ERRETURN                PUT OUT ERROR MESSAGE   @XL03HAJ
         BAL   R7,SNOCCUR              ANY OTHER CAUSE OF      @VS49571
*                                       ERROR IS IMPOSSIBLE    @XL03HAJ
         SPACE 4                                               @XL03HAJ
OTHERAPL EQU   *                                               @XL03HAJ
         TM    MFLAGS,INTRPRT          ERROR ON INTRPRET?      @X50BHD3
         BZ    OPNDSPC                 NO.                     @X50BHD3
         LA    R0,MSG02                YES. WRITE THE MESSAGE  @X50BHD3
*                                       'INPUT NOT RECOGNIZED'.@X50BHD3
         B     ERRETURN                                        @X50BHD3
OPNDSPC  EQU   *
         TM    MFLAGS,OPNDSPEC         ERROR ON OPNDST(SPEC)?  @XL03HAJ
         BO    SNOCCUR                 YES.  THEN THE INSTAL-  @XL03HAJ
*                                       LATION AUTHORIZATION   @XL03HAJ
*                                       ROUTINE DOES NOT ALLOW @XL03HAJ
*                                       NETSOL TO BE CONNECTED @XL03HAJ
         TM    MFLAGS2,CLSDST          WAS THIS A CLOSE        @VS49571
         BO    ERRETURN                YES, THEN HAPPENED ON   @VS49571
*                                       CLDST(PASS).  OHER     @XL03HAJ
*                                       APPLICATION CAN'T BE   @XL03HAJ
*                                       CONNECTED AS REQUESTED @XL03HAJ
*                                       IN RELREQ OR READEND.  @XL03HAJ
*                                       ISSUE ALREADY PREPARED @XL03HAJ
*                                       ERROR MESSAGE.         @XL03HAJ
         BAL   R7,SNOCCUR              NO, ANY OTHER CAUSE     @VS49571
*                                       IS IMPOSSIBLE          @VS49571
         EJECT                                                 @VS49571
STDLOGON EQU   *                                               @XL03HAJ
         SPACE 2                                               @XL03HAJ
         AIF ('&SYSTEM' NE 'DOS').NDOS6                        @D31JKAX
         SPACE 2
***********************************************************************
*                                                                     *
*    NO ROUTINE TO SCAN STANDARD LOGON SEQUENCE IN DOS/VS      @D31JKAJ
*                                                                     *
***********************************************************************
.NDOS6   AIF ('&SYSTEM' NE 'VS1').NVS16                        @D31JKAX
         SPACE 2
***********************************************************************
*
*    NSYSCODE -- OS/VS1 SYSTEM DEPENDENT
*                                                                     *
*    SCAN INPUT FOR STANDARD LOGON SEQUENCE                           *
*                                                                     *
*    STANDARD LOGON SEQUENCE IS AS FOLLOWS:                    @XM07051
*      ANY NUMBER OF BLANKS                                    @XM07051
*      'LOGON ' OR 'LOGON,'                                    @XM07051
*      OPTIONAL OTHER DATA ENDING IN ' ' OR ','                @XM07051
*      'APPLID('                                               @XM07051
*      ONE TO EIGHT ALAPHANUMERIC CHARACTERS SIGNIFYING        @XM07051
*       THE APPLICATION NAME                                   @XM07051
*      ')'                                                     @XM07051
*      AN OPTIONAL ' ' OR ',' FOLLOWED BY OTHER DATA           @XM07051
*
***********************************************************************
         SPACE 2
*                                                              @VS49571
*        XXXXXXXXXX                                            @VS49571
         DROP  PTRNIB                  REG 8 IS NO LONGER NIB  @VS49571
*        XXXXXXXXXX                     DSECT BASE REG.        @VS49571
*                                                              @VS49571
         SR    RECLENG,RECLENG         LENGTH OF LOGON MESSAGE @XM06788
         IC    RECLENG,DATASEQL                                @XM06788
         LA    RCUR,DATASEQ            POINT TO LOGON MESSAGE  @XM07051
         LR    REND,RCUR               POINT BEYOND END OF     @XM07051
         AR    REND,RECLENG             LOGON MESSAGE
         BCTR  RCUR,0                  BACKSPACE 1 FOR LOOP    @XM07051
*                                       ACTION                 @XL03HAJ
*                                       BELOW                  @XM07051
         SPACE 2
NEXTCHAR EQU   *
         SPACE 2
         LA    RCUR,1(,RCUR)           NEXT CHARACTER
         LA    RENDMIN,L'CLOGON+L'CAPPLID+3(,RCUR) MINIMUM END @XM07051
         CR    RENDMIN,REND            CAN STANDARD SEQUENCE   @XM07051
*                                       FIT IN DATA AREA?      @XM07051
         BH    INVALID                 NO. ERROR               @XM07051
         SPACE 2
         CLI   0(RCUR),C' '            IGNORE LEADING BLANKS
         BE    NEXTCHAR
         SPACE 2
SECNDPAS EQU   *                                               @VS49571
         CLC   CLOGON,0(RCUR)          IS FIRST WORD LOGON?    @XM07051
         BE    FOUNDLOG                YES, CONTINUE PROCESSING@VS49571
         TM    FLAGS2,LWRCASE          ALREADY TRIED LOWERCASE?@VS49571
         BO    INVALID                  YES, THEN NOT LOWERCASE@VS49571
         OI    FLAGS2,LWRCASE          INDICATE TRYING LOWER   @VS49571
         TR    DATASEQ,TRTAB2          TRANSLATE LOWER TO UPPER@VS49571
         B     SECNDPAS                TRY AGAIN               @VS49571
         SPACE 2
*       'LOGON' HAS BEEN FOUND.SEARCH FOR APPLID(NAME)
         SPACE 2
FOUNDLOG EQU   *                                               @VS49571
         LA    RCUR,L'CLOGON(,RCUR)    NEXT CHAR BEYOND LOGON  @XM07051
         CLI   0(RCUR),C' '            NEXT CHAR MUST BE       @XM07051
         BE    APPLSCAN                  EITHER BLANK OR A     @XM07051
         CLI   0(RCUR),C','              COMMA                 @XM07051
         BNE   INVALID
         SPACE 2
APPLSCAN EQU   *
         SPACE 2
         LA    RCUR,1(,RCUR)           NEXT CHAR
         LA    RENDMIN,L'CAPPLID+2(,RCUR) MINIMUM END          @XM07051
         CR    RENDMIN,REND            CAN STANDARD SEQUENCE   @XM07051
*                                       FIT IN DATA AREA?      @XM07051
         BH    INVALID                 NO. ERROR               @XM07051
         SPACE 2
         CLC   CAPPLID,0(RCUR)         IS THIS APPLID(?
         BNE   APPLSCAN
         SPACE 2
*       APPLID( FOUND--ENSURE THAT BLANK OR COMMA PRECEDES IT
*       AND THAT ITS WITHIN BOUNDS OF MESSAGE
         SPACE 2
         BCTR  RCUR,0                  BACKSPACE ONE
         CLI   0(RCUR),C' '            IS IT A BLANK?
         BE STARTSOK                   CONTINUE IF SO
         SPACE 2
         CLI 0(RCUR),C','              IS IT A COMMA?
         BE    STARTSOK                CONTINUE IF SO
         SPACE 2
         LA    RCUR,L'CAPPLID+1(,RCUR) NEXT CHAR PAST APPLID(  @XM07051
         B     APPLSCAN                CONTINUE SCAN FOR APPLID(
         SPACE 2
STARTSOK EQU   *
         SPACE 2
         LA    RCUR,L'CAPPLID+1(,RCUR) GO PAST APPLID(         @XM07051
         CLI   0(RCUR),C')'            NULL APPL NAME?
         BE    APPLSCAN                YES. LOOK FOR VALID     @XM07051
*                                       APPLID(                @XM07051
         SPACE 2
*       FIND RIGHT PARENTHESIS
         SPACE 2
         LR    RAPPL,RCUR              ADDRESS POTENTIAL APPLID NAME
         SPACE 2
FNDPAREN EQU   *
         SPACE 2
         LA    RCUR,1(,RCUR)           POINT TO NEXT CHAR
         CR    RCUR,REND               END REACHED?            @XM07051
         BNL INVALID                   YES
         SPACE 2
         CLI   0(RCUR),C')'            IS THIS RIGHT PAREN.?
         BNE   FNDPAREN                NO,CONTINUE SCAN
         LA    RENDMIN,1(,RCUR)        MINIMUM END             @XM07051
         CR    RENDMIN,REND            END OF DATA             @XM07051
         BE    NAMELENG                YES. CAN CHECK FOR      @XM07051
*                                       APPL NAME              @XM07051
         SPACE 2                                               @XM07051
         CLI   1(RCUR),C' '            NO. NEXT CHARACTER MUST @XM07051
         BE    NAMELENG                 BE BLANK OR COMMA,     @XL03HAJ
         CLI   1(RCUR),C','             ELSE CONTINUE SCAN FOR @XM07051
         BNE   APPLSCAN                 VALID APPLID           @XM07051
         SPACE 2                                               @XM07051
NAMELENG EQU *                                                 @XM07051
         SPACE 2
*       IF THIS POINT REACHED APPLID WITH LEFT AND RT. PAREN FOUND
*        AND IT IS FOLLOWED BY A BLANK OR A COMMA OR NO MORE DATA
         SPACE 2
         SR    RCUR,RAPPL              LENGTH OF APPL NAME IN RCUR
         CH    RCUR,LAPPLID            IS NAME TOO BIG?
         BNH   EXTRAPPL                NO. EXTRACT APPL NAME   @XM07051
         LR    RCUR,RAPPL              YES. CONTINUE SCAN FOR  @XM07051
         B     APPLSCAN                 VALID APPLID(          @XL03HAJ
         SPACE 2
EXTRAPPL EQU   *                                               @XM07051
         SPACE 2
         BCTR  RCUR,D0                 DECREMENT FOR EXECUTE   @XL03HAJ
         MVC   APPLID,BLANK8           CLEAR OUT TO MOVE NAME  @XL03HAJ
         EX    RCUR,MVCNAME            EXEC MVC WITH CORRECT LENGTH
         SR    R15,R15                 INDICATE THAT LOGON SEQ @XL03HAJ
         SR    R0,R0                    WAS INTERPRETED OK     @XL03HAJ
         B     ERRETURN                RETURN TO EXIT ROUTINE  @XL03HAJ
         SPACE 3
BLANK8   DC    CL8' '                  BLANKS FOR NAME         @XL03HAJ
CLOGON   DC    C'LOGON'
CAPPLID  DC    C'APPLID('
LAPPLID  DC    AL2(L'APPLID)           LENGTH OF APPLID NAME   @XM07051
MVCNAME  MVC   APPLID(0),0(RAPPL)                              @XM07051
         SPACE 3
INVALID  EQU   *
         SPACE 2
.NVS16   AIF ('&SYSTEM' NE 'VS2').NVS26                        @D31JKAX
         SPACE 2                                               @D31JKAJ
***********************************************************************
*                                                              @D31JKAJ
*    NSYSCODE -- OS/VS2 SYSTEM DEPENDENT                       @D31JKAJ
*                                                                     *
*    SCAN INPUT FOR STANDARD LOGON SEQUENCE                           *
*                                                                     *
*    STANDARD LOGON SEQUENCE IS AS FOLLOWS:                    @D31JKAJ
*      ANY NUMBER OF BLANKS                                    @D31JKAJ
*      'LOGON ' OR 'LOGON,'                                    @D31JKAJ
*      OPTIONAL OTHER DATA ENDING IN ' ' OR ','                @D31JKAJ
*      'APPLID('                                               @D31JKAJ
*      ONE TO EIGHT ALAPHANUMERIC CHARACTERS SIGNIFYING        @D31JKAJ
*       THE APPLICATION NAME                                   @D31JKAJ
*      ')'                                                     @D31JKAJ
*      AN OPTIONAL ' ' OR ',' FOLLOWED BY OTHER DATA           @D31JKAJ
*                                                              @Z30APGV
* NOTE: FOR VS2                                                @Z30APGV
* 'LOGON' OR 'LOGON ' OR 'LOGON,'                              @Z30APGV
* IS SUFFICIENT TO LOGON                                       @Z30APGV
* TO TCAM                                                      @Z30APGV
*                                                              @D31JKAJ
***********************************************************************
         SPACE 2                                               @D31JKAJ
*                                                              @VS49571
*        XXXXXXXXXX                                            @VS49571
         DROP  PTRNIB                  REG 8 IS NO LONGER NIB  @VS49571
*        XXXXXXXXXX                     DSECT BASE REG.        @VS49571
*                                                              @VS49571
         SR    RECLENG,RECLENG         LENGTH OF LOGON MESSAGE @D31JKAJ
         IC    RECLENG,DATASEQL                                @D31JKAJ
         LA    RCUR,DATASEQ            POINT TO LOGON MESSAGE  @D31JKAJ
         LR    REND,RCUR               POINT BEYOND END OF     @D31JKAJ
         AR    REND,RECLENG             LOGON MESSAGE          @D31JKAJ
         BCTR  RCUR,0                  BACKSPACE 1 FOR LOOP    @D31JKAJ
*                                       ACTION                 @D31JKAJ
*                                       BELOW                  @D31JKAJ
         SPACE 2                                               @D31JKAJ
NEXTCHAR EQU   *                                               @D31JKAJ
         SPACE 2                                               @D31JKAJ
         LA    RCUR,1(,RCUR)           NEXT CHARACTER          @D31JKAJ
         CLI   0(RCUR),C' '            IGNORE LEADING BLANKS   @D31JKAJ
         BNE   SECNDPAS                NON BLANK CONTINUE      @ZA17038
         BCT   RECLENG,NEXTCHAR        ALL BLANKS?             @ZA17038
         B     INVALID                 YES, EXIT               @ZA17038
         SPACE 2                                               @D31JKAJ
SECNDPAS EQU   *                                               @VS49571
         CLC   CLOGON,0(RCUR)          IS FIRST WORD LOGON?    @XM07051
         BE    FOUNDLOG                YES, CONTINUE PROCESSING@VS49571
         TM    FLAGS2,LWRCASE          ALREADY TRIED LOWERCASE?@VS49571
         BO    INVALID                  YES, THEN NOT LOWERCASE@VS49571
         OI    FLAGS2,LWRCASE          INDICATE TRYING LOWER   @VS49571
         TR    DATASEQ,TRTAB2          TRANSLATE LOWER TO UPPER@VS49571
         B     SECNDPAS                TRY AGAIN               @VS49571
         SPACE 2
FOUNDLOG EQU   *                                               @VS49571
         LA    RENDMIN,L'CLOGON+L'CAPPLID+3(,RCUR) MINIMUM END @Z30APGV
         CR    RENDMIN,REND            CAN STANDARD SEQUENCE   @Z30APGV
*                                       FIT IN DATA AREA?      @Z30APGV
         BH    VS2CONT                 NO. ERROR               @Z30APGV
         SPACE 2                                               @Z30APGV
*       'LOGON' HAS BEEN FOUND.SEARCH FOR APPLID(NAME)         @D31JKAJ
         SPACE 2                                               @D31JKAJ
         LA    RCUR,L'CLOGON(,RCUR)    NEXT CHAR BEYOND LOGON  @D31JKAJ
         CLI   0(RCUR),C' '            NEXT CHAR MUST BE       @D31JKAJ
         BE    APPLSCAN                  EITHER BLANK OR A     @D31JKAJ
         CLI   0(RCUR),C','              COMMA                 @D31JKAJ
         BNE   INVALID                                         @D31JKAJ
         SPACE 2                                               @D31JKAJ
APPLSCAN EQU   *                                               @D31JKAJ
         SPACE 2                                               @D31JKAJ
         LA    RCUR,1(,RCUR)           NEXT CHAR               @D31JKAJ
         LA    RENDMIN,L'CAPPLID+2(,RCUR) MINIMUM END          @D31JKAJ
         CR    RENDMIN,REND            CAN STANDARD SEQUENCE   @D31JKAJ
*                                       FIT IN DATA AREA?      @D31JKAJ
         BH    INVALID                 NO. ERROR               @D31JKAJ
         SPACE 2                                               @D31JKAJ
         CLC   CAPPLID,0(RCUR)         IS THIS APPLID(?        @D31JKAJ
         BNE   APPLSCAN                                        @D31JKAJ
         SPACE 2                                               @D31JKAJ
*       APPLID( FOUND--ENSURE THAT BLANK OR COMMA PRECEDES IT  @D31JKAJ
*       AND THAT ITS WITHIN BOUNDS OF MESSAGE                  @D31JKAJ
         SPACE 2                                               @D31JKAJ
         BCTR  RCUR,0                  BACKSPACE ONE           @D31JKAJ
         CLI   0(RCUR),C' '            IS IT A BLANK?          @D31JKAJ
         BE STARTSOK                   CONTINUE IF SO          @D31JKAJ
         SPACE 2                                               @D31JKAJ
         CLI 0(RCUR),C','              IS IT A COMMA?          @D31JKAJ
         BE    STARTSOK                CONTINUE IF SO          @D31JKAJ
         SPACE 2                                               @D31JKAJ
         LA    RCUR,L'CAPPLID+1(,RCUR) NEXT CHAR PAST APPLID(  @D31JKAJ
         B     APPLSCAN                CONTINUE SCAN FOR APPLID(
         SPACE 2                                               @D31JKAJ
STARTSOK EQU   *                                               @D31JKAJ
         SPACE 2                                               @D31JKAJ
         LA    RCUR,L'CAPPLID+1(,RCUR) GO PAST APPLID(         @D31JKAJ
         CLI   0(RCUR),C')'            NULL APPL NAME?         @D31JKAJ
         BE    APPLSCAN                YES. LOOK FOR VALID     @D31JKAJ
*                                       APPLID(                @D31JKAJ
         SPACE 2                                               @D31JKAJ
*       FIND RIGHT PARENTHESIS                                 @D31JKAJ
         SPACE 2                                               @D31JKAJ
         LR    RAPPL,RCUR              ADDRESS POTENTIAL APPLID NAME
         SPACE 2                                               @D31JKAJ
FNDPAREN EQU   *                                               @D31JKAJ
         SPACE 2                                               @D31JKAJ
         LA    RCUR,1(,RCUR)           POINT TO NEXT CHAR      @D31JKAJ
         CR    RCUR,REND               END REACHED?            @D31JKAJ
         BNL INVALID                   YES                     @D31JKAJ
         SPACE 2                                               @D31JKAJ
         CLI   0(RCUR),C')'            IS THIS RIGHT PAREN.?   @D31JKAJ
         BNE   FNDPAREN                NO,CONTINUE SCAN        @D31JKAJ
         LA    RENDMIN,1(,RCUR)        MINIMUM END             @D31JKAJ
         CR    RENDMIN,REND            END OF DATA             @D31JKAJ
         BE    NAMELENG                YES. CAN CHECK FOR      @D31JKAJ
*                                       APPL NAME              @D31JKAJ
         SPACE 2                                               @D31JKAJ
         CLI   1(RCUR),C' '            NO. NEXT CHARACTER MUST @D31JKAJ
         BE    NAMELENG                 BE BLANK OR COMMA,     @D31JKAJ
         CLI   1(RCUR),C','             ELSE CONTINUE SCAN FOR @D31JKAJ
         BNE   APPLSCAN                 VALID APPLID           @D31JKAJ
         SPACE 2                                               @D31JKAJ
NAMELENG EQU *                                                 @D31JKAJ
         SPACE 2                                               @D31JKAJ
*       IF THIS POINT REACHED APPLID WITH LEFT AND RT. PAREN FOUND
*        AND IT IS FOLLOWED BY A BLANK OR A COMMA OR NO MORE DATA
         SPACE 2                                               @D31JKAJ
         SR    RCUR,RAPPL              LENGTH OF APPL NAME IN RCUR
         CH    RCUR,LAPPLID            IS NAME TOO BIG?        @D31JKAJ
         BNH   EXTRAPPL                NO. EXTRACT APPL NAME   @D31JKAJ
         LR    RCUR,RAPPL              YES. CONTINUE SCAN FOR  @D31JKAJ
         B     APPLSCAN                 VALID APPLID(          @D31JKAJ
         SPACE 2
*  VS2 CODE FOR TCAM                                           @Z30APGV
VS2CONT  LA    RENDMIN,L'CLOGON+0(,RCUR)   GET MIN. LOGON      @ZM32671
         CR    RENDMIN,REND                IS IT OK            @Z30APGV
         BH    INVALID                     BR IF NO, ERROR     @ZM32912
         BE    VS2NTCAM                    BR IF OK            @Z30APGV
*  DETERMINE IF FOLLOWED BY TRAILING'' OR ','                  @Z30APGV
         LA    RCUR,L'CLOGON(,RCUR)        GET NEXT CHAR       @ZA17038
         CLI   0(RCUR),C' '                IS IT BLANK         @Z30APGV
         BE    VS2NTCAM                    BR IF YES           @Z30APGV
         CLI   0(RCUR),C','                IS IT A COMMA       @Z30APGV
         BNE   INVALID                     BR IF NO, ERROR     @Z30APGV
*  LOGON IS FOR TCAM                                           @Z30APGV
VS2NTCAM MVC   APPLID,CTCAM MOVE NAME                          @Z30APGV
         B     VS2ISOK               GO SET GOOD CODE          @Z30APGV
         SPACE 2                                               @D31JKAJ
EXTRAPPL EQU   *                                               @D31JKAJ
         SPACE 2                                               @D31JKAJ
         BCTR  RCUR,D0                 DECREMENT FOR EXECUTE   @D31JKAJ
         MVC   APPLID,BLANK8           CLEAR OUT TO MOVE NAME  @D31JKAJ
         EX    RCUR,MVCNAME            EXEC MVC WITH CORRECT LENGTH
VS2ISOK  SR    R15,R15                 INDICATE THAT LOGON SEQ @Z30APGV
         SR    R0,R0                    WAS INTERPRETED OK     @D31JKAJ
         B     ERRETURN                RETURN TO EXIT ROUTINE  @D31JKAJ
         SPACE 3                                               @D31JKAJ
BLANK8   DC    CL8' '                  BLANKS FOR NAME         @D31JKAJ
CLOGON   DC    C'LOGON'                                        @D31JKAJ
CTCAM    DC    C'TCAM    '                                     @Z30APGV
CAPPLID  DC    C'APPLID('                                      @D31JKAJ
LAPPLID  DC    AL2(L'APPLID)           LENGTH OF APPLID NAME   @D31JKAJ
MVCNAME  MVC   APPLID(0),0(RAPPL)                              @D31JKAJ
         SPACE 3                                               @D31JKAJ
INVALID  EQU   *                                               @D31JKAJ
.NVS26   ANOP                                                  @D31JKAX
         SPACE 2                                               @D31JKAJ
         B     ERRETURN                TAKE APPROPRIATE        @XL03HAJ
*                                       DEBUGGING              #XM09020
*                                       ACTION                 @XL03HAJ
         TITLE 'ERREXIT - ERROR OCCURRED            ERRETURN'  @VS49571
         SPACE 2                                               @XL03HAJ
ERRETURN EQU   *                                               @XL03HAJ
         STC   R15,ACTIONS             SAVE ACTION CODES FOR   @XM09020
         STC   R0,ACTIONS+ONE           DEBUGGING              @XM09020
         SPACE 2                                               @VS49571
         CR    R1,R5                   DO WE HAVE BOTH A SYNCH @VS49571
*                                      RPL AND A ASYNCH RPL    @VS49571
         BE    ERROUT                  NO, SKIP THE MOVE OF THE@VS49571
*                                      RPL WORKAREA            @VS49571
         MVC   LNIFGRPL(WORKRPLA,R5),SYNWORK SAVE THE WORKAREA @VS49571
         MVC   INRPLWRK(WRPLREST,R5),SYNWORK+WORKRPLA          @VS49571
         OI    FLAGS2,SYNCHIO          RESET SW IN SYNCHRPL    @VS49571
*                                                              @VS49571
*        XXXXXXXXXXXXXXX                                       @VS49571
         DROP  R1                                              @VS49571
         USING IFGRPL,R5                                       @VS49571
*        XXXXXXXXXXXXXXX                                       @VS49571
*                                                              @VS49571
ERROUT   EQU   *                                               @VS49571
         LR    R14,R3                  RESTORE ADDR AND RETURN @XL03HAJ
         BR    R14                      VTAM WHICH WILL RETURN @XL03HAJ
*                                       TO THE NSI AFTER THE   @XL03HAJ
*                                       COMMAND WHICH CAUSED   @XL03HAJ
*                                       ERREXIT TO BE ENTERED. @XL03HAJ
         TITLE 'NETWORK SOLICITOR - CONSTANTS AND EQUATES'
*    EQUATES AND CONSTANTS FOR MAIN NETSOL CODE                @VS49571
         SPACE 1
R0       EQU   0                       MACRO WORK REGISTER, AND
*                                      CONTAINS REASON CODE UPON
*                                      ABNORMAL TERMINATION
         SPACE 1
R1       EQU   1                       PARAMETER REGISTER,
*                                      CORRUPTED BY API MACROS
         SPACE 1
R2       EQU   2                       WORK REGISTER
         SPACE 1
R3       EQU   3                       WORK REGISTER
         SPACE 1
R4       EQU   4                       WORK REGISTER
         SPACE 1
R5       EQU   5                       POINTER TO CURRENT RPL, IT
*                                      IS NOT USED FOR ANY OTHER
*                                      PURPOSE
         SPACE 1
PTRRPL   EQU   R5                      AS ABOVE                @VS49571
         SPACE 1
R6       EQU   6                       WORK REGISTER
RENDMIN  EQU   6                       MINIMUM END OF LOGON    @XM07051
*                                       MESSAGE                @XM07051
         SPACE 1
R7       EQU   7                       WORK REG
REND     EQU   7                       END OF LOGON MESSAGE    @XM09031
         SPACE 1
R8       EQU   8                       NIB POINTER             @VS49571
PTRNIB   EQU   8                        EXCEPT IN STD LOGON.   @VS49571
RECLENG  EQU   8           VS1/2 ONLY  LOGON MESSAGE LENGTH
RAPPL    EQU   8           VS1/2 ONLY  APPLICATION NAME ADDRESS
         SPACE 1
R9       EQU   9                       WORK REG
RCUR     EQU   9                       CHARACTER BEING SCANNED @XM09031
         SPACE 1
R10      EQU   10                      THIRD BASE REGISTER     @ZM32689
         SPACE 1
R11      EQU   11                      SECOND BASE REGISTER
         SPACE 1
R12      EQU   12                      FIRST BASE REGISTER
         SPACE 1
R13      EQU   13                      SAVE AREA POINTER
         SPACE 1
R14      EQU   14                      RETURN REGISTER
         SPACE 1
R15      EQU   15                      RETURN CODE AND EXIT ENTRY
*                                      POINTER
         EJECT                                                 @VS49571
************************************************************** @VS49571
*                                                              @VS49571
*        FLAGS INDEPENDENT OF A SPECIFIC REQUEST               @VS49571
*                                                              @VS49571
************************************************************** @VS49571
         SPACE 2                                               @VS49571
UFLAGS   DC    X'02'                   INITIALLY NEEDREAD FLAG ON
SHUTDOWN EQU   X'01'                   SHUTDOWN IN PROGRESS    @VS49571
NEEDREAD EQU   X'02'                   ON WHEN A READ (ANY) IS PENDING
SNOCCURM EQU   X'04'                   SET WHEN 'SHOULD NOT    @ZA27846
*                                      OCCUR' CONDITION HAPPEN @ZA27846
*        EQU   X'08'                   RESERVED                @VS49571
*        EQU   X'10'                   RESERVED                @VS49571
*        EQU   X'20'                   RESERVED                @VS49571
*        EQU   X'40'                   RESERVED                @VS49571
*        EQU   X'80'                   RESERVED                @VS49571
*                                                              @VS49571
UFLAGS2  DC    X'00'                   RESERVED FLAGS          @VS49571
*        EQU   X'01'                   RESERVED                @VS49571
*        EQU   X'02'                   RESERVED                @VS49571
*        EQU   X'04'                   RESERVED                @VS49571
*        EQU   X'08'                   RESERVED                @VS49571
*        EQU   X'10'                   RESERVED                @VS49571
*        EQU   X'20'                   RESERVED                @VS49571
*        EQU   X'40'                   RESERVED                @VS49571
*        EQU   X'80'                   RESERVED                @VS49571
*                                                              @VS49571
DUMPFLAG DC    X'00'                   REASON CODE FOR DUMPING @VS49571
*        DUMP REASON CODES
         SPACE 2
OPENCODE EQU   1                       OPEN ACB FAILURE
SETLCODE EQU   2                       SETLOGON FAILURE
CBLKCODE EQU   4                       CONTROL BLOCK FAILURE
RPL0CODE EQU   5                       RPL0 ACTIVE CAN NOT USE @ZA43303
DEVPCODE EQU   7                       DEVICE/DEFINITION PROB  @XL03HAJ
         SPACE 8                                               @VS49571
         AIF   ('&ABEND' NE 'NO').IPLT                         @ZA32003
TEMP1    DC    XL3'00'                 TEMP1                   @ZA32003
TEMP2    DC    XL5'00'                 TEMP2                   @ZA32003
TRTBL    DC    C'0123456789ABCDEF'     TRANSLATE TABLE         @ZA32003
.IPLT    ANOP                                                  @ZA32003
IPLTIME  DC    F'0'                    TIME NO LOGON WRITE     @ZA25713
*                                       IS ISSUED IN .01 SECS  @ZA25713
TIMECONV DC    F'6000'                 TIME CONVERSION         @ZA32555
NOLOGWRT DC    X'FF'                   FLAG TO SKIP LOGON WRITE@ZA25713
SNOREGS  DC    16F'0'                  REGS FOR SNO CONDITIONS @VS49571
RETVTAM@ DS    F                       SAVE AREA FOR EXIT RETURN ADDR
GENSAVE  DS    18F                     SAVE AREA FOR EXIT ROUTINES
*                                                              @VS49571
SUBSAV14 DC    F'0'                    SAVE AREA FOR REG 14    @VS49571
*                                       USED BY SUBROUTINES    @VS49571
ARPL0    DC    A(RPL0)                 ADDR OF FIRST RPL IN TAB@VS49571
DCZEROS  DC    2F'0'                   ZEROS NEEDED FOR COMPARE@VS49571
FINISECB DC    F'0'                    ECB THAT MAIN-LINE CODE WAITS
*                                      ON, IT IS POST'ED BY TPEND EXIT
TABDEV@  DC    A(TABDEV)               ADDRESS FOR THE INDEX   @VS49571
INQDCHAR DC    XL8'00'                 WORK AREA USED FOR      @VS49571
*                                       INQUIRE(DEVCHAR).  IT  @DA04534
*                                       IS ADDRESSABLE VIA THE @DA04534
*                                       ISTDVCHR DSECT         @DA04534
*                                                              @VS49571
*        DEBUG AREA FOR INQUIRE APPSTAT.                       @VS49571
*                                                              @VS49571
APPLSTAT DC    X'0'                    FOR RPL FDBK FIELD      @VS49571
         EJECT                                                 @VS49571
*    MISCELLANEOUS CONSTANTS AND MASKS.
         SPACE 2
NUL      EQU   X'00'                   NO BITS ON DEVICE CON-  @DA04534
*                                       TROL CHARACTER (USED   @DA04534
*                                       BY 3735)               @DA04534
PF01     EQU   X'F1'                   3270 PROGRAM FUNCTION KEY  1
PF09     EQU   X'F9'                   3270 PROGRAM FUNCTION KEY  9
PF10     EQU   X'7A'                   3270 PROGRAM FUNCTION KEY 10
PF12     EQU   X'7C'                   3270 PROGRAM FUNCTION KEY 12
PA1      EQU   X'6C'                   3270 PROGRAM ACCESS KEY 1
PA2      EQU   X'6E'                   3270 PROGRAM ACCESS KEY 2
PA3      EQU   X'6B'                   3270 PROGRAM ACCESS KEY 3
SBA      EQU   X'11'                   3270 SET BUFFER @ FIELD @DM07616
CLEARKEY EQU   X'6D'                   3270 CLEAR KEY
LCTLSEQ  EQU   3                       LENGTH OF LEADING DEVICE CONTROL
*                                       CHARACTERS FOR 3270    @DA04534
*                                       AND 3735               @DA04534
TRAILMSK EQU   B'1111'                 MASK FOR TRAILING CONTROL STRING
         SPACE 2
FF       EQU   X'FF'                   USED TO TURN OFF SWITCHES
         SPACE 2                                               @VS49571
D0       EQU   0                       DISPLACEMENT VALUE
D1       EQU   1                       DISPLACEMENT VALUE
D2       EQU   2                       DISPLACEMENT VALUE
D3       EQU   3                       DISPLACEMENT VALUE      @XL03HAJ
D4       EQU   4                       DISPLACEMENT VALUE
D8       EQU   8                       DISPLACEMENT VALUE      @XL03HAJ
D9       EQU   9                       DISPLACEMENT VALUE
D12      EQU   12                      DISPLACEMENT VALUE      @DM14112
ZERO     EQU   0                   VALUE OF ZERO               @VS49571
ONE      EQU   1                   VALUE OF ONE                @VS49571
TWO      EQU   2                   VALUE OF TWO                @VS49571
THREE    EQU   3                   VALUE OF 3                  @VS49571
FOUR     EQU   4                   VALUE OF 4                  @VS49571
FIVE     EQU   5                   VALUE OF 5                  @VS49571
SIX      EQU   6                   VALUE OF 6                  @VS49571
SEVEN    EQU   7                   VALUE OF 7                  @VS49571
EIGHT    EQU   8                   VALUE OF 8                  @VS49571
NINE     EQU   9                   VALUE OF 9                  @VS49571
TEN      EQU   10                  VALUE OF 10                 @VS49571
ELEVEN   EQU   11                  VALUE OF 11                 @VS49571
TWELVE   EQU   12                  VALUE OF 12                 @VS49571
         SPACE 2                                               @VS49571
*    EQUATES FOR ACTION CODES AND MODIFIERS                    @XL03HAJ
         SPACE 2                                               @XL03HAJ
TORELES  EQU   8                       BRANCH TO RELEASE       @XL03HAJ
TOWRITE  EQU   X'0C'                   BRANCH TO WRITE         @XL03HAJ
REISSU   EQU   X'10'                   REISSUE COMMAND         @XL03HAJ
RSETONLY EQU   4        MODIFIER       RESET ONLY,DON'T REISSUE@XL03HAJ
RESET1ST EQU   8        MODIFIER       RESET 1ST, THEN REISSUE @XL03HAJ
TOENDREQ EQU   X'14'                   BRANCH TO FREERPL       @VS49571
CATCHALL EQU   X'18'                   TAKE ACTION ACCORDING TO RTN
TOSOLIC  EQU   X'00'    MODIFIER       BRANCH TO SOLICIT       @VS49571
NOFLUSH  EQU   X'04'    MODIFIER       NO FLUSING NEEDED       @VS49571
IGNORE   EQU   X'08'    MODIFIER       IGNORE THE DIAGNOSTIC   @VS49571
RSETSOL  EQU   X'1C'                   BRANCH TO RESET THEN    @DA04534
*                                       SOLICIT/READ           @DA04534
TOPROBDV EQU   X'20'                   BRANCH TO PROBDEV       @Z40GKD3
*                                                              @DA04534
*                                                              @DA04534
*        OTHER BIT EQUATES
         SPACE 2
BIT0     EQU   B'10000000'
BIT1     EQU   B'01000000'
BIT2     EQU   B'00100000'
BIT3     EQU   B'00010000'
BIT4     EQU   B'00001000'
BIT5     EQU   B'00000100'
BIT6     EQU   B'00000010'
BIT7     EQU   B'00000001'
         SPACE 6                                               @VS49571
*     HEX VALUES FOR FEEDBACK AND RETURN CODE COMPARES         @XL03HAJ
         SPACE 2                                               @XL03HAJ
         DS    0H                                              @XL03HAJ
HEX2     DC    XL2'2'                                          @XL03HAJ
HEX3     DC    XL2'3'                                          @XL03HAJ
HEX4     DC    XL2'4'                                          @XL03HAJ
HEX7     DC    XL2'7'                                          @VS49571
HEX8     DC    XL2'8'                                          @XL03HAJ
HEX9     DC    XL2'9'                                          @XL03HAJ
HEXA     DC    XL2'A'                                          @XL03HAJ
HEXB     DC    XL2'B'                                          @XL03HAJ
HEXC     DC    XL2'C'                                          @XL03HAJ
HEXE     DC    XL2'E'                                          @VS49571
HEXF     DC    XL2'F'                                          @VS49571
HEX10    DC    XL2'10'                                         @XL03HAJ
HEX12    DC    XL2'12'                                         @XL03HAJ
HEX13    DC    XL2'13'                                         @XL03HAJ
HEX14    DC    XL2'14'                                         @XL03HAJ
HEX16    DC    XL2'16'                                         @XL03HAJ
HEX18    DC    XL2'18'                                         @XL03HAJ
HEX1C    DC    XL2'1C'                                         @DA04534
HEX1E    DC    XL2'1E'                                         @ZA37625
HEX20    DC    XL2'20'                                         @Z40GKD3
HEX28    DC    XL2'28'                                         @DM14112
HEX32    DC    XL2'32'                                         @VS49571
HEX4A    DC    XL2'4A'                                         @XL03HAJ
HEX56    DC    XL2'56'                                         @XL03HAJ
HEX5D    DC    XL2'5D'                                         @VS49571
HEX5F    DC    XL2'5F'                                         @XL03HAJ
HEX60    DC    XL2'60'                                         @XL03HAJ
*                                                              @ZA13672
*                                                              @ZA13672
MAXLOOP  DC    XL2'20'                 MAX # LOOPS ALLOWED FOR @ZA13672
*                                       INTERVENTION REQUIRED  @ZA13672
         EJECT                                                 @VS49571
*     BISYNCH STATUS ERROR MESSAGE CODES                       @DA04534
*                                                              @DA04534
*                                                              @DA04534
         DS    0H                                              @DA04534
BIST4050 DC    XL2'4050'               3270 -- INTERRUPTION    @VS49571
*                                       REQUIRED BECAUSE DEVICE@VS49571
*                                       POWERED OFF.           @VS49571
BISTC240 DC    XL2'C240'               3270 -- DEVICE END      @DA04534
*                                       (ALONE), MEANING THAT  @DA04534
*                                       THE DEVICE IS POWERED  @DA04534
*                                       ON AND OK TO USE.      @DA04534
BISTE2   DC    XL2'E2'                 3741 -- TERMINAL OP-    @DA04534
*                                       ERATOR ABORTED JOB BY  @DA04534
*                                       PRESSING RESET         @DA04534
BISTF2   DC    XL2'F2'                 3741 -- NO RECORD FOUND @DA04534
*                                       ON DISKETTE            @DA04534
BIST50   DC    XL2'50'                 3747 -- TERMINAL OP-    @DA04534
*                                       ERATOR REQUESTED ABORT @DA04534
         SPACE 6                                               #XL03HAJ
*        LITERAL POOL
         SPACE 2
         LTORG
         EJECT
         SPACE 2
*    EQUATES ETC FOR ERROR MESSAGE NUMBERS AND REASON-CODES
         SPACE 2
VCONMSGS DC    V(&AMSG)                NAME OF MESSAGE CSECT
         SPACE 2
MSG01    EQU   1                       I/O ERROR ON READ
MSG02    EQU   2                       LOGON DATA NOT IN INTRPRET TBLE.
MSG03    EQU   3                       NO INTRPRET TABLE
MSG04    EQU   4                       NO ROUTINE TO FIND APPL NAME
MSG05    EQU   5                       NOT AUTHORIZED FOR APPLICATION
MSG06    EQU   6                       APPLICATION NOT KNOWN
MSG07    EQU   7                       APPLICATION DEACTIVATED
MSG08    EQU   8                       APPLICATION INACTIVE
MSG09    EQU   9                       APPLICATION QUIESCING
MSG10    EQU   10                      APPLICATION NEVER ACCEPTS LOGONS
MSG11    EQU   11                      APPLICATION TEMPORARILY NOT
*                                      ACCEPTING LOGONS.
MSG12    EQU   12                      THIS TERMINAL LOGGED ON @YYYYYY
*                                      TO NETWORK SOLICITOR    @YYYYYY
         EJECT
         AIF ('&SYSTEM' EQ 'DOS').DOSJG5A                      @VS49571
***********************************************************************
*                                                                     *
*        LIST FORMS OF MACROS                                  @Z40GKD3
*                                                                     *
***********************************************************************
         SPACE 2                                               @Z40GKD3
*        LIST FORM OF WRITE TO OPERATOR FROM PROBDEV           @Z40GKD3
         SPACE 2                                               @Z40GKD3
*LISTWTO WTO   'IST800I TERM XXXXXXXX HAS BEEN RELEASED BY NETSOL DUE *
*              TO I/O ERROR',                                         *
*              ROUTCDE=(8),DESC=(7),MF=L                       @Z40GKD3
LISTWTO  WTO   'IST800I TERM XXXXXXXX HAS BEEN RELEASED BY NETSOL DUE T*
               O I/O ERROR',                                           *
               ROUTCDE=(8),DESC=(7),MF=L                       @Z40GKD3
*LISTWTO1 WTO  'IST249I RC=42 ON NETSOL CLOSE ACB',            @ZA19857*
               ROUTCDE=(8),DESC=(7),MF=L                       @ZA19857
LISTWTO1 WTO   'IST249I RC=42 ON NETSOL CLOSE ACB',                    *
               ROUTCDE=(8),DESC=(7),MF=L
*LISTWTO2 WTO  'IST806I TERMINAL UNKNOWN  IS BEING RELEASE BECAUSE OF
*              AN ERROR REQUEST TYPE XX  RETURN CODE XXXX',
*              ROUTCDE=(8),DESC=(7),MF=L                       @ZA32003
LISTWTO2 WTO   'IST806I TERMINAL UNKNOWN  IS BEING RELEASED BECAUSE OF *
               AN ERROR REQUEST TYPE XX  RETURN CODE XXXX',            *
               ROUTCDE=(8),DESC=(7),MF=L                       @ZA32003
         EJECT                                                 @VS49571
.DOSJG5A ANOP                                                  @Z40GKD3
***********************************************************************
*                                                                     *
*        WORK AREAS, TABLES, AND CONTROL BLOCKS                       *
*                                                                     *
***********************************************************************
         SPACE 2                                               @VS49571
**********************************************************************
*    FOLLOWING ARE TABLES AND CONSTANTS FOR DEVICE DEPENDENCIES.
**********************************************************************
         SPACE 2
*    DEVICE CONTROL CHARACTER TABLE.  CONTAINS STRINGS
*    OF DEVICE CONTROL CHARACTERS FOR INSERTION BEFORE AND AFTER
*    ERROR MESSAGES.
*                                                              @DA04534
*                                                              @DA04534
*    DISCRIPTIONS OF DEVICE CONTROL CHARACTER STRINGS WILL USE @DA04534
*    THE FOLLOWING ACRONYMS AND ABBREVIATIONS:                 @DA04534
*                                                              @DA04534
*     NL  - NEW LINE                                           @DA04534
*     CR  - CARRIAGE RETURN                                    @DA04534
*     LF  - LINE FEED                                          @DA04534
*     IRS - INTER-RECORD SEPARATOR                             @DA04534
*     SMM - START MANUAL MESSAGE                               @DA04534
*     ESC - ESCAPE CHARACTER (MEANS A VARIABLE CONTROL WILL    @DA04534
*           FOLLOW)                                            @DA04534
*     NUL - NULL (NO BITS ON)                                  @DA04534
*     WCC - WRITE CONTROL CHARACTER                            @DA04534
*     @   - AN ADDRESS                                         @DA04534
*     SBA - START BUFFER ADDRESS                               @DA04534
*     IC  - INSERT CURSOR                                      @DA04534
*     ATT - ATTRIBUTE                                          @DA04534
*     RA  - REPEAT TO ADDRESS                                  @DA04534
*                                                              @DA04534
*                                                              @DA04534
CHTAB    EQU   *
*                                                              @DA04534
*                                                              @DA04534
*    LEADING CONTROL CHARACTERS                                @DA04534
*                                                              @DA04534
CC2780   DC    X'27',X'61'             ESC, / (SKIP TO CHANNEL)
CC3735   DC    X'00',C'I',X'00'        NUL, I, NUL             @DA04534
CC2265L  DC    X'15'                   NL                      @DA04534
CC3270L  DC    X'C3',X'11',X'4040',X'13',X'11',X'C36F',X'1D',X'60'
*               WCC,  SBA,    @,     IC,  SBA,    @,     SF,  ATT(PROT)
CCTWX    DC    X'0D',X'25'             CR,LF                   @ZA31003
*                                      WRITES PROTECTED ERROR  @DA04534
*                                       MSG ON LINE 4 (OR LINE 8)
*                                       OF DISPLAY             @DA04534
*                                                              @DA04534
*                                                              @DA04534
*    TRAILING CONTROL CHARACTERS                               @DA04534
*                                                              @DA04534
NL       DC    X'15'                   NL                      @DA04534
CRLF     DC    X'26',X'15'             CR, LF                  @DA04534
CRLFWTTY DC    X'15',X'25'             CR, LF                  @DA04534
IRS      DC    X'1E'                   IRS                     @DA04534
CC2265T  DC    X'0A'                   SMM                     @DA04534
CC3270T  DC    X'3C',X'C5E8',X'00',X'1D',X'40'                 @DA04534
*                RA,     @,    NUL,  SF,   ATT(UNPROTECT)      @DA04534
*                                      SET REST OF SCREEN UN-  @DA04534
*                                       PROTECTED PAST LONGEST @DA04534
*                                       POSSIBLE MSG TEXT      @DA04534
         SPACE 4                                               @DA04534
*    LENGTHS OF THE CONTROL CHARACTER STRINGS ARE AS FOLLOWS:  @DA04534
*                                                              @DA04534
LCC2780  EQU   2                                               @DA04534
LCC3735  EQU   3                                               @DA04534
LCC2265L EQU   1                                               @DA04534
LCC3270L EQU   10                                              @DA04534
LNL      EQU   1                                               @DA04534
LCRLF    EQU   2                                               @DA04534
LCRLFWTT EQU   2                                               @DA04534
LIRS     EQU   1                                               @DA04534
LCC2265T EQU   1                                               @DA04534
LCC3270T EQU   6                                               @DA04534
         SPACE 4                                               @DA04534
*    DEVICES USING THE ABOVE TABLES ARE AS FOLLOWS:            @DA04534
*                                                              @DA04534
*    *NL        *CRLF       *CRLFWTTY       *IRS       *CC2780 @DA04534
*     2740       TWX         WTTY            5496       2780   @DA04534
*     2741       115A                                          @DA04534
*     1050       83B3                                          @DA04534
*     2770                  *CC3270L        *CC2370T   *CC3735 @DA04534
*     3780                   3277            3277       3735   @DA04534
*     2980      *CC2265      3275            3275              @DA04534
*     1052       2265                                          @DA04534
         EJECT                                                 @DA04534
**********************************************************************
*                                                              @DA04534
*    DEVICE TABLE.  EQUATES THE DEVICE CHARACTERISTICS RETURNED BY
*    INQUIRE DEVCHAR (IE DEVCHAR2) WITH A 4 BYTE USERFLD AS FOLLOWS:-
         SPACE 2
*    0              1              2               3               4
*    ---------------------------------------------------------------
*    |              |       |       |               |               |
*    | DEVICE CODE  | LNGTH | LNGTH | OFFSET LEAD   | OFFSET TRAIL  |
*    |              | LEAD  | TRAIL |    STRING     |    STRING     |
*    |              | STRNG | STRNG |               |               |
*    |              |       |       |               |               |
*    ----------------------------------------------------------------
*                                                              @DA04534
*                                                              @DA04534
*                                                              @DA04534
*    THE FIRST BYTE OF EACH 4 BYTE ENTRY IS IDENTICAL TO THE   @DA04534
*    DEVCHAR2 FIELD RETURNED BY INQUIRE(DEVCHAR).  THE REMAIN- @DA04534
*    ING 3 BYTES OF EACH ENTRY ARE THE DESIRED RPLUSFLD        @DA04534
*    SETTINGS AS ILLUSTRATED IN THE ABOVE DIAGRAM.             @DA04534
*                                                              @DA04534
*                                                              @DA04534
*    THE FOLLOWING DSECT DESCRIBE A TABLE ENTRY.
*                                                              @DA04534
*        NOTE:                                                 @VS49571
*              THIS TABLE SHOULD NOT GET LARGER THAN 255 BYTES @VS49571
*              DUE TO THE FACT THAT A ONE BYTE INDEX IS KEPT   @VS49571
*              IN THE RPL TO FIND THE CORRECT DEVICE ENTRY.    @VS49571
*              THE INDEX IS GOTTEN IN THE LOGON EXIT RTN. AND  @VS49571
*              PUT IN THE NCB USER FIELD AND IS THEN AVAILABLE @VS49571
*              AS LONG AS THE TERMINAL IS OPEN TO NETSOL.      @VS49571
*                                                              @VS49571
*                                                              @DA04534
TABENT   DSECT                                                 @DA04534
TABENTRY DS    XL4                     ENTRY FOR EACH DEVICE   @DA04534
         ORG   TABENTRY                                        @DA04534
TABNSCDE DS    XL4                     NETSOL'S 4 BYTE DEVICE CODE
*                                      DESCRIBED ABOVE
         ORG   TABNSCDE                                        @DA04534
TABCHAR  DS    X                       SAME AS DEVCHAR2 IN     @DA04534
*                                       ISTDEVCH DSECT         @DA04534
         ORG   TABNSCDE+L'TABNSCDE                             @DA04534
TABNEXT  EQU   *                       POSITION OF NEXT DEVTAB ENTRY
*                                                              @DA04534
*                                                              @DA04534
*                                                              @DA04534
*                                                              @DA04534
&ALABEL  CSECT                         RESUME MAIN CONTROL SECTION
         EJECT                                                 @DA04534
**********************************************************************
*                                                              @DA04534
*    DEVICE TABLE
*                                                              @DA04534
*                                                              @DA04534
TABDEV   DS    0F                                              @VS49571
*                                                              @DA04534
*                                      2740 COMMUNICATIONS TERMINAL
DVT2740  DC    AL1(DEV2740),AL.4(0,LNL),AL1(0,NL-CHTAB)        @DA04534
*                                                              @DA04534
*                                                              @DA04534
*                                      2741 COMMUNICATIONS TERMINAL
DVT2741  DC    AL1(DEV2741),AL.4(0,LNL),AL1(0,NL-CHTAB)        @DA04534
*                                                              @DA04534
*                                                              @DA04534
*                                      1050 DATA COMMUNICATIONS
*                                       SYSTEM                 @DA04534
DVT1050  DC    AL1(DEV1050),AL.4(0,LNL),AL1(0,NL-CHTAB)        @DA04534
*                                                              @DA04534
*                                                              @DA04534
*                                      1052 PRINTER-KEYBOARD   @DA04534
DVT1052  DC    AL1(DEV1052),AL.4(0,LNL),AL1(0,NL-CHTAB)        @DA04534
*                                                              @DA04534
*                                                              @DA04534
*                                      AT&T TELETYPE MODEL 33/35
DVTTWX   DC    AL1(DEVTWX),AL.4(LCRLF,LCRLF),AL1(CCTWX-CHTAB,CCTWX-CHTA*
               B)                                              @XA31003
*                                                              @DA04534
*                                                              @DA04534
*                                      WORLD TRADE TELEGRAPH STATION
DVTWTTY  DC    AL1(DEVWTTY),AL.4(0,LCRLFWTT),AL1(0,CRLFWTTY-CHTAB)
*                                                              @DA04534
*                                                              @DA04534
*                                      WU PLAN 115A OUTSTATION
DVT115A  DC    AL1(DEV115A),AL.4(0,LCRLF),AL1(0,CRLF-CHTAB)    @DA04534
*                                                              @DA04534
*                                                              @DA04534
*                                      AT&T 83B3 STATION
DVT83B3  DC    AL1(DEV83B3),AL.4(0,LCRLF),AL1(0,CRLF-CHTAB)    @DA04534
*                                                              @DA04534
*                                                              @DA04534
*                                      1054 PAPAR TAPE READER  @DA04534
DVT1054  DC    AL1(DEV1054),AL.4(0,0),AL1(0,0)  INPUT ONLY     @DA04534
*                                                              @DA04534
*                                                              @DA04534
*                                      1056 CARD READER        @DA04534
DVT1056  DC    AL1(DEV1056),AL.4(0,0),AL1(0,0)  INPUT ONLY     @DA04534
*                                                              @DA04534
*                                                              @DA04534
*                                      1092 PROGRAMMED KEYBOARD
DVT1092  DC    AL1(DEV1092),AL.4(0,0),AL1(0,0)  INPUT ONLY     @DA04534
*                                                              @DA04534
*                                                              @DA04534
*                                      1093 PROGRAMMED KEYBOARD
DVT1093  DC    AL1(DEV1093),AL.4(0,0),AL1(0,0)  INPUT ONLY     @DA04534
*                                                              @DA04534
*                                                              @DA04534
*                                      2770 DATA COMMUNICATIONS
*                                       TERMINAL               @DA04534
DVT2770  DC    AL1(DEV2770),AL.4(0,LNL),AL1(0,NL-CHTAB)        @DA04534
*                                                              @DA04534
*                                                              @DA04534
*                                      2265 DISPLAY STATION (COMP 2770)
DVT2265  DC    AL1(DEV2265),AL.4(LCC2265L,LCC2265T),AL1(CC2265L-CHTAB,C*
               C2265T-CHTAB)                                   @DA04534
*                                                              @DA04534
*                                                              @DA04534
*                                      2780 DATA TRANSMISSION  @DA04534
*                                       TERMINAL               @DA04534
DVT2780  DC    AL1(DEV2780),AL.4(LCC2780,0),AL1(CC2780-CHTAB,0)
*                                                              @DA04534
*                                                              @DA04534
*                                      2980 GENERAL BANKING TERMINAL
DVT2980  DC    AL1(DEV2980),AL.4(0,LNL),AL1(0,NL-CHTAB)        @DA04534
*                                                              @DA04534
*                                                              @DA04534
*                                      3275 DISPLAY STATION    @DA04534
DVT3275  DC    AL1(DEV3275),AL.4(LCC3270L,LCC3270T),AL1(CC3270L-CHTAB,C*
               C3270T-CHTAB)                                   @DA04534
*                                                              @DA04534
*                                                              @DA04534
*                                      3277 DISPLAY STATION    @DA04534
DVT3277  DC    AL1(DEV3277),AL.4(LCC3270L,LCC3270T),AL1(CC3270L-CHTAB,C*
               C3270T-CHTAB)                                   @DA04534
*                                                              @DA04534
*                                                              @DA04534
*                                      SYSTEM 3 CPU            @DA04534
DVTSYS3  DC    AL1(DEVSYS3),AL.4(0,0),AL1(0,0)  NO CHARS       @DA04534
*                                                              @DA04534
*                                                              @DA04534
*                                      3735 PROGRAMMABLE       @DA04534
*                                       BUFFERED TERMANAL      @DA04534
DVT3735  DC    AL1(DEV3735),AL.4(LCC3735,0),AL1(CC3735-CHTAB,0)
*                                                              @DA04534
*                                                              @DA04534
*                                      3780 DATA TRANSMISSION  @DA04534
*                                       TERMINAL               @DA04534
DVT3780  DC    AL1(DEV3780),AL.4(0,LNL),AL1(0,NL-CHTAB)        @DA04534
*                                                              @DA04534
*                                                              @DA04534
*                                      3741 DATA STATION       @DA04534
DVT3741  DC    AL1(DEV3741),AL.4(0,0),AL1(0,0)  NO CHARS       @DA04534
*                                                              @DA04534
*                                                              @DA04534
*                                      3747 DATA CONVERTER     @DA04534
DVT3747  DC    AL1(DEV3747),AL.4(0,0),AL1(0,0)  NO CHARS       @DA04534
*                                                              @DA04534
*                                                              @DA04534
*                                      2502 CARD READER        @DA04534
DVT2502  DC    AL1(DEV2502),AL.4(0,0),AL1(0,0)  INPUT ONLY     @DA04534
*                                                              @DA04534
*                                                              @DA04534
*                                 50 MAGNETIC DATA INSCRIBER   @DA04534
DVT50    DC    AL1(DEV50),AL.4(0,0),AL1(0,0)    INPUT ONLY     @DA04534
*                                                              @DA04534
*                                                              @DA04534
*                                 1255 MAGNETIC CHARACTER READER
DVT1255  DC    AL1(DEV1255),AL.4(0,0),AL1(0,0)  INPUT ONLY     @DA04534
*                                                              @DA04534
*                                                              @DA04534
*                                 5496 DATA RECORDER           @DA04534
DVT5496  DC    AL1(DEV5496),AL.4(0,LIRS),AL1(0,IRS-CHTAB)      @DA04534
*                                                              @DA04534
         SPACE 2
TABDEVF  EQU   *                       END OF DEVICE TABLE     @DA04534
         SPACE 2
NTABENT  EQU   (TABDEVF-TABDEV)/L'TABENTRY NUMBER OF ENTRIES IN TABDEV
T3275    EQU   DVT3275-TABDEV                                  @VS49571
T3277    EQU   DVT3277-TABDEV                                  @VS49571
         EJECT                                                 @XM09031
         SPACE 2                                               @XM09031
***                                                            @XM09031
*                                                              @XM09031
*  TRANSLATE TABLE TO CONVERT DEVICE CONTROL CHARACTERS        @XM09031
*  (ACTUALLY NON-PRINTIBLES) TO BLANKS.                        @XM09031
*                                                              @XM09031
***                                                            @XM09031
*                                                              @XM09031
TRTAB1  EQU   *                                                @XM09031
         DC    74C' '         00-49    BLANK OUT CONTROL CHARS @DA04534
         DC    X'4A'                   CENT OR LEFT ARROW      @XM09031
         DC    C'.<(+|'                                        @XM09031
         DC    X'50'                   AMPERSAND               @XM09031
         DC    X'515253545556575859'                           @DA04534
         DC    X'5A'                   EXCLAMATION POINT       @XM09031
         DC    C'$*);^-/'                                      @XM09031
         DC    X'6263646566676869'                             @DA04534
         DC    X'6A'                   VERTICLE LINE (NOT |)   @XM09031
         DC    C',%_>?'                                        @XM09031
         DC    X'707172737475767778'                           @DA04534
         DC    X'79'                   GRAVE ACCENT            @XM09031
         DC    C':#@'                                          @XM09031
         DC    X'7D'                   SINGLE QUOTE            @XM09031
         DC    C'="'                                           @XM09031
         DC    X'80'                                           @DA04534
         DC    C'abcdefghi'            SMALL LETTERS           @XM09031
         DC    X'8A8B8C8D8E8F90'                               @DA04534
         DC    C'jklmnopqr'            SMALL LETTERS           @XM09031
         DC    X'9A9B9C9D9E9FA0'                               @DA04534
         DC    X'A1'                   TILDE                   @XM09031
         DC    C'stuvwxyz'             SMALL LETTERS           @XM09031
         DC    X'AAABACADAEAF'                                 @DA04534
         DC    X'B0B1B2B3B4B5B6B7B8B9'                         @DA04534
         DC    X'BABBBCBDBEBF'                                 @DA04534
         DC    X'C0'                   LEFT BRACE              #XM09031
         DC    C'ABCDEFGHI'            CAPITAL LETTERS         #XM09031
         DC    X'CACB'                                         @DA04534
         DC    X'CC'                   HOOK                    #XM09031
         DC    X'CD'                                           @DA04534
         DC    X'CE'                   FORK                    #XM09031
         DC    X'CF'                                           @DA04534
         DC    X'D0'                   RIGHT BRACE             #XM09031
         DC    C'JKLMNOPQR'            CAPITAL LETTERS         #XM09031
         DC    X'DADBDCDDDEDF'                                 @DA04534
         DC    X'E0'                   REVERSE SLANT           #XM09031
         DC    X'E1'                                           @DA04534
         DC    C'STUVWXYZ'             CAPITAL LETTERS         #XM09031
         DC    X'EAEB'                                         @DA04534
         DC    X'EC'                   CHAIR                   #XM09031
         DC    X'EDEEEF'                                       @DA04534
         DC    C'0123456789'                                   #XM09031
         DC    X'FA'                   LONG VERTICLE LINE (NOT #XM09031
*                                       | OR VERTICLE LINE)    #XM09031
         DC    X'FBFCFDFEFF'                                   @DA04534
         AIF   ('&SYSTEM' EQ 'DOS').NDOSTRT
         EJECT                                                 @VS49571
*
*        TRANSLATE TABLE FOR LOWER CASE LOGON
*        TRANSLATION TO UPPER CASE.
*
TRTAB2  EQU   *                                                @VS49571
         DC    74C' '         00-49    BLANK OUT CONTROL CHARS @VS49571
         DC    X'4A'                   CENT OR LEFT ARROW      @VS49571
         DC    C'.<(+|'                                        @VS49571
         DC    X'50'                   AMPERSAND               @VS49571
         DC    X'515253545556575859'                           @VS49571
         DC    X'5A'                   EXCLAMATION POINT       @VS49571
         DC    C'$*);^-/'                                      @VS49571
         DC    X'6263646566676869'                             @VS49571
         DC    X'6A'                   VERTICLE LINE (NOT |)   @VS49571
         DC    C',%_>?'                                        @VS49571
         DC    X'707172737475767778'                           @VS49571
         DC    X'79'                   GRAVE ACCENT            @VS49571
         DC    C':#@'                                          @VS49571
         DC    X'7D'                   SINGLE QUOTE            @VS49571
         DC    C'="'                                           @VS49571
         DC    X'80'                                           @VS49571
         DC    C'ABCDEFGHI'            SMALL LETTERS           @VS49571
         DC    X'8A8B8C8D8E8F90'                               @VS49571
         DC    C'JKLMNOPQR'            SMALL LETTERS           @VS49571
         DC    X'9A9B9C9D9E9FA0'                               @VS49571
         DC    X'A1'                   TILDE                   @VS49571
         DC    C'STUVWXYZ'             SMALL LETTERS           @VS49571
         DC    X'AAABACADAEAF'                                 @VS49571
         DC    X'B0B1B2B3B4B5B6B7B8B9'                         @VS49571
         DC    X'BABBBCBDBEBF'                                 @VS49571
         DC    X'C0'                   LEFT BRACE              @VS49571
         DC    C'ABCDEFGHI'            CAPITAL LETTERS         @VS49571
         DC    X'CACB'                                         @VS49571
         DC    X'CC'                   HOOK                    @VS49571
         DC    X'CD'                                           @VS49571
         DC    X'CE'                   FORK                    @VS49571
         DC    X'CF'                                           @VS49571
         DC    X'D0'                   RIGHT BRACE             @VS49571
         DC    C'JKLMNOPQR'            CAPITAL LETTERS         @VS49571
         DC    X'DADBDCDDDEDF'                                 @VS49571
         DC    X'E0'                   REVERSE SLANT           @VS49571
         DC    X'E1'                                           @VS49571
         DC    C'STUVWXYZ'             CAPITAL LETTERS         @VS49571
         DC    X'EAEB'                                         @VS49571
         DC    X'EC'                   CHAIR                   @VS49571
         DC    X'EDEEEF'                                       @VS49571
         DC    C'0123456789'                                   @VS49571
         DC    X'FA'                   LONG VERTICLE LINE (NOT @VS49571
*                                       | OR VERTICLE LINE)    @VS49571
         DC    X'FBFCFDFEFF'                                   @VS49571
.NDOSTRT ANOP
         SPACE 8                                               @VS49571
**********************************************************************
*    END OF DEVICE DEPENDENT TABLES AND CONSTANTS.
*********************************************************************
         EJECT
*    VTAM CONTROL BLOCK DEFINITIONS
         SPACE 2                                               @VS49571
***********************************************************************
*                                                                     *
*        THE FOLLOWING IS THE TABLE USED TO INDEX INTO THE RPL CSECT  *
*        TO LOCATE FREE RPL'S.  IF THE ENTRY IN THE TABLE IS ZERO,    *
*        THAT RPL IS IN USE. (RPL0 IS ALWAYS IN USE DUE TO THE FACT   *
*        THAT IT IS RESERVED FOR SYNCH USE.)                          *
*                                                                     *
***********************************************************************
         SPACE 2                                               @VS49571
RNDXTABL DS    0F                  START OF TABLE              @VS49571
.RINDEX  ANOP                                                  @VS49571
         DC    AL1(&TABCONT)       INDEX TO RPLS               @VS49571
&TABCONT SETA  &TABCONT+1                                      @VS49571
         AIF   (&TABCONT LT &NUM).RINDEX                       @VS49571
*                                                              @VS49571
*        END OF INDEX TABLE                                    @VS49571
*                                                              @VS49571
         SPACE 2
NSNAME  EQU   *
         DC    AL1(8)                  LENGTH OF ID SEQUENCE
         DC    CL8'&ALABEL'            NETSOL MACRO LABEL AS ID
         EJECT                                                @VS49571
.*
.*
         AIF   ('&PRTCT' EQ '').NOPRTCT TEST FOR PASSWORD SPECIFIED ON
.*                                     NETSOL MACRO.
.*
.*
PASSWD   EQU   *
         DC    AL1(&KPRTCT)            LENGTH OF PASSWORD
         DC    C'&APRTCT'              PASSWORD
         SPACE 2
*ACB     ACB   AM=VTAM,                                               *
*              APPLID=NSNAME,                                        *
*              PASSWD=PASSWD,                                         *
*              EXLST=EXLST,                                           *
*              MACRF=LOGON
ACB      ACB   AM=VTAM,                                                *
               APPLID=NSNAME,                                  @VS49571*
               PASSWD=PASSWD,                                          *
               EXLST=EXLST,                                            *
               MACRF=LOGON
         AGO   .EXLSTL
.*
.NOPRTCT ANOP
*ACB     ACB   AM=VTAM,                                               *
*              APPLID=NSNAME,                                        *
*              EXLST=EXLST,                                           *
*              MACRF=LOGON
ACB      ACB   AM=VTAM,                                                *
               APPLID=NSNAME,                                  @VS49571*
               EXLST=EXLST,                                            *
               MACRF=LOGON
.*
.EXLSTL  ANOP
         EJECT
         SPACE 2
*    EXIT ROUTINES TO BE SCHEDULED IN RESPONSE TO VTAM EVENTS
*
*              * ERREXIT ENTERED FOR ERROR CONDITIONS.         @XL03HAJ
*              * TPEND SCHEDULED WHEN VTAM SHUTS DOWN
*              * LOGON SCHEDULED WHEN A TERMINAL LOGS ON
*              * LOSTERM SCHEDULED WHEN A TERMINAL IS LOST
         AIF   ('&AACQ' EQ 'NO').EXLST2
*              * RELREQ SCHEDULED WHEN ANOTHER APPLICATION ACQUIRES
*                A TERMINAL CURRENTLY LOGGED ON TO NETSOL.
         SPACE 2
*EXLST   EXLST LERAD=ERREXIT,                                 @XL03HAJ*
*              SYNAD=ERREXIT,                                 @XL03HAJ*
*              TPEND=TPEND,                                           *
*              RELREQ=RELREQ,                                         *
*              LOGON=LOGON,                                           *
*              LOSTERM=LOSTERM,                                       *
*              AM=VTAM
EXLST    EXLST LERAD=ERREXIT,                                  @XL03HAJ*
               SYNAD=ERREXIT,                                  @XL03HAJ*
               TPEND=TPEND,                                            *
               RELREQ=RELREQ,                                          *
               LOGON=LOGON,                                            *
               LOSTERM=LOSTERM,                                        *
               AM=VTAM
         AGO   .NSTABLE
.EXLST2  ANOP
         SPACE 2
*EXLST   EXLST LERAD=ERREXIT,                                 @XL03HAJ*
*              SYNAD=ERREXIT,                                 @XL03HAJ*
*              TPEND=TPEND,                                           *
*              LOGON=LOGON,                                           *
*              LOSTERM=LOSTERM,                                       *
*              AM=VTAM
EXLST    EXLST LERAD=ERREXIT,                                  @XL03HAJ*
               SYNAD=ERREXIT,                                  @XL03HAJ*
               TPEND=TPEND,                                            *
               LOGON=LOGON,                                            *
               LOSTERM=LOSTERM,                                        *
               AM=VTAM
.NSTABLE ANOP
         EJECT                                                 @DA04534
         SPACE 2
***********************************************************************
*                                                                     *
*        THE FOLLOWING NIB IS USED FOR ALL OPERATIONS NEEDING         *
*        A NIB.                                                @VS49571
*                                                                     *
***********************************************************************
         SPACE 2
*SYNCHNIB NIB  MODE=BASIC,PROC=TRUNC,                          @VS49571
*              LISTEND=YES
         SPACE 2                                               @VS49571
SYNCHNIB NIB   MODE=BASIC,PROC=TRUNC,                          @VS49571*
               LISTEND=YES
         EJECT
         SPACE 2                                               @VS49571
**********************************************************************
*                                                                    *
*        THIS RPL IS USED EXCLUSIVELY FOR REFRESHING THE ASYNC       *
*        RPL'S IN THE RPL CSECT.  IT IS NOT ITSELF USED IN ANY       *
*        MACRO.                                                      *
**********************************************************************
         SPACE 2                                               @VS49571
*FRESHRPL RPL  ACB=ACB,                                               *
*              AM=VTAM,                                               *
*              OPTCD=ASY                                       @VS49571
FRESHRPL RPL   ACB=ACB,                                        @VS49571*
               AM=VTAM,                                        @VS49571*
               OPTCD=ASY                                       @VS49571
         TITLE 'NETWORK SOLICITOR - NIB + RPL/WORK-AREA DSECTS'
***************************************************************@VS49571
*                                                              @VS49571
*        VTAM DSECT DEFINITIONS                                @VS49571
*                                                              @VS49571
***************************************************************@VS49571
         SPACE 2                                               @VS49571
*                                                              @VS49571
*        DSECT FOR THE NIB                                     @VS49571
*                                                              @VS49571
*        ISTDNIB                                               @VS49571
         SPACE 2                                               @VS49571
         ISTDNIB                                               @VS49571
         EJECT                                                 @VS49571
************************************************************** @VS49571
*                                                            * @VS49571
*    DESECT FOR RPL'S IN RPLAREA                             * @VS49571
*                                                            * @VS49571
************************************************************** @VS49571
IFGRPLX  DSECT                                                 @VS49571
STSECT   DS    0D                  START DSECT ON D-WORD       @VS49571
*        IFGRPL DSECT=NO,AM=VTAM                               @VS49571
         IFGRPL DSECT=NO,AM=VTAM                               @VS49571
*************** END OF RPL DSECT AND START OF RPL WORK AREA    @VS49571
         EJECT                                                 @VS49571
************************************************************** @VS49571
*                                                              @VS49571
*        NOTE: DSECT IS NOW 260 BYTES WITH 3 BYTES RESERVED    @VS49571
*        FOR GROWTH.  IF MORE ROOM IS NEEDED, THE WIPEOUTS     @VS49571
*        (MVC WORKSPAC+ONE(WORKRPLA),WORKSPAC AND              @VS49571
*         MVC WORKSPAC+WORKRPLA(WORKRPLB),WORKSPAC AND         @VS49571
*         ALL OTHER TYPES OF WORK-AREA WIPEOUT OR SAVE)        @VS49571
*        WILL HAVE TO BE CHECKED AND CHANGED IF NECESSARY.     @VS49571
*                                                              @VS49571
************************************************************** @VS49571
         SPACE 2                                               @VS49571
         ORG
         SPACE 2                                               @VS49571
WORKSPAC DS    0D                      START OF RPL WORK AREA  @VS49571
TABLINFO DS    XL4                     NETSOL DEVICE CODE      @VS49571
         ORG   TABLINFO                                        @VS49571
TYPECODE DS    X                       NETSOL DEVICE TYPE      @VS49571
LENGCC   DS    X                       LENGTHS OF LEADING AND  @VS49571
*                                       TRAILING DEVICE CON-   @VS49571
*                                       TROL CHARACTER STRINGS @VS49571
LEADCC   DS    X                       OFFSET TO LEADING CC    @VS49571
*                                       STRING IN CHTAB        @VS49571
TRAILCC  DS    X                       OFFSET TO TRAILING CC   @VS49571
*                                       STRING IN CHTAB        @VS49571
         ORG
         SPACE 2                                               @VS49571
NAMEDEV  DS    CL8                     SYMBOLIC DEVICE NAME    @VS49571
*                                       TRANSLATED FROM CID BY @VS49571
*                                       INQUIRE(CIDXLATE)      @VS49571
CID      DS    F                       CID OF READ DEVICE      @VS49571
CIDLOC   EQU   CID-STSECT              DISPLACEMENT TO CID     @VS49571
USERWORD DS    F                       DEVICE DEPENDENT INFO   @VS49571
         ORG   USERWORD                                        @VS49571
TABINDEX DS    X                       INDEX TO TABLINFO WITHIN TABDEV
DFLAGS   DS    X                       DEVICE STATUS FLAGS     @VS49571
IODEV    EQU   X'01'                   I/O STATUS FLAG         @VS49571
*                                       IF ZERO TERM IS INPUT ONLY
*                                       IF ONE  TERM IS INTERACTIVE
MODMCNT  DS    X                       COUNT FOR INT REQ LOOP  @ZA13672
         DS    X                       RESERVED                @VS49571
         ORG
APPLID   DS    CL8                     NAME OF APPLICATION     @VS49571
RTNSAVE  DS    F                       RETURN ADDRESS FOR RESETSUB
RECLEN   DS    F                       FOR READ RECLEN FIELD   @ZA13651
WRITELEN DS    F                       FOR WRITE RECLEN FIELD  @ZA13651
STATUS2  DS    H                       2 BYTES OF BISYNCH DONE @VS49571
RDATAFLG DS    X                       DATA FLAGS(RPL FDBK FIELD)
RTNCD    DS    X                       FOR RPL RTNCD FIELD     @VS49571
FDBK2    DS    X                       FOR RPL FDBK2 FIELD     @VS49571
MSGINDEX DS    X                       NUMBER OF ERROR MESSAGE WRITTEN
RESETIND EQU   X'80'                   INDICATE NEED A RESET   @VS49571
ACTIONS  DS    2X                      SAVE AREA FOR ERROR     @VS49571
*                                       ACTION CODES           @VS49571
*        INTERNAL FLAG BYTES                                   @VS49571
         SPACE 2                                               @VS49571
FLAGS    DS    X                       FLAG BYTE               @VS49571
*                                                              @VS49571
*RESERVEDEQU   X'80'                   RESERVED                @VS49571
LOOPONCE EQU   X'40'                   COMMAND REISSUED ALREADY@VS49571
RELOPND  EQU   X'20'                   RELEASE DEVICE, THEN    @VS49571
*                                       ATTEMPT TO RECONNECT   @VS49571
*                                       VIA OPNDST             @VS49571
*RESERVEDEQU   X'10'                   RESERVED                @VS49571
*RESERVEDEQU   X'08'                   RESERVED                @VS49571
*RESERVEDEQU   X'04'                   RESERVED                @VS49571
*RESERVEDEQU   X'02'                   RESERVED                @VS49571
ONERESET EQU   X'01'                   AT LEAST ONE RESET DONE @VS49571
*                                       SINCE ENTRY TO READEND @VS49571
         SPACE 4                                               @VS49571
FLAGS2   DS    X                       SECOND FLAG BYTE        @VS49571
BADEVICE EQU   X'80'                   PROBLEM WITH DEVICE     @VS49571
SYNCHIO  EQU   X'40'                   IF 1, RPL IS SYNCH      @VS49571
LWRCASE  EQU   X'20'                   STANDARD LOGON IN       @VS49571
*                                       LOWERCASE CHARACTERS   @VS49571
MODMLOOP EQU   X'10'                   FLAG TO UPDATE COUNT OF @ZA13672
*                                       READ LOOPS BECAUSE OF  @ZA13672
*                                       BAD MODEM SENDING OUT  @ZA13672
*                                       INTERVENTION REQUIRED  @ZA13672
LOGWRITE EQU   X'08'                   ERASE WRITE             @ZA13651
*                                       FROM LOGON EXIT        @ZA13651
         SPACE 2                                               @VS49571
EXITFLAG DS    X                       CONTAINS FLAGS TO       @VS49571
*                                       INDICATE WHAT EXITS    @VS49571
*                                       HAVE BEEN ENTERED      @VS49571
LOGONEX  EQU   X'01'                   ENTERED THE LOGON EXIT  @VS49571
READEX   EQU   X'02'                   ENTERED THE READEND EXIT@VS49571
PASSEX   EQU   X'04'                   ENTERED THE CLSDST(PASS) EXIT
WRITEX   EQU   X'08'                   ENTERED THE WRITE EXIT  @VS49571
RELREQEX EQU   X'10'                   ENTERED THE RELREQ EXIT @VS49571
LOSTEX   EQU   X'20'                   ENTERED THE LOSTERM EXIT@VS49571
CLOSEX   EQU   X'40'                   ENTERED THE CLSDST(RELEASE)EXIT
RESETEX  EQU   X'80'                   ENTERED THE RESET EXIT  @VS49571
*                                                              @VS49571
EXITFLA2 DS    X                       EXTENSION OF EXITFLAG   @VS49571
*                                                              @VS49571
*RESERVEDEQU   X'01'                   RESERVED                @VS49571
         SPACE 2                                               @VS49571
         DS    1X                      RESERVED                @VS49571
         SPACE 2                                               @VS49571
MFLAGS   DS    X                       FLAG BYTE FOR WHICH     @VS49571
*                                       MACRO JUST ISSUED      @VS49571
*                                                              @VS49571
OPNDSPEC EQU   X'01'                   OPNDST(SPEC)            @VS49571
INQAPPST EQU   X'02'                   INQUIRE(APPSTST) IN     @VS49571
*                                       PROGRESS               @VS49571
WRITING  EQU   X'04'                   WRITE IN PROGRESS       @VS49571
READA    EQU   X'08'                   READ(ANY) IN PROGRESS   @VS49571
RESETU   EQU   X'20'                   RESET(UNCOND) INDICATOR @VS49571
INTRPRT  EQU   X'40'                   INTRPRET IN PROGRESS    @VS49571
CHNGENIB EQU   X'80'                   CHANGE IN PROGRESS      @ZA13672
         SPACE 2                                               @VS49571
MFLAGS2  DS    X                       FLAG BYTE FOR WHICH     @VS49571
*                                       MACRO JUST ISSUED      @VS49571
*                                                              @VS49571
*RESERVEDEQU   X'01'                   RESERVED                @VS49571
CLSDST   EQU   X'02'                   CLSDST                  @VS49571
*RESERVEDEQU   X'04'                   RESERVED                @VS49571
INQUIRE  EQU   X'08'                   INQUIRE (NOT APPSTAT)   @VS49571
SOLICITS EQU   X'10'                   A SOLICIT(SPEC)         @VS49571
         AIF   ('&ABEND' EQ 'YES').SKP2                        @ZA32003
ERRCON   EQU   X'20'                   ERROR CONDICTION        @ZA32003
.SKP2    ANOP                                                  @ZA32003
*RESERVEDEQU   X'40'                   RESERVED                @VS49571
*RESERVEDEQU   X'80'                   RESERVED                @VS49571
         SPACE 2                                               @VS49571
MACFLAGS DC    X'00'                   INDICATE WHITCH MACROS  @VS49571
*                                       HAVE BEEN CALLED       @VS49571
INQDEVCH EQU   X'02'                   WILL DO INQUIRE (DEVCHAR)
CLSREL   EQU   X'04'                   WILL DO CLSDST(RELEASE) @VS49571
OPNSPEC  EQU   X'08'                   WILL DO OPEN(SPEC)      @VS49571
SOLIC    EQU   X'10'                   WILL DO SOLICIT         @VS49571
INQCIDX  EQU   X'80'                   WILL DO INQUIRE (CIDXLATE)
*                                                              @VS49571
MACFLAG2 DC    X'00'                   EXTEND MACFLAGS         @VS49571
INTAPPID EQU   X'01'                   WILL DO INTERP (APPLID) @VS49571
INQAPPS  EQU   X'04'                   WILL DO INQUIRE(APPSTAT)@VS49571
CLOSPASS EQU   X'08'                   WILL DO CLSDST(PASS)    @VS49571
WRITLBT  EQU   X'20'                   WILL DO WRITE           @VS49571
RESETUN  EQU   X'40'                   WILL DO RESET           @VS49571
CHANGNIB EQU   X'80'                   WILL DO CHANGE          @ZA13672
         EJECT                                                 @VS49571
         AIF   ('&ASTRIP' EQ 'YES').STRIP4
STRIPLEN DS    X                       DATA LENGTH WITH DEVICE @ZA07805
*                                       CONTROL CHARACTERS     @ZA07805
NOSTRIPA DS    CL80                    DATA WITH DEVICE        @ZA07805
*                                       CONTROL CHARACTERS     @ZA07805
.STRIP4  ANOP
DATASEQL DS    X                       X-LATED DATA SEQ-LENGTH @VS49571
DATASEQ  DS    CL80                    TRANSLATED DATA SEQUENC @VS49571
         SPACE 2                                               @VS49571
IOAREA   DS    CL80                                            @VS49571
CID2     DS    CL4                     CID IS PUT HERE BEFORE  @VS49571
*                                      IT IS WIPED OUT IN      @VS49571
*                                      FREERPL                 @VS49571
         ORG
ENDSECT  DS    0D                  END DSECT ON D-WORD         @VS49571
WORKRPLA EQU   IOAREA-WORKSPAC      USED TO CLEAR OUT WORKAREA @VS49571
WRPLREST EQU   ENDSECT-IOAREA       USED IN MOVES OF THE       @VS49571
*                                    RPL-WORKAREA              @VS49571
WORKRPL  EQU   ENDSECT-WORKSPAC     SIZE OF RPL-WORKAREA       @VS49571
LNIFGRPL EQU   WORKSPAC-STSECT      LENGTH OF ONE RPL AREA     @VS49571
*                                    WITHOUT THE WORKAREA      @VS49571
INRPLWRK EQU   LNIFGRPL+WORKRPLA    USED IN MOVE OF WORKAREA   @VS49571
NUMRPLS  EQU   &NUM                 NUMBER OF RPLS BEING       @VS49571
*                                    GENERATED                 @VS49571
         EJECT                                                 @VS49571
&ALABEL  CSECT                                                 @VS49571
         SPACE 2
***********************************************************************
*                                                                     *
*        THE FOLLOWING RPL IS USED FOR ALL SYNCHRONOUS COMMANDS@VS49571
*                                                                     *
***********************************************************************
         SPACE 2
         DS    0D                  ALIGN TO D-WORD             @VS49571
*SYNCHRPL RPL  ACB=ACB,OPTCD=SYN,                              @VS49571
*              AM=VTAM
SYNCHRPL RPL   ACB=ACB,OPTCD=SYN,                              @VS49571*
               AM=VTAM
*        XXXXXXXXX                                             @VS49571
         ORG
         DS    0D                  ALIGN  TO D-WORD            @VS49571
*        XXXXXXXXX                                             @VS49571
SYNWORK  DC    (WORKRPL)X'00'         RPL WORK AREA            @VS49571
LNGTHRPL DC    A(ENDSECT-STSECT)       LENGTH OF ONE RPL + ITS @VS49571
*                                      OWN WORKAREA            @VS49571
SYNARG   EQU   SYNCHRPL+RPLARG-IFGRPL DISPLACEMENT TO THE ARG  @VS49571
*                                      WITHIN SYNCHRPL         @VS49571
SYNFDB3  EQU   SYNCHRPL+RPLFDB3-IFGRPL DISPLACEMENT TO FDB3    @VS49571
*                                       IN SYNCHRPL'S WORKAREA @VS49571
SYNCID   EQU   SYNCHRPL+CID-IFGRPL    DISPLACEMENT TO THE CID  @VS49571
*                                      WITHIN SYNCHRPL'S       @VS49571
*                                      WORKAREA                @VS49571
SYNUSFLD EQU   SYNCHRPL+RPLUSFLD-IFGRPL DISPLACEMENT TO USERFLD@ZA13651
*                                        WITHIN SYNCHRPL       @ZA13651
SRPLEXT1 EQU   SYNCHRPL+RPLEXTD1-IFGRPL  DISPLACEMENT TO 'NIB@ @VS49571
*                                        IN ARG FIELD' BIT     @VS49571
SYNFDB2  EQU   SYNCHRPL+RPLFDB2-IFGRPL   DISPLACEMENT TO FDB2  @ZA30101
*                                        IN SYNRPL WORKAREA    @ZA30101
         EJECT
***************************************************************@VS49571
*        SETLOGON RPL - A SEPARATE RPL IS NECESSARY BECAUSE    @VS49571
*         THE LOGON EXIT CAN BE DRIVEN BEFORE THE SETLOGON     @VS49571
*         COMPLETES.                                           @VS49571
***************************************************************@VS49571
*                                                              @VS49571
*SETLRPL RPL   ACB=ACB,OPTCD=SYN,                              @VS49571
*              AM=VTAM
SETLRPL  RPL   ACB=ACB,OPTCD=SYN,                              @VS49571*
               AM=VTAM
         EJECT
         SPACE 9                                               @VS49571
***********************************************************************
*                                                                     *
*        PATCH AREA = 100 BYTES
*                                                                     *
***********************************************************************
         SPACE 2
         DS    0H                      ALIGN ON INSTRUCTION BOUNDARY
PATCH    DC    CL8'NS PATCH',12FL8'0'                          @DA04534
         EJECT                                                 @VS49571
RWKAREAS CSECT                                                 @VS49571
&TABCONT SETA  0                                               @VS49571
.RPLLOOP ANOP                                                  @VS49571
RPL&TABCONT DC    (ENDSECT-STSECT)X'00' ONE RPL WORK AREA      @VS49571
&TABCONT SETA  &TABCONT+1          INCROMENT LABEL COUNT       @VS49571
&NUM     SETA  &NUM-1              DECREMENT RPL COUNT         @VS49571
         AIF   (&NUM    GT 0).RPLLOOP                          @VS49571
*END OF RPL CSECT                                              @VS49571
         EJECT                                                 @VS49571
&ALABEL  CSECT                  RESUME MAIN CSECT              @VS49571
.*
.*       CHECK IF STANDARD MESSAGE CSECT IS TO BE GENERATED
.*
         AIF   ('&MESSAGE' EQ 'IBMMSG').MSGS
         MEXIT
.*
.*
.MSGS    ANOP
.*
.*
         TITLE 'MSGCSECT - MESSAGE CONTROL SECTION'
         SPACE 2
MSGCSECT CSECT
         SPACE 2
***********************************************************************
*                                                                     *
*        MESSAGE TABLE INDEX                                          *
*                                                                     *
***********************************************************************
         SPACE 2
         DC    AL2(L'AMSG01,AMSG01-MSGCSECT)
         DC    AL2(L'AMSG02,AMSG02-MSGCSECT)
         DC    AL2(L'AMSG03,AMSG03-MSGCSECT)
         DC    AL2(L'AMSG04,AMSG04-MSGCSECT)
         DC    AL2(L'AMSG05,AMSG05-MSGCSECT)
         DC    AL2(L'AMSG06,AMSG06-MSGCSECT)
         DC    AL2(L'AMSG07,AMSG07-MSGCSECT)
         DC    AL2(L'AMSG08,AMSG08-MSGCSECT)
         DC    AL2(L'AMSG09,AMSG09-MSGCSECT)
         DC    AL2(L'AMSG10,AMSG10-MSGCSECT)
         DC    AL2(L'AMSG11,AMSG11-MSGCSECT)
         DC    AL2(L'AMSG12,AMSG12-MSGCSECT)
         SPACE 2
***********************************************************************
*                                                                     *
*        MESSAGE TEXTS                                                *
*                                                                     *
***********************************************************************
         SPACE 2
AMSG01   DC    C'ERROR WHEN READING INPUT MESSAGE'             @ZA37625
AMSG02   DC    C'INPUT NOT RECOGNIZED'
AMSG03   DC    C'NO INTERPRET TABLE'                           @XL03HAJ
AMSG04   DC    C'NO ROUTINE TO RECOGNIZE APPLICATION'
AMSG05   DC    C'USER UNAUTHORIZED FOR THIS APPLICATION'
AMSG06   DC    C'APPLICATION UNKNOWN TO VTAM'
AMSG07   DC    C'APPLICATION DEACTIVATED BY NETWORK OPERATOR'
AMSG08   DC    C'APPLICATION IS INACTIVE'
AMSG09   DC    C'APPLICATION IS CLOSING DOWN'
AMSG10   DC    C'APPLICATION NEVER ACCEPTS LOGONS'
AMSG11   DC    C'APPLICATION IS NOT ACCEPTING LOGONS'
AMSG12   DC    C'THIS TERMINAL IS LOGGED ON TO THE NETWORK SOLICITOR'
         EJECT                                                 @VS49571
&ALABEL  CSECT                                                 @ZA37922
*                           THIS CSECT IS JUST INCASE THE USER @VS49571
*                           WISHES TO ADD CODE TO NETSOL       @VS49571
         MEND

