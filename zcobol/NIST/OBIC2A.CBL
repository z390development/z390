000100 IDENTIFICATION DIVISION.
000200 PROGRAM-ID.
000300     OBIC2A.
000400****************************************************************
000500*                                                              *
000600*    VALIDATION FOR:-                                          *
000700*                                                              *
000800*    "ON-SITE VALIDATION, NATIONAL INSTITUTE OF STD & TECH.     ".
000900*                                                              *
001000*    "COBOL 85 VERSION 4.2, Apr  1993 SSVG                      ".
001100*                                                              *
001200****************************************************************
001300*                                                              *
001400*      X-CARDS USED BY THIS PROGRAM ARE :-                     *
001500*                                                              *
001600*        X-55  - SYSTEM PRINTER NAME.                          *
001700*        X-82  - SOURCE COMPUTER NAME.                         *
001800*        X-83  - OBJECT COMPUTER NAME.                         *
001900*                                                              *
002000****************************************************************
002100*
002200*        THE SUBPROGRAM IC219 TESTS THE USE OF A SORT STATEMENT
002300*    IN A SEGMENTED SUBPROGRAM.  THE FIRST NON-DECLARATIVE SECTION
002400*    OF THE SUBPROGRAM CONSISTS OF A SORT STATEMENT AND A STOP RUN
002500*    STATEMENT IN A FIXED PERMANENT SEGMENT.  THE SORT INPUT
002600*    PROCEDURE AND THE SORT OUTPUT PROCEDURE ARE CONTAINED IN TWO
002700*    INDEPENDENT SEGMENTS.  THE MAIN PROGRAM IC218 CALLS THIS
002800*    SUBPROGRAM AND THE SUBPROGRAM IC220 IS CALLED FROM THE
002900*    OUTPUT PROCEDURE SECTION TO PRINT THE OUTPUT REPORT.
003000*
003100******************************************************************
003200 ENVIRONMENT DIVISION.
003300 CONFIGURATION SECTION.
003400 SOURCE-COMPUTER.
003500     XXXXX082.
003600 OBJECT-COMPUTER.
003700     XXXXX083.
003800 INPUT-OUTPUT SECTION.
003900 FILE-CONTROL.
004000     SELECT ST-FS1 ASSIGN TO
004100     XXXXX027.
004200 DATA DIVISION.
004300 FILE SECTION.
004400 SD  ST-FS1
004500     DATA RECORD IS ST-FS1R1-F-G-126.
004600 01  ST-FS1R1-F-G-126.
004700     02  ST-FS1-1-120.
004800         03  FILLER          PICTURE X(34).
004900         03  ST-FS1-REC-NO   PICTURE 9(6).
005000         03  FILLER          PICTURE X(80).
005100     02  ST-FS1-121-124      PICTURE X(4).
005200     02  ST-FS1-125-126      PICTURE 99.
005300 WORKING-STORAGE SECTION.
005400 01  TEMP1               PICTURE X(4).
005500 01  TEMP2               PICTURE 999.
005600 01  TEMP3               PICTURE 999.
005700 01  TEMP4               PICTURE 9(6).
005800 01  FAIL-COUNT          PICTURE 999    VALUE ZERO.
005900 01  EOF-FLAG            PICTURE 9    VALUE ZERO.
006000 01  PRINT-LINE-VALUES.
006100     02  PASS-OR-FAIL        PICTURE X(5).
006200     02  R-COUNT             PICTURE 99.
006300     02  FEATURE-TESTED      PICTURE X(20).
006400     02  COMPUTED-SORT-KEY.
006500         03  COMPUTED-1-4    PICTURE X(4).
006600         03  COMPUTED-5-6    PICTURE 99.
006700         03  COMPUTED-7-12   PICTURE 9(6).
006800         03  FILLER          PICTURE X(8)  VALUE SPACE.
006900     02  CORRECT-SORT-KEY.
007000         03  CORRECT-1-4     PICTURE X(4).
007100         03  CORRECT-5-6     PICTURE 99.
007200         03  CORRECT-7-12    PICTURE 9(6).
007300         03  FILLER          PICTURE X(8)   VALUE SPACE.
007400     02  PARAGRAPH-NAME      PICTURE X(12).
007500 01  PRINT-FLAG              PICTURE 9.
007600 01  FILE-RECORD-INFORMATION-REC.
007700     03 FILE-RECORD-INFO-SKELETON.
007800        05 FILLER                 PICTURE X(48)       VALUE
007900             "FILE=      ,RECORD=      /0,RECNO=000000,UPDT=00".
008000        05 FILLER                 PICTURE X(46)       VALUE
008100             ",ODO=0000,PGM=     ,LRECL=000000,BLKSIZ  =0000".
008200        05 FILLER                 PICTURE X(26)       VALUE
008300             ",LFIL=000000,ORG=  ,LBLR= ".
008400        05 FILLER                 PICTURE X(37)       VALUE
008500             ",RECKEY=                             ".
008600        05 FILLER                 PICTURE X(38)       VALUE
008700             ",ALTKEY1=                             ".
008800        05 FILLER                 PICTURE X(38)       VALUE
008900             ",ALTKEY2=                             ".
009000        05 FILLER                 PICTURE X(7)        VALUE SPACE.
009100     03 FILE-RECORD-INFO          OCCURS  10  TIMES.
009200        05 FILE-RECORD-INFO-P1-120.
009300           07 FILLER              PIC X(5).
009400           07 XFILE-NAME           PIC X(6).
009500           07 FILLER              PIC X(8).
009600           07 XRECORD-NAME         PIC X(6).
009700           07 FILLER              PIC X(1).
009800           07 REELUNIT-NUMBER     PIC 9(1).
009900           07 FILLER              PIC X(7).
010000           07 XRECORD-NUMBER       PIC 9(6).
010100           07 FILLER              PIC X(6).
010200           07 UPDATE-NUMBER       PIC 9(2).
010300           07 FILLER              PIC X(5).
010400           07 ODO-NUMBER          PIC 9(4).
010500           07 FILLER              PIC X(5).
010600           07 XPROGRAM-NAME        PIC X(5).
010700           07 FILLER              PIC X(7).
010800           07 XRECORD-LENGTH       PIC 9(6).
010900           07 FILLER              PIC X(7).
011000           07 CHARS-OR-RECORDS    PIC X(2).
011100           07 FILLER              PIC X(1).
011200           07 XBLOCK-SIZE          PIC 9(4).
011300           07 FILLER              PIC X(6).
011400           07 RECORDS-IN-FILE     PIC 9(6).
011500           07 FILLER              PIC X(5).
011600           07 XFILE-ORGANIZATION   PIC X(2).
011700           07 FILLER              PIC X(6).
011800           07 XLABEL-TYPE          PIC X(1).
011900        05 FILE-RECORD-INFO-P121-240.
012000           07 FILLER              PIC X(8).
012100           07 XRECORD-KEY          PIC X(29).
012200           07 FILLER              PIC X(9).
012300           07 ALTERNATE-KEY1      PIC X(29).
012400           07 FILLER              PIC X(9).
012500           07 ALTERNATE-KEY2      PIC X(29).
012600           07 FILLER              PIC X(7).
012700 LINKAGE SECTION.
012800 01  SORT-LINK           PICTURE 9.
012900 PROCEDURE DIVISION USING SORT-LINK.
013000 SECT-IC219-0001 SECTION 30.
013100*
013200*        THIS SECTION CONTAINS A SORT STATEMENT AND A STOP RUN
013300*    STATEMENT, THE ONLY STATEMENTS PERMITTED IN THE FIRST NON-
013400*    DECLARATIVE PORTION OF THE PROCEDURE DIVISION IN SORT LEVEL 1
013500*
013600 SORT-PARAGRAPH.
013700     SORT ST-FS1
013800         ASCENDING KEY ST-FS1-121-124
013900         ASCENDING KEY ST-FS1-125-126
014000         ASCENDING KEY ST-FS1-REC-NO
014100             INPUT PROCEDURE IS SECT-IC219-0002
014200             OUTPUT PROCEDURE IS SECT-IC219-0003.
014300     STOP RUN.
014400 SECT-IC219-0002 SECTION 60.
014500*
014600*        THE SORT INPUT PROCEDURE RELEASES 500 SORT RECORDS OF
014700*    LENGTH 126 CHARACTERS.  THREE ITEMS ARE USED AS THE SORT KEY,
014800*    THEY ARE CHARACTERS 121-124 PICX(4), CHARACTERS 125-126
014900*    PIC 99, AND THE RECORD NUMBER FIELD CHARACTERS 35-40 PIC 9(6)
015000*    THE RECORDS ARE WRITTEN WITH THE SORT KEY ITEMS CONTAINING
015100*    THE FOLLOWING CHARACTERS
015200*
015300*        FIRST 100 RECORDS  ABCD  00 THRU 99  000001 THRU 000100
015400*        SECOND 100 RECORDS AAAA  00 THRU 99  000101 THRU 000200
015500*        THIRD 100 RECORDS  ABCD  00 THRU 99  000201 THRU 00300
015600*        FOURTH 100 RECORDS UVWY  00 THRU 99  000301 THRU 000400
015700*        FIFTH 100 RECORDS  UVWX  00 THRU 99  000401 THRU 000500
015800*
015900 SORT-INPUT-PROCEDURE.
016000     MOVE 1 TO SORT-LINK.
016100     MOVE FILE-RECORD-INFO-SKELETON TO FILE-RECORD-INFO (1).
016200     PERFORM RECORD-AREA-INIT.
016300     MOVE "ABCD" TO TEMP1.
016400     MOVE 0 TO TEMP2.
016500     PERFORM RELEASE-RECORD 100 TIMES.
016600     MOVE "AAAA" TO TEMP1.
016700     MOVE 0 TO TEMP2.
016800     PERFORM RELEASE-RECORD 100 TIMES.
016900     MOVE "ABCD" TO TEMP1.
017000     MOVE 0 TO TEMP2.
017100     PERFORM RELEASE-RECORD 100 TIMES.
017200     MOVE "UVWY" TO TEMP1.
017300     MOVE 0 TO TEMP2.
017400     PERFORM RELEASE-RECORD 100 TIMES.
017500     MOVE "UVWX" TO TEMP1.
017600     MOVE 0 TO TEMP2.
017700     PERFORM RELEASE-RECORD 100 TIMES.
017800     GO TO SECT-IC219-0002-EXIT.
017900 RECORD-AREA-INIT.
018000     MOVE "ST-FS1" TO XFILE-NAME (1).
018100     MOVE "R1-F-G" TO XRECORD-NAME (1).
018200     MOVE "IC219" TO XPROGRAM-NAME (1).
018300     MOVE 126 TO XRECORD-LENGTH (1).
018400     MOVE "RC" TO CHARS-OR-RECORDS (1).
018500     MOVE 0001 TO XBLOCK-SIZE (1).
018600     MOVE 500 TO RECORDS-IN-FILE (1).
018700     MOVE "NA" TO XFILE-ORGANIZATION (1).
018800     MOVE "N" TO XLABEL-TYPE (1).
018900     MOVE 1 TO XRECORD-NUMBER (1).
019000 RELEASE-RECORD.
019100     MOVE FILE-RECORD-INFO-P1-120 (1) TO ST-FS1-1-120.
019200     MOVE TEMP1 TO ST-FS1-121-124.
019300     MOVE TEMP2 TO ST-FS1-125-126.
019400     RELEASE ST-FS1R1-F-G-126.
019500     ADD 1 TO XRECORD-NUMBER (1).
019600     ADD 1 TO TEMP2.
019700 SECT-IC219-0002-EXIT.
019800     EXIT.
019900 SECT-IC219-0003 SECTION 80.
020000*
020100*        THE SORT OUTPUT PROCEDURE RETURNS 500 SORT RECORDS.  THE
020200*    DATA ITEMS COMPRISING THE SORT KEY ARE CHECKED TO ENSURE THE
020300*    RECORDS ARE RETURNED IN THE EXPECTED SORT ORDER.  THE SUBPRO-
020400*    GRAM IC220 IS CALLED TO PRODUCE THE OUTPUT REPORT FOR THE
020500*    TEST RESULTS.
020600*
020700*        THE RECORDS SHOULD BE RETURNED WITH THE SORT KEY ITEMS
020800*    CONTAINING THE FOLLOWING CHARACTERS
020900*
021000*        FIRST 100 RECORDS  AAAA  00 THRU 99  000101 THRU 000200
021100*                           ABCD  00          000001
021200*        NEXT               ABCD  00          000201
021300*            200            ABCD  01          000002
021400*               RECORDS     ABCD  01          000202
021500*                            . . .            . . .
021600*                           ABCD  99          000100
021700*                           ABCD  99          000300
021800*        FOURTH 100 RECORDS UVWX  00 THRU 99  000401 THRU 000500
021900*        FIFTH 100 RECORDS  UVWY  00 THRU 99  000301 THRU 000400
022000*
022100 SORT-OUTPUT-INIT.
022200     MOVE 2 TO SORT-LINK.
022300     MOVE 1 TO PRINT-FLAG.
022400     CALL "OBIC3A" USING PRINT-LINE-VALUES  PRINT-FLAG.
022500     MOVE "SORT IN SUBPROGRAM" TO FEATURE-TESTED.
022600     MOVE "IC-SORT-TEST" TO PARAGRAPH-NAME.
022700     MOVE 0 TO R-COUNT.
022800 CHECK-OUTPUT-FROM-SORT.
022900     MOVE "AAAA" TO TEMP1.
023000     MOVE 0 TO TEMP3.
023100     MOVE 100 TO TEMP4.
023200     PERFORM CHECK-RECORD 100 TIMES.
023300     MOVE "ABCD" TO TEMP1.
023400     MOVE 0 TO TEMP3.
023500     MOVE 0 TO TEMP4.
023600     PERFORM CHECK-ABCD-RECORDS 100 TIMES.
023700     MOVE "UVWX" TO TEMP1.
023800     MOVE 0 TO TEMP3.
023900     MOVE 400 TO TEMP4.
024000     PERFORM CHECK-RECORD 100 TIMES.
024100     MOVE "UVWY" TO TEMP1.
024200     MOVE 0 TO TEMP3.
024300     MOVE 300 TO TEMP4.
024400     PERFORM CHECK-RECORD 100 TIMES.
024500 CHECK-RESULTS.
024600     IF EOF-FLAG EQUAL TO 1
024700         MOVE "PREMATURE EOF" TO COMPUTED-SORT-KEY
024800         MOVE "DATA RECORD EXPECTED" TO CORRECT-SORT-KEY
024900         GO TO FAIL-WRITE.
025000     RETURN ST-FS1 AT END GO TO CHECK-FAIL-COUNT.
025100     MOVE "NO EOF - 500 READ" TO COMPUTED-SORT-KEY.
025200     MOVE "EOF EXPECTED" TO CORRECT-SORT-KEY.
025300     GO TO FAIL-WRITE.
025400 CHECK-FAIL-COUNT.
025500     IF FAIL-COUNT EQUAL TO ZERO
025600         MOVE "PASS " TO PASS-OR-FAIL
025700         GO TO WRITE-RESULTS.
025800     MOVE "SORT ERRORS" TO COMPUTED-SORT-KEY.
025900     MOVE SPACE TO CORRECT-SORT-KEY.
026000 FAIL-WRITE.
026100     MOVE "FAIL " TO PASS-OR-FAIL.
026200 WRITE-RESULTS.
026300     MOVE 0 TO R-COUNT.
026400     MOVE 2 TO PRINT-FLAG.
026500     CALL "OBIC3A" USING PRINT-LINE-VALUES  PRINT-FLAG.
026600 WRAPUP-OUTPUT-PROC.
026700     MOVE 3 TO PRINT-FLAG.
026800     CALL "OBIC3A" USING PRINT-LINE-VALUES  PRINT-FLAG.
026900     GO TO SECT-IC219-0003-EXIT.
027000 CHECK-RECORD.
027100     PERFORM RETURN-RECORD THROUGH RETURN-EXIT.
027200     ADD 1 TO TEMP4.
027300     PERFORM COMPARE-VALUES THROUGH COMPARE-EXIT.
027400     ADD 1 TO TEMP3.
027500 RETURN-RECORD.
027600     IF EOF-FLAG EQUAL TO 1
027700         GO TO RETURN-EXIT.
027800     RETURN ST-FS1  AT END  MOVE 1 TO EOF-FLAG.
027900 RETURN-EXIT.
028000     EXIT.
028100 CHECK-ABCD-RECORDS.
028200     PERFORM CHECK-RECORD.
028300     SUBTRACT 1 FROM TEMP3.
028400     ADD 199 TO TEMP4.
028500     PERFORM CHECK-RECORD.
028600     SUBTRACT 200 FROM TEMP4.
028700 COMPARE-VALUES.
028800     IF TEMP1 NOT EQUAL TO ST-FS1-121-124
028900         GO TO SORT-FAIL.
029000     IF TEMP3 NOT EQUAL TO ST-FS1-125-126
029100         GO TO SORT-FAIL.
029200     IF TEMP4 NOT EQUAL TO ST-FS1-REC-NO
029300         GO TO SORT-FAIL.
029400     GO TO COMPARE-EXIT.
029500 SORT-FAIL.
029600     MOVE "FAIL " TO PASS-OR-FAIL.
029700     ADD 1 TO R-COUNT.
029800     MOVE TEMP1 TO CORRECT-1-4.
029900     MOVE TEMP3 TO CORRECT-5-6.
030000     MOVE TEMP4 TO CORRECT-7-12.
030100     MOVE ST-FS1-121-124 TO COMPUTED-1-4.
030200     MOVE ST-FS1-125-126 TO COMPUTED-5-6.
030300     MOVE ST-FS1-REC-NO TO COMPUTED-7-12.
030400     MOVE 2 TO PRINT-FLAG.
030500     CALL "OBIC3A" USING PRINT-LINE-VALUES  PRINT-FLAG.
030600     ADD 1 TO FAIL-COUNT.
030700 COMPARE-EXIT.
030800     EXIT.
030900 SECT-IC219-0003-EXIT.
031000     EXIT.
