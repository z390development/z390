000100 IDENTIFICATION DIVISION.
000200 PROGRAM-ID.
000300     IF107A.
000400
000500***********************************************************
000600*                                                         *
000700* This program forms part of the CCVS85 COBOL Test Suite. *
000800* It contains tests for the Intrinsic Function            *
000900* CURRENT-DATE.                                           *
001000*                                                         *
001100***********************************************************
001200 ENVIRONMENT DIVISION.
001300 CONFIGURATION SECTION.
001400 SOURCE-COMPUTER.
001500     XXXXX082.
001600 OBJECT-COMPUTER.
001700     XXXXX083.
001800 INPUT-OUTPUT SECTION.
001900 FILE-CONTROL.
002000     SELECT PRINT-FILE ASSIGN TO
002100     XXXXX055.
002200 DATA DIVISION.
002300 FILE SECTION.
002400 FD  PRINT-FILE.
002500 01  PRINT-REC PICTURE X(120).
002600 01  DUMMY-RECORD PICTURE X(120).
002700 WORKING-STORAGE SECTION.
002800***********************************************************
002900* Variables specific to the Intrinsic Function Test IF107A*
003000***********************************************************
003100 01  TEMP1                       PIC X(21).
003200 01  TEMP2                       PIC X(21).
003300 01  WS-FIRST                    VALUE SPACES.
003400     02  FILLER                  PIC X(8).
003500     02  WS-TIME1                PIC X(8).
003600     02  FILLER                  PIC X(5).
003700 01  WS-SECOND                   VALUE SPACES.
003800     02  FILLER                  PIC X(8).
003900     02  WS-TIME2                PIC X(8).
004000     02  FILLER                  PIC X(5).
004100 01  WS-DATE.
004200     02  WS-YEAR                 PIC 9999.
004300              88 CON-YEAR        VALUE 1990 THRU 9999.
004400     02  WS-MONTH                PIC 99.
004500              88 CON-MONTH       VALUE 01 THRU 12.
004600     02  WS-DAY                  PIC 99.
004700              88 CON-DAY         VALUE 01 THRU 31.
004800     02  WS-HOUR                 PIC 99.
004900              88 CON-HOUR        VALUE 00 THRU 23.
005000     02  WS-MIN                  PIC 99.
005100              88 CON-MIN         VALUE 00 THRU 59.
005200     02  WS-SECOND               PIC 99.
005300              88 CON-SEC         VALUE 00 THRU 59.
005400     02  WS-HUNDSEC              PIC 99.
005500              88 CON-HUNDSEC     VALUE 00 THRU 99.
005600     02  WS-GREENW               PIC X.
005700              88 CON-GREENW      VALUE "-", "+", "0".
005800     02  WS-OFFSET               PIC 99.
005900              88 CON-OFFSET      VALUE 00 THRU 13.
006000     02  WS-OFFSET2              PIC 99.
006100              88 CON-OFFSET2     VALUE 00 THRU 59.
006200*
006300**********************************************************
006400*
006500 01  TEST-RESULTS.
006600     02 FILLER                   PIC X      VALUE SPACE.
006700     02 FEATURE                  PIC X(20)  VALUE SPACE.
006800     02 FILLER                   PIC X      VALUE SPACE.
006900     02 P-OR-F                   PIC X(5)   VALUE SPACE.
007000     02 FILLER                   PIC X      VALUE SPACE.
007100     02  PAR-NAME.
007200       03 FILLER                 PIC X(19)  VALUE SPACE.
007300       03  PARDOT-X              PIC X      VALUE SPACE.
007400       03 DOTVALUE               PIC 99     VALUE ZERO.
007500     02 FILLER                   PIC X(8)   VALUE SPACE.
007600     02 RE-MARK                  PIC X(61).
007700 01  TEST-COMPUTED.
007800     02 FILLER                   PIC X(30)  VALUE SPACE.
007900     02 FILLER                   PIC X(17)  VALUE
008000            "       COMPUTED=".
008100     02 COMPUTED-X.
008200     03 COMPUTED-A               PIC X(20)  VALUE SPACE.
008300     03 COMPUTED-N               REDEFINES COMPUTED-A
008400                                 PIC -9(9).9(9).
008500     03 COMPUTED-0V18 REDEFINES COMPUTED-A   PIC -.9(18).
008600     03 COMPUTED-4V14 REDEFINES COMPUTED-A   PIC -9(4).9(14).
008700     03 COMPUTED-14V4 REDEFINES COMPUTED-A   PIC -9(14).9(4).
008800     03       CM-18V0 REDEFINES COMPUTED-A.
008900         04 COMPUTED-18V0                    PIC -9(18).
009000         04 FILLER                           PIC X.
009100     03 FILLER PIC X(50) VALUE SPACE.
009200 01  TEST-CORRECT.
009300     02 FILLER PIC X(30) VALUE SPACE.
009400     02 FILLER PIC X(17) VALUE "       CORRECT =".
009500     02 CORRECT-X.
009600     03 CORRECT-A                  PIC X(20) VALUE SPACE.
009700     03 CORRECT-N    REDEFINES CORRECT-A     PIC -9(9).9(9).
009800     03 CORRECT-0V18 REDEFINES CORRECT-A     PIC -.9(18).
009900     03 CORRECT-4V14 REDEFINES CORRECT-A     PIC -9(4).9(14).
010000     03 CORRECT-14V4 REDEFINES CORRECT-A     PIC -9(14).9(4).
010100     03      CR-18V0 REDEFINES CORRECT-A.
010200         04 CORRECT-18V0                     PIC -9(18).
010300         04 FILLER                           PIC X.
010400     03 FILLER PIC X(2) VALUE SPACE.
010500     03 COR-ANSI-REFERENCE             PIC X(48) VALUE SPACE.
010600 01  CCVS-C-1.
010700     02 FILLER  PIC IS X(99)    VALUE IS " FEATURE              PA
010800-    "SS  PARAGRAPH-NAME
010900-    "       REMARKS".
011000     02 FILLER                     PIC X(20)    VALUE SPACE.
011100 01  CCVS-C-2.
011200     02 FILLER                     PIC X        VALUE SPACE.
011300     02 FILLER                     PIC X(6)     VALUE "TESTED".
011400     02 FILLER                     PIC X(15)    VALUE SPACE.
011500     02 FILLER                     PIC X(4)     VALUE "FAIL".
011600     02 FILLER                     PIC X(94)    VALUE SPACE.
011700 01  REC-SKL-SUB                   PIC 9(2)     VALUE ZERO.
011800 01  REC-CT                        PIC 99       VALUE ZERO.
011900 01  DELETE-COUNTER                PIC 999      VALUE ZERO.
012000 01  ERROR-COUNTER                 PIC 999      VALUE ZERO.
012100 01  INSPECT-COUNTER               PIC 999      VALUE ZERO.
012200 01  PASS-COUNTER                  PIC 999      VALUE ZERO.
012300 01  TOTAL-ERROR                   PIC 999      VALUE ZERO.
012400 01  ERROR-HOLD                    PIC 999      VALUE ZERO.
012500 01  DUMMY-HOLD                    PIC X(120)   VALUE SPACE.
012600 01  RECORD-COUNT                  PIC 9(5)     VALUE ZERO.
012700 01  ANSI-REFERENCE                PIC X(48)    VALUE SPACES.
012800 01  CCVS-H-1.
012900     02  FILLER                    PIC X(39)    VALUE SPACES.
013000     02  FILLER                    PIC X(42)    VALUE
013100     "OFFICIAL COBOL COMPILER VALIDATION SYSTEM".
013200     02  FILLER                    PIC X(39)    VALUE SPACES.
013300 01  CCVS-H-2A.
013400   02  FILLER                        PIC X(40)  VALUE SPACE.
013500   02  FILLER                        PIC X(7)   VALUE "CCVS85 ".
013600   02  FILLER                        PIC XXXX   VALUE
013700     "4.2 ".
013800   02  FILLER                        PIC X(28)  VALUE
013900            " COPY - NOT FOR DISTRIBUTION".
014000   02  FILLER                        PIC X(41)  VALUE SPACE.
014100
014200 01  CCVS-H-2B.
014300   02  FILLER                        PIC X(15)  VALUE
014400            "TEST RESULT OF ".
014500   02  TEST-ID                       PIC X(9).
014600   02  FILLER                        PIC X(4)   VALUE
014700            " IN ".
014800   02  FILLER                        PIC X(12)  VALUE
014900     " HIGH       ".
015000   02  FILLER                        PIC X(22)  VALUE
015100            " LEVEL VALIDATION FOR ".
015200   02  FILLER                        PIC X(58)  VALUE
015300     "ON-SITE VALIDATION, NATIONAL INSTITUTE OF STD & TECH.     ".
015400 01  CCVS-H-3.
015500     02  FILLER                      PIC X(34)  VALUE
015600            " FOR OFFICIAL USE ONLY    ".
015700     02  FILLER                      PIC X(58)  VALUE
015800     "COBOL 85 VERSION 4.2, Apr  1993 SSVG                      ".
015900     02  FILLER                      PIC X(28)  VALUE
016000            "  COPYRIGHT   1985 ".
016100 01  CCVS-E-1.
016200     02 FILLER                       PIC X(52)  VALUE SPACE.
016300     02 FILLER  PIC X(14) VALUE IS "END OF TEST-  ".
016400     02 ID-AGAIN                     PIC X(9).
016500     02 FILLER                       PIC X(45)  VALUE SPACES.
016600 01  CCVS-E-2.
016700     02  FILLER                      PIC X(31)  VALUE SPACE.
016800     02  FILLER                      PIC X(21)  VALUE SPACE.
016900     02 CCVS-E-2-2.
017000         03 ERROR-TOTAL              PIC XXX    VALUE SPACE.
017100         03 FILLER                   PIC X      VALUE SPACE.
017200         03 ENDER-DESC               PIC X(44)  VALUE
017300            "ERRORS ENCOUNTERED".
017400 01  CCVS-E-3.
017500     02  FILLER                      PIC X(22)  VALUE
017600            " FOR OFFICIAL USE ONLY".
017700     02  FILLER                      PIC X(12)  VALUE SPACE.
017800     02  FILLER                      PIC X(58)  VALUE
017900     "ON-SITE VALIDATION, NATIONAL INSTITUTE OF STD & TECH.     ".
018000     02  FILLER                      PIC X(13)  VALUE SPACE.
018100     02 FILLER                       PIC X(15)  VALUE
018200             " COPYRIGHT 1985".
018300 01  CCVS-E-4.
018400     02 CCVS-E-4-1                   PIC XXX    VALUE SPACE.
018500     02 FILLER                       PIC X(4)   VALUE " OF ".
018600     02 CCVS-E-4-2                   PIC XXX    VALUE SPACE.
018700     02 FILLER                       PIC X(40)  VALUE
018800      "  TESTS WERE EXECUTED SUCCESSFULLY".
018900 01  XXINFO.
019000     02 FILLER                       PIC X(19)  VALUE
019100            "*** INFORMATION ***".
019200     02 INFO-TEXT.
019300       04 FILLER                     PIC X(8)   VALUE SPACE.
019400       04 XXCOMPUTED                 PIC X(20).
019500       04 FILLER                     PIC X(5)   VALUE SPACE.
019600       04 XXCORRECT                  PIC X(20).
019700     02 INF-ANSI-REFERENCE           PIC X(48).
019800 01  HYPHEN-LINE.
019900     02 FILLER  PIC IS X VALUE IS SPACE.
020000     02 FILLER  PIC IS X(65)    VALUE IS "************************
020100-    "*****************************************".
020200     02 FILLER  PIC IS X(54)    VALUE IS "************************
020300-    "******************************".
020400 01  CCVS-PGM-ID                     PIC X(9)   VALUE
020500     "IF107A".
020600 PROCEDURE DIVISION.
020700 CCVS1 SECTION.
020800 OPEN-FILES.
020900     OPEN     OUTPUT PRINT-FILE.
021000     MOVE CCVS-PGM-ID TO TEST-ID. MOVE CCVS-PGM-ID TO ID-AGAIN.
021100     MOVE    SPACE TO TEST-RESULTS.
021200     PERFORM  HEAD-ROUTINE THRU COLUMN-NAMES-ROUTINE.
021300     GO TO CCVS1-EXIT.
021400 CLOSE-FILES.
021500     PERFORM END-ROUTINE THRU END-ROUTINE-13. CLOSE PRINT-FILE.
021600 TERMINATE-CCVS.
021700     STOP     RUN.
021800 INSPT. MOVE "INSPT" TO P-OR-F. ADD 1 TO INSPECT-COUNTER.
021900 PASS.  MOVE "PASS " TO P-OR-F.  ADD 1 TO PASS-COUNTER.
022000 FAIL.  MOVE "FAIL*" TO P-OR-F.  ADD 1 TO ERROR-COUNTER.
022100 DE-LETE.  MOVE "*****" TO P-OR-F.  ADD 1 TO DELETE-COUNTER.
022200     MOVE "****TEST DELETED****" TO RE-MARK.
022300 PRINT-DETAIL.
022400     IF REC-CT NOT EQUAL TO ZERO
022500             MOVE "." TO PARDOT-X
022600             MOVE REC-CT TO DOTVALUE.
022700     MOVE     TEST-RESULTS TO PRINT-REC. PERFORM WRITE-LINE.
022800     IF P-OR-F EQUAL TO "FAIL*"  PERFORM WRITE-LINE
022900        PERFORM FAIL-ROUTINE THRU FAIL-ROUTINE-EX
023000          ELSE PERFORM BAIL-OUT THRU BAIL-OUT-EX.
023100     MOVE SPACE TO P-OR-F. MOVE SPACE TO COMPUTED-X.
023200     MOVE SPACE TO CORRECT-X.
023300     IF     REC-CT EQUAL TO ZERO  MOVE SPACE TO PAR-NAME.
023400     MOVE     SPACE TO RE-MARK.
023500 HEAD-ROUTINE.
023600     MOVE CCVS-H-1  TO DUMMY-RECORD. PERFORM WRITE-LINE 2 TIMES.
023700     MOVE CCVS-H-2A TO DUMMY-RECORD. PERFORM WRITE-LINE 2 TIMES.
023800     MOVE CCVS-H-2B TO DUMMY-RECORD. PERFORM WRITE-LINE 3 TIMES.
023900     MOVE CCVS-H-3  TO DUMMY-RECORD. PERFORM WRITE-LINE 3 TIMES.
024000 COLUMN-NAMES-ROUTINE.
024100     MOVE CCVS-C-1 TO DUMMY-RECORD. PERFORM WRITE-LINE.
024200     MOVE CCVS-C-2 TO DUMMY-RECORD. PERFORM WRITE-LINE 2 TIMES.
024300     MOVE HYPHEN-LINE TO DUMMY-RECORD. PERFORM WRITE-LINE.
024400 END-ROUTINE.
024500     MOVE HYPHEN-LINE TO DUMMY-RECORD. PERFORM WRITE-LINE 5
024600     TIMES.
024700 END-RTN-EXIT.
024800     MOVE CCVS-E-1 TO DUMMY-RECORD. PERFORM WRITE-LINE 2 TIMES.
024900 END-ROUTINE-1.
025000      ADD ERROR-COUNTER TO ERROR-HOLD ADD INSPECT-COUNTER TO
025100      ERROR-HOLD. ADD DELETE-COUNTER TO ERROR-HOLD.
025200      ADD PASS-COUNTER TO ERROR-HOLD.
025300      MOVE PASS-COUNTER TO CCVS-E-4-1.
025400      MOVE ERROR-HOLD TO CCVS-E-4-2.
025500      MOVE CCVS-E-4 TO CCVS-E-2-2.
025600      MOVE CCVS-E-2 TO DUMMY-RECORD PERFORM WRITE-LINE.
025700  END-ROUTINE-12.
025800      MOVE "TEST(S) FAILED" TO ENDER-DESC.
025900     IF       ERROR-COUNTER IS EQUAL TO ZERO
026000         MOVE "NO " TO ERROR-TOTAL
026100         ELSE
026200         MOVE ERROR-COUNTER TO ERROR-TOTAL.
026300     MOVE     CCVS-E-2 TO DUMMY-RECORD.
026400     PERFORM WRITE-LINE.
026500 END-ROUTINE-13.
026600     IF DELETE-COUNTER IS EQUAL TO ZERO
026700         MOVE "NO " TO ERROR-TOTAL  ELSE
026800         MOVE DELETE-COUNTER TO ERROR-TOTAL.
026900     MOVE "TEST(S) DELETED     " TO ENDER-DESC.
027000     MOVE CCVS-E-2 TO DUMMY-RECORD. PERFORM WRITE-LINE.
027100      IF   INSPECT-COUNTER EQUAL TO ZERO
027200          MOVE "NO " TO ERROR-TOTAL
027300      ELSE MOVE INSPECT-COUNTER TO ERROR-TOTAL.
027400      MOVE "TEST(S) REQUIRE INSPECTION" TO ENDER-DESC.
027500      MOVE CCVS-E-2 TO DUMMY-RECORD. PERFORM WRITE-LINE.
027600     MOVE CCVS-E-3 TO DUMMY-RECORD. PERFORM WRITE-LINE.
027700 WRITE-LINE.
027800     ADD 1 TO RECORD-COUNT.
027900Y    IF RECORD-COUNT GREATER 42
028000Y        MOVE DUMMY-RECORD TO DUMMY-HOLD
028100Y        MOVE SPACE TO DUMMY-RECORD
028200Y        WRITE DUMMY-RECORD AFTER ADVANCING PAGE
028300Y        MOVE CCVS-H-1  TO DUMMY-RECORD  PERFORM WRT-LN 2 TIMES
028400Y        MOVE CCVS-H-2A TO DUMMY-RECORD  PERFORM WRT-LN 2 TIMES
028500Y        MOVE CCVS-H-2B TO DUMMY-RECORD  PERFORM WRT-LN 3 TIMES
028600Y        MOVE CCVS-H-3  TO DUMMY-RECORD  PERFORM WRT-LN 3 TIMES
028700Y        MOVE CCVS-C-1  TO DUMMY-RECORD  PERFORM WRT-LN
028800Y        MOVE CCVS-C-2  TO DUMMY-RECORD  PERFORM WRT-LN
028900Y        MOVE HYPHEN-LINE TO DUMMY-RECORD PERFORM WRT-LN
029000Y        MOVE DUMMY-HOLD TO DUMMY-RECORD
029100Y        MOVE ZERO TO RECORD-COUNT.
029200     PERFORM WRT-LN.
029300 WRT-LN.
029400     WRITE    DUMMY-RECORD AFTER ADVANCING 1 LINES.
029500     MOVE SPACE TO DUMMY-RECORD.
029600 BLANK-LINE-PRINT.
029700     PERFORM WRT-LN.
029800 FAIL-ROUTINE.
029900     IF     COMPUTED-X NOT EQUAL TO SPACE
030000            GO TO FAIL-ROUTINE-WRITE.
030100     IF     CORRECT-X NOT EQUAL TO SPACE GO TO FAIL-ROUTINE-WRITE.
030200     MOVE   ANSI-REFERENCE TO INF-ANSI-REFERENCE.
030300     MOVE  "NO FURTHER INFORMATION, SEE PROGRAM." TO INFO-TEXT.
030400     MOVE   XXINFO TO DUMMY-RECORD. PERFORM WRITE-LINE 2 TIMES.
030500     MOVE   SPACES TO INF-ANSI-REFERENCE.
030600     GO TO  FAIL-ROUTINE-EX.
030700 FAIL-ROUTINE-WRITE.
030800     MOVE   TEST-COMPUTED TO PRINT-REC PERFORM WRITE-LINE
030900     MOVE   ANSI-REFERENCE TO COR-ANSI-REFERENCE.
031000     MOVE   TEST-CORRECT TO PRINT-REC PERFORM WRITE-LINE 2 TIMES.
031100     MOVE   SPACES TO COR-ANSI-REFERENCE.
031200 FAIL-ROUTINE-EX. EXIT.
031300 BAIL-OUT.
031400     IF     COMPUTED-A NOT EQUAL TO SPACE GO TO BAIL-OUT-WRITE.
031500     IF     CORRECT-A EQUAL TO SPACE GO TO BAIL-OUT-EX.
031600 BAIL-OUT-WRITE.
031700     MOVE CORRECT-A TO XXCORRECT.
031800     MOVE COMPUTED-A TO XXCOMPUTED.
031900     MOVE   ANSI-REFERENCE TO INF-ANSI-REFERENCE.
032000     MOVE   XXINFO TO DUMMY-RECORD. PERFORM WRITE-LINE 2 TIMES.
032100     MOVE   SPACES TO INF-ANSI-REFERENCE.
032200 BAIL-OUT-EX. EXIT.
032300 CCVS1-EXIT.
032400     EXIT.
032500********************************************************
032600*                                                      *
032700*    Intrinsic Function Tests   IF107A - CURRENT-DATE *
032800*                                                      *
032900********************************************************
033000 SECT-IF107A SECTION.
033100 F-WHENCOMP-INFO.
033200     MOVE     "See ref. A-39 2.11" TO ANSI-REFERENCE.
033300     MOVE     "CURRENT-DATE"     TO FEATURE.
033400*****************TEST (a) ******************************
033500 F-WHENCOMP-01.
033600     MOVE SPACES TO TEMP1.
033700     MOVE SPACES TO WS-DATE.
033800 F-WHENCOMP-TEST-01.
033900     MOVE FUNCTION CURRENT-DATE TO TEMP1.
034000     MOVE TEMP1 TO WS-DATE.
034100     IF CON-YEAR     AND
034200        CON-MONTH    AND
034300        CON-DAY      AND
034400        CON-HOUR     AND
034500        CON-MIN      AND
034600        CON-SEC      AND
034700        CON-HUNDSEC  AND
034800        CON-GREENW   AND
034900        CON-OFFSET   AND
035000        CON-OFFSET2  THEN
035100                  PERFORM PASS
035200     ELSE
035300                  MOVE TEMP1 TO COMPUTED-A
035400                  MOVE "Date & Time value " TO CORRECT-X
035500                  PERFORM FAIL.
035600     GO TO F-WHENCOMP-WRITE-01.
035700 F-WHENCOMP-DELETE-01.
035800     PERFORM  DE-LETE.
035900     GO TO    F-WHENCOMP-WRITE-01.
036000 F-WHENCOMP-WRITE-01.
036100     MOVE "F-WHENCOMP-01" TO PAR-NAME.
036200     PERFORM  PRINT-DETAIL.
036300*****************TEST (b) ******************************
036400 F-WHENCOMP-TEST-02.
036500     IF FUNCTION CURRENT-DATE >= TEMP1 THEN
036600                    PERFORM PASS
036700     ELSE
036800                    PERFORM FAIL.
036900     GO TO F-WHENCOMP-WRITE-02.
037000 F-WHENCOMP-DELETE-02.
037100     PERFORM  DE-LETE.
037200     GO TO    F-WHENCOMP-WRITE-02.
037300 F-WHENCOMP-WRITE-02.
037400     MOVE "F-WHENCOMP-02" TO PAR-NAME.
037500     PERFORM  PRINT-DETAIL.
037600*******************END OF TESTS**************************
037700 CCVS-EXIT SECTION.
037800 CCVS-999999.
037900     GO TO CLOSE-FILES.
