000100 IDENTIFICATION DIVISION.
000200 PROGRAM-ID.
000300     SQ211A.
000400****************************************************************
000500*                                                              *
000600*    VALIDATION FOR:-                                          *
000700*    "ON-SITE VALIDATION, NATIONAL INSTITUTE OF STD & TECH.     ".
000800*    USING CCVS85 VERSION 3.0.                                 *
000900*                                                              *
001000*    CREATION DATE     /     VALIDATION DATE                   *
001100*    "COBOL 85 VERSION 4.2, Apr  1993 SSVG                      ".
001200*                                                              *
001300****************************************************************
001400*                                                              *
001500*      X-CARDS USED BY THIS PROGRAM ARE :-                     *
001600*                                                              *
001700*            X-01   SEQUENTIAL TAPE                            *
001800*            X-55   SYSTEM PRINTER                             *
001900*            X-82   SOURCE-COMPUTER                            *
002000*            X-83   OBJECT-COMPUTER.                           *
002100*            X-84   LABEL RECORDS OPTION                       *
002200*                                                              *
002300****************************************************************
002400*                                                              *
002500*    SQ211A TESTS THE CLOSE STATEMENT WITH THE WITH LOCK PHRASE*
002600*    A MAGNETIC TAPE FILE WITH ONE RECORD IS CREATED AND IS    *
002700*    CLOSED WITH LOCK.  THE FILE IS THEN RE-OPENED AFTER IT HAS*
002800*    BEEN CLOSED WITH LOCK. THERE ARE NO DECLARATIVE           *
002900*    PROCEDURES. THE TEST FOR CORRECT I-O STATUS CODE IS IN    *
003000*    THE MAIN LINE CODE, THEREFORE AN ABNORMAL TERMINATION IS  *
003100*    POSSIBLE BEFORE THE TEST OF THE I-O STATUS CODE IS        *
003200*    ACCOMPLISHED.                                             *
003300*                                                              *
003400****************************************************************
003500*
003600 ENVIRONMENT DIVISION.
003700 CONFIGURATION SECTION.
003800 SOURCE-COMPUTER.
003900     XXXXX082.
004000 OBJECT-COMPUTER.
004100     XXXXX083.
004200*
004300 INPUT-OUTPUT SECTION.
004400 FILE-CONTROL.
004500     SELECT PRINT-FILE ASSIGN TO
004600     XXXXX055.
004700*
004800     SELECT SQ-FS1 ASSIGN TO
004900     XXXXX001
005000            FILE STATUS IS SQ-FS1-STATUS.
005100*
005200*
005300 DATA DIVISION.
005400 FILE SECTION.
005500 FD  PRINT-FILE
005600C    LABEL RECORDS
005700C    XXXXX084
005800C    DATA RECORD IS PRINT-REC DUMMY-RECORD
005900               .
006000 01  PRINT-REC    PICTURE X(120).
006100 01  DUMMY-RECORD PICTURE X(120).
006200*
006300 FD  SQ-FS1
006400C    LABEL RECORD IS STANDARD
006500                .
006600 01  SQ-FS1R1-F-G-120 PIC X(120).
006700*
006800 WORKING-STORAGE SECTION.
006900*
007000***************************************************************
007100*                                                             *
007200*    WORKING-STORAGE DATA ITEMS SPECIFIC TO THIS TEST SUITE   *
007300*                                                             *
007400***************************************************************
007500*
007600 01  SQ-FS1-STATUS.
007700   03  SQ-FS1-KEY-1   PIC X.
007800   03  SQ-FS1-KEY-2   PIC X.
007900*
008000***************************************************************
008100*                                                             *
008200*    WORKING-STORAGE DATA ITEMS USED BY THE CCVS              *
008300*                                                             *
008400***************************************************************
008500*
008600 01  REC-SKEL-SUB   PIC 99.
008700*
008800 01  FILE-RECORD-INFORMATION-REC.
008900     03 FILE-RECORD-INFO-SKELETON.
009000        05 FILLER                 PICTURE X(48)       VALUE
009100             "FILE=      ,RECORD=      /0,RECNO=000000,UPDT=00".
009200        05 FILLER                 PICTURE X(46)       VALUE
009300             ",ODO=0000,PGM=     ,LRECL=000000,BLKSIZ  =0000".
009400        05 FILLER                 PICTURE X(26)       VALUE
009500             ",LFIL=000000,ORG=  ,LBLR= ".
009600        05 FILLER                 PICTURE X(37)       VALUE
009700             ",RECKEY=                             ".
009800        05 FILLER                 PICTURE X(38)       VALUE
009900             ",ALTKEY1=                             ".
010000        05 FILLER                 PICTURE X(38)       VALUE
010100             ",ALTKEY2=                             ".
010200        05 FILLER                 PICTURE X(7)        VALUE SPACE.
010300     03 FILE-RECORD-INFO          OCCURS  10  TIMES.
010400        05 FILE-RECORD-INFO-P1-120.
010500           07 FILLER              PIC X(5).
010600           07 XFILE-NAME          PIC X(6).
010700           07 FILLER              PIC X(8).
010800           07 XRECORD-NAME        PIC X(6).
010900           07 FILLER              PIC X(1).
011000           07 REELUNIT-NUMBER     PIC 9(1).
011100           07 FILLER              PIC X(7).
011200           07 XRECORD-NUMBER      PIC 9(6).
011300           07 FILLER              PIC X(6).
011400           07 UPDATE-NUMBER       PIC 9(2).
011500           07 FILLER              PIC X(5).
011600           07 ODO-NUMBER          PIC 9(4).
011700           07 FILLER              PIC X(5).
011800           07 XPROGRAM-NAME       PIC X(5).
011900           07 FILLER              PIC X(7).
012000           07 XRECORD-LENGTH      PIC 9(6).
012100           07 FILLER              PIC X(7).
012200           07 CHARS-OR-RECORDS    PIC X(2).
012300           07 FILLER              PIC X(1).
012400           07 XBLOCK-SIZE         PIC 9(4).
012500           07 FILLER              PIC X(6).
012600           07 RECORDS-IN-FILE     PIC 9(6).
012700           07 FILLER              PIC X(5).
012800           07 XFILE-ORGANIZATION  PIC X(2).
012900           07 FILLER              PIC X(6).
013000           07 XLABEL-TYPE         PIC X(1).
013100        05 FILE-RECORD-INFO-P121-240.
013200           07 FILLER              PIC X(8).
013300           07 XRECORD-KEY         PIC X(29).
013400           07 FILLER              PIC X(9).
013500           07 ALTERNATE-KEY1      PIC X(29).
013600           07 FILLER              PIC X(9).
013700           07 ALTERNATE-KEY2      PIC X(29).
013800           07 FILLER              PIC X(7).
013900*
014000 01  TEST-RESULTS.
014100     02 FILLER              PIC X      VALUE SPACE.
014200     02 FEATURE             PIC X(24)  VALUE SPACE.
014300     02 FILLER              PIC X      VALUE SPACE.
014400     02 P-OR-F              PIC X(5)   VALUE SPACE.
014500     02 FILLER              PIC X      VALUE SPACE.
014600     02  PAR-NAME.
014700       03 FILLER              PIC X(14)  VALUE SPACE.
014800       03 PARDOT-X            PIC X      VALUE SPACE.
014900       03 DOTVALUE            PIC 99     VALUE ZERO.
015000     02 FILLER              PIC X(9)   VALUE SPACE.
015100     02 RE-MARK             PIC X(61).
015200 01  TEST-COMPUTED.
015300   02 FILLER  PIC X(30)  VALUE SPACE.
015400   02 FILLER  PIC X(17)  VALUE "      COMPUTED =".
015500   02 COMPUTED-X.
015600     03 COMPUTED-A    PIC X(20)  VALUE SPACE.
015700     03 COMPUTED-N    REDEFINES COMPUTED-A PIC -9(9).9(9).
015800     03 COMPUTED-0V18 REDEFINES COMPUTED-A PIC -.9(18).
015900     03 COMPUTED-4V14 REDEFINES COMPUTED-A PIC -9(4).9(14).
016000     03 COMPUTED-14V4 REDEFINES COMPUTED-A PIC -9(14).9(4).
016100     03       CM-18V0 REDEFINES COMPUTED-A.
016200        04 COMPUTED-18V0                   PIC -9(18).
016300        04 FILLER                          PIC X.
016400     03 FILLER PIC X(50) VALUE SPACE.
016500 01  TEST-CORRECT.
016600     02 FILLER PIC X(30) VALUE SPACE.
016700     02 FILLER PIC X(17) VALUE "       CORRECT =".
016800     02 CORRECT-X.
016900     03 CORRECT-A                  PIC X(20) VALUE SPACE.
017000     03 CORRECT-N    REDEFINES CORRECT-A     PIC -9(9).9(9).
017100     03 CORRECT-0V18 REDEFINES CORRECT-A     PIC -.9(18).
017200     03 CORRECT-4V14 REDEFINES CORRECT-A     PIC -9(4).9(14).
017300     03 CORRECT-14V4 REDEFINES CORRECT-A     PIC -9(14).9(4).
017400     03      CR-18V0 REDEFINES CORRECT-A.
017500         04 CORRECT-18V0                     PIC -9(18).
017600         04 FILLER                           PIC X.
017700     03 FILLER PIC X(2) VALUE SPACE.
017800     03 COR-ANSI-REFERENCE             PIC X(48) VALUE SPACE.
017900 01  CCVS-C-1.
018000     02 FILLER  PIC IS X(4)     VALUE SPACE.
018100     02 FILLER  PIC IS X(98)    VALUE IS "FEATURE               PA
018200-    "SS  PARAGRAPH-NAME
018300-    "       REMARKS".
018400     02 FILLER           PIC X(17)    VALUE SPACE.
018500 01  CCVS-C-2.
018600     02 FILLER           PIC XXXX     VALUE SPACE.
018700     02 FILLER           PIC X(6)     VALUE "TESTED".
018800     02 FILLER           PIC X(16)    VALUE SPACE.
018900     02 FILLER           PIC X(4)     VALUE "FAIL".
019000     02 FILLER           PIC X(90)    VALUE SPACE.
019100 01  REC-SKL-SUB       PIC 9(2)     VALUE ZERO.
019200 01  REC-CT            PIC 99       VALUE ZERO.
019300 01  DELETE-COUNTER    PIC 999      VALUE ZERO.
019400 01  ERROR-COUNTER     PIC 999      VALUE ZERO.
019500 01  INSPECT-COUNTER   PIC 999      VALUE ZERO.
019600 01  PASS-COUNTER      PIC 999      VALUE ZERO.
019700 01  TOTAL-ERROR       PIC 999      VALUE ZERO.
019800 01  ERROR-HOLD        PIC 999      VALUE ZERO.
019900 01  DUMMY-HOLD        PIC X(120)   VALUE SPACE.
020000 01  RECORD-COUNT      PIC 9(5)     VALUE ZERO.
020100 01  ANSI-REFERENCE    PIC X(48)    VALUE SPACES.
020200 01  CCVS-H-1.
020300     02  FILLER          PIC X(39)    VALUE SPACES.
020400     02  FILLER          PIC X(42)    VALUE
020500     "OFFICIAL COBOL COMPILER VALIDATION SYSTEM".
020600     02  FILLER          PIC X(39)    VALUE SPACES.
020700 01  CCVS-H-2A.
020800   02  FILLER            PIC X(40)  VALUE SPACE.
020900   02  FILLER            PIC X(7)   VALUE "CCVS85 ".
021000   02  FILLER            PIC XXXX   VALUE
021100     "4.2 ".
021200   02  FILLER            PIC X(28)  VALUE
021300            " COPY - NOT FOR DISTRIBUTION".
021400   02  FILLER            PIC X(41)  VALUE SPACE.
021500*
021600 01  CCVS-H-2B.
021700   02  FILLER            PIC X(15)  VALUE "TEST RESULT OF ".
021800   02  TEST-ID           PIC X(9).
021900   02  FILLER            PIC X(4)   VALUE " IN ".
022000   02  FILLER            PIC X(12)  VALUE
022100     " HIGH       ".
022200   02  FILLER            PIC X(22)  VALUE
022300            " LEVEL VALIDATION FOR ".
022400   02  FILLER            PIC X(58)  VALUE
022500     "ON-SITE VALIDATION, NATIONAL INSTITUTE OF STD & TECH.     ".
022600 01  CCVS-H-3.
022700     02  FILLER          PIC X(34)  VALUE
022800            " FOR OFFICIAL USE ONLY    ".
022900     02  FILLER          PIC X(58)  VALUE
023000     "COBOL 85 VERSION 4.2, Apr  1993 SSVG                      ".
023100     02  FILLER          PIC X(28)  VALUE
023200            "  COPYRIGHT   1985,1986 ".
023300 01  CCVS-E-1.
023400     02 FILLER           PIC X(52)  VALUE SPACE.
023500     02 FILLER  PIC X(14) VALUE IS "END OF TEST-  ".
023600     02 ID-AGAIN         PIC X(9).
023700     02 FILLER           PIC X(45)  VALUE SPACES.
023800 01  CCVS-E-2.
023900     02  FILLER          PIC X(31)  VALUE SPACE.
024000     02  FILLER          PIC X(21)  VALUE SPACE.
024100     02  CCVS-E-2-2.
024200         03 ERROR-TOTAL    PIC XXX    VALUE SPACE.
024300         03 FILLER         PIC X      VALUE SPACE.
024400         03 ENDER-DESC     PIC X(44)  VALUE
024500            "ERRORS ENCOUNTERED".
024600 01  CCVS-E-3.
024700     02  FILLER          PIC X(22)  VALUE
024800            " FOR OFFICIAL USE ONLY".
024900     02  FILLER          PIC X(12)  VALUE SPACE.
025000     02  FILLER          PIC X(58)  VALUE
025100     "ON-SITE VALIDATION, NATIONAL INSTITUTE OF STD & TECH.     ".
025200     02  FILLER          PIC X(8)   VALUE SPACE.
025300     02  FILLER          PIC X(20)  VALUE
025400             " COPYRIGHT 1985,1986".
025500 01  CCVS-E-4.
025600     02 CCVS-E-4-1       PIC XXX    VALUE SPACE.
025700     02 FILLER           PIC X(4)   VALUE " OF ".
025800     02 CCVS-E-4-2       PIC XXX    VALUE SPACE.
025900     02 FILLER           PIC X(40)  VALUE
026000      "  TESTS WERE EXECUTED SUCCESSFULLY".
026100 01  XXINFO.
026200     02 FILLER           PIC X(19)  VALUE "*** INFORMATION ***".
026300     02 INFO-TEXT.
026400       04 FILLER             PIC X(8)   VALUE SPACE.
026500       04 XXCOMPUTED         PIC X(20).
026600       04 FILLER             PIC X(5)   VALUE SPACE.
026700       04 XXCORRECT          PIC X(20).
026800     02 INF-ANSI-REFERENCE PIC X(48).
026900 01  HYPHEN-LINE.
027000     02 FILLER  PIC IS X VALUE IS SPACE.
027100     02 FILLER  PIC IS X(65)    VALUE IS "************************
027200-    "*****************************************".
027300     02 FILLER  PIC IS X(54)    VALUE IS "************************
027400-    "******************************".
027500 01  CCVS-PGM-ID  PIC X(9)   VALUE
027600     "SQ211A".
027700*
027800 PROCEDURE DIVISION.
027900 CCVS1 SECTION.
028000 OPEN-FILES.
028100     OPEN    OUTPUT PRINT-FILE.
028200     MOVE    CCVS-PGM-ID TO TEST-ID.
028300     MOVE    CCVS-PGM-ID TO ID-AGAIN.
028400     MOVE    SPACE TO TEST-RESULTS.
028500     PERFORM HEAD-ROUTINE THRU COLUMN-NAMES-ROUTINE.
028600     MOVE    ZERO TO REC-SKEL-SUB.
028700     PERFORM CCVS-INIT-FILE 10 TIMES.
028800     GO TO CCVS1-EXIT.
028900*
029000 CCVS-INIT-FILE.
029100     ADD     1 TO REC-SKL-SUB.
029200     MOVE    FILE-RECORD-INFO-SKELETON TO
029300                  FILE-RECORD-INFO (REC-SKL-SUB).
029400*
029500 CLOSE-FILES.
029600     PERFORM END-ROUTINE THRU END-ROUTINE-13.
029700     CLOSE   PRINT-FILE.
029800 TERMINATE-CCVS.
029900     STOP    RUN.
030000*
030100 INSPT.
030200     MOVE   "INSPT" TO P-OR-F.
030300     ADD     1 TO INSPECT-COUNTER.
030400     PERFORM PRINT-DETAIL.
030500
030600 PASS.
030700     MOVE   "PASS " TO P-OR-F.
030800     ADD     1 TO PASS-COUNTER.
030900     PERFORM PRINT-DETAIL.
031000*
031100 FAIL.
031200     MOVE   "FAIL*" TO P-OR-F.
031300     ADD     1 TO ERROR-COUNTER.
031400     PERFORM PRINT-DETAIL.
031500*
031600 DE-LETE.
031700     MOVE   "****TEST DELETED****" TO RE-MARK.
031800     MOVE   "*****" TO P-OR-F.
031900     ADD     1 TO DELETE-COUNTER.
032000     PERFORM PRINT-DETAIL.
032100*
032200 PRINT-DETAIL.
032300     IF REC-CT NOT EQUAL TO ZERO
032400         MOVE   "." TO PARDOT-X
032500         MOVE    REC-CT TO DOTVALUE.
032600     MOVE    TEST-RESULTS TO PRINT-REC.
032700     PERFORM WRITE-LINE.
032800     IF P-OR-F EQUAL TO "FAIL*"
032900         PERFORM WRITE-LINE
033000         PERFORM FAIL-ROUTINE THRU FAIL-ROUTINE-EX
033100     ELSE
033200         PERFORM BAIL-OUT THRU BAIL-OUT-EX.
033300     MOVE    SPACE TO P-OR-F.
033400     MOVE    SPACE TO COMPUTED-X.
033500     MOVE    SPACE TO CORRECT-X.
033600     IF REC-CT EQUAL TO ZERO  MOVE SPACE TO PAR-NAME.
033700     MOVE    SPACE TO RE-MARK.
033800*
033900 HEAD-ROUTINE.
034000     MOVE CCVS-H-1  TO DUMMY-RECORD. PERFORM WRITE-LINE 2 TIMES.
034100     MOVE CCVS-H-2A TO DUMMY-RECORD. PERFORM WRITE-LINE 2 TIMES.
034200     MOVE CCVS-H-2B TO DUMMY-RECORD. PERFORM WRITE-LINE 3 TIMES.
034300     MOVE CCVS-H-3  TO DUMMY-RECORD. PERFORM WRITE-LINE 3 TIMES.
034400 COLUMN-NAMES-ROUTINE.
034500     MOVE CCVS-C-1 TO DUMMY-RECORD. PERFORM WRITE-LINE.
034600     MOVE CCVS-C-2 TO DUMMY-RECORD. PERFORM WRITE-LINE 2 TIMES.
034700     MOVE HYPHEN-LINE TO DUMMY-RECORD. PERFORM WRITE-LINE.
034800 END-ROUTINE.
034900     MOVE    HYPHEN-LINE TO DUMMY-RECORD.
035000     PERFORM WRITE-LINE 5 TIMES.
035100 END-RTN-EXIT.
035200     MOVE    CCVS-E-1 TO DUMMY-RECORD.
035300     PERFORM WRITE-LINE 2 TIMES.
035400*
035500 END-ROUTINE-1.
035600     ADD     ERROR-COUNTER   TO ERROR-HOLD
035700     ADD     INSPECT-COUNTER TO ERROR-HOLD.
035800     ADD     DELETE-COUNTER  TO ERROR-HOLD.
035900     ADD     PASS-COUNTER    TO ERROR-HOLD.
036000     MOVE    PASS-COUNTER    TO CCVS-E-4-1.
036100     MOVE    ERROR-HOLD      TO CCVS-E-4-2.
036200     MOVE    CCVS-E-4        TO CCVS-E-2-2.
036300     MOVE    CCVS-E-2        TO DUMMY-RECORD
036400     PERFORM WRITE-LINE.
036500     MOVE   "TEST(S) FAILED" TO ENDER-DESC.
036600     IF ERROR-COUNTER IS EQUAL TO ZERO
036700         MOVE   "NO " TO ERROR-TOTAL
036800     ELSE
036900         MOVE    ERROR-COUNTER TO ERROR-TOTAL.
037000     MOVE    CCVS-E-2 TO DUMMY-RECORD.
037100     PERFORM WRITE-LINE.
037200 END-ROUTINE-13.
037300     IF DELETE-COUNTER IS EQUAL TO ZERO
037400         MOVE   "NO " TO ERROR-TOTAL
037500     ELSE
037600         MOVE    DELETE-COUNTER TO ERROR-TOTAL.
037700     MOVE   "TEST(S) DELETED     " TO ENDER-DESC.
037800     MOVE    CCVS-E-2 TO DUMMY-RECORD.
037900     PERFORM WRITE-LINE.
038000     IF INSPECT-COUNTER EQUAL TO ZERO
038100         MOVE   "NO " TO ERROR-TOTAL
038200     ELSE
038300         MOVE    INSPECT-COUNTER TO ERROR-TOTAL.
038400     MOVE   "TEST(S) REQUIRE INSPECTION" TO ENDER-DESC.
038500     MOVE    CCVS-E-2 TO DUMMY-RECORD. PERFORM WRITE-LINE.
038600     MOVE    CCVS-E-3 TO DUMMY-RECORD. PERFORM WRITE-LINE.
038700*
038800 WRITE-LINE.
038900     ADD     1 TO RECORD-COUNT.
039000Y    IF RECORD-COUNT GREATER 50
039100Y        MOVE  DUMMY-RECORD TO DUMMY-HOLD
039200Y        MOVE  SPACE TO DUMMY-RECORD
039300Y        WRITE DUMMY-RECORD AFTER ADVANCING PAGE
039400Y        MOVE  CCVS-C-1 TO DUMMY-RECORD PERFORM WRT-LN
039500Y        MOVE  CCVS-C-2 TO DUMMY-RECORD PERFORM WRT-LN 2 TIMES
039600Y        MOVE  HYPHEN-LINE TO DUMMY-RECORD PERFORM WRT-LN
039700Y        MOVE  DUMMY-HOLD TO DUMMY-RECORD
039800Y        MOVE  ZERO TO RECORD-COUNT.
039900     PERFORM WRT-LN.
040000*
040100 WRT-LN.
040200     WRITE   DUMMY-RECORD AFTER ADVANCING 1 LINES.
040300     MOVE    SPACE TO DUMMY-RECORD.
040400 BLANK-LINE-PRINT.
040500     PERFORM WRT-LN.
040600 FAIL-ROUTINE.
040700     IF COMPUTED-X NOT EQUAL TO SPACE GO TO FAIL-ROUTINE-WRITE.
040800     IF CORRECT-X NOT EQUAL TO SPACE GO TO FAIL-ROUTINE-WRITE.
040900     MOVE    ANSI-REFERENCE TO INF-ANSI-REFERENCE.
041000     MOVE   "NO FURTHER INFORMATION, SEE PROGRAM." TO INFO-TEXT.
041100     MOVE    XXINFO TO DUMMY-RECORD.
041200     PERFORM WRITE-LINE 2 TIMES.
041300     MOVE    SPACES TO INF-ANSI-REFERENCE.
041400     GO TO   FAIL-ROUTINE-EX.
041500 FAIL-ROUTINE-WRITE.
041600     MOVE    TEST-COMPUTED  TO PRINT-REC
041700     PERFORM WRITE-LINE
041800     MOVE    ANSI-REFERENCE TO COR-ANSI-REFERENCE.
041900     MOVE    TEST-CORRECT   TO PRINT-REC
042000     PERFORM WRITE-LINE 2 TIMES.
042100     MOVE    SPACES         TO COR-ANSI-REFERENCE.
042200 FAIL-ROUTINE-EX.
042300     EXIT.
042400 BAIL-OUT.
042500     IF COMPUTED-A NOT EQUAL TO SPACE GO TO BAIL-OUT-WRITE.
042600     IF CORRECT-A EQUAL TO SPACE GO TO BAIL-OUT-EX.
042700 BAIL-OUT-WRITE.
042800     MOVE    CORRECT-A      TO XXCORRECT.
042900     MOVE    COMPUTED-A     TO XXCOMPUTED.
043000     MOVE    ANSI-REFERENCE TO INF-ANSI-REFERENCE.
043100     MOVE    XXINFO TO DUMMY-RECORD.
043200     PERFORM WRITE-LINE 2 TIMES.
043300     MOVE    SPACES TO INF-ANSI-REFERENCE.
043400 BAIL-OUT-EX.
043500     EXIT.
043600 CCVS1-EXIT.
043700     EXIT.
043800*
043900****************************************************************
044000*                                                              *
044100*    THIS POINT MARKS THE END OF THE CCVS MONITOR ROUTINES AND *
044200*    THE START OF THE TESTS OF SPECIFIC COBOL FEATURES.        *
044300*                                                              *
044400****************************************************************
044500*
044600 SECT-SQ211A-0001 SECTION.
044700 WRITE-INIT-GF-01.
044800*
044900*        THIS TEST CREATES FILE SQ-FS1 AND CLOSES IT WITH LOCK.
045000*        FIRST IT SETS UP A SKELETON RECORD IN WORKING STORAGE.
045100*
045200     MOVE "SQ-FS1"     TO XFILE-NAME (1).
045300     MOVE "R1-F-G"     TO XRECORD-NAME (1).
045400     MOVE  CCVS-PGM-ID TO XPROGRAM-NAME (1).
045500     MOVE 120          TO XRECORD-LENGTH (1).
045600     MOVE "RC"         TO CHARS-OR-RECORDS (1).
045700     MOVE 1            TO XBLOCK-SIZE (1).
045800     MOVE 1            TO RECORDS-IN-FILE (1).
045900     MOVE "SQ"         TO XFILE-ORGANIZATION (1).
046000     MOVE "S"          TO XLABEL-TYPE (1).
046100     MOVE 1            TO XRECORD-NUMBER (1).
046200*
046300 WRITE-OPEN-01.
046400     MOVE    1 TO REC-CT.
046500     MOVE   "WRITE-OPEN-01" TO PAR-NAME.
046600     MOVE   "OPEN OUTPUT - NEW FILE" TO FEATURE.
046700     MOVE   "**" TO SQ-FS1-STATUS.
046800     OPEN    OUTPUT SQ-FS1.
046900     IF SQ-FS1-STATUS = "00"
047000         PERFORM PASS
047100     ELSE
047200         MOVE   "00" TO CORRECT-A
047300         MOVE    SQ-FS1-STATUS TO COMPUTED-A
047400         MOVE   "FILE OPEN FAILED, FURTHER TESTS ABANDONED"
047500                   TO RE-MARK
047600         MOVE   "VII-3, VII-40, FILE STATUS" TO ANSI-REFERENCE
047700         PERFORM FAIL
047800         GO TO   CCVS-EXIT
047900     END-IF.
048000*
048100*        WRITE A SINGLE RECORD TO THE FILE
048200*
048300 WRITE-INIT-01.
048400     MOVE    1 TO REC-CT.
048500     MOVE   "WRITE-TEST-01" TO PAR-NAME
048600     MOVE   "SEQUENTIAL WRITE" TO FEATURE.
048700 WRITE-TEST-01-01.
048800     MOVE    FILE-RECORD-INFO-P1-120 (1) TO SQ-FS1R1-F-G-120.
048900     WRITE   SQ-FS1R1-F-G-120.
049000     IF SQ-FS1-STATUS = "00"
049100         PERFORM PASS
049200     ELSE
049300         MOVE   "00" TO CORRECT-A
049400         MOVE    SQ-FS1-STATUS TO COMPUTED-A
049500         MOVE   "WRITING FAILED, FURTHER TESTS ABANDONED"
049600                   TO RE-MARK
049700         MOVE   "VII-3, VII-53, FILE STATUS" TO ANSI-REFERENCE
049800         PERFORM FAIL
049900         GO TO   CCVS-EXIT
050000     END-IF.
050100*
050200*        CLOSE THE FILE WITH LOCK, SO IT SHOULD NOT REOPEN
050300*
050400 CLOSE-INIT-01.
050500     MOVE    1 TO REC-CT.
050600     MOVE   "CLOSE-TEST-01"   TO PAR-NAME.
050700     MOVE   "CLOSE WITH LOCK" TO FEATURE.
050800     MOVE   "**" TO SQ-FS1-STATUS.
050900 CLOSE-TEST-01.
051000     CLOSE   SQ-FS1 WITH LOCK.
051100     IF SQ-FS1-STATUS = "00"
051200         PERFORM PASS
051300     ELSE
051400         MOVE   "00" TO CORRECT-A
051500         MOVE    SQ-FS1-STATUS TO COMPUTED-A
051600         MOVE   "CLOSE WITH LOCK FAILED, FURTHER TESTS ABANDONED"
051700                   TO RE-MARK
051800         MOVE   "VII-3, VII-38, FILE STATUS" TO ANSI-REFERENCE
051900         PERFORM FAIL
052000         GO TO   CCVS-EXIT
052100     END-IF.
052200*
052300*        HAVING LOCKED THE FILE, WE NOW TRY TO REOPEN IT.
052400*        THE TEST PASSES IF THE FILE CANNOT BE OPENED AND
052500*        THE APPROPRIATE I-O STATUS VALUE IS RETURNED.
052600*        AN IMPLEMENTATION MAY TERMINATE EXECUTION OF THE
052700*        PROGRAM ON EXIT FROM THE DECLARATIVE ASSOCIATED
052800*        WITH THE FILE, OR MAY RETURN CONTROL TO THE
052900*        STATEMENT FOLLOWING THE OPEN STATEMENT.
053000*
053100 OPEN-INIT-01.
053200*
053300     MOVE   "OPEN AFTER LOCK" TO FEATURE.
053400     MOVE   "**" TO SQ-FS1-STATUS.
053500 OPEN-TEST-01.
053600     MOVE    1 TO REC-CT.
053700     MOVE   "OPEN-TEST-01"    TO PAR-NAME.
053800     MOVE "ABNORMAL TERMINATION AT THIS POINT IS ACCEPTABLE"
053900                 TO DUMMY-RECORD.
054000     PERFORM WRITE-LINE 3 TIMES.
054100     OPEN INPUT SQ-FS1.
054200     IF SQ-FS1-STATUS = "38"
054300         PERFORM PASS
054400     ELSE
054500         MOVE SQ-FS1-STATUS TO COMPUTED-A
054600         MOVE    "38"       TO CORRECT-A
054700         MOVE "STATUS OF OPEN AFTER CLOSE WITH LOCK INCORRECT"
054800                 TO RE-MARK
054900         PERFORM FAIL
055000     END-IF.
055100*
055200 CCVS-EXIT SECTION.
055300 CCVS-999999.
055400     GO TO CLOSE-FILES.
