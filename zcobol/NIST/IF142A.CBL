000100 IDENTIFICATION DIVISION.
000200 PROGRAM-ID.
000300     IF142A.
000400
000500***********************************************************
000600*                                                         *
000700* This program forms part of the CCVS85 COBOL Test Suite. *
000800* It contains tests for the Intrinsic Function            *
000900* WHEN-COMPILED.                                          *
001000*                                                         *
001100***********************************************************
001200 ENVIRONMENT DIVISION.
001300 CONFIGURATION SECTION.
001400 SOURCE-COMPUTER.
001500     XXXXX082.
001600 OBJECT-COMPUTER.
001700     XXXXX083.
001800 INPUT-OUTPUT SECTION.
001900 FILE-CONTROL.
002000     SELECT PRINT-FILE ASSIGN TO
002100     XXXXX055.
002200 DATA DIVISION.
002300 FILE SECTION.
002400 FD  PRINT-FILE.
002500 01  PRINT-REC PICTURE X(120).
002600 01  DUMMY-RECORD PICTURE X(120).
002700 WORKING-STORAGE SECTION.
002800***********************************************************
002900* Variables specific to the Intrinsic Function Test IF142A*
003000***********************************************************
003100 01  TEMP1                       PIC X(21).
003200 01  WS-DATE.
003300     02  WS-YEAR                 PIC 9999.
003400              88 CON-YEAR        VALUE 1990 THRU 9999.
003500     02  WS-MONTH                PIC 99.
003600              88 CON-MONTH       VALUE 01 THRU 12.
003700     02  WS-DAY                  PIC 99.
003800              88 CON-DAY         VALUE 01 THRU 31.
003900     02  WS-HOUR                 PIC 99.
004000              88 CON-HOUR        VALUE 00 THRU 23.
004100     02  WS-MIN                  PIC 99.
004200              88 CON-MIN         VALUE 00 THRU 59.
004300     02  WS-SECOND               PIC 99.
004400              88 CON-SEC         VALUE 00 THRU 59.
004500     02  WS-HUNDSEC              PIC 99.
004600              88 CON-HUNDSEC     VALUE 00 THRU 99.
004700     02  WS-GREENW               PIC X.
004800              88 CON-GREENW      VALUE "-", "+", "0".
004900     02  WS-OFFSET               PIC 99.
005000              88 CON-OFFSET      VALUE 00 THRU 13.
005100*
005200**********************************************************
005300*
005400 01  TEST-RESULTS.
005500     02 FILLER                   PIC X      VALUE SPACE.
005600     02 FEATURE                  PIC X(20)  VALUE SPACE.
005700     02 FILLER                   PIC X      VALUE SPACE.
005800     02 P-OR-F                   PIC X(5)   VALUE SPACE.
005900     02 FILLER                   PIC X      VALUE SPACE.
006000     02  PAR-NAME.
006100       03 FILLER                 PIC X(19)  VALUE SPACE.
006200       03  PARDOT-X              PIC X      VALUE SPACE.
006300       03 DOTVALUE               PIC 99     VALUE ZERO.
006400     02 FILLER                   PIC X(8)   VALUE SPACE.
006500     02 RE-MARK                  PIC X(61).
006600 01  TEST-COMPUTED.
006700     02 FILLER                   PIC X(30)  VALUE SPACE.
006800     02 FILLER                   PIC X(17)  VALUE
006900            "       COMPUTED=".
007000     02 COMPUTED-X.
007100     03 COMPUTED-A               PIC X(20)  VALUE SPACE.
007200     03 COMPUTED-N               REDEFINES COMPUTED-A
007300                                 PIC -9(9).9(9).
007400     03 COMPUTED-0V18 REDEFINES COMPUTED-A   PIC -.9(18).
007500     03 COMPUTED-4V14 REDEFINES COMPUTED-A   PIC -9(4).9(14).
007600     03 COMPUTED-14V4 REDEFINES COMPUTED-A   PIC -9(14).9(4).
007700     03       CM-18V0 REDEFINES COMPUTED-A.
007800         04 COMPUTED-18V0                    PIC -9(18).
007900         04 FILLER                           PIC X.
008000     03 FILLER PIC X(50) VALUE SPACE.
008100 01  TEST-CORRECT.
008200     02 FILLER PIC X(30) VALUE SPACE.
008300     02 FILLER PIC X(17) VALUE "       CORRECT =".
008400     02 CORRECT-X.
008500     03 CORRECT-A                  PIC X(20) VALUE SPACE.
008600     03 CORRECT-N    REDEFINES CORRECT-A     PIC -9(9).9(9).
008700     03 CORRECT-0V18 REDEFINES CORRECT-A     PIC -.9(18).
008800     03 CORRECT-4V14 REDEFINES CORRECT-A     PIC -9(4).9(14).
008900     03 CORRECT-14V4 REDEFINES CORRECT-A     PIC -9(14).9(4).
009000     03      CR-18V0 REDEFINES CORRECT-A.
009100         04 CORRECT-18V0                     PIC -9(18).
009200         04 FILLER                           PIC X.
009300     03 FILLER PIC X(2) VALUE SPACE.
009400     03 COR-ANSI-REFERENCE             PIC X(48) VALUE SPACE.
009500 01  CCVS-C-1.
009600     02 FILLER  PIC IS X(99)    VALUE IS " FEATURE              PA
009700-    "SS  PARAGRAPH-NAME
009800-    "       REMARKS".
009900     02 FILLER                     PIC X(20)    VALUE SPACE.
010000 01  CCVS-C-2.
010100     02 FILLER                     PIC X        VALUE SPACE.
010200     02 FILLER                     PIC X(6)     VALUE "TESTED".
010300     02 FILLER                     PIC X(15)    VALUE SPACE.
010400     02 FILLER                     PIC X(4)     VALUE "FAIL".
010500     02 FILLER                     PIC X(94)    VALUE SPACE.
010600 01  REC-SKL-SUB                   PIC 9(2)     VALUE ZERO.
010700 01  REC-CT                        PIC 99       VALUE ZERO.
010800 01  DELETE-COUNTER                PIC 999      VALUE ZERO.
010900 01  ERROR-COUNTER                 PIC 999      VALUE ZERO.
011000 01  INSPECT-COUNTER               PIC 999      VALUE ZERO.
011100 01  PASS-COUNTER                  PIC 999      VALUE ZERO.
011200 01  TOTAL-ERROR                   PIC 999      VALUE ZERO.
011300 01  ERROR-HOLD                    PIC 999      VALUE ZERO.
011400 01  DUMMY-HOLD                    PIC X(120)   VALUE SPACE.
011500 01  RECORD-COUNT                  PIC 9(5)     VALUE ZERO.
011600 01  ANSI-REFERENCE                PIC X(48)    VALUE SPACES.
011700 01  CCVS-H-1.
011800     02  FILLER                    PIC X(39)    VALUE SPACES.
011900     02  FILLER                    PIC X(42)    VALUE
012000     "OFFICIAL COBOL COMPILER VALIDATION SYSTEM".
012100     02  FILLER                    PIC X(39)    VALUE SPACES.
012200 01  CCVS-H-2A.
012300   02  FILLER                        PIC X(40)  VALUE SPACE.
012400   02  FILLER                        PIC X(7)   VALUE "CCVS85 ".
012500   02  FILLER                        PIC XXXX   VALUE
012600     "4.2 ".
012700   02  FILLER                        PIC X(28)  VALUE
012800            " COPY - NOT FOR DISTRIBUTION".
012900   02  FILLER                        PIC X(41)  VALUE SPACE.
013000
013100 01  CCVS-H-2B.
013200   02  FILLER                        PIC X(15)  VALUE
013300            "TEST RESULT OF ".
013400   02  TEST-ID                       PIC X(9).
013500   02  FILLER                        PIC X(4)   VALUE
013600            " IN ".
013700   02  FILLER                        PIC X(12)  VALUE
013800     " HIGH       ".
013900   02  FILLER                        PIC X(22)  VALUE
014000            " LEVEL VALIDATION FOR ".
014100   02  FILLER                        PIC X(58)  VALUE
014200     "ON-SITE VALIDATION, NATIONAL INSTITUTE OF STD & TECH.     ".
014300 01  CCVS-H-3.
014400     02  FILLER                      PIC X(34)  VALUE
014500            " FOR OFFICIAL USE ONLY    ".
014600     02  FILLER                      PIC X(58)  VALUE
014700     "COBOL 85 VERSION 4.2, Apr  1993 SSVG                      ".
014800     02  FILLER                      PIC X(28)  VALUE
014900            "  COPYRIGHT   1985 ".
015000 01  CCVS-E-1.
015100     02 FILLER                       PIC X(52)  VALUE SPACE.
015200     02 FILLER  PIC X(14) VALUE IS "END OF TEST-  ".
015300     02 ID-AGAIN                     PIC X(9).
015400     02 FILLER                       PIC X(45)  VALUE SPACES.
015500 01  CCVS-E-2.
015600     02  FILLER                      PIC X(31)  VALUE SPACE.
015700     02  FILLER                      PIC X(21)  VALUE SPACE.
015800     02 CCVS-E-2-2.
015900         03 ERROR-TOTAL              PIC XXX    VALUE SPACE.
016000         03 FILLER                   PIC X      VALUE SPACE.
016100         03 ENDER-DESC               PIC X(44)  VALUE
016200            "ERRORS ENCOUNTERED".
016300 01  CCVS-E-3.
016400     02  FILLER                      PIC X(22)  VALUE
016500            " FOR OFFICIAL USE ONLY".
016600     02  FILLER                      PIC X(12)  VALUE SPACE.
016700     02  FILLER                      PIC X(58)  VALUE
016800     "ON-SITE VALIDATION, NATIONAL INSTITUTE OF STD & TECH.     ".
016900     02  FILLER                      PIC X(13)  VALUE SPACE.
017000     02 FILLER                       PIC X(15)  VALUE
017100             " COPYRIGHT 1985".
017200 01  CCVS-E-4.
017300     02 CCVS-E-4-1                   PIC XXX    VALUE SPACE.
017400     02 FILLER                       PIC X(4)   VALUE " OF ".
017500     02 CCVS-E-4-2                   PIC XXX    VALUE SPACE.
017600     02 FILLER                       PIC X(40)  VALUE
017700      "  TESTS WERE EXECUTED SUCCESSFULLY".
017800 01  XXINFO.
017900     02 FILLER                       PIC X(19)  VALUE
018000            "*** INFORMATION ***".
018100     02 INFO-TEXT.
018200       04 FILLER                     PIC X(8)   VALUE SPACE.
018300       04 XXCOMPUTED                 PIC X(20).
018400       04 FILLER                     PIC X(5)   VALUE SPACE.
018500       04 XXCORRECT                  PIC X(20).
018600     02 INF-ANSI-REFERENCE           PIC X(48).
018700 01  HYPHEN-LINE.
018800     02 FILLER  PIC IS X VALUE IS SPACE.
018900     02 FILLER  PIC IS X(65)    VALUE IS "************************
019000-    "*****************************************".
019100     02 FILLER  PIC IS X(54)    VALUE IS "************************
019200-    "******************************".
019300 01  CCVS-PGM-ID                     PIC X(9)   VALUE
019400     "IF142A".
019500 PROCEDURE DIVISION.
019600 CCVS1 SECTION.
019700 OPEN-FILES.
019800     OPEN     OUTPUT PRINT-FILE.
019900     MOVE CCVS-PGM-ID TO TEST-ID. MOVE CCVS-PGM-ID TO ID-AGAIN.
020000     MOVE    SPACE TO TEST-RESULTS.
020100     PERFORM  HEAD-ROUTINE THRU COLUMN-NAMES-ROUTINE.
020200     GO TO CCVS1-EXIT.
020300 CLOSE-FILES.
020400     PERFORM END-ROUTINE THRU END-ROUTINE-13. CLOSE PRINT-FILE.
020500 TERMINATE-CCVS.
020600     STOP     RUN.
020700 INSPT. MOVE "INSPT" TO P-OR-F. ADD 1 TO INSPECT-COUNTER.
020800 PASS.  MOVE "PASS " TO P-OR-F.  ADD 1 TO PASS-COUNTER.
020900 FAIL.  MOVE "FAIL*" TO P-OR-F.  ADD 1 TO ERROR-COUNTER.
021000 DE-LETE.  MOVE "*****" TO P-OR-F.  ADD 1 TO DELETE-COUNTER.
021100     MOVE "****TEST DELETED****" TO RE-MARK.
021200 PRINT-DETAIL.
021300     IF REC-CT NOT EQUAL TO ZERO
021400             MOVE "." TO PARDOT-X
021500             MOVE REC-CT TO DOTVALUE.
021600     MOVE     TEST-RESULTS TO PRINT-REC. PERFORM WRITE-LINE.
021700     IF P-OR-F EQUAL TO "FAIL*"  PERFORM WRITE-LINE
021800        PERFORM FAIL-ROUTINE THRU FAIL-ROUTINE-EX
021900          ELSE PERFORM BAIL-OUT THRU BAIL-OUT-EX.
022000     MOVE SPACE TO P-OR-F. MOVE SPACE TO COMPUTED-X.
022100     MOVE SPACE TO CORRECT-X.
022200     IF     REC-CT EQUAL TO ZERO  MOVE SPACE TO PAR-NAME.
022300     MOVE     SPACE TO RE-MARK.
022400 HEAD-ROUTINE.
022500     MOVE CCVS-H-1  TO DUMMY-RECORD. PERFORM WRITE-LINE 2 TIMES.
022600     MOVE CCVS-H-2A TO DUMMY-RECORD. PERFORM WRITE-LINE 2 TIMES.
022700     MOVE CCVS-H-2B TO DUMMY-RECORD. PERFORM WRITE-LINE 3 TIMES.
022800     MOVE CCVS-H-3  TO DUMMY-RECORD. PERFORM WRITE-LINE 3 TIMES.
022900 COLUMN-NAMES-ROUTINE.
023000     MOVE CCVS-C-1 TO DUMMY-RECORD. PERFORM WRITE-LINE.
023100     MOVE CCVS-C-2 TO DUMMY-RECORD. PERFORM WRITE-LINE 2 TIMES.
023200     MOVE HYPHEN-LINE TO DUMMY-RECORD. PERFORM WRITE-LINE.
023300 END-ROUTINE.
023400     MOVE HYPHEN-LINE TO DUMMY-RECORD. PERFORM WRITE-LINE 5
023500     TIMES.
023600 END-RTN-EXIT.
023700     MOVE CCVS-E-1 TO DUMMY-RECORD. PERFORM WRITE-LINE 2 TIMES.
023800 END-ROUTINE-1.
023900      ADD ERROR-COUNTER TO ERROR-HOLD ADD INSPECT-COUNTER TO
024000      ERROR-HOLD. ADD DELETE-COUNTER TO ERROR-HOLD.
024100      ADD PASS-COUNTER TO ERROR-HOLD.
024200      MOVE PASS-COUNTER TO CCVS-E-4-1.
024300      MOVE ERROR-HOLD TO CCVS-E-4-2.
024400      MOVE CCVS-E-4 TO CCVS-E-2-2.
024500      MOVE CCVS-E-2 TO DUMMY-RECORD PERFORM WRITE-LINE.
024600  END-ROUTINE-12.
024700      MOVE "TEST(S) FAILED" TO ENDER-DESC.
024800     IF       ERROR-COUNTER IS EQUAL TO ZERO
024900         MOVE "NO " TO ERROR-TOTAL
025000         ELSE
025100         MOVE ERROR-COUNTER TO ERROR-TOTAL.
025200     MOVE     CCVS-E-2 TO DUMMY-RECORD.
025300     PERFORM WRITE-LINE.
025400 END-ROUTINE-13.
025500     IF DELETE-COUNTER IS EQUAL TO ZERO
025600         MOVE "NO " TO ERROR-TOTAL  ELSE
025700         MOVE DELETE-COUNTER TO ERROR-TOTAL.
025800     MOVE "TEST(S) DELETED     " TO ENDER-DESC.
025900     MOVE CCVS-E-2 TO DUMMY-RECORD. PERFORM WRITE-LINE.
026000      IF   INSPECT-COUNTER EQUAL TO ZERO
026100          MOVE "NO " TO ERROR-TOTAL
026200      ELSE MOVE INSPECT-COUNTER TO ERROR-TOTAL.
026300      MOVE "TEST(S) REQUIRE INSPECTION" TO ENDER-DESC.
026400      MOVE CCVS-E-2 TO DUMMY-RECORD. PERFORM WRITE-LINE.
026500     MOVE CCVS-E-3 TO DUMMY-RECORD. PERFORM WRITE-LINE.
026600 WRITE-LINE.
026700     ADD 1 TO RECORD-COUNT.
026800Y    IF RECORD-COUNT GREATER 42
026900Y        MOVE DUMMY-RECORD TO DUMMY-HOLD
027000Y        MOVE SPACE TO DUMMY-RECORD
027100Y        WRITE DUMMY-RECORD AFTER ADVANCING PAGE
027200Y        MOVE CCVS-H-1  TO DUMMY-RECORD  PERFORM WRT-LN 2 TIMES
027300Y        MOVE CCVS-H-2A TO DUMMY-RECORD  PERFORM WRT-LN 2 TIMES
027400Y        MOVE CCVS-H-2B TO DUMMY-RECORD  PERFORM WRT-LN 3 TIMES
027500Y        MOVE CCVS-H-3  TO DUMMY-RECORD  PERFORM WRT-LN 3 TIMES
027600Y        MOVE CCVS-C-1  TO DUMMY-RECORD  PERFORM WRT-LN
027700Y        MOVE CCVS-C-2  TO DUMMY-RECORD  PERFORM WRT-LN
027800Y        MOVE HYPHEN-LINE TO DUMMY-RECORD PERFORM WRT-LN
027900Y        MOVE DUMMY-HOLD TO DUMMY-RECORD
028000Y        MOVE ZERO TO RECORD-COUNT.
028100     PERFORM WRT-LN.
028200 WRT-LN.
028300     WRITE    DUMMY-RECORD AFTER ADVANCING 1 LINES.
028400     MOVE SPACE TO DUMMY-RECORD.
028500 BLANK-LINE-PRINT.
028600     PERFORM WRT-LN.
028700 FAIL-ROUTINE.
028800     IF     COMPUTED-X NOT EQUAL TO SPACE
028900            GO TO FAIL-ROUTINE-WRITE.
029000     IF     CORRECT-X NOT EQUAL TO SPACE GO TO FAIL-ROUTINE-WRITE.
029100     MOVE   ANSI-REFERENCE TO INF-ANSI-REFERENCE.
029200     MOVE  "NO FURTHER INFORMATION, SEE PROGRAM." TO INFO-TEXT.
029300     MOVE   XXINFO TO DUMMY-RECORD. PERFORM WRITE-LINE 2 TIMES.
029400     MOVE   SPACES TO INF-ANSI-REFERENCE.
029500     GO TO  FAIL-ROUTINE-EX.
029600 FAIL-ROUTINE-WRITE.
029700     MOVE   TEST-COMPUTED TO PRINT-REC PERFORM WRITE-LINE
029800     MOVE   ANSI-REFERENCE TO COR-ANSI-REFERENCE.
029900     MOVE   TEST-CORRECT TO PRINT-REC PERFORM WRITE-LINE 2 TIMES.
030000     MOVE   SPACES TO COR-ANSI-REFERENCE.
030100 FAIL-ROUTINE-EX. EXIT.
030200 BAIL-OUT.
030300     IF     COMPUTED-A NOT EQUAL TO SPACE GO TO BAIL-OUT-WRITE.
030400     IF     CORRECT-A EQUAL TO SPACE GO TO BAIL-OUT-EX.
030500 BAIL-OUT-WRITE.
030600     MOVE CORRECT-A TO XXCORRECT.
030700     MOVE COMPUTED-A TO XXCOMPUTED.
030800     MOVE   ANSI-REFERENCE TO INF-ANSI-REFERENCE.
030900     MOVE   XXINFO TO DUMMY-RECORD. PERFORM WRITE-LINE 2 TIMES.
031000     MOVE   SPACES TO INF-ANSI-REFERENCE.
031100 BAIL-OUT-EX. EXIT.
031200 CCVS1-EXIT.
031300     EXIT.
031400********************************************************
031500*                                                      *
031600*    Intrinsic Function Tests   IF142A - WHEN-COMPILED *
031700*                                                      *
031800********************************************************
031900 SECT-IF142A SECTION.
032000 F-WHENCOMP-INFO.
032100     MOVE     "See ref. A-75 2.46" TO ANSI-REFERENCE.
032200     MOVE     "WHEN-COMPILED"     TO FEATURE.
032300*****************TEST (a) ******************************
032400 F-WHENCOMP-01.
032500     MOVE SPACES TO TEMP1.
032600     MOVE SPACES TO WS-DATE.
032700 F-WHENCOMP-TEST-01.
032800     MOVE FUNCTION WHEN-COMPILED TO TEMP1.
032900     MOVE TEMP1 TO WS-DATE.
033000     IF CON-YEAR     AND
033100        CON-MONTH    AND
033200        CON-DAY      AND
033300        CON-HOUR     AND
033400        CON-MIN      AND
033500        CON-SEC      AND
033600        CON-HUNDSEC  AND
033700        CON-GREENW   AND
033800        CON-OFFSET   THEN
033900                  PERFORM PASS
034000     ELSE
034100                  MOVE TEMP1 TO COMPUTED-A
034200                  MOVE "Date & Time value " TO CORRECT-X
034300                  PERFORM FAIL.
034400     GO TO F-WHENCOMP-WRITE-01.
034500 F-WHENCOMP-DELETE-01.
034600     PERFORM  DE-LETE.
034700     GO TO    F-WHENCOMP-WRITE-01.
034800 F-WHENCOMP-WRITE-01.
034900     MOVE "F-WHENCOMP-01" TO PAR-NAME.
035000     PERFORM  PRINT-DETAIL.
035100*****************TEST (b) ******************************
035200 F-WHENCOMP-TEST-02.
035300     IF FUNCTION WHEN-COMPILED >= TEMP1 THEN
035400                    PERFORM PASS
035500     ELSE
035600                    PERFORM FAIL.
035700     GO TO F-WHENCOMP-WRITE-02.
035800 F-WHENCOMP-DELETE-02.
035900     PERFORM  DE-LETE.
036000     GO TO    F-WHENCOMP-WRITE-02.
036100 F-WHENCOMP-WRITE-02.
036200     MOVE "F-WHENCOMP-02" TO PAR-NAME.
036300     PERFORM  PRINT-DETAIL.
036400*******************END OF TESTS**************************
036500 CCVS-EXIT SECTION.
036600 CCVS-999999.
036700     GO TO CLOSE-FILES.
