@if /I "%1" == "tron" (echo on) else (echo off)
rem demo hello world demo

setlocal
if /I "%1" == "tron" (set z_TraceMode=tron
                      shift /1
              ) else (if /I "%1" == "troff" (set z_TraceMode=troff
                                             shift /1
                                     ) else (set z_TraceMode=)
                      )
set /A z_NestLevel=%z_NestLevel%+1
rem ----- Lvl(%z_NestLevel%) Start %0 %1 %2 %3 %4 %5 %6 %7 %8 %9

rem
rem Maintenance note: this procedure leaves trash behind.
rem after successful execution it should clean up after itself.
rem When a failure occurs these files should be left in place for diagnostic purposes.
rem

SET CICSPATH=cics\vsam
SET PROGRAM=Z390CAT1
CALL bat\MZ390 %z_TraceMode% %CICSPATH%\%PROGRAM% SYSMAC(%CICSPATH%+MAC) SYSCPY(%CICSPATH%+MAC) || GOTO WRONG_ASM
CALL bat\LZ390 %z_TraceMode% %CICSPATH%\%PROGRAM%                                               || GOTO WRONG_ASM

rem
rem BUILD THE VARIABLE ESDS
SET INFILE=%CICSPATH%\MYFILE1V.TXT[RECFM=VT]
SET OUTFILE=%CICSPATH%\Z390CAT1.MYFILE01
CALL bat\EZ390 %z_TraceMode% LINKLIB\REPRO %1     || GOTO WRONG
rem RUN REPRO TO UNLOAD FROM .VES TO .TF2
SET INFILE=%CICSPATH%\Z390CAT1.MYFILE01
SET OUTFILE=%CICSPATH%\MYFILE1V.TF2[RECFM=VT]
CALL bat\EZ390 %z_TraceMode% LINKLIB\REPRO %1     || GOTO WRONG

rem
rem BUILD THE FIXED ESDS
SET INFILE=%CICSPATH%\MYFILE2F.TXT[RECFM=FT]
SET OUTFILE=%CICSPATH%\Z390CAT1.MYFILE02
CALL bat\EZ390 %z_TraceMode% LINKLIB\REPRO        || GOTO WRONG
rem RUN REPRO TO UNLOAD FROM .VES TO .TF2
SET INFILE=%CICSPATH%\Z390CAT1.MYFILE02
SET OUTFILE=%CICSPATH%\MYFILE2F.TF2[RECFM=FT]
CALL bat\EZ390 %z_TraceMode% LINKLIB\REPRO        || GOTO WRONG

rem
rem BUILD THE FIXED RRDS
SET INFILE=%CICSPATH%\MYFILE6F.TF1
SET OUTFILE=%CICSPATH%\Z390CAT1.MYFILE06
CALL bat\EZ390 %z_TraceMode% LINKLIB\REPRO        || GOTO WRONG
rem RUN REPRO TO UNLOAD FROM .VES TO .TF2
SET INFILE=%CICSPATH%\Z390CAT1.MYFILE06
SET OUTFILE=%CICSPATH%\MYFILE6F.TF2
CALL bat\EZ390 %z_TraceMode% LINKLIB\REPRO        || GOTO WRONG

rem
rem BUILD THE VARIABLE RRDS
SET INFILE=%CICSPATH%\MYFILE7V.TF1
SET OUTFILE=%CICSPATH%\Z390CAT1.MYFILE07
CALL bat\EZ390 %z_TraceMode% LINKLIB\REPRO        || GOTO WRONG
rem RUN REPRO TO UNLOAD FROM .VES TO .TF2
SET INFILE=%CICSPATH%\Z390CAT1.MYFILE07
SET OUTFILE=%CICSPATH%\MYFILE7V.TF2
CALL bat\EZ390 %z_TraceMode% LINKLIB\REPRO        || GOTO WRONG

rem
rem BUILD THE FIXED KSDS
SET INFILE=%CICSPATH%\MYFILE8F.TXT[RECFM=FT]
SET OUTFILE=%CICSPATH%\Z390CAT1.MYFILE08
CALL bat\EZ390 %z_TraceMode% LINKLIB\REPRO        || GOTO WRONG
rem RUN REPRO TO UNLOAD FROM .VES TO .TF2
SET INFILE=%CICSPATH%\Z390CAT1.MYFILE08
SET OUTFILE=%CICSPATH%\MYFILE8F.TF2[RECFM=FT]
CALL bat\EZ390 %z_TraceMode% LINKLIB\REPRO        || GOTO WRONG

rem
rem BUILD THE VARIABLE KSDS
SET INFILE=%CICSPATH%\MYFILE9V.TXT[RECFM=VT]
SET OUTFILE=%CICSPATH%\Z390CAT1.MYFILE09
CALL bat\EZ390 %z_TraceMode% LINKLIB\REPRO        || GOTO WRONG
rem RUN REPRO TO UNLOAD FROM .VES TO .TF2
SET INFILE=%CICSPATH%\Z390CAT1.MYFILE09
SET OUTFILE=%CICSPATH%\MYFILE9V.TF2[RECFM=VT]
CALL bat\EZ390 %z_TraceMode% LINKLIB\REPRO        || GOTO WRONG

rem
rem BUILD THE FIXED ESDS'S MYWORD01 AND MYWORD02
SET INFILE=%CICSPATH%\MYWORD1F.TXT[RECFM=FT]
SET OUTFILE=%CICSPATH%\Z390CAT1.MYWORD01
CALL bat\EZ390 %z_TraceMode% LINKLIB\REPRO        || GOTO WRONG
rem RUN REPRO TO UNLOAD FROM .VES TO .TF2
SET INFILE=%CICSPATH%\Z390CAT1.MYWORD01
SET OUTFILE=%CICSPATH%\MYWORD1F.TF2[RECFM=FT]
CALL bat\EZ390 %z_TraceMode% LINKLIB\REPRO        || GOTO WRONG

rem
rem RUN REPRO TO BUILD AIX03
SET INFILE=%CICSPATH%\Z390CAT1.MYWORD01
SET OUTFILE=%CICSPATH%\Z390CAT1.MYAIX03
CALL bat\EZ390 %z_TraceMode% LINKLIB\REPRO        || GOTO WRONG
rem RUN REPRO TO DUMP AIX03 VIA PATH
SET INFILE=%CICSPATH%\Z390CAT1.AIXESDS
SET OUTFILE=%CICSPATH%\MYAIX03.TXT
CALL bat\EZ390 %z_TraceMode% LINKLIB\REPRO        || GOTO WRONG
rem
SET INFILE=%CICSPATH%\MYWORD2F.TXT[RECFM=FT]
SET OUTFILE=%CICSPATH%\Z390CAT1.MYWORD02
CALL bat\EZ390 %z_TraceMode% LINKLIB\REPRO        || GOTO WRONG
rem RUN REPRO TO UNLOAD FROM .VES TO .TF2
SET INFILE=%CICSPATH%\Z390CAT1.MYWORD02
SET OUTFILE=%CICSPATH%\MYWORD2F.TF2[RECFM=FT]
CALL bat\EZ390 %z_TraceMode% LINKLIB\REPRO        || GOTO WRONG

rem
rem BUILD THE FIXED KSDS MYKSDS01
SET INFILE=%CICSPATH%\MYKSDS1F.TXT[RECFM=FT]
SET OUTFILE=%CICSPATH%\Z390CAT1.MYKSDS01
CALL bat\EZ390 %z_TraceMode% LINKLIB\REPRO        || GOTO WRONG
rem RUN REPRO TO UNLOAD FROM .VES TO .TF2
SET INFILE=%CICSPATH%\Z390CAT1.MYKSDS01
SET OUTFILE=%CICSPATH%\MYKSDS1F.TF2[RECFM=FT]
CALL bat\EZ390 %z_TraceMode% LINKLIB\REPRO        || GOTO WRONG
rem RUN REPRO TO BUILD AIX01
SET INFILE=%CICSPATH%\Z390CAT1.MYKSDS01
SET OUTFILE=%CICSPATH%\Z390CAT1.MYAIX01
CALL bat\EZ390 %z_TraceMode% LINKLIB\REPRO        || GOTO WRONG
rem RUN REPRO TO BUILD AIX02
SET INFILE=%CICSPATH%\Z390CAT1.MYKSDS01
SET OUTFILE=%CICSPATH%\Z390CAT1.MYAIX02
CALL bat\EZ390 %z_TraceMode% LINKLIB\REPRO        || GOTO WRONG
rem RUN REPRO TO DUMP AIX01 VIA PATH
SET INFILE=%CICSPATH%\Z390CAT1.AIXSURN
SET OUTFILE=%CICSPATH%\MYAIX01.TXT
CALL bat\EZ390 %z_TraceMode% LINKLIB\REPRO        || GOTO WRONG
rem RUN REPRO TO DUMP AIX02 VIA PATH
SET INFILE=%CICSPATH%\Z390CAT1.AIXNAME
SET OUTFILE=%CICSPATH%\MYAIX02.TXT
CALL bat\EZ390 %z_TraceMode% LINKLIB\REPRO        || GOTO WRONG
GOTO return

:WRONG_ASM
echo %0 error while building program %PROGRAM% - see log and listings for details
set z_ReturnCode=8
goto return
:WRONG
echo %0 error while REPRO-ing %INFILE% to %OUTFILE% - see log and listings for details
set z_ReturnCode=8

:return
popd
rem ----- Lvl(%z_NestLevel%)  End %0 %1 %2 %3 %4 %5 %6 %7 %8 %9
exit /b %z_ReturnCode%
