#!/bin/bash

# relver: read version from version.txt file and verify git tag

cd $(dirname $0)
cd ..

VERSION_FILE="version.txt"

if [ ! -f "$VERSION_FILE" ]; then
    echo "Error: version.txt file not found"
    exit 1
fi

VER=$(cat "$VERSION_FILE")

# Verify git tag exists if in git repo
if git rev-parse --is-inside-work-tree > /dev/null 2>&1; then
    if ! git tag | grep -q "v${VER}"; then
        echo "Warning: Git tag v${VER} not found"
        if [[ "$1" != "FORCE" ]]; then
            echo "Add FORCE parameter to ignore missing git tag"
            exit 1
        fi
    fi
fi

echo "version=${VER}" > z390.properties
cat z390.properties
