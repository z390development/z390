@echo off
REM create KSF1ADDR alternate index
rem %0 in z390\vsam1\test\bat; switch to z390
pushd %~dps0..\..\..

SET VSAMPATH=vsam1\test
SET ZVSAM=ZVSAM(1)
SET TRACE=%
IF /I "%1" == "traceall" (
    SET TRACE=TRACEALL
    shift /1
)

SET RC=0

REM BUILD AIX KSF1ADDR
SET INFILE=%VSAMPATH%\TESTCAT.KSF1NAME
SET OUTFILE=%VSAMPATH%\TESTCAT.KSF1ADDR
CALL bat\EXEC linklib\REPRO %1 %2 %3 %4 %5 %ZVSAM% %TRACE%
SET RC=%ERRORLEVEL%
IF %RC% NEQ 0 (
    SET ERRMSG=ERROR IN BUILDAIX KSF1ADDR
	GOTO errmsg
)
REM READ KSDS ADDRLIST PATH AND COMPARE RECORDS
SET QFILE=%VSAMPATH%\KSF1ADDR.TF1
SET VFILE=%VSAMPATH%\TESTCAT.ADDRLIST
CALL bat\ASMLG %VSAMPATH%\KSF1COMP %1 %2 %3 %4 %5 %ZVSAM% %TRACE%
SET RC=%ERRORLEVEL%
IF %RC% NEQ 0 (
    SET ERRMSG=ERROR IN READ ADDRLIST PATH RECS BY KEY
	GOTO errmsg
)

:return
popd
exit /b %RC%
:errmsg
echo ERROR: %ERRMSG%
SET RC=8
GOTO return

