@echo off
setlocal
pushd %~dp0
cd..
cd..

REM REBUILD sort\SORT
CALL bat\ASML sort\SORT %1 %2 %3 %4 %5 || goto error
REM TESTSORT = SORT ASCII 21 RECORD SIMPLE SORT

SET SORTIN=sort\TESTSORT.IN[RECFM=FT,LRECL=80]
SET SORTOUT=sort\TESTSORT.OUT[RECMF=FT]
SET SYSIN=sort\TESTSORT.INI
erase sort\TESTSORT.OUT
CALL bat\EXEC sort\SORT STATS %1 %2 %3 %4 %5
IF %ERRORLEVEL% NEQ 0 (
    set rc=%ERRORLEVEL%
    if errorlevel 1 copy sort\SORT.STA sort\SORT1.STA
    set ERRORLEVEL=%rc%
    goto error
)

REM TESTSRT1/2 TEST ALL KEY TYPES WITH 21 20 byte records
SET SYSUT2=sort\TESTSRT1.IN
CALL bat\ASMLG sort\TESTSRT1 %1 %2 %3 %4 %5
if %ERRORLEVEL% NEQ 0 (
    echo ERROR IN TESTSRT1 21 RECORD GEN
    goto error
)

SET SORTIN=sort\TESTSRT1.IN[RECFM=F,LRECL=20]
SET SORTOUT=sort\TESTSRT1.OUT
SET SYSIN=sort\TESTSRT1.INI
erase sort\TESTSRT1.OUT
CALL bat\EXEC sort\SORT STATS %1 %2 %3 %4 %5
if %ERRORLEVEL% NEQ 0 (
    echo ERROR IN SORT2 FOR TESTSRT1.OUT
    goto error
)

copy sort\SORT.STA sort\SORT2.STA
SET SYSUT1=sort\TESTSRT1.OUT
CALL bat\ASMLG sort\TESTSRT2 %1 %2 %3 %4 %5
if %ERRORLEVEL% NEQ 0 (
    echo ERROR IN TESTSRT2 VERIFY TESTSRT1.OUT
    goto error
)

REM TESTSRT3/4 TEST SORTING 100000 USING 1000 REC TABLE
SET SYSUT2=sort\TESTSRT3.IN
CALL bat\ASMLG sort\TESTSRT3 PARM(100000) %1 %2 %3 %4 %5
if %ERRORLEVEL% NEQ 0 (
    echo ERROR IN TESTSRT3 100000 RECORD GEN
    goto error
)

SET SORTIN=sort\TESTSRT3.IN[RECFM=F,LRECL=4]
SET SORTOUT=sort\TESTSRT3.OUT
SET SYSIN=sort\TESTSRT3.INI
erase sort\TESTSRT3.OUT
CALL bat\EXEC sort\SORT STATS PARM(1000) %1 %2 %3 %4 %5
if %ERRORLEVEL% NEQ 0 (
    echo ERROR IN SORT FOR TESTSRT3.OUT
    goto error
)

copy sort\SORT.STA sort\SORT3.STA
SET SYSUT1=sort\TESTSRT3.OUT
CALL bat\ASMLG sort\TESTSRT4 PARM(100000) %1 %2 %3 %4 %5
if %ERRORLEVEL% NEQ 0 (
    echo ERROR IN TESTSRT4 VERIFY TESTSRT3.OUT
    goto error
)

goto:eof

:error
echo.RUNSORT  ERROR: Encountered RC %ERRORLEVEL% - exiting
exit /b %ERRORLEVEL%
